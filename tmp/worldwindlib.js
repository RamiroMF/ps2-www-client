/**
 * @license almond 0.3.0 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*
 * Copyright (C) 2014 United States Government as represented by the Administrator of the
 * National Aeronautics and Space Administration. All Rights Reserved.
 */

/*
 * Copyright (C) 2015 United States Government as represented by the Administrator of the
 * National Aeronautics and Space Administration. All Rights Reserved.
 */

/*
 * @license
 * Copyright 2000, Silicon Graphics, Inc. All Rights Reserved.
 * Copyright 2014, Google Inc. All Rights Reserved.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to
 * deal in the Software without restriction, including without limitation the
 * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
 * sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice including the dates of first publication and
 * either this permission notice or a reference to http://oss.sgi.com/projects/FreeB/
 * shall be included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
 * SILICON GRAPHICS, INC. BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
 * IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 *
 * Original Code. The Original Code is: OpenGL Sample Implementation,
 * Version 1.2.1, released January 26, 2000, developed by Silicon Graphics,
 * Inc. The Original Code is Copyright (c) 1991-2000 Silicon Graphics, Inc.
 * Copyright in any portions created by third parties is as indicated
 * elsewhere herein. All Rights Reserved.
 */

(function(e,t){typeof define=="function"&&define.amd?define([],t):e.WorldWind=t()})(this,function(){var e,t,n;(function(r){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(e,t){return function(){var n=p.call(arguments,0);return typeof n[0]!="string"&&n.length===1&&n.push(null),s.apply(r,n.concat([e,t]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(e){if(v(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!v(a,e)&&!v(c,e))throw new Error("No "+e);return a[e]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},i=function(e,t,n,i){var s,l,h,p,d,m=[],y=typeof n,E;i=i||e;if(y==="undefined"||y==="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(d=0;d<t.length;d+=1){p=o(t[d],i),l=p.f;if(l==="require")m[d]=u.require(e);else if(l==="exports")m[d]=u.exports(e),E=!0;else if(l==="module")s=m[d]=u.module(e);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=n?n.apply(a[e],m):undefined;if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!E)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){if(typeof e=="string")return u[e]?u[e](t):w(o(e,t).f);if(!e.splice){l=e,l.deps&&s(l.deps,l.callback);if(!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s},s.config=function(e){return s(e)},e._defined=a,n=function(e,t,n){t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}})(),n("../tools/almond",function(){}),n("error/AbstractError",[],function(){"use strict";var e=function(e,t){this.name=e,this.message=t};return e.prototype.toString=function(){var e=this.name+": "+this.message;return this.stack&&(e+="\n"+this.stack.toString()),e},e}),n("geom/Angle",[],function(){"use strict";var e={DEGREES_TO_RADIANS:Math.PI/180,RADIANS_TO_DEGREES:180/Math.PI,TWO_PI:2*Math.PI,HALF_PI:Math.PI/2,normalizedDegrees:function(e){var t=e%360;return t>180?t-360:t<-180?360+t:t},normalizedDegreesLatitude:function(e){var t=e%180;return t>90?180-t:t<-90?-180-t:t},normalizedDegreesLongitude:function(e){var t=e%360;return t>180?t-360:t<-180?360+t:t},normalizedRadians:function(e){var t=e%this.TWO_PI;return t>Math.PI?t-this.TWO_PI:t<-Math.PI?this.TWO_PI+t:t},normalizedRadiansLatitude:function(e){var t=e%Math.PI;return t>this.HALF_PI?Math.PI-t:t<-this.HALF_PI?-Math.PI-t:t},normalizedRadiansLongitude:function(e){var t=e%this.TWO_PI;return t>Math.PI?t-this.TWO_PI:t<-Math.PI?this.TWO_PI+t:t},isValidLatitude:function(e){return e>=-90&&e<=90},isValidLongitude:function(e){return e>=-180&&e<=180},toString:function(e){return e.toString()+"°"},toDecimalDegreesString:function(e){return e.toString()+"°"},toDMSString:function(e){var t,n,r,i,s;return t=e<0?-1:1,n=t*e,r=Math.floor(n),n=(n-r)*60,i=Math.floor(n),n=(n-i)*60,s=Math.round(n),s==60&&(i++,s=0),i==60&&(r++,i=0),(t==-1?"-":"")+r+"°"+" "+i+"’"+" "+s+"”"},toDMString:function(e){var t,n,r,i,s,o;return t=e<0?-1:1,n=t*e,r=Math.floor(n),n=(n-r)*60,i=Math.floor(n),n=(n-i)*60,s=Math.round(n),s==60&&(i++,s=0),i==60&&(r++,i=0),o=s==0?i:i+s/60,(t==-1?"-":"")+r+"°"+" "+o+"’"}};return e}),n("error/ArgumentError",["../error/AbstractError"],function(e){"use strict";var t=function(t){e.call(this,"ArgumentError",t);var n;try{throw new Error}catch(r){n=r.stack}this.stack=n};return t.prototype=Object.create(e.prototype),t}),n("util/Logger",[],function(){"use strict";var e={LEVEL_NONE:0,LEVEL_SEVERE:1,LEVEL_WARNING:2,LEVEL_INFO:3,setLoggingLevel:function(e){t=e},getLoggingLevel:function(){return t},log:function(n,r){r&&n>0&&n<=t&&(n===e.LEVEL_SEVERE?console.error(r):n===e.LEVEL_WARNING?console.warn(r):n===e.LEVEL_INFO?console.info(r):console.log(r))},makeMessage:function(e,t,n){var r=this.messageTable[n]?this.messageTable[n]:n;return e+"."+t+": "+r},logMessage:function(e,t,n,r){var i=this.makeMessage(t,n,r);return this.log(e,i),i},messageTable:{abstractInvocation:"The function called is abstract and must be overridden in a subclass.",indexOutOfRange:"The specified index is out of range.",invalidHeight:"The specified height is zero or negative.",invalidWidth:"The specified width is zero or negative.",invalidSize:"The specified size is zero or negative.",missingAltitudeMode:"The specified altitude mode is null or undefined.",missingAttributeName:"The specified DBase attribute file name is null or undefined.",missingArray:"The specified array is null, undefined or of insufficient length.",missingBoundaries:"The specified boundaries array is null or undefined.",missingBuffer:"The specified buffer descriptor is null or undefined.",missingColor:"The specified color is null or undefined.",missingDc:"The specified draw context is null or undefined.",missingEntry:"The specified entry is null or undefined.",missingFont:"The specified font is null or undefined.",missingFrustum:"The specified frustum is null or undefined.",missingGlContext:"The specified WebGL rendering context is null or undefined.",missingGlobe:"The specified globe is null or undefined.",missingImage:"The specified image is null or undefined.",missingIndices:"The specified indices array is null or undefined.",missingKey:"The specified key is null or undefined.",missingLevel:"The specified level is null or undefined.",missingLine:"The specified line is null or undefined.",missingList:"The specified list is null or undefined.",missingListener:"The specified listener is null or undefined",missingLocation:"The specified location is null or undefined.",missingMatrix:"The specified matrix is null or undefined.",missingNavigatorState:"The specified navigator state is null or undefined.",missingOffset:"The specified offset is null or undefined.",missingPath:"The specified path is null or undefined.",missingPlacename:"The specified place name is null or undefined.",missingPlane:"The specified plane is null or undefined.",missingPoint:"The specified point is null or undefined.",missingPoints:"The specified points array is null or undefined.",missingPosition:"The specified position is null or undefined.",missingPositions:"The specified positions array is null or undefined.",missingProgram:"The specified program is null or undefined.",missingProjection:"The specified projection is null or undefined.",missingRectangle:"The specified rectangle is null or undefined.",missingRenderable:"The specified renderable is null or undefined.",missingResource:"The specified resource is null or undefined.",missingResult:"The specified result variable is null or undefined.",missingResults:"The specified results array is null or undefined.",missingSector:"The specified sector is null or undefined.",missingShapeType:"The specified shape type is null or undefined.",missingSize:"The specified size is null or undefined.",missingText:"The specified text is null or undefined.",missingTexture:"The specified texture is null or undefined.",missingTile:"The specified tile is null or undefined.",missingType:"The specified type is null or undefined.",missingUrl:"The specified URL is null or undefined",missingVector:"The specified vector is null or undefined.",missingVertex:"The specified vertex is null or undefined.",missingViewport:"The specified viewport is null or undefined.",missingWorldWindow:"The specified World Window is null or undefined.",notYetImplemented:"This function is not yet implemented"}},t=1;return e}),n("util/Color",["../util/Logger"],function(e){"use strict";var t=function(e,t,n,r){this.red=e,this.green=t,this.blue=n,this.alpha=r};return t.WHITE=new t(1,1,1,1),t.BLACK=new t(0,0,0,1),t.RED=new t(1,0,0,1),t.GREEN=new t(0,1,0,1),t.BLUE=new t(0,0,1,1),t.CYAN=new t(0,1,1,1),t.YELLOW=new t(1,1,0,1),t.MAGENTA=new t(1,0,1,1),t.LIGHT_GRAY=new t(.75,.75,.75,1),t.MEDIUM_GRAY=new t(.5,.5,.5,1),t.DARK_GRAY=new t(.25,.25,.25,1),t.TRANSPARENT=new t(0,0,0,0),t.prototype.set=function(e,t,n,r){return this.red=e,this.green=t,this.blue=n,this.alpha=r,this},t.prototype.copy=function(t){if(!t)throw new ArgumentError(e.logMessage(e.LEVEL_SEVERE,"Color","copy","missingColor"));return this.red=t.red,this.green=t.green,this.blue=t.blue,this.alpha=t.alpha,this},t.prototype.clone=function(){return new t(this.red,this.green,this.blue,this.alpha)},t.prototype.premultipliedComponents=function(e){var t=this.alpha;return e[0]=this.red*t,e[1]=this.green*t,e[2]=this.blue*t,e[3]=t,e},t.colorFromByteArray=function(e){return new t(e[0]/255,e[1]/255,e[2]/255,e[3]/255)},t.colorFromBytes=function(e,n,r,i){return new t(e/255,n/255,r/255,i/255)},t.prototype.nextColor=function(){var e=Math.round(this.red*255),t=Math.round(this.green*255),n=Math.round(this.blue*255);return e<255?this.red=(e+1)/255:t<255?(this.red=0,this.green=(t+1)/255):n<255?(this.red=0,this.green=0,this.blue=(n+1)/255):(this.red=1/255,this.green=0,this.blue=0),this},t.prototype.equals=function(e){var t=Math.round(this.red*255),n=Math.round(this.green*255),r=Math.round(this.blue*255),i=Math.round(this.alpha*255),s=Math.round(e.red*255),o=Math.round(e.green*255),u=Math.round(e.blue*255),a=Math.round(e.alpha*255);return t===s&&n===o&&r===u&&i===a},t.prototype.equalsBytes=function(e){var t=Math.round(this.red*255),n=Math.round(this.green*255),r=Math.round(this.blue*255),i=Math.round(this.alpha*255);return t===e[0]&&n===e[1]&&r===e[2]&&i===e[3]},t.prototype.toByteString=function(){var e=Math.round(this.red*255),t=Math.round(this.green*255),n=Math.round(this.blue*255),r=Math.round(this.alpha*255);return"("+e+","+t+","+n+","+r+")"},t.prototype.toHexString=function(e){var t=Math.ceil(this.red*255).toString(16),n=Math.ceil(this.green*255).toString(16),r=Math.ceil(this.blue*255).toString(16),i=Math.ceil(this.alpha*255).toString(16),s="#";return s+=t.length<2?"0"+t:t,s+=n.length<2?"0"+n:n,s+=r.length<2?"0"+r:r,e&&(s+=i.length<2?"0"+i:i),s},t}),n("shaders/GpuShader",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(n,r,i){if(r!==WebGLRenderingContext.VERTEX_SHADER&&r!==WebGLRenderingContext.FRAGMENT_SHADER)throw new e(t.logMessage(t.LEVEL_SEVERE,"GpuShader","constructor","The specified shader type is unrecognized."));if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"GpuShader","constructor","The specified shader source is null or undefined."));var s=n.createShader(r);if(!s)throw new e(t.logMessage(t.LEVEL_SEVERE,"GpuShader","constructor","Unable to create shader of type "+(r==WebGLRenderingContext.VERTEX_SHADER?"VERTEX_SHADER.":"FRAGMENT_SHADER.")));if(!this.compile(n,s,r,i)){var o=n.getShaderInfoLog(s);throw n.deleteShader(s),new e(t.logMessage(t.LEVEL_SEVERE,"GpuShader","constructor","Unable to compile shader: "+o))}this.shaderId=s};return n.prototype.compile=function(e,t,n,r){return e.shaderSource(t,r),e.compileShader(t),e.getShaderParameter(t,WebGLRenderingContext.COMPILE_STATUS)},n.prototype.dispose=function(e){this.shaderId&&(e.deleteShader(this.shaderId),delete this.shaderId)},n}),n("shaders/GpuProgram",["../error/ArgumentError","../util/Color","../shaders/GpuShader","../util/Logger"],function(e,t,n,r){"use strict";var i=function(t,i,s,o){if(!i||!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","constructor","The specified shader source is null or undefined."));var u,a,f;try{a=new n(t,WebGLRenderingContext.VERTEX_SHADER,i),f=new n(t,WebGLRenderingContext.FRAGMENT_SHADER,s)}catch(l){throw a&&a.dispose(t),f&&f.dispose(t),l}u=t.createProgram();if(!u)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","constructor","Unable to create shader program."));t.attachShader(u,a.shaderId),t.attachShader(u,f.shaderId);if(o)for(var c=0;c<o.length;c++)t.bindAttribLocation(u,c,o[c]);if(!this.link(t,u)){var h=t.getProgramInfoLog(u);throw t.detachShader(u,a.shaderId),t.detachShader(u,f.shaderId),t.deleteProgram(u),a.dispose(t),f.dispose(t),new e(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","constructor","Unable to link shader program: "+h))}this.attributeLocations={},this.uniformLocations={},this.programId=u,this.vertexShader=a,this.fragmentShader=f,this.size=i.length+s.length};return i.prototype.bind=function(e){e.useProgram(this.programId)},i.prototype.dispose=function(e){this.programId&&(this.vertexShader&&e.detachShader(this.programId,this.vertexShader.shaderId),this.fragmentShader&&e.detachShader(this.programId,this.fragmentShader.shaderId),e.deleteProgram(this.programId),delete this.programId),this.vertexShader&&(this.vertexShader.dispose(e),delete this.vertexShader),this.fragmentShader&&(this.fragmentShader.dispose(e),delete this.fragmentShader),this.attributeLocations={},this.uniformLocations={}},i.prototype.attributeLocation=function(t,n){if(!n||n.length==0)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","attributeLocation","The specified attribute name is null, undefined or empty."));var i=this.attributeLocations[n];return i||(i=t.getAttribLocation(this.programId,n),this.attributeLocations[n]=i),i},i.prototype.uniformLocation=function(t,n){if(!n||n.length==0)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","uniformLocation","The specified uniform name is null, undefined or empty."));var i=this.uniformLocations[n];return i||(i=t.getUniformLocation(this.programId,n),this.uniformLocations[n]=i),i},i.prototype.link=function(e,t){return e.linkProgram(t),e.getProgramParameter(t,WebGLRenderingContext.LINK_STATUS)},i.loadUniformMatrix=function(t,n,i){if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","loadUniformMatrix","missingMatrix"));t.uniformMatrix4fv(i,!1,n.columnMajorComponents(new Float32Array(16)))},i.loadUniformColor=function(t,n,i){if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"GpuProgram","loadUniformColor","missingColor"));var s=n.premultipliedComponents(new Float32Array(4));t.uniform4f(i,s[0],s[1],s[2],s[3])},i.loadUniformColorComponents=function(e,t,n,r,i,s){e.uniform4f(s,t*i,n*i,r*i,i)},i.loadUniformFloat=function(e,t,n){e.uniform1f(n,t)},i.loadUniformInteger=function(e,t,n){e.uniform1i(n,t)},i.loadUniformBoolean=function(e,t,n){e.uniform1i(n,t)},i}),n("shaders/BasicProgram",["../error/ArgumentError","../util/Color","../shaders/GpuProgram","../util/Logger"],function(e,t,n,r){"use strict";var i=function(e){var t="attribute vec4 vertexPoint;\nuniform mat4 mvpMatrix;\nvoid main() {gl_Position = mvpMatrix * vertexPoint;}",r="precision mediump float;\nuniform vec4 color;\nvoid main() {gl_FragColor = color;}";n.call(this,e,t,r),this.vertexPointLocation=this.attributeLocation(e,"vertexPoint"),this.mvpMatrixLocation=this.uniformLocation(e,"mvpMatrix"),this.colorLocation=this.uniformLocation(e,"color")};return i.key="WorldWindGpuBasicProgram",i.prototype=Object.create(n.prototype),i.prototype.loadModelviewProjection=function(t,i){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"BasicProgram","loadModelviewProjection","missingMatrix"));n.loadUniformMatrix(t,i,this.mvpMatrixLocation)},i.prototype.loadColor=function(t,i){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"BasicProgram","loadColor","missingColor"));n.loadUniformColor(t,i,this.colorLocation)},i.prototype.loadColorComponents=function(e,t,r,i,s){n.loadUniformColorComponents(e,t,r,i,s,this.colorLocation)},i}),n("shaders/BasicTextureProgram",["../error/ArgumentError","../util/Color","../shaders/GpuProgram","../util/Logger"],function(e,t,n,r){"use strict";var i=function(e){var t="attribute vec4 vertexPoint;\nattribute vec4 vertexTexCoord;\nattribute vec4 normalVector;\nuniform mat4 mvpMatrix;\nuniform mat4 mvInverseMatrix;\nuniform mat4 texCoordMatrix;\nuniform bool applyLighting;\nvarying vec2 texCoord;\nvarying vec4 normal;\nvoid main() {gl_Position = mvpMatrix * vertexPoint;\ntexCoord = (texCoordMatrix * vertexTexCoord).st;\nif (applyLighting) {normal = mvInverseMatrix * normalVector;}\n}",r="precision mediump float;\nuniform float opacity;\nuniform vec4 color;\nuniform bool enableTexture;\nuniform bool modulateColor;\nuniform sampler2D textureSampler;\nuniform bool applyLighting;\nvarying vec2 texCoord;\nvarying vec4 normal;\nvoid main() {\nvec4 textureColor = texture2D(textureSampler, texCoord);\nfloat ambient = 0.15; vec4 lightDirection = vec4(0, 0, 1, 0);\nif (enableTexture && !modulateColor)\n    gl_FragColor = textureColor * color * opacity;\nelse if (enableTexture && modulateColor)\n    gl_FragColor = color * floor(textureColor.a + 0.5);\nelse\n    gl_FragColor = color * opacity;\nif (gl_FragColor.a == 0.0) {discard; return;}\nif (applyLighting) {\n    vec4 n = normal * (gl_FrontFacing ? 1.0 : -1.0);\n    gl_FragColor.rgb *= clamp(ambient + dot(lightDirection, n), 0.0, 1.0);\n}\n}",i=["vertexPoint","normalVector","vertexTexCoord"];n.call(this,e,t,r,i),this.vertexPointLocation=this.attributeLocation(e,"vertexPoint"),this.normalVectorLocation=this.attributeLocation(e,"normalVector"),this.vertexTexCoordLocation=this.attributeLocation(e,"vertexTexCoord"),this.mvpMatrixLocation=this.uniformLocation(e,"mvpMatrix"),this.mvInverseMatrixLocation=this.uniformLocation(e,"mvInverseMatrix"),this.colorLocation=this.uniformLocation(e,"color"),this.textureEnabledLocation=this.uniformLocation(e,"enableTexture"),this.modulateColorLocation=this.uniformLocation(e,"modulateColor"),this.textureUnitLocation=this.uniformLocation(e,"textureSampler"),this.textureMatrixLocation=this.uniformLocation(e,"texCoordMatrix"),this.opacityLocation=this.uniformLocation(e,"opacity"),this.applyLightingLocation=this.uniformLocation(e,"applyLighting")};return i.key="WorldWindGpuBasicTextureProgram",i.prototype=Object.create(n.prototype),i.prototype.loadModelviewInverse=function(t,i){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"BasicTextureProgram","loadModelviewInverse","missingMatrix"));n.loadUniformMatrix(t,i,this.mvInverseMatrixLocation)},i.prototype.loadModelviewProjection=function(t,i){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"BasicTextureProgram","loadModelviewProjection","missingMatrix"));n.loadUniformMatrix(t,i,this.mvpMatrixLocation)},i.prototype.loadColor=function(t,i){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"BasicTextureProgram","loadColor","missingColor"));n.loadUniformColor(t,i,this.colorLocation)},i.prototype.loadTextureEnabled=function(e,t){n.loadUniformInteger(e,t?1:0,this.textureEnabledLocation)},i.prototype.loadModulateColor=function(e,t){n.loadUniformInteger(e,t?1:0,this.modulateColorLocation)},i.prototype.loadTextureUnit=function(e,t){n.loadUniformInteger(e,t-WebGLRenderingContext.TEXTURE0,this.textureUnitLocation)},i.prototype.loadTextureMatrix=function(e,t){n.loadUniformMatrix(e,t,this.textureMatrixLocation)},i.prototype.loadOpacity=function(e,t){n.loadUniformFloat(e,t,this.opacityLocation)},i.prototype.loadApplyLighting=function(e,t){n.loadUniformInteger(e,t,this.applyLightingLocation)},i}),n("geom/Vec3",["../util/Logger","../error/ArgumentError"],function(e,t){"use strict";var n=function(t,n,r){this[0]=t,this[1]=n,this[2]=r};return n.prototype=new Float64Array(3),n.ZERO=new n(0,0,0),n.average=function(n,r){if(!n||n.length<1)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","average","missingArray"));if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","average","missingResult"));var i=n.length,s;r[0]=0,r[1]=0,r[2]=0;for(var o=0,u=n.length;o<u;o++)s=n[o],r[0]+=s[0]/i,r[1]+=s[1]/i,r[2]+=s[2]/i;return r},n.averageOfBuffer=function(n,r){if(!n||n.length<1)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","averageBuffer","missingArray"));if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","averageBuffer","missingResult"));var i=n.length/3;r[0]=0,r[1]=0,r[2]=0;for(var s=0;s<i;s++)r[0]+=n[s*3]/i,r[1]+=n[s*3+1]/i,r[2]+=n[s*3+2]/i;return r},n.areColinear=function(n,r,i){if(!n||!r||!i)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","areColinear","missingVector"));var s=r.subtract(n).normalize(),o=i.subtract(r).normalize();return Math.abs(s.dot(o))>.999},n.computeTriangleNormal=function(r,i,s){if(!r||!i||!s)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","areColinear","missingVector"));var o=(i[1]-r[1])*(s[2]-r[2])-(i[2]-r[2])*(s[1]-r[1]),u=(i[2]-r[2])*(s[0]-r[0])-(i[0]-r[0])*(s[2]-r[2]),a=(i[0]-r[0])*(s[1]-r[1])-(i[1]-r[1])*(s[0]-r[0]),f=o*o+u*u+a*a;return f===0?new n(o,u,a):(f=Math.sqrt(f),new n(o/f,u/f,a/f))},n.findThreeIndependentVertices=function(e,t){var r=t&&t>0?t:3;if(!e||e.length<3*r)return null;var i=new n(e[0],e[1],e[2]),s=null,o=null,u=r;for(;u<e.length;u+=r){s=new n(e[u],e[u+1],e[u+2]);if(s[0]!==i[0]||s[1]!==i[1]||s[2]!==i[2])break;s=null}if(!s)return null;for(u+=r;u<e.length;u+=r){o=new n(e[u],e[u+1],e[u+2]);if(!(o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]||o[0]===s[0]&&o[1]===s[1]&&o[2]===s[2])&&!n.areColinear(i,s,o))break;o=null}return o?[i,s,o]:null},n.computeBufferNormal=function(e,t){var r=n.findThreeIndependentVertices(e,t);return r?n.computeTriangleNormal(r[0],r[1],r[2]):null},n.prototype.set=function(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this},n.prototype.copy=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","copy","missingVector"));return this[0]=n[0],this[1]=n[1],this[2]=n[2],this},n.prototype.equals=function(e){return this[0]===e[0]&&this[1]===e[1]&&this[2]===e[2]},n.prototype.add=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","add","missingVector"));return this[0]+=n[0],this[1]+=n[1],this[2]+=n[2],this},n.prototype.subtract=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","subtract","missingVector"));return this[0]-=n[0],this[1]-=n[1],this[2]-=n[2],this},n.prototype.multiply=function(e){return this[0]*=e,this[1]*=e,this[2]*=e,this},n.prototype.divide=function(e){return this[0]/=e,this[1]/=e,this[2]/=e,this},n.prototype.multiplyByMatrix=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","multiplyByMatrix","missingMatrix"));var r=n[0]*this[0]+n[1]*this[1]+n[2]*this[2]+n[3],i=n[4]*this[0]+n[5]*this[1]+n[6]*this[2]+n[7],s=n[8]*this[0]+n[9]*this[1]+n[10]*this[2]+n[11],o=n[12]*this[0]+n[13]*this[1]+n[14]*this[2]+n[15];return this[0]=r/o,this[1]=i/o,this[2]=s/o,this},n.prototype.mix=function(n,r){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","mix","missingVector"));var i=1-r,s=r;return this[0]=this[0]*i+n[0]*s,this[1]=this[1]*i+n[1]*s,this[2]=this[2]*i+n[2]*s,this},n.prototype.negate=function(){return this[0]=-this[0],this[1]=-this[1],this[2]=-this[2],this},n.prototype.dot=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","dot","missingVector"));return this[0]*n[0]+this[1]*n[1]+this[2]*n[2]},n.prototype.cross=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","cross","missingVector"));var r=this[1]*n[2]-this[2]*n[1],i=this[2]*n[0]-this[0]*n[2],s=this[0]*n[1]-this[1]*n[0];return this[0]=r,this[1]=i,this[2]=s,this},n.prototype.magnitudeSquared=function(){return this.dot(this)},n.prototype.magnitude=function(){return Math.sqrt(this.magnitudeSquared())},n.prototype.normalize=function(){var e=this.magnitude(),t=1/e;return this[0]*=t,this[1]*=t,this[2]*=t,this},n.prototype.distanceToSquared=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","distanceToSquared","missingVector"));var r=this[0]-n[0],i=this[1]-n[1],s=this[2]-n[2];return r*r+i*i+s*s},n.prototype.distanceTo=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec3","distanceTo","missingVector"));return Math.sqrt(this.distanceToSquared(n))},n.prototype.swap=function(e){var t=this[0];return this[0]=e[0],e[0]=t,t=this[1],this[1]=e[1],e[1]=t,t=this[2],this[2]=e[2],e[2]=t,this},n.prototype.toString=function(){return"("+this[0]+", "+this[1]+", "+this[2]+")"},n}),n("geom/Line",["../error/ArgumentError","../util/Logger","../geom/Vec3"],function(e,t,n){"use strict";var r=function(n,r){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"Line","constructor","Origin is null or undefined."));if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Line","constructor","Direction is null or undefined."));this.origin=n,this.direction=r};return r.fromSegment=function(i,s){if(!i||!s)throw new e(t.logMessage(t.LEVEL_SEVERE,"Line","fromSegment","missingPoint"));var o=new n(i[0],i[1],i[2]),u=new n(s[0]-i[0],s[1]-i[1],s[2]-i[2]);return new r(o,u)},r.prototype.pointAt=function(n,r){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Line","pointAt","missingResult."));return r[0]=this.origin[0]+this.direction[0]*n,r[1]=this.origin[1]+this.direction[1]*n,r[2]=this.origin[2]+this.direction[2]*n,r},r}),n("geom/Plane",["../error/ArgumentError","../geom/Line","../util/Logger","../geom/Vec3"],function(e,t,n,r){"use strict";var i=function(e,t,n,i){this.normal=new r(e,t,n),this.distance=i};return i.fromPoints=function(t,s,o){if(!t||!s||!o)throw new e(n.logMessage(n.LEVEL_SEVERE,"Plane","fromPoints","missingVector"));var u=new r(s[0],s[1],s[2]);u.subtract(t);var a=new r(o[0],o[1],o[2]);a.subtract(t),u.cross(a),u.normalize();var f=-u.dot(t);return new i(u[0],u[1],u[2],f)},i.prototype.dot=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Plane","dot","missingVector"));return this.normal.dot(t)+this.distance},i.prototype.distanceToPoint=function(e){return this.dot(e)},i.prototype.transformByMatrix=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Plane","transformByMatrix","missingMatrix"));var r=t[0]*this.normal[0]+t[1]*this.normal[1]+t[2]*this.normal[2]+t[3]*this.distance,i=t[4]*this.normal[0]+t[5]*this.normal[1]+t[6]*this.normal[2]+t[7]*this.distance,s=t[8]*this.normal[0]+t[9]*this.normal[1]+t[10]*this.normal[2]+t[11]*this.distance,o=t[12]*this.normal[0]+t[13]*this.normal[1]+t[14]*this.normal[2]+t[15]*this.distance;return this.normal[0]=r,this.normal[1]=i,this.normal[2]=s,this.distance=o,this},i.prototype.normalize=function(){var e=this.normal.magnitude();return e===0?this:(this.normal.divide(e),this.distance/=e,this)},i.prototype.intersectsSegment=function(e,t){var n=this.dot(e),r=this.dot(t);return n*r<=0},i.prototype.intersectsSegmentAt=function(e,t,n){var r=this.dot(e),i=this.dot(t);if(r===0&&i===0)return n[0]=e[0],n[1]=e[1],n[2]=e[2],!0;if(r===i)return!1;var s=-r/(i-r),o=1-s;return n[0]=s*e[0]+o*t[0],n[1]=s*e[1]+o*t[1],n[2]=s*e[2]+o*t[2],r*i<=0},i.prototype.onSameSide=function(t,r){if(!t||!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"Plane","onSameSide","missingPoint"));var i=this.distanceToPoint(t),s=this.distanceToPoint(r);return i<0&&s<0?-1:i>0&&s>0?1:0},i.prototype.clip=function(i,s){if(!i||!s)throw new e(n.logMessage(n.LEVEL_SEVERE,"Plane","clip","missingPoint"));if(i.equals(s))return null;var o=t.fromSegment(i,s),u=this.normal.dot(o.direction),a,f,l;return u===0?(a=this.dot(o.origin),a===0?[i,s]:null):(f=-this.dot(o.origin)/u,f<0||f>1?null:(l=o.pointAt(f,new r(0,0,0)),u>0?[l,s]:[i,l]))},i}),n("geom/Rectangle",["../util/Logger"],function(e){"use strict";var t=function(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r};return t.prototype.set=function(e,t,n,r){this.x=e,this.y=t,this.width=n,this.height=r},t.prototype.getMinX=function(){return this.x},t.prototype.getMinY=function(){return this.y},t.prototype.getMaxX=function(){return this.x+this.width},t.prototype.getMaxY=function(){return this.y+this.height},t.prototype.containsPoint=function(e){return e[0]>=this.x&&e[0]<=this.x+this.width&&e[1]>=this.y&&e[1]<=this.y+this.height},t.prototype.intersects=function(e){return e.x+e.width<this.x?!1:e.x>this.x+this.width?!1:e.y+e.height<this.y?!1:e.y>this.y+this.height?!1:!0},t.prototype.intersectsRectangles=function(e){if(e)for(var t=0;t<e.length;t++)if(this.intersects(e[t]))return!0;return!1},t.prototype.toString=function(){return this.x+", "+this.y+", "+this.width+", "+this.height},t}),n("util/WWMath",["../geom/Angle","../error/ArgumentError","../geom/Line","../util/Logger","../geom/Rectangle","../geom/Vec3"],function(e,t,n,r,i,s){"use strict";var o={clamp:function(e,t,n){return e<t?t:e>n?n:e},interpolate:function(e,t,n){return(1-e)*t+e*n},cbrt:function(e){return typeof Math.cbrt=="function"?Math.cbrt(e):Math.pow(e,1/3)},computeEllipsoidalGlobeIntersection:function(e,n,i,s){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeEllipsoidalGlobeIntersection","missingLine"));if(!s)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeEllipsoidalGlobeIntersection","missingResult"));var o=e.direction[0],u=e.direction[1],a=e.direction[2],f=e.origin[0],l=e.origin[1],c=e.origin[2],h=n/i,p=h*h,d=n*n,v=o*o+p*u*u+a*a,m=2*(f*o+p*l*u+c*a),g=f*f+p*l*l+c*c-d,y=m*m-4*v*g,b;return y<0?!1:(b=(-m-Math.sqrt(y))/(2*v),s[0]=f+o*b,s[1]=l+u*b,s[2]=c+a*b,!0)},computeTriangleIntersection:function(e,n,i,s,o){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriangleIntersection","missingLine"));if(!n||!i||!s)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriangleIntersection","missingVertex"));if(!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriangleIntersection","missingResult"));var u=e.direction[0],a=e.direction[1],f=e.direction[2],l=e.origin[0],c=e.origin[1],h=e.origin[2],p=1e-5,d=i[0]-n[0],v=i[1]-n[1],m=i[2]-n[2],g=s[0]-n[0],y=s[1]-n[1],b=s[2]-n[2],w=a*b-f*y,E=f*g-u*b,S=u*y-a*g,x=d*w+v*E+m*S;if(x>-p&&x<p)return!1;var T=1/x,N=l-n[0],C=c-n[1],k=h-n[2],L=T*(N*w+C*E+k*S);if(L<-p||L>1+p)return!1;var A=C*m-k*v,O=k*d-N*m,M=N*v-C*d,_=T*(u*A+a*O+f*M);if(_<-p||L+_>1+p)return!1;var D=T*(g*A+y*O+b*M);return D<0?!1:(o[0]=l+u*D,o[1]=c+a*D,o[2]=h+f*D,!0)},computeTriStripIntersections:function(e,n,i,o){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriStripIntersections","missingLine"));if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriStripIntersections","missingPoints"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriStripIntersections","missingIndices"));if(!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","computeTriStripIntersections","missingResults"));var u=e.direction[0],a=e.direction[1],f=e.direction[2],l=e.origin[0],c=e.origin[1],h=e.origin[2],p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z=1e-5;U=3*i[0],m=n[U++],g=n[U++],y=n[U],U=3*i[1],b=n[U++],w=n[U++],E=n[U];for(var W=2,X=i.length;W<X;W++){p=m,d=g,v=y,m=b,g=w,y=E,U=3*i[W],b=n[U++],w=n[U++],E=n[U],S=m-p,x=g-d,T=y-v,N=b-p,C=w-d,k=E-v,L=a*k-f*C,A=f*N-u*k,O=u*C-a*N,q=S*L+x*A+T*O;if(q>-z&&q<z)continue;R=1/q,M=l-p,_=c-d,D=h-v,j=R*(M*L+_*A+D*O);if(j<-z||j>1+z)continue;P=_*T-D*x,H=D*S-M*T,B=M*x-_*S,F=R*(u*P+a*H+f*B);if(F<-z||j+F>1+z)continue;I=R*(N*P+C*H+k*B),I>=0&&o.push(new s(l+u*I,c+a*I,h+f*I))}},fabs:function(e){return e>=0?e:-e},fmod:function(e,t){return t===0?0:e-Math.floor(e/t)*t},fract:function(e){return e-Math.floor(e)},mod:function(e,t){return(e%t+t)%t},max:function(e,t){return e>t?e:t},localCoordinateAxesAtPoint:function(e,n,i,s,o){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","localCoordinateAxesAtPoint","missingVector"));if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","localCoordinateAxesAtPoint","missingGlobe"));if(!i||!s||!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","localCoordinateAxesAtPoint","missingResult"));var u=e[0],a=e[1],f=e[2];n.surfaceNormalAtPoint(u,a,f,o),n.northTangentAtPoint(u,a,f,s),i.set(s[0],s[1],s[2]),i.cross(o),i.normalize(),s.set(o[0],o[1],o[2]),s.cross(i),s.normalize()},horizonDistanceForGlobeRadius:function(e,n){if(e<0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","horizontalDistanceForGlobeRadius","The specified globe radius is negative."));return e>0&&n>0?Math.sqrt(n*(2*e+n)):0},perspectiveNearDistanceForFarDistance:function(e,n,i){if(e<0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistanceForFarDistance","The specified distance is negative."));if(n<0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistanceForFarDistance","The specified resolution is negative."));if(i<1)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistanceForFarDistance","The specified depth bits is negative."));var s=(1<<i)-1;return e/(s/(1-n/e)-s+1)},perspectiveNearDistance:function(e,n,i){if(e<=0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistance","invalidWidth"));if(n<=0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistance","invalidHeight"));if(i<0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveNearDistance","The specified distance is negative."));var s=n/e;return 2*i/Math.sqrt(s*s+5)},perspectiveFrustumRectangle:function(e,n,s){if(e<=0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveFrustumRectangle","invalidWidth"));if(n<=0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveFrustumRectangle","invalidHeight"));if(s<0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectiveFrustumRectangle","The specified distance is negative."));var o=s,u=s*n/e;return new i(-o/2,-u/2,o,u)},perspectivePixelSize:function(e,n,i){if(e<=0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectivePixelSize","invalidWidth"));if(n<=0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectivePixelSize","invalidHeight"));if(i<0)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","perspectivePixelSize","The specified distance is negative."));var s=o.perspectiveFrustumRectangle(e,n,i).height;return s/n},boundingRectForUnitQuad:function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"WWMath","boundingRectForUnitQuad","missingMatrix"));var n=e,s=n[3],o=n[7],u=n[0]+n[3],a=n[4]+n[7],f=n[1]+n[3],l=n[5]+n[7],c=n[0]+n[1]+n[3],h=n[4]+n[5]+n[7],p=Math.min(Math.min(s,u),Math.min(f,c)),d=Math.max(Math.max(s,u),Math.max(f,c)),v=Math.min(Math.min(o,a),Math.min(l,h)),m=Math.max(Math.max(o,a),Math.max(l,h));return new i(p,v,d-p,m-v)},isPowerOfTwo:function(e){return e!=0&&(e&e-1)===0},signum:function(e){return e>0?1:e<0?-1:0},gudermannianInverse:function(t){return Math.log(Math.tan(Math.PI/4+t*e.DEGREES_TO_RADIANS/2))/Math.PI}};return o}),n("geom/Location",["../geom/Angle","../error/ArgumentError","../util/Logger","../geom/Plane","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s){"use strict";var o=function(e,t){this.latitude=e,this.longitude=t};return o.ZERO=new o(0,0),o.fromRadians=function(t,n){return new o(t*e.RADIANS_TO_DEGREES,n*e.RADIANS_TO_DEGREES)},o.prototype.copy=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","copy","missingLocation"));return this.latitude=e.latitude,this.longitude=e.longitude,this},o.prototype.set=function(e,t){return this.latitude=e,this.longitude=t,this},o.prototype.equals=function(e){return e&&e.latitude===this.latitude&&e.longitude===this.longitude},o.interpolateAlongPath=function(e,r,i,s,o){if(!i||!s)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","interpolateAlongPath","missingLocation"));if(!o)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","interpolateAlongPath","missingResult"));return e===WorldWind.GREAT_CIRCLE?this.interpolateGreatCircle(r,i,s,o):e&&e===WorldWind.RHUMB_LINE?this.interpolateRhumb(r,i,s,o):this.interpolateLinear(r,i,s,o)},o.interpolateGreatCircle=function(e,r,i,o){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","interpolateGreatCircle","missingLocation"));if(!o)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","interpolateGreatCircle","missingResult"));if(r.equals(i))return o.latitude=r.latitude,o.longitude=r.longitude,o;var u=s.clamp(e,0,1),a=this.greatCircleAzimuth(r,i),f=this.greatCircleDistance(r,i);return this.greatCircleLocation(r,a,u*f,o)},o.greatCircleAzimuth=function(r,i){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","greatCircleAzimuth","missingLocation"));var s=r.latitude*e.DEGREES_TO_RADIANS,o=i.latitude*e.DEGREES_TO_RADIANS,u=r.longitude*e.DEGREES_TO_RADIANS,a=i.longitude*e.DEGREES_TO_RADIANS,f,l,c;return s==o&&u==a?0:u==a?s>o?180:0:(l=Math.cos(o)*Math.sin(a-u),f=Math.cos(s)*Math.sin(o)-Math.sin(s)*Math.cos(o)*Math.cos(a-u),c=Math.atan2(l,f),isNaN(c)?0:c*e.RADIANS_TO_DEGREES)},o.greatCircleDistance=function(r,i){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","greatCircleDistance","missingLocation"));var s=r.latitude*e.DEGREES_TO_RADIANS,o=i.latitude*e.DEGREES_TO_RADIANS,u=r.longitude*e.DEGREES_TO_RADIANS,a=i.longitude*e.DEGREES_TO_RADIANS,f,l,c,h;return s==o&&u==a?0:(f=Math.sin((o-s)/2),l=Math.sin((a-u)/2),c=f*f+Math.cos(s)*Math.cos(o)*l*l,h=2*Math.asin(Math.sqrt(c)),isNaN(h)?0:h)},o.greatCircleLocation=function(r,i,s,o){if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","greatCircleLocation","missingLocation"));if(!o)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","greatCircleLocation","missingResult"));if(s==0)return o.latitude=r.latitude,o.longitude=r.longitude,o;var u=r.latitude*e.DEGREES_TO_RADIANS,a=r.longitude*e.DEGREES_TO_RADIANS,f=i*e.DEGREES_TO_RADIANS,l,c;return l=Math.asin(Math.sin(u)*Math.cos(s)+Math.cos(u)*Math.sin(s)*Math.cos(f)),c=a+Math.atan2(Math.sin(s)*Math.sin(f),Math.cos(u)*Math.cos(s)-Math.sin(u)*Math.sin(s)*Math.cos(f)),isNaN(l)||isNaN(c)?(o.latitude=r.latitude,o.longitude=r.longitude):(o.latitude=e.normalizedDegreesLatitude(l*e.RADIANS_TO_DEGREES),o.longitude=e.normalizedDegreesLongitude(c*e.RADIANS_TO_DEGREES)),o},o.interpolateRhumb=function(e,r,i,o){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","interpolateRhumb","missingLocation"));if(!o)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","interpolateRhumb","missingResult"));if(r.equals(i))return o.latitude=r.latitude,o.longitude=r.longitude,o;var u=s.clamp(e,0,1),a=this.rhumbAzimuth(r,i),f=this.rhumbDistance(r,i);return this.rhumbLocation(r,a,u*f,o)},o.rhumbAzimuth=function(r,i){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","rhumbAzimuth","missingLocation"));var o=r.latitude*e.DEGREES_TO_RADIANS,u=i.latitude*e.DEGREES_TO_RADIANS,a=r.longitude*e.DEGREES_TO_RADIANS,f=i.longitude*e.DEGREES_TO_RADIANS,l,c,h;return o==u&&a==f?0:(l=f-a,c=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),s.fabs(l)>Math.PI&&(l=l>0?-(2*Math.PI-l):2*Math.PI+l),h=Math.atan2(l,c),isNaN(h)?0:h*e.RADIANS_TO_DEGREES)},o.rhumbDistance=function(r,i){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","rhumbDistance","missingLocation"));var o=r.latitude*e.DEGREES_TO_RADIANS,u=i.latitude*e.DEGREES_TO_RADIANS,a=r.longitude*e.DEGREES_TO_RADIANS,f=i.longitude*e.DEGREES_TO_RADIANS,l,c,h,p,d;if(o==u&&a==f)return 0;l=u-o,c=f-a,h=Math.log(Math.tan(u/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),p=l/h;if(isNaN(h)||isNaN(p))p=Math.cos(o);return s.fabs(c)>Math.PI&&(c=c>0?-(2*Math.PI-c):2*Math.PI+c),d=Math.sqrt(l*l+p*p*c*c),isNaN(d)?0:d},o.rhumbLocation=function(r,i,o,u){if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","rhumbLocation","missingLocation"));if(!u)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","rhumbLocation","missingResult"));if(o==0)return u.latitude=r.latitude,u.longitude=r.longitude,u;var a=r.latitude*e.DEGREES_TO_RADIANS,f=r.longitude*e.DEGREES_TO_RADIANS,l=i*e.DEGREES_TO_RADIANS,c=a+o*Math.cos(l),h=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(a/2+Math.PI/4)),p=(c-a)/h,d,v;if(isNaN(h)||isNaN(p)||!isFinite(p))p=Math.cos(a);return d=o*Math.sin(l)/p,s.fabs(c)>Math.PI/2&&(c=c>0?Math.PI-c:-Math.PI-c),v=s.fmod(f+d+Math.PI,2*Math.PI)-Math.PI,isNaN(c)||isNaN(v)?(u.latitude=r.latitude,u.longitude=r.longitude):(u.latitude=e.normalizedDegreesLatitude(c*e.RADIANS_TO_DEGREES),u.longitude=e.normalizedDegreesLongitude(v*e.RADIANS_TO_DEGREES)),u},o.interpolateLinear=function(e,r,i,o){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","interpolateLinear","missingLocation"));if(!o)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","interpolateLinear","missingResult"));if(r.equals(i))return o.latitude=r.latitude,o.longitude=r.longitude,o;var u=s.clamp(e,0,1),a=this.linearAzimuth(r,i),f=this.linearDistance(r,i);return this.linearLocation(r,a,u*f,o)},o.linearAzimuth=function(r,i){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","linearAzimuth","missingLocation"));var o=r.latitude*e.DEGREES_TO_RADIANS,u=i.latitude*e.DEGREES_TO_RADIANS,a=r.longitude*e.DEGREES_TO_RADIANS,f=i.longitude*e.DEGREES_TO_RADIANS,l,c,h;return o==u&&a==f?0:(l=f-a,c=u-o,s.fabs(l)>Math.PI&&(l=l>0?-(2*Math.PI-l):2*Math.PI+l),h=Math.atan2(l,c),isNaN(h)?0:h*e.RADIANS_TO_DEGREES)},o.linearDistance=function(r,i){if(!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","linearDistance","missingLocation"));var o=r.latitude*e.DEGREES_TO_RADIANS,u=i.latitude*e.DEGREES_TO_RADIANS,a=r.longitude*e.DEGREES_TO_RADIANS,f=i.longitude*e.DEGREES_TO_RADIANS,l,c,h;return o==u&&a==f?0:(l=u-o,c=f-a,s.fabs(c)>Math.PI&&(c=c>0?-(2*Math.PI-c):2*Math.PI+c),h=Math.sqrt(l*l+c*c),isNaN(h)?0:h)},o.linearLocation=function(r,i,o,u){if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","linearLocation","missingLocation"));if(!u)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","linearLocation","missingResult"));if(o==0)return u.latitude=r.latitude,u.longitude=r.longitude,u;var a=r.latitude*e.DEGREES_TO_RADIANS,f=r.longitude*e.DEGREES_TO_RADIANS,l=i*e.DEGREES_TO_RADIANS,c=a+o*Math.cos(l),h;return s.fabs(c)>Math.PI/2&&(c=c>0?Math.PI-c:-Math.PI-c),h=s.fmod(f+o*Math.sin(l)+Math.PI,2*Math.PI)-Math.PI,isNaN(c)||isNaN(h)?(u.latitude=r.latitude,u.longitude=r.longitude):(u.latitude=e.normalizedDegreesLatitude(c*e.RADIANS_TO_DEGREES),u.longitude=e.normalizedDegreesLongitude(h*e.RADIANS_TO_DEGREES)),u},o.locationsCrossDateLine=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","locationsCrossDateline","missingLocation"));var r=null;for(var i=0,o=e.length;i<o;i+=1){var u=e[i];if(r!=null&&s.signum(r.longitude)!=s.signum(u.longitude)){var a=Math.abs(r.longitude-u.longitude);if(a>180&&a<360)return!0}r=u}return!1},o.greatCircleArcExtremeLocations=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","greatCircleArcExtremeLocations","missingLocation"));var r=null,i=null,s=null;for(var u=0,a=e.length;u<a;u+=1){var f=e[u];if(s!=null){var l=o.greatCircleArcExtremeForTwoLocations(s,f);if(l==null)continue;if(r==null||r.latitude>l[0].latitude)r=l[0];if(i==null||i.latitude<l[1].latitude)i=l[1]}s=f}return[r,i]},o.greatCircleArcExtremeForTwoLocations=function(e,r){if(!e||!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","greatCircleArcExtremeForTwoLocations","missingLocation"));var i,u,a,f=null,l=null,c=90,h=-90,p=[e,r];for(i=0,u=p.length;i<u;i+=1)a=p[i],c>=a.latitude&&(c=a.latitude,f=a),h<=a.latitude&&(h=a.latitude,l=a);var d=o.greatCircleAzimuth(e,r),v=o.greatCircleDistance(e,r),m=o.greatCircleExtremeLocationsUsingAzimuth(e,d);for(i=0,u=m.length;i<u;i+=1){a=m[i];var g=o.greatCircleAzimuth(e,a),y=o.greatCircleDistance(e,a);s.signum(g)==s.signum(d)&&y>=0&&y<=v&&(c>=a.latitude&&(c=a.latitude,f=a),h<=a.latitude&&(h=a.latitude,l=a))}return[f,l]},o.greatCircleExtremeLocationsUsingAzimuth=function(r,i){if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Location","greatCircleArcExtremeLocationsUsingAzimuth","missingLocation"));var s=r.latitude,u=i*e.DEGREES_TO_RADIANS,a=-Math.tan(s)/Math.cos(u),f=Math.atan(a),l=f+Math.PI/2,c=f-Math.PI/2;return[o.greatCircleLocation(r,i,l,new o(0,0)),o.greatCircleLocation(r,i,c,new o(0,0))]},o.intersectionWithMeridian=function(e,t,n,s){var o=s.computePointFromLocation(e.latitude,e.longitude,new i(0,0,0)),u=s.computePointFromLocation(t.latitude,t.longitude,new i(0,0,0)),a=s.computePointFromLocation(90,n,new i(0,0,0)),f=s.computePointFromLocation(0,n,new i(0,0,0)),l=r.fromPoints(a,f,i.ZERO),c=new i(0,0,0);if(!l.intersectsSegmentAt(o,u,c))return null;var h=new WorldWind.Position(0,0,0);return s.computePositionFromPoint(c[0],c[1],c[2],h),h.latitude},o.poles={NONE:0,NORTH:1,SOUTH:2},o}),n("geom/Sector",["../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s){"use strict";var o=function(e,t,n,r){this.minLatitude=e,this.maxLatitude=t,this.minLongitude=n,this.maxLongitude=r};return o.ZERO=new o(0,0,0,0),o.FULL_SPHERE=new o(-90,90,-180,180),o.prototype.copy=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"Sector","copy","missingSector"));return this.minLatitude=e.minLatitude,this.maxLatitude=e.maxLatitude,this.minLongitude=e.minLongitude,this.maxLongitude=e.maxLongitude,this},o.prototype.isEmpty=function(){return this.minLatitude===this.maxLatitude&&this.minLongitude===this.maxLongitude},o.prototype.deltaLatitude=function(){return this.maxLatitude-this.minLatitude},o.prototype.deltaLongitude=function(){return this.maxLongitude-this.minLongitude},o.prototype.centroidLatitude=function(){return.5*(this.minLatitude+this.maxLatitude)},o.prototype.centroidLongitude=function(){return.5*(this.minLongitude+this.maxLongitude)},o.prototype.centroid=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"Sector","centroid","missingResult"));return e.latitude=this.centroidLatitude(),e.longitude=this.centroidLongitude(),e},o.prototype.minLatitudeRadians=function(){return this.minLatitude*e.DEGREES_TO_RADIANS},o.prototype.maxLatitudeRadians=function(){return this.maxLatitude*e.DEGREES_TO_RADIANS},o.prototype.minLongitudeRadians=function(){return this.minLongitude*e.DEGREES_TO_RADIANS},o.prototype.maxLongitudeRadians=function(){return this.maxLongitude*e.DEGREES_TO_RADIANS},o.prototype.setToBoundingSector=function(e){if(!e||e.length<2)throw new t(r.logMessage(r.LEVEL_SEVERE,"Sector","setToBoundingSector","missingArray"));var n=90,i=-90,s=180,o=-180;for(var u=0,a=e.length;u<a;u+=1){var f=e[u];if(!f)continue;n=Math.min(n,f.latitude),i=Math.max(i,f.latitude),s=Math.min(s,f.longitude),o=Math.max(o,f.longitude)}return this.minLatitude=n,this.maxLatitude=i,this.minLongitude=s,this.maxLongitude=o,this},o.splitBoundingSectors=function(e){if(!e||e.length<2)throw new t(r.logMessage(r.LEVEL_SEVERE,"Sector","splitBoundingSectors","missingArray"));var n=90,i=180,u=-90,a=-180,f=null;for(var l=0,c=e.length;l<c;l+=1){var h=e[l],p=h.latitude;p<n&&(n=p),p>u&&(u=p);var d=h.longitude;d>=0&&d<i&&(i=d),d<=0&&d>a&&(a=d);if(f!=null){var v=f.longitude;s.signum(d)!=s.signum(v)&&Math.abs(d-v)<180&&(a=0,i=0)}f=h}return n===u&&i===a?null:[new o(n,u,i,180),new o(n,u,-180,a)]},o.prototype.intersects=function(e){return e&&this.minLongitude<=e.maxLongitude&&this.maxLongitude>=e.minLongitude&&this.minLatitude<=e.maxLatitude&&this.maxLatitude>=e.minLatitude},o.prototype.overlaps=function(e){return e&&this.minLongitude<e.maxLongitude&&this.maxLongitude>e.minLongitude&&this.minLatitude<e.maxLatitude&&this.maxLatitude>e.minLatitude},o.prototype.contains=function(e){return e&&this.minLatitude<=e.minLatitude&&this.maxLatitude>=e.maxLatitude&&this.minLongitude<=e.minLongitude&&this.maxLongitude>=e.maxLongitude},o.prototype.containsLocation=function(e,t){return this.minLatitude<=e&&this.maxLatitude>=e&&this.minLongitude<=t&&this.maxLongitude>=t},o.prototype.intersection=function(e){if(!e instanceof o)throw new t(r.logMessage(r.LEVEL_SEVERE,"Sector","intersection","missingSector"));return this.minLatitude<e.minLatitude&&(this.minLatitude=e.minLatitude),this.maxLatitude>e.maxLatitude&&(this.maxLatitude=e.maxLatitude),this.minLongitude<e.minLongitude&&(this.minLongitude=e.minLongitude),this.maxLongitude>e.maxLongitude&&(this.maxLongitude=e.maxLongitude),this.maxLatitude<this.minLatitude&&(this.maxLatitude=this.minLatitude),this.maxLongitude<this.minLongitude&&(this.maxLongitude=this.minLongitude),this},o.prototype.union=function(e){if(!e instanceof o)throw new t(r.logMessage(r.LEVEL_SEVERE,"Sector","union","missingSector"));return this.minLatitude>e.minLatitude&&(this.minLatitude=e.minLatitude),this.maxLatitude<e.maxLatitude&&(this.maxLatitude=e.maxLatitude),this.minLongitude>e.minLongitude&&(this.minLongitude=e.minLongitude),this.maxLongitude<e.maxLongitude&&(this.maxLongitude=e.maxLongitude),this},o}),n("util/AbsentResourceList",[],function(){"use strict";var e=function(e,t){this.maxTrys=e,this.minCheckInterval=t,this.tryAgainInterval=6e4,this.possiblyAbsent={}};return e.prototype.isResourceAbsent=function(e){var t=this.possiblyAbsent[e];if(!t)return!1;if(t.permanent)return!0;var n=Date.now()-t.timeOfLastMark;return n>this.tryAgainInterval?(delete this.possiblyAbsent[e],!1):n<this.minCheckInterval||t.numTrys>this.maxTrys},e.prototype.markResourceAbsent=function(e){var t=this.possiblyAbsent[e];t||(t={timeOfLastMark:Date.now(),numTrys:0},this.possiblyAbsent[e]=t),t.numTrys=t.numTrys+1,t.timeOfLastMark=Date.now()},e.prototype.markResourceAbsentPermanently=function(e){var t=this.possiblyAbsent[e];t||(t={timeOfLastMark:Date.now(),numTrys:0},this.possiblyAbsent[e]=t),t.numTrys=t.numTrys+1,t.timeOfLastMark=Date.now(),t.permanent=!0},e.prototype.unmarkResourceAbsent=function(e){var t=this.possiblyAbsent[e];t&&delete this.possiblyAbsent[e]},e}),n("geom/Position",["../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger","../util/WWMath"],function(e,t,n,r,i){"use strict";var s=function(e,t,n){this.latitude=e,this.longitude=t,this.altitude=n};return s.ZERO=new s(0,0,0),s.fromRadians=function(t,n,r){return new s(t*e.RADIANS_TO_DEGREES,n*e.RADIANS_TO_DEGREES,r)},s.prototype.copy=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"Position","copy","missingPosition"));return this.latitude=e.latitude,this.longitude=e.longitude,this.altitude=e.altitude,this},s.prototype.equals=function(e){return e&&e.latitude===this.latitude&&e.longitude===this.longitude&&e.altitude===this.altitude},s.interpolateGreatCircle=function(e,s,o,u){if(!s||!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateGreatCircle","missingPosition"));if(!u)throw new t(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateGreatCircle","missingResult"));var a=i.clamp(e,0,1);return u.altitude=i.interpolate(a,s.altitude,o.altitude),n.interpolateGreatCircle(a,s,o,u),u},s.interpolateRhumb=function(e,s,o,u){if(!s||!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateRhumb","missingPosition"));if(!u)throw new t(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateRhumb","missingResult"));var a=i.clamp(e,0,1);return u.altitude=i.interpolate(a,s.altitude,o.altitude),n.interpolateRhumb(a,s,o,u),u},s.interpolateLinear=function(e,s,o,u){if(!s||!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateLinear","missingPosition"));if(!u)throw new t(r.logMessage(r.LEVEL_SEVERE,"Position","interpolateLinear","missingResult"));var a=i.clamp(e,0,1);return u.altitude=i.interpolate(a,s.altitude,o.altitude),n.interpolateLinear(a,s,o,u),u},s.prototype.toString=function(){return"("+this.latitude.toString()+"°, "+this.longitude.toString()+"°, "+this.altitude.toString()},s}),n("render/Texture",["../error/ArgumentError","../util/Logger","../util/WWMath"],function(e,t,n){"use strict";var r=function(r,i){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Texture","constructor","missingGlContext"));if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"Texture","constructor","missingImage"));var s=r.createTexture(),o=n.isPowerOfTwo(i.width)&&n.isPowerOfTwo(i.height);this.imageWidth=i.width,this.imageHeight=i.height,this.size=i.width*i.height*4,this.originalImageWidth=this.imageWidth,this.originalImageHeight=this.imageHeight,r.bindTexture(WebGLRenderingContext.TEXTURE_2D,s),r.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_MIN_FILTER,o?WebGLRenderingContext.LINEAR_MIPMAP_LINEAR:WebGLRenderingContext.LINEAR),r.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_MAG_FILTER,WebGLRenderingContext.LINEAR),r.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_WRAP_S,WebGLRenderingContext.CLAMP_TO_EDGE),r.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_WRAP_T,WebGLRenderingContext.CLAMP_TO_EDGE);var u=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");u&&r.texParameteri(WebGLRenderingContext.TEXTURE_2D,u.TEXTURE_MAX_ANISOTROPY_EXT,4),r.pixelStorei(WebGLRenderingContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),r.texImage2D(WebGLRenderingContext.TEXTURE_2D,0,WebGLRenderingContext.RGBA,WebGLRenderingContext.RGBA,WebGLRenderingContext.UNSIGNED_BYTE,i),r.pixelStorei(WebGLRenderingContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),o&&r.generateMipmap(WebGLRenderingContext.TEXTURE_2D),this.textureId=s};return r.prototype.dispose=function(e){e.deleteTexture(this.textureId),delete this.textureId},r.prototype.bind=function(e){return e.currentGlContext.bindTexture(WebGLRenderingContext.TEXTURE_2D,this.textureId),e.frameStatistics.incrementTextureLoadCount(1),!0},r}),n("geom/Matrix",["../geom/Angle","../error/ArgumentError","../util/Logger","../geom/Plane","../geom/Position","../geom/Rectangle","../render/Texture","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a){"use strict";var f=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){this[0]=e,this[1]=t,this[2]=n,this[3]=r,this[4]=i,this[5]=s,this[6]=o,this[7]=u,this[8]=a,this[9]=f,this[10]=l,this[11]=c,this[12]=h,this[13]=p,this[14]=d,this[15]=v};return f.prototype=new Float64Array(16),f.fromIdentity=function(){return new f(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)},f.principalAxesFromPoints=function(e,r,i,s){if(!e||e.length<1)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","principalAxesFromPoints","missingPoints"));if(!r||!i||!s)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","principalAxesFromPoints","An axis argument is null or undefined."));var o=f.fromIdentity();o.setToCovarianceOfPoints(e),o.eigensystemFromSymmetricMatrix(r,i,s),r.normalize(),i.normalize(),s.normalize()},f.prototype.set=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){return this[0]=e,this[1]=t,this[2]=n,this[3]=r,this[4]=i,this[5]=s,this[6]=o,this[7]=u,this[8]=a,this[9]=f,this[10]=l,this[11]=c,this[12]=h,this[13]=p,this[14]=d,this[15]=v,this},f.prototype.setToIdentity=function(){this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=1,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=1,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1},f.prototype.copy=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","copy","missingMatrix"));this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15]},f.prototype.equals=function(e){return e&&this[0]==e[0]&&this[1]==e[1]&&this[2]==e[2]&&this[3]==e[3]&&this[4]==e[4]&&this[5]==e[5]&&this[6]==e[6]&&this[7]==e[7]&&this[8]==e[8]&&this[9]==e[9]&&this[10]==e[10]&&this[11]==e[11]&&this[12]==e[12]&&this[13]==e[13]&&this[14]==e[14]&&this[15]==e[15]},f.prototype.columnMajorComponents=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","columnMajorComponents","missingResult"));return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e},f.prototype.setToTranslation=function(e,t,n){return this[0]=1,this[1]=0,this[2]=0,this[3]=e,this[4]=0,this[5]=1,this[6]=0,this[7]=t,this[8]=0,this[9]=0,this[10]=1,this[11]=n,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},f.prototype.setTranslation=function(e,t,n){return this[3]=e,this[7]=t,this[11]=n,this},f.prototype.setToScale=function(e,t,n){return this[0]=e,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=t,this[6]=0,this[7]=0,this[8]=0,this[9]=0,this[10]=n,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},f.prototype.setScale=function(e,t,n){return this[0]=e,this[5]=t,this[10]=n,this},f.prototype.setToTransposeOfMatrix=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToTransposeOfMatrix","missingMatrix"));return this[0]=e[0],this[1]=e[4],this[2]=e[8],this[3]=e[12],this[4]=e[1],this[5]=e[5],this[6]=e[9],this[7]=e[13],this[8]=e[2],this[9]=e[6],this[10]=e[10],this[11]=e[14],this[12]=e[3],this[13]=e[7],this[14]=e[11],this[15]=e[15],this},f.prototype.setToMultiply=function(e,r){if(!e||!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToMultiply","missingMatrix"));var i=e,s=r;return this[0]=i[0]*s[0]+i[1]*s[4]+i[2]*s[8]+i[3]*s[12],this[1]=i[0]*s[1]+i[1]*s[5]+i[2]*s[9]+i[3]*s[13],this[2]=i[0]*s[2]+i[1]*s[6]+i[2]*s[10]+i[3]*s[14],this[3]=i[0]*s[3]+i[1]*s[7]+i[2]*s[11]+i[3]*s[15],this[4]=i[4]*s[0]+i[5]*s[4]+i[6]*s[8]+i[7]*s[12],this[5]=i[4]*s[1]+i[5]*s[5]+i[6]*s[9]+i[7]*s[13],this[6]=i[4]*s[2]+i[5]*s[6]+i[6]*s[10]+i[7]*s[14],this[7]=i[4]*s[3]+i[5]*s[7]+i[6]*s[11]+i[7]*s[15],this[8]=i[8]*s[0]+i[9]*s[4]+i[10]*s[8]+i[11]*s[12],this[9]=i[8]*s[1]+i[9]*s[5]+i[10]*s[9]+i[11]*s[13],this[10]=i[8]*s[2]+i[9]*s[6]+i[10]*s[10]+i[11]*s[14],this[11]=i[8]*s[3]+i[9]*s[7]+i[10]*s[11]+i[11]*s[15],this[12]=i[12]*s[0]+i[13]*s[4]+i[14]*s[8]+i[15]*s[12],this[13]=i[12]*s[1]+i[13]*s[5]+i[14]*s[9]+i[15]*s[13],this[14]=i[12]*s[2]+i[13]*s[6]+i[14]*s[10]+i[15]*s[14],this[15]=i[12]*s[3]+i[13]*s[7]+i[14]*s[11]+i[15]*s[15],this},f.prototype.setToCovarianceOfPoints=function(e){if(!e||e.length<1)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToCovarianceOfPoints","missingArray"));var r,i,s,o,a=0,f=0,l=0,c=0,h=0,p=0,d=0,v=new u(0,0,0);r=u.averageOfBuffer(e,new u(0,0,0));for(var m=0,g=e.length/3;m<g;m++)v[0]=e[m*3],v[1]=e[m*3+1],v[2]=e[m*3+2],i=v[0]-r[0],s=v[1]-r[1],o=v[2]-r[2],++a,f+=i*i,l+=s*s,c+=o*o,h+=i*s,p+=i*o,d+=s*o;return this[0]=f/a,this[1]=h/a,this[2]=p/a,this[3]=0,this[4]=h/a,this[5]=l/a,this[6]=d/a,this[7]=0,this[8]=p/a,this[9]=d/a,this[10]=c/a,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=0,this},f.prototype.multiplyByTranslation=function(e,t,n){return this.multiply(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},f.prototype.multiplyByRotation=function(t,n,r,i){var s=Math.cos(i*e.DEGREES_TO_RADIANS),o=Math.sin(i*e.DEGREES_TO_RADIANS);return this.multiply(s+(1-s)*t*t,(1-s)*t*n-o*r,(1-s)*t*r+o*n,0,(1-s)*t*n+o*r,s+(1-s)*n*n,(1-s)*n*r-o*t,0,(1-s)*t*r-o*n,(1-s)*n*r+o*t,s+(1-s)*r*r,0,0,0,0,1),this},f.prototype.multiplyByScale=function(e,t,n){return this.multiply(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},f.prototype.setToUnitYFlip=function(){return this[0]=1,this[1]=0,this[2]=0,this[3]=0,this[4]=0,this[5]=-1,this[6]=0,this[7]=1,this[8]=0,this[9]=0,this[10]=1,this[11]=0,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},f.prototype.multiplyByLocalCoordinateTransform=function(e,r){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyByLocalCoordinateTransform","Origin vector is null or undefined"));if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyByLocalCoordinateTransform","missingGlobe"));var i=new u(0,0,0),s=new u(0,0,0),o=new u(0,0,0);return a.localCoordinateAxesAtPoint(e,r,i,s,o),this.multiply(i[0],s[0],o[0],e[0],i[1],s[1],o[1],e[1],i[2],s[2],o[2],e[2],0,0,0,1),this},f.prototype.multiplyByTextureTransform=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyByTextureTransform","missingTexture"));var r=e.originalImageWidth/e.imageWidth,i=e.originalImageHeight/e.imageHeight;return this.multiply(r,0,0,0,0,-i,0,i,0,0,1,0,0,0,0,1),this},f.prototype.extractTranslation=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","extractTranslation","missingResult"));return e[0]=this[3],e[1]=this[7],e[2]=this[11],e},f.prototype.extractRotationAngles=function(r){if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","extractRotationAngles","missingResult"));var i=Math.atan2(this[6],this[10]),s=Math.atan2(-this[2],Math.sqrt(this[0]*this[0]+this[1]*this[1])),o=Math.cos(i),u=Math.sin(i),a=Math.atan2(u*this[8]-o*this[4],o*this[5]-u*this[9]);return r[0]=i*e.RADIANS_TO_DEGREES,r[1]=s*e.RADIANS_TO_DEGREES,r[2]=a*e.RADIANS_TO_DEGREES,r},f.prototype.multiplyByFirstPersonModelview=function(r,i,s,o,f){if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyByFirstPersonModelview","missingPosition"));if(!f)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyByFirstPersonModelview","missingGlobe"));var l,c,h,p,d,v,m,g,y,b,w,E,S,x,T=new u(0,0,0),N=new u(0,0,0),C=new u(0,0,0),k=new u(0,0,0);return l=Math.cos(o*e.DEGREES_TO_RADIANS),c=Math.sin(o*e.DEGREES_TO_RADIANS),this.multiply(l,c,0,0,-c,l,0,0,0,0,1,0,0,0,0,1),l=Math.cos(s*e.DEGREES_TO_RADIANS),c=Math.sin(s*e.DEGREES_TO_RADIANS),this.multiply(1,0,0,0,0,l,c,0,0,-c,l,0,0,0,0,1),l=Math.cos(i*e.DEGREES_TO_RADIANS),c=Math.sin(i*e.DEGREES_TO_RADIANS),this.multiply(l,-c,0,0,c,l,0,0,0,0,1,0,0,0,0,1),f.computePointFromPosition(r.latitude,r.longitude,r.altitude,T),h=T[0],p=T[1],d=T[2],a.localCoordinateAxesAtPoint(T,f,N,C,k),v=N[0],m=N[1],g=N[2],y=C[0],b=C[1],w=C[2],E=k[0],S=k[1],x=k[2],this.multiply(v,m,g,-v*h-m*p-g*d,y,b,w,-y*h-b*p-w*d,E,S,x,-E*h-S*p-x*d,0,0,0,1),this},f.prototype.multiplyByLookAtModelview=function(e,r,i,s,o,u){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyByLookAtModelview","missingPosition"));if(r<0)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyByLookAtModelview","Range is less than zero"));if(!u)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyByLookAtModelview","missingGlobe"));return this.multiplyByTranslation(0,0,-r),this.multiplyByFirstPersonModelview(e,i,s,o,u),this},f.prototype.setToPerspectiveProjection=function(e,r,i,s){if(e<=0)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToPerspectiveProjection","invalidWidth"));if(r<=0)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToPerspectiveProjection","invalidHeight"));if(i===s)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToPerspectiveProjection","Near and far distance are the same."));if(i<=0||s<=0)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToPerspectiveProjection","Near or far distance is less than or equal to zero."));var o=a.perspectiveFrustumRectangle(e,r,i),u=o.getMinX(),f=o.getMaxX(),l=o.getMinY(),c=o.getMaxY();return this[0]=2*i/(f-u),this[1]=0,this[2]=(f+u)/(f-u),this[3]=0,this[4]=0,this[5]=2*i/(c-l),this[6]=(c+l)/(c-l),this[7]=0,this[8]=0,this[9]=0,this[10]=-(s+i)/(s-i),this[11]=-2*i*s/(s-i),this[12]=0,this[13]=0,this[14]=-1,this[15]=0,this},f.prototype.setToScreenProjection=function(e,r){if(e<=0)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToScreenProjection","invalidWidth"));if(r<=0)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","setToScreenProjection","invalidHeight"));return this[0]=2/e,this[1]=0,this[2]=0,this[3]=-1,this[4]=0,this[5]=2/r,this[6]=0,this[7]=-1,this[8]=0,this[9]=0,this[10]=2,this[11]=-1,this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},f.prototype.extractEyePoint=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","extractEyePoint","missingResult"));return e[0]=-(this[0]*this[3])-this[4]*this[7]-this[8]*this[11],e[1]=-(this[1]*this[3])-this[5]*this[7]-this[9]*this[11],e[2]=-(this[2]*this[3])-this[6]*this[7]-this[10]*this[11],e},f.prototype.extractForwardVector=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","extractForwardVector","missingResult"));return e[0]=-this[8],e[1]=-this[9],e[2]=-this[10],e},f.prototype.extractViewingParameters=function(r,s,o,u){if(!r)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","extractViewingParameters","The specified origin is null or undefined."));if(!o)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","extractViewingParameters","missingGlobe"));if(!u)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","extractViewingParameters","missingResult"));var a=new i(0,0,0),l=f.fromIdentity(),c,h,p,d,v,m,g,y,b;return o.computePositionFromPoint(r[0],r[1],r[2],a),l.copy(this),l.multiplyByLocalCoordinateTransform(r,o),c=-l[11],h=l[10],p=Math.sqrt(l[2]*l[2]+l[6]*l[6]),d=Math.atan2(p,h)*e.RADIANS_TO_DEGREES,v=Math.cos(s*e.DEGREES_TO_RADIANS),m=Math.sin(s*e.DEGREES_TO_RADIANS),g=v*l[0]-m*l[4],y=m*l[5]-v*l[1],b=Math.atan2(y,g)*e.RADIANS_TO_DEGREES,u.origin=a,u.range=c,u.heading=b,u.tilt=d,u.roll=s,u},f.prototype.offsetProjectionDepth=function(e){return this[10]*=1+e,this},f.prototype.multiplyMatrix=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","multiplyMatrix","missingMatrix"));var r=this,i=e,s,o,u,a;return s=r[0],o=r[1],u=r[2],a=r[3],r[0]=s*i[0]+o*i[4]+u*i[8]+a*i[12],r[1]=s*i[1]+o*i[5]+u*i[9]+a*i[13],r[2]=s*i[2]+o*i[6]+u*i[10]+a*i[14],r[3]=s*i[3]+o*i[7]+u*i[11]+a*i[15],s=r[4],o=r[5],u=r[6],a=r[7],r[4]=s*i[0]+o*i[4]+u*i[8]+a*i[12],r[5]=s*i[1]+o*i[5]+u*i[9]+a*i[13],r[6]=s*i[2]+o*i[6]+u*i[10]+a*i[14],r[7]=s*i[3]+o*i[7]+u*i[11]+a*i[15],s=r[8],o=r[9],u=r[10],a=r[11],r[8]=s*i[0]+o*i[4]+u*i[8]+a*i[12],r[9]=s*i[1]+o*i[5]+u*i[9]+a*i[13],r[10]=s*i[2]+o*i[6]+u*i[10]+a*i[14],r[11]=s*i[3]+o*i[7]+u*i[11]+a*i[15],s=r[12],o=r[13],u=r[14],a=r[15],r[12]=s*i[0]+o*i[4]+u*i[8]+a*i[12],r[13]=s*i[1]+o*i[5]+u*i[9]+a*i[13],r[14]=s*i[2]+o*i[6]+u*i[10]+a*i[14],r[15]=s*i[3]+o*i[7]+u*i[11]+a*i[15],this},f.prototype.multiply=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this,g,y,b,w;return g=m[0],y=m[1],b=m[2],w=m[3],m[0]=g*e+y*i+b*a+w*h,m[1]=g*t+y*s+b*f+w*p,m[2]=g*n+y*o+b*l+w*d,m[3]=g*r+y*u+b*c+w*v,g=m[4],y=m[5],b=m[6],w=m[7],m[4]=g*e+y*i+b*a+w*h,m[5]=g*t+y*s+b*f+w*p,m[6]=g*n+y*o+b*l+w*d,m[7]=g*r+y*u+b*c+w*v,g=m[8],y=m[9],b=m[10],w=m[11],m[8]=g*e+y*i+b*a+w*h,m[9]=g*t+y*s+b*f+w*p,m[10]=g*n+y*o+b*l+w*d,m[11]=g*r+y*u+b*c+w*v,g=m[12],y=m[13],b=m[14],w=m[15],m[12]=g*e+y*i+b*a+w*h,m[13]=g*t+y*s+b*f+w*p,m[14]=g*n+y*o+b*l+w*d,m[15]=g*r+y*u+b*c+w*v,this},f.prototype.invertMatrix=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","invertMatrix","missingMatrix"));var r=[[],[],[],[]];r[0][0]=e[0],r[0][1]=e[1],r[0][2]=e[2],r[0][3]=e[3],r[1][0]=e[4],r[1][1]=e[5],r[1][2]=e[6],r[1][3]=e[7],r[2][0]=e[8],r[2][1]=e[9],r[2][2]=e[10],r[2][3]=e[11],r[3][0]=e[12],r[3][1]=e[13],r[3][2]=e[14],r[3][3]=e[15];var i=[],s=f.ludcmp(r,i),o,u;for(o=0;o<4;o+=1)s*=r[o][o];if(Math.abs(s)<1e-8)return null;var a=[[],[],[],[]],l=[];for(u=0;u<4;u+=1){for(o=0;o<4;o+=1)l[o]=0;l[u]=1,f.lubksb(r,i,l);for(o=0;o<4;o+=1)a[o][u]=l[o]}return this[0]=a[0][0],this[1]=a[0][1],this[2]=a[0][2],this[3]=a[0][3],this[4]=a[1][0],this[5]=a[1][1],this[6]=a[1][2],this[7]=a[1][3],this[8]=a[2][0],this[9]=a[2][1],this[10]=a[2][2],this[11]=a[2][3],this[12]=a[3][0],this[13]=a[3][1],this[14]=a[3][2],this[15]=a[3][3],this},f.lubksb=function(e,t,n){var r=-1,i,s,o;for(i=0;i<4;i+=1){var u=t[i];o=n[u],n[u]=n[i];if(r!=-1)for(s=r;s<=i-1;s+=1)o-=e[i][s]*n[s];else o!=0&&(r=i);n[i]=o}for(i=3;i>=0;i-=1){o=n[i];for(s=i+1;s<4;s+=1)o-=e[i][s]*n[s];n[i]=o/e[i][i]}},f.ludcmp=function(e,t){var n=1e-20,r=[],i=1,s,o,u,a,f,l,c,h;for(o=0;o<4;o+=1){f=0;for(u=0;u<4;u+=1)(s=Math.abs(e[o][u]))>f&&(f=s);if(f==0)return 0;r[o]=1/f}for(u=0;u<4;u+=1){for(o=0;o<u;o+=1){l=e[o][u];for(a=0;a<o;a+=1)l-=e[o][a]*e[a][u];e[o][u]=l}f=0,c=-1;for(o=u;o<4;o+=1){l=e[o][u];for(a=0;a<u;a++)l-=e[o][a]*e[a][u];e[o][u]=l,(h=r[o]*Math.abs(l))>=f&&(f=h,c=o)}if(u!=c){for(a=0;a<4;a+=1)h=e[c][a],e[c][a]=e[u][a],e[u][a]=h;i=-i,r[c]=r[u]}t[u]=c,e[u][u]==0&&(e[u][u]=n);if(u!=3){h=1/e[u][u];for(o=u+1;o<4;o+=1)e[o][u]*=h}}return i},f.prototype.invertOrthonormalMatrix=function(e){if(!e)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","invertOrthonormalMatrix","missingMatrix"));var r=e;return this[0]=r[0],this[1]=r[4],this[2]=r[8],this[3]=0-r[0]*r[3]-r[4]*r[7]-r[8]*r[11],this[4]=r[1],this[5]=r[5],this[6]=r[9],this[7]=0-r[1]*r[3]-r[5]*r[7]-r[9]*r[11],this[8]=r[2],this[9]=r[6],this[10]=r[10],this[11]=0-r[2]*r[3]-r[6]*r[7]-r[10]*r[11],this[12]=0,this[13]=0,this[14]=0,this[15]=1,this},f.prototype.eigensystemFromSymmetricMatrix=function(e,r,i){if(!e||!r||!i)throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","eigensystemFromSymmetricMatrix","missingResult"));if(this[1]!=this[4]||this[2]!=this[8]||this[6]!=this[9])throw new t(n.logMessage(n.LEVEL_SEVERE,"Matrix","eigensystemFromSymmetricMatrix","Matrix is not symmetric"));var s=1e-10,o=this[0],u=this[1],f=this[2],l=this[5],c=this[6],h=this[10],p=[[1,0,0],[0,1,0],[0,0,1]],d=32,v,m,g,y,b,w,E,S,x,T,N;for(var C=0;C<d;C++){if(a.fabs(u)<s&&a.fabs(f)<s&&a.fabs(c)<s)break;if(u!=0){v=(l-o)*.5/u,m=v*v,g=m+1,y=g!=m?(v<0?-1:1)*(Math.sqrt(g)-a.fabs(v)):.5/v,b=1/Math.sqrt(y*y+1),w=b*y,o-=y*u,l+=y*u,u=0,E=b*f-w*c,c=w*f+b*c,f=E;for(S=0;S<3;S++)E=b*p[S][0]-w*p[S][1],p[S][1]=w*p[S][0]+b*p[S][1],p[S][0]=E}if(f!=0){v=(h-o)*.5/f,m=v*v,g=m+1,y=g!=m?(v<0?-1:1)*(Math.sqrt(g)-a.fabs(v)):.5/v,b=1/Math.sqrt(y*y+1),w=b*y,o-=y*f,h+=y*f,f=0,E=b*u-w*c,c=w*u+b*c,u=E;for(S=0;S<3;S++)E=b*p[S][0]-w*p[S][2],p[S][2]=w*p[S][0]+b*p[S][2],p[S][0]=E}if(c!=0){v=(h-l)*.5/c,m=v*v,g=m+1,y=g!=m?(v<0?-1:1)*(Math.sqrt(g)-a.fabs(v)):.5/v,b=1/Math.sqrt(y*y+1),w=b*y,l-=y*c,h+=y*c,c=0,E=b*u-w*f,f=w*u+b*f,u=E;for(S=0;S<3;S++)E=b*p[S][1]-w*p[S][2],p[S][2]=w*p[S][1]+b*p[S][2],p[S][1]=E}}x=0,T=1,N=2,o<l&&(E=o,o=l,l=E,E=x,x=T,T=E),l<h&&(E=l,l=h,h=E,E=T,T=N,N=E),o<l&&(E=o,o=l,l=E,E=x,x=T,T=E),e[0]=p[0][x],e[1]=p[1][x],e[2]=p[2][x],r[0]=p[0][T],r[1]=p[1][T],r[2]=p[2][T],i[0]=p[0][N],i[1]=p[1][N],i[2]=p[2][N],e.normalize(),r.normalize(),i.normalize(),e.multiply(o),r.multiply(l),i.multiply(h)},f.prototype.upper3By3=function(){var e=f.fromIdentity();return e[0]=this[0],e[1]=this[1],e[2]=this[2],e[4]=this[4],e[5]=this[5],e[6]=this[6],e[8]=this[8],e[9]=this[9],e[10]=this[10],e},f}),n("geom/Frustum",["../error/ArgumentError","../geom/Matrix","../geom/Plane","../util/Logger"],function(e,t,n,r){"use strict";var i=function(t,n,i,s,o,u){if(!t||!n||!i||!s||!o||!u)throw new e(r.logMessage(r.LEVEL_SEVERE,"Frustum","constructor","missingPlane"));this._left=t,this._right=n,this._bottom=i,this._top=s,this._near=o,this._far=u,this._planes=[this._left,this._right,this._top,this._bottom,this._near,this._far]};return Object.defineProperties(i.prototype,{left:{get:function(){return this._left}},right:{get:function(){return this._right}},bottom:{get:function(){return this._bottom}},top:{get:function(){return this._top}},near:{get:function(){return this._near}},far:{get:function(){return this._far}}}),i.prototype.transformByMatrix=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Frustum","transformByMatrix","missingMatrix"));return this._left.transformByMatrix(t),this._right.transformByMatrix(t),this._bottom.transformByMatrix(t),this._top.transformByMatrix(t),this._near.transformByMatrix(t),this._far.transformByMatrix(t),this},i.prototype.normalize=function(){return this._left.normalize(),this._right.normalize(),this._bottom.normalize(),this._top.normalize(),this._near.normalize(),this._far.normalize(),this},i.unitFrustum=function(){return new i(new n(1,0,0,1),new n(-1,0,0,1),new n(0,1,1,1),new n(0,-1,0,1),new n(0,0,-1,1),new n(0,0,1,1))},i.fromProjectionMatrix=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Frustum","fromProjectionMatrix","missingMatrix"));var s,o,u,a,f,l,c,h,p,d,v;return s=t[12]+t[0],o=t[13]+t[1],u=t[14]+t[2],a=t[15]+t[3],f=Math.sqrt(s*s+o*o+u*u),l=new n(s/f,o/f,u/f,a/f),s=t[12]-t[0],o=t[13]-t[1],u=t[14]-t[2],a=t[15]-t[3],f=Math.sqrt(s*s+o*o+u*u),c=new n(s/f,o/f,u/f,a/f),s=t[12]+t[4],o=t[13]+t[5],u=t[14]+t[6],a=t[15]+t[7],f=Math.sqrt(s*s+o*o+u*u),p=new n(s/f,o/f,u/f,a/f),s=t[12]-t[4],o=t[13]-t[5],u=t[14]-t[6],a=t[15]-t[7],f=Math.sqrt(s*s+o*o+u*u),h=new n(s/f,o/f,u/f,a/f),s=t[12]+t[8],o=t[13]+t[9],u=t[14]+t[10],a=t[15]+t[11],f=Math.sqrt(s*s+o*o+u*u),d=new n(s/f,o/f,u/f,a/f),s=t[12]-t[8],o=t[13]-t[9],u=t[14]-t[10],a=t[15]-t[11],f=Math.sqrt(s*s+o*o+u*u),v=new n(s/f,o/f,u/f,a/f),new i(l,c,p,h,d,v)},i.prototype.containsPoint=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"Frustum","containsPoint","missingPoint"));return this._far.dot(t)<=0?!1:this._left.dot(t)<=0?!1:this._right.dot(t)<=0?!1:this._top.dot(t)<=0?!1:this._bottom.dot(t)<=0?!1:this._near.dot(t)<=0?!1:!0},i.prototype.intersectsSegment=function(t,n){if(!t||!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"Frustum","containsPoint","missingPoint"));if(this.containsPoint(t)||this.containsPoint(n))return!0;if(t.equals(n))return!1;for(var i=0,s=this._planes.length;i<s;i++){if(this._planes[i].onSameSide(t,n)<0)return!1;if(this._planes[i].clip(t,n)!=null)return!0}return!1},i}),n("error/NotYetImplementedError",["../error/AbstractError"],function(e){"use strict";var t=function(t){e.call(this,"NotYetImplementedError",t);var n;try{throw new Error}catch(r){n=r.stack}this.stack=n};return t.prototype=Object.create(e.prototype),t}),n("util/WWUtil",["../error/ArgumentError","../geom/Line","../util/Logger","../geom/Rectangle","../geom/Vec3"],function(e,t,n,r,i){"use strict";var s={latLonRegex:/^(\-?\d+(\.\d+)?),\s*(\-?\d+(\.\d+)?)$/,suffixForMimeType:function(e){return e==="image/png"?"png":e==="image/jpeg"?"jpg":e==="application/bil16"?"bil":null},currentUrlSansFilePart:function(){var e=window.location.protocol,t=window.location.host,n=window.location.pathname,r=n.split("/"),i="";for(var s=0,o=r.length;s<o-1;s++)r[s].length>0&&(i=i+"/"+r[s]);return e+"//"+t+i},worldwindlibLocation:function(){var e=document.getElementsByTagName("script"),t="/worldwindlib.";for(var n=0;n<e.length;n++){var r=e[n].src.indexOf(t);if(r>=0)return e[n].src.substring(0,r)+"/"}return null},urlPath:function(e){if(!e)return"";var t=e.split("/"),n="";for(var r=0,i=t.length;r<i;r++){var s=t[r];if(!s||s.length===0||s.indexOf(":")!=-1||s==="."||s===".."||s==="null"||s==="undefined")continue;n.length!==0&&(n+="/"),n+=s}return n},fillArray:function(e,t){if(!e)return;for(var n=0,r=e.length;n<r;n++)e[n]=t},multiplyArray:function(e,t){if(!e)return;for(var n=0,r=e.length;n<r;n++)e[n]*=t},jsonpCounter:0,jsonp:function(e,t,n){var r="gov_nasa_worldwind_jsonp_"+s.jsonpCounter++;window[r]=function(e){delete window[r],n(e)};var i=e+(e.indexOf("?")===-1?"?":"&");i+=t+"="+r;var o=document.createElement("script");o.async=!0,o.src=i;var u=document.getElementsByTagName("head")[0],a=function(){o.onload=undefined,o.onerror=undefined,u.removeChild(o)};o.onload=a,o.onerror=a,u.appendChild(o)}};return s}),n("geom/BoundingBox",["../error/ArgumentError","../shaders/BasicProgram","../geom/Frustum","../util/Logger","../geom/Matrix","../error/NotYetImplementedError","../geom/Plane","../geom/Sector","../geom/Vec3","../util/WWMath","../util/WWUtil"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";var c=function(){this.center=new a(0,0,0),this.bottomCenter=new a(-0.5,0,0),this.topCenter=new a(.5,0,0),this.r=new a(1,0,0),this.s=new a(0,1,0),this.t=new a(0,0,1),this.radius=Math.sqrt(3),this.tmp1=new a(0,0,0),this.tmp2=new a(0,0,0),this.tmp3=new a(0,0,0),this.scratchElevations=new Float64Array(9),this.scratchPoints=new Float64Array(3*this.scratchElevations.length)};return c.scratchMatrix=i.fromIdentity(),c.prototype.setToPoints=function(t){if(!t||t.length<3)throw new e(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","setToPoints","missingArray"));var n=+Number.MAX_VALUE,s=-Number.MAX_VALUE,o=+Number.MAX_VALUE,u=-Number.MAX_VALUE,f=+Number.MAX_VALUE,l=-Number.MAX_VALUE,c=this.r,h=this.s,p=this.t,d=new a(0,0,0),v,m,g,y,b,w,E,S,x,T,N,C,k,L,A;i.principalAxesFromPoints(t,c,h,p);for(var O=0,M=t.length/3;O<M;O++)d[0]=t[O*3],d[1]=t[O*3+1],d[2]=t[O*3+2],v=d.dot(c),n>v&&(n=v),s<v&&(s=v),m=d.dot(h),o>m&&(o=m),u<m&&(u=m),g=d.dot(p),f>g&&(f=g),l<g&&(l=g);return s===n&&(s=n+1),u===o&&(u=o+1),l===f&&(l=f+1),y=s-n,b=u-o,w=l-f,E=s+n,S=u+o,x=l+f,T=.5*c[0]*y,N=.5*c[1]*y,C=.5*c[2]*y,k=.5*(c[0]*E+h[0]*S+p[0]*x),L=.5*(c[1]*E+h[1]*S+p[1]*x),A=.5*(c[2]*E+h[2]*S+p[2]*x),this.center[0]=k,this.center[1]=L,this.center[2]=A,this.topCenter[0]=k+T,this.topCenter[1]=L+N,this.topCenter[2]=A+C,this.bottomCenter[0]=k-T,this.bottomCenter[1]=L-N,this.bottomCenter[2]=A-C,c.multiply(y),h.multiply(b),p.multiply(w),this.radius=.5*Math.sqrt(y*y+b*b+w*w),this},c.prototype.setToSector=function(t,n,i,s){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","setToSector","missingSector"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","setToSector","missingGlobe"));var o=this.scratchElevations,u=this.scratchPoints;l.fillArray(o,s),o[0]=o[2]=o[6]=o[8]=i,n.computePointsForGrid(t,3,3,o,a.ZERO,u);var c=12;this.tmp1.set(u[c],u[c+1],u[c+2]),f.localCoordinateAxesAtPoint(this.tmp1,n,this.r,this.s,this.t);var h=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],p=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],d=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];for(var v=0,m=u.length;v<m;v+=3)this.tmp1.set(u[v],u[v+1],u[v+2]),this.adjustExtremes(this.r,h,this.s,p,this.t,d,this.tmp1);h[1]-h[0]<p[1]-p[0]&&this.swapAxes(this.r,h,this.s,p),p[1]-p[0]<d[1]-d[0]&&this.swapAxes(this.s,p,this.t,d),h[1]-h[0]<p[1]-p[0]&&this.swapAxes(this.r,h,this.s,p);var g=h[1]-h[0],y=p[1]-p[0],b=d[1]-d[0],w=h[1]+h[0],E=p[1]+p[0],S=d[1]+d[0],x=.5*(this.r[0]*w+this.s[0]*E+this.t[0]*S),T=.5*(this.r[1]*w+this.s[1]*E+this.t[1]*S),N=.5*(this.r[2]*w+this.s[2]*E+this.t[2]*S),C=.5*this.r[0]*g,k=.5*this.r[1]*g,L=.5*this.r[2]*g;return this.center.set(x,T,N),this.topCenter.set(x+C,T+k,N+L),this.bottomCenter.set(x-C,T-k,N-L),this.r.multiply(g),this.s.multiply(y),this.t.multiply(b),this.radius=.5*Math.sqrt(g*g+y*y+b*b),this},c.prototype.translate=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","translate","missingVector"));return this.bottomCenter.add(t),this.topCenter.add(t),this.center.add(t),this},c.prototype.distanceTo=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","distanceTo","missingPoint"));var n=this.center.distanceTo(t)-this.radius;return n>=0?n:-n},c.prototype.effectiveRadius=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","effectiveRadius","missingPlane"));var n=t.normal;return.5*(f.fabs(this.r.dot(n))+f.fabs(this.s.dot(n))+f.fabs(this.t.dot(n)))},c.prototype.intersectsFrustum=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"BoundingBox","intersectsFrustum","missingFrustum"));return this.tmp1.copy(this.bottomCenter),this.tmp2.copy(this.topCenter),this.intersectionPoint(t.near)<0?!1:this.intersectionPoint(t.far)<0?!1:this.intersectionPoint(t.left)<0?!1:this.intersectionPoint(t.right)<0?!1:this.intersectionPoint(t.top)<0?!1:this.intersectionPoint(t.bottom)<0?!1:!0},c.prototype.intersectionPoint=function(e){var t=e.normal,n=.5*(Math.abs(this.s.dot(t))+Math.abs(this.t.dot(t)));return this.intersectsAt(e,n,this.tmp1,this.tmp2)},c.prototype.intersectsAt=function(e,t,n,r){var i=e.dot(n),s=i<=-t,o=e.dot(r),u=o<=-t;if(s&&u)return-1;if(s==u)return 0;this.tmp3.copy(n),this.tmp3.subtract(r);var a=(t+i)/e.normal.dot(this.tmp3);return this.tmp3.copy(r),this.tmp3.subtract(n),this.tmp3.multiply(a),this.tmp3.add(n),s?n.copy(this.tmp3):r.copy(this.tmp3),a},c.prototype.adjustExtremes=function(e,t,n,r,i,s,o){var u=o.dot(e);t[0]>u&&(t[0]=u),t[1]<u&&(t[1]=u);var a=o.dot(n);r[0]>a&&(r[0]=a),r[1]<a&&(r[1]=a);var f=o.dot(i);s[0]>f&&(s[0]=f),s[1]<f&&(s[1]=f)},c.prototype.swapAxes=function(e,t,n,r){e.swap(n);var i=t[0];t[0]=r[0],r[0]=i,i=t[1],t[1]=r[1],r[1]=i},c.prototype.render=function(e){var n=e.currentGlContext,r=c.scratchMatrix,i=e.findAndBindProgram(t);try{r.copy(e.navigatorState.modelviewProjection),r.multiply(this.r[0],this.s[0],this.t[0],this.center[0],this.r[1],this.s[1],this.t[1],this.center[1],this.r[2],this.s[2],this.t[2],this.center[2],0,0,0,1),r.multiplyByTranslation(-0.5,-0.5,-0.5),i.loadModelviewProjection(n,r),n.disable(WebGLRenderingContext.CULL_FACE),n.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,e.unitCubeBuffer()),n.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,e.unitCubeElements()),n.enableVertexAttribArray(i.vertexPointLocation),n.vertexAttribPointer(i.vertexPointLocation,3,WebGLRenderingContext.FLOAT,!1,0,0),i.loadColorComponents(n,0,1,0,.6),n.drawElements(WebGLRenderingContext.LINES,24,WebGLRenderingContext.UNSIGNED_SHORT,72),i.loadColorComponents(n,1,1,1,.3),n.drawElements(WebGLRenderingContext.TRIANGLES,36,WebGLRenderingContext.UNSIGNED_SHORT,0)}finally{n.enable(WebGLRenderingContext.CULL_FACE),n.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,null),n.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,null),e.bindProgram(null)}},c}),n("util/Tile",["../error/ArgumentError","../geom/BoundingBox","../util/Logger","../geom/Sector","../geom/Vec3","../util/WWUtil"],function(e,t,n,r,i,s){"use strict";var o=function(t,r,i,s){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","constructor","missingSector"));if(!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","constructor","The specified level is null or undefined."));if(i<0||s<0)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","constructor","The specified row or column is less than zero."));this.sector=t,this.level=r,this.row=i,this.column=s,this.tileWidth=r.tileWidth,this.tileHeight=r.tileHeight,this.texelSize=r.texelSize,this.tileKey=r.levelNumber.toString()+"."+i.toString()+"."+s.toString(),this.extent=null,this.referencePoint=null,this.samplePoints=null,this.sampleElevations=null,this.updateTimestamp=null,this.updateVerticalExaggeration=null,this.updateGlobeStateKey=null};return o.prototype.isEqual=function(e){return e?e.tileKey?this.tileKey==e.tileKey:!1:!1},o.prototype.size=function(){return 828},o.prototype.distanceTo=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","distanceTo","missingVector"));var r=t[0],i=t[1],s=t[2],o,u,a,f=this.samplePoints,l=Number.POSITIVE_INFINITY;for(var c=0,h=f.length;c<h;c+=3)o=r-f[c],u=i-f[c+1],a=s-f[c+2],l=Math.min(l,o*o+u*u+a*a);return Math.sqrt(l)},o.prototype.subdivide=function(t,i){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","subdivide","The specified level is null or undefined."));if(!i)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","subdivide","The specified tile factory is null or undefined."));var s=this.sector.minLatitude,o=this.sector.maxLatitude,u=this.sector.centroidLatitude(),a=this.sector.minLongitude,f=this.sector.maxLongitude,l=this.sector.centroidLongitude(),c,h,p,d=[];return c=2*this.row,h=2*this.column,p=new r(s,u,a,l),d.push(i.createTile(p,t,c,h)),c=2*this.row,h=2*this.column+1,p=new r(s,u,l,f),d.push(i.createTile(p,t,c,h)),c=2*this.row+1,h=2*this.column,p=new r(u,o,a,l),d.push(i.createTile(p,t,c,h)),c=2*this.row+1,h=2*this.column+1,p=new r(u,o,l,f),d.push(i.createTile(p,t,c,h)),d},o.prototype.subdivideToCache=function(t,r,i){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","subdivideToCache","The specified level is null or undefined."));if(!r)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","subdivideToCache","The specified tile factory is null or undefined."));var s=i?i.entryForKey(this.tileKey):null;return s||(s=this.subdivide(t,r),s&&i&&i.putEntry(this.tileKey,s,4*s[0].size())),s},o.prototype.mustSubdivide=function(e,t){var n=e.globe.equatorialRadius*this.texelSize,r=this.distanceTo(e.navigatorState.eyePoint);return n>r*Math.pow(10,-t)},o.prototype.update=function(e){var t=e.globe.elevationTimestamp(),n=e.verticalExaggeration,r=e.globeStateKey;if(this.updateTimestamp!=t||this.updateVerticalExaggeration!=n||this.updateGlobeStateKey!=r)this.doUpdate(e),e.frameStatistics.incrementTileUpdateCount(1),this.updateTimestamp=t,this.updateVerticalExaggeration=n,this.updateGlobeStateKey=r},o.prototype.doUpdate=function(e){var n=e.globe,r=e.verticalExaggeration,o=n.minAndMaxElevationsForSector(this.sector),u=o?o[0]*r:0,a=o?o[1]*r:0;u==a&&(u=a+10),this.extent||(this.extent=new t),this.extent.setToSector(this.sector,n,u,a),this.samplePoints||(this.sampleElevations=new Float64Array(9),this.samplePoints=new Float64Array(3*this.sampleElevations.length)),s.fillArray(this.sampleElevations,.5*(u+a)),n.computePointsForGrid(this.sector,3,3,this.sampleElevations,i.ZERO,this.samplePoints),this.referencePoint||(this.referencePoint=new i(0,0,0)),n.computePointFromPosition(this.sector.centroidLatitude(),this.sector.centroidLongitude(),0,this.referencePoint)},o.computeRow=function(e,t){var n=Math.floor((t+90)/e);return t==90&&(n-=1),n},o.computeColumn=function(e,t){var n=Math.floor((t+180)/e);return t==180&&(n-=1),n},o.computeLastRow=function(e,t){var n=Math.ceil((t+90)/e-1);return t+90<e&&(n=0),n},o.computeLastColumn=function(e,t){var n=Math.ceil((t+180)/e-1);return t+180<e&&(n=0),n},o.computeSector=function(t,i,s){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","computeSector","missingLevel"));if(i<0||s<0)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","computeSector","The specified row or column is less than zero."));var o=t.tileDelta.latitude,u=t.tileDelta.longitude,a=-90+i*o,f=-180+s*u,l=a+o,c=f+u;return new r(a,l,f,c)},o.createTilesForLevel=function(t,i,s){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","createTilesForLevel","missingLevel"));if(!i)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","createTilesForLevel","The specified tile factory is null or undefined"));if(!s)throw new e(n.logMessage(n.LEVEL_SEVERE,"Tile","createTilesForLevel","missingResult"));var u=t.tileDelta.latitude,a=t.tileDelta.longitude,f=t.sector,l=o.computeRow(u,f.minLatitude),c=o.computeRow(u,f.maxLatitude),h=o.computeColumn(a,f.minLongitude),p=o.computeColumn(a,f.maxLongitude),d=-90+l*u,v=-180+h*a,m=d,g,y,b;for(var w=l;w<=c;w+=1){y=m+u,g=v;for(var E=h;E<=p;E+=1){b=g+a;var S=new r(m,y,g,b),x=i.createTile(S,t,w,E);s.push(x),g=b}m=y}},o}),n("render/TextureTile",["../error/ArgumentError","../util/Logger","../util/Tile"],function(e,t,n){"use strict";var r=function(e,t,r,i){n.call(this,e,t,r,i),this.gpuCacheKey=null};return r.prototype=Object.create(n.prototype),r.prototype.size=function(){return n.prototype.size.call(this)},r.prototype.bind=function(e){var t=e.gpuResourceCache.resourceForKey(this.gpuCacheKey);return t?t.bind(e):!1},r.prototype.applyInternalTransform=function(e,t){},r}),n("render/ImageTile",["../error/ArgumentError","../util/Logger","../render/TextureTile","../util/Tile"],function(e,t,n,r){"use strict";var i=function(r,i,s,o,u){if(!u||u.length<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"ImageTile","constructor","The specified image path is null, undefined or zero length."));n.call(this,r,i,s,o),this.imagePath=u,this.fallbackTile=null,this.gpuCacheKey=u};return i.prototype=Object.create(n.prototype),i.prototype.size=function(){return this.__proto__.__proto__.size.call(this)+this.imagePath.length+8},i.prototype.bind=function(e){var t=this.__proto__.__proto__.bind.call(this,e);return t?!0:this.fallbackTile?this.fallbackTile.bind(e):!1},i.prototype.applyInternalTransform=function(e,t){this.fallbackTile&&!e.gpuResourceCache.resourceForKey(this.imagePath)&&this.applyFallbackTransform(t)},i.prototype.applyFallbackTransform=function(e){var t=this.level.levelNumber-this.fallbackTile.level.levelNumber;if(t<=0)return;var n=2<<t-1,r=1/n,i=r*(this.column%n),s=r*(this.row%n);e.multiply(r,0,0,i,0,r,0,s,0,0,1,0,0,0,0,1)},i}),n("layer/Layer",["../util/Logger"],function(e){"use strict";var t=function(e){this.displayName=e?e:"Layer",this.enabled=!0,this.pickEnabled=!0,this.opacity=1,this.minActiveAltitude=-Number.MAX_VALUE,this.maxActiveAltitude=Number.MAX_VALUE,this.inCurrentFrame=!1};return t.prototype.render=function(e){this.inCurrentFrame=!1;if(!this.enabled)return;if(e.pickingMode&&!this.pickEnabled)return;if(!this.withinActiveAltitudes(e))return;if(!this.isLayerInView(e))return;this.doRender(e)},t.prototype.doRender=function(e){},t.prototype.withinActiveAltitudes=function(e){var t=e.eyePosition;return t?t.altitude>=this.minActiveAltitude&&t.altitude<=this.maxActiveAltitude:!1},t.prototype.isLayerInView=function(e){return!0},t}),n("util/Level",["../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger"],function(e,t,n,r){"use strict";var i=function(n,i,s){if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"Level","constructor","The specified tile delta is null or undefined"));if(!s)throw new t(r.logMessage(r.LEVEL_SEVERE,"Level","constructor","The specified parent level set is null or undefined"));this.levelNumber=n,this.tileDelta=i,this.parent=s,this.texelSize=i.latitude*e.DEGREES_TO_RADIANS/s.tileHeight,this.tileWidth=s.tileWidth,this.tileHeight=s.tileHeight,this.sector=s.sector};return i.prototype.isFirstLevel=function(){return this.parent.firstLevel()==this},i.prototype.isLastLevel=function(){return this.parent.lastLevel()==this},i.prototype.previousLevel=function(){return this.parent.level(this.levelNumber-1)},i.prototype.nextLevel=function(){return this.parent.level(this.levelNumber+1)},i.prototype.compare=function(e){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"Level","compare","The specified level is null or undefined"));return this.levelNumber<e.levelNumber?-1:this.levelNumber>e.levelNumber?1:0},i}),n("util/LevelSet",["../error/ArgumentError","../util/Level","../geom/Location","../util/Logger"],function(e,t,n,r){"use strict";var i=function(i,s,o,u,a){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","missingSector"));if(!s)throw new e(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","The specified level zero delta is null or undefined"));if(s.latitude<=0||s.longitude<=0)throw new e(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","The specified level zero delta is less than or equal to zero."));if(o<1)throw new e(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","The specified number of levels is less than one."));if(u<1||a<1)throw new e(r.logMessage(r.LEVEL_SEVERE,"LevelSet","constructor","The specified tile width or tile height is less than one."));this.sector=i,this.levelZeroDelta=s,this.numLevels=o,this.tileWidth=u,this.tileHeight=a,this.levels=[];for(var f=0;f<o;f+=1){var l=Math.pow(2,f),c=s.latitude/l,h=s.longitude/l,p=new n(c,h),d=new t(f,p,this);this.levels[f]=d}};return i.prototype.level=function(e){return e<0||e>=this.levels.length?null:this.levels[e]},i.prototype.levelForTexelSize=function(e){var t=this.lastLevel();if(t.texelSize>=e)return t;for(var n=0,r=this.levels.length;n<r;n+=1){var i=this.levels[n];if(i.texelSize<=e)return i}return t},i.prototype.firstLevel=function(){return this.levels[0]},i.prototype.lastLevel=function(){return this.levels[this.levels.length-1]},i}),n("cache/MemoryCache",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(n,r){if(!n||n<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","constructor","The specified capacity is undefined, zero or negative"));if(!r||r>=n||r<0)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","constructor","The specified low-water value is undefined, greater than or equal to the capacity, or less than 1"));this._capacity=n,this._lowWater=r,this.usedCapacity=0,this.freeCapacity=n,this.entries={},this.listeners=[]};return Object.defineProperties(n.prototype,{capacity:{get:function(){return this._capacity},set:function(n){if(!n||n<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","capacity","Specified cache capacity is undefined, 0 or negative."));var r=this._capacity;this._capacity=n,this._capacity<=this.lowWater&&(this._lowWater=.85*this._capacity),this._capacity<r&&this.makeSpace(0)}},lowWater:{get:function(){return this._lowWater},set:function(n){if(!n||n>=this._capacity||n<0)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","lowWater","Specified cache low-water value is undefined, negative or not less than the current capacity."));this._lowWater=n}}}),n.prototype.entryForKey=function(e){if(!e)return null;var t=this.entries[e];return t?(t.lastUsed=Date.now(),t.entry):null},n.prototype.putEntry=function(n,r,i){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","putEntry","missingKey."));if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","putEntry","missingEntry."));if(i<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","putEntry","The specified entry size is less than 1."));var s=this.entries[n],o;s&&this.removeEntry(n),this.usedCapacity+i>this._capacity&&this.makeSpace(i),this.usedCapacity+=i,this.freeCapacity=this._capacity-this.usedCapacity,o={key:n,entry:r,size:i,lastUsed:Date.now()},this.entries[n]=o},n.prototype.clear=function(e){if(e)for(var t in this.entries)this.entries.hasOwnProperty(t)&&this.removeCacheEntry(t);this.entries={},this.freeCapacity=this._capacity,this.usedCapacity=0},n.prototype.removeEntry=function(e){if(!e)return;var t=this.entries[e];t&&this.removeCacheEntry(t)},n.prototype.removeCacheEntry=function(e){delete this.entries[e.key],this.usedCapacity-=e.size,this.freeCapacity=this._capacity-this.usedCapacity;for(var t=0,n=this.listeners.length;t<n;t++)try{this.listeners[t].entryRemoved(e.key,e.entry)}catch(r){this.listeners[t].removalError(r,e.key,e.entry)}},n.prototype.containsKey=function(e){return e&&this.entries[e]},n.prototype.addCacheListener=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","addCacheListener","missingListener"));if(typeof n.entryRemoved!="function"||typeof n.removalError!="function")throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","addCacheListener","The specified listener does not implement the required functions."));this.listeners.push(n)},n.prototype.removeCacheListener=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"MemoryCache","removeCacheListener","missingListener"));var r=this.listeners.indexOf(n);r>-1&&this.listeners.splice(r,1)},n.prototype.makeSpace=function(e){var t=[],n=this.usedCapacity;for(var r in this.entries)this.entries.hasOwnProperty(r)&&t.push(this.entries[r]);t.sort(function(e,t){return e.lastUsed-t.lastUsed});for(var i=0,s=t.length;i<s;i++){if(!(this.usedCapacity>this._lowWater||this.freeCapacity<e))break;this.removeCacheEntry(t[i])}},n}),n("layer/TiledImageLayer",["../util/AbsentResourceList","../error/ArgumentError","../render/ImageTile","../layer/Layer","../util/LevelSet","../util/Logger","../cache/MemoryCache","../render/Texture","../util/Tile","../util/WWUtil"],function(e,t,n,r,i,s,o,u,a,f){"use strict";var l=function(n,u,a,f,l,c,h){if(!n)throw new t(s.logMessage(s.LEVEL_SEVERE,"TiledImageLayer","constructor","missingSector"));if(!u)throw new t(s.logMessage(s.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified level-zero delta is null or undefined."));if(!f)throw new t(s.logMessage(s.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified image format is null or undefined."));if(!l)throw new t(s.logMessage(s.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified cache path is null or undefined."));if(!a||a<1)throw new t(s.logMessage(s.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified number of levels is less than one."));if(!c||!h||c<1||h<1)throw new t(s.logMessage(s.LEVEL_SEVERE,"TiledImageLayer","constructor","The specified tile width or height is less than one."));r.call(this,"Tiled Image Layer"),this.retrievalImageFormat=f,this.cachePath=l,this.levels=new i(n,u,a,c,h),this.currentTiles=[],this.currentTilesInvalid=!0,this.tileCache=new o(5e5,4e5),this.detailHintOrigin=2.4,this.detailHint=0,this.currentRetrievals=[],this.absentResourceList=new e(3,5e4),this.mapAncestorToTile=!0,this.pickEnabled=!1};return l.prototype=Object.create(r.prototype),l.prototype.createTile=function(e,t,r,i){var s=this.cachePath+"-layer/"+t.levelNumber+"/"+r+"/"+r+"_"+i+"."+f.suffixForMimeType(this.retrievalImageFormat);return new n(e,t,r,i,s)},l.prototype.doRender=function(e){if(!e.terrain)return;this.expiration&&(new Date).getTime()>this.expiration.getTime()&&(this.currentTilesInvalid=!0);if(this.currentTilesInvalid||!this.lasTtMVP||!e.navigatorState.modelviewProjection.equals(this.lasTtMVP)||e.globeStateKey!=this.lastGlobeStateKey)this.currentTilesInvalid=!1,this.assembleTiles(e);this.lasTtMVP=e.navigatorState.modelviewProjection,this.lastGlobeStateKey=e.globeStateKey,this.currentTiles.length>0&&(e.surfaceTileRenderer.renderTiles(e,this.currentTiles,this.opacity),e.frameStatistics.incrementImageTileCount(this.currentTiles.length),this.inCurrentFrame=!0)},l.prototype.isLayerInView=function(e){return e.terrain&&e.terrain.sector&&e.terrain.sector.intersects(this.levels.sector)},l.prototype.createTopLevelTiles=function(e){this.topLevelTiles=[],a.createTilesForLevel(this.levels.firstLevel(),this,this.topLevelTiles)},l.prototype.assembleTiles=function(e){this.currentTiles=[],(!this.topLevelTiles||this.topLevelTiles.length===0)&&this.createTopLevelTiles(e);for(var t=0,n=this.topLevelTiles.length;t<n;t++){var r=this.topLevelTiles[t];r.update(e),this.currentAncestorTile=null,this.isTileVisible(e,r)&&this.addTileOrDescendants(e,r)}},l.prototype.addTileOrDescendants=function(e,t){if(this.tileMeetsRenderingCriteria(e,t)){this.addTile(e,t);return}var n=null;try{if(this.isTileTextureInMemory(e,t)||t.level.levelNumber===0)n=this.currentAncestorTile,this.currentAncestorTile=t;var r=this.levels.level(t.level.levelNumber+1),i=t.subdivideToCache(r,this,this.tileCache);for(var s=0,o=i.length;s<o;s++){var u=i[s];u.update(e),this.levels.sector.intersects(u.sector)&&this.isTileVisible(e,u)&&this.addTileOrDescendants(e,u)}}finally{n&&(this.currentAncestorTile=n)}},l.prototype.addTile=function(e,t){t.fallbackTile=null;var n=e.gpuResourceCache.resourceForKey(t.imagePath);if(n){this.currentTiles.push(t),this.expiration&&this.isTextureExpired(n)&&this.retrieveTileImage(e,t);return}this.retrieveTileImage(e,t),this.currentAncestorTile&&this.isTileTextureInMemory(e,this.currentAncestorTile)&&(this.mapAncestorToTile?(t.fallbackTile=this.currentAncestorTile,this.currentTiles.push(t)):this.currentTiles.push(this.currentAncestorTile))},l.prototype.isTileVisible=function(e,t){return e.globe.projectionLimits&&!t.sector.overlaps(e.globe.projectionLimits)?!1:t.extent.intersectsFrustum(e.navigatorState.frustumInModelCoordinates)},l.prototype.tileMeetsRenderingCriteria=function(e,t){var n=this.detailHintOrigin+this.detailHint;if(t.sector.minLatitude>=75||t.sector.maxLatitude<=-75)n*=.9;return t.level.isLastLevel()||!t.mustSubdivide(e,n)},l.prototype.isTileTextureInMemory=function(e,t){return e.gpuResourceCache.containsResource(t.imagePath)},l.prototype.isTextureExpired=function(e){return this.expiration&&this.expiration<(new Date).getTime},l.prototype.retrieveTileImage=function(e,t){if(this.currentRetrievals.indexOf(t.imagePath)<0){if(this.absentResourceList.isResourceAbsent(t.imagePath))return;var n=this.resourceUrlForTile(t,this.retrievalImageFormat),r=new Image,i=t.imagePath,o=e.gpuResourceCache,u=e.currentGlContext.canvas,a=this;if(!n){this.currentTilesInvalid=!0;return}r.onload=function(){s.log(s.LEVEL_INFO,"Image retrieval succeeded: "+n);var f=a.createTexture(e,t,r);a.removeFromCurrentRetrievals(i);if(f){o.putResource(i,f,f.size),a.currentTilesInvalid=!0,a.absentResourceList.unmarkResourceAbsent(i);var l=document.createEvent("Event");l.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),u.dispatchEvent(l)}},r.onerror=function(){a.removeFromCurrentRetrievals(i),a.absentResourceList.markResourceAbsent(i),s.log(s.LEVEL_WARNING,"Image retrieval failed: "+n)},this.currentRetrievals.push(i),r.crossOrigin="anonymous",r.src=n}},l.prototype.createTexture=function(e,t,n){return new u(e.currentGlContext,n)},l.prototype.removeFromCurrentRetrievals=function(e){var t=this.currentRetrievals.indexOf(e);t>-1&&this.currentRetrievals.splice(t,1)},l.prototype.resourceUrlForTile=function(e,t){return this.urlBuilder?this.urlBuilder.urlForTile(e,t):null},l}),n("geom/Vec2",["../util/Logger","../error/ArgumentError","../geom/Vec3"],function(e,t,n){"use strict";var r=function(t,n){this[0]=t,this[1]=n};return r.prototype=new Float64Array(2),r.prototype.set=function(e,t){return this[0]=e,this[1]=t,this},r.prototype.copy=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","copy","missingVector"));return this[0]=n[0],this[1]=n[1],this},r.prototype.equals=function(e){return this[0]===e[0]&&this[1]===e[1]},r.average=function(n,r){if(!n||n.length<1)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","average","missingArray"));if(!r)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","average","missingResult"));var i=n.length,s;r[0]=0,r[1]=0;for(var o=0,u=n.length;o<u;o++)s=n[o],r[0]+=s[0]/i,r[1]+=s[1]/i;return r},r.prototype.add=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","add","missingVector"));return this[0]+=n[0],this[1]+=n[1],this},r.prototype.subtract=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","subtract","missingVector"));return this[0]-=n[0],this[1]-=n[1],this},r.prototype.multiply=function(e){return this[0]*=e,this[1]*=e,this},r.prototype.divide=function(e){return this[0]/=e,this[1]/=e,this},r.prototype.mix=function(n,r){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","mix","missingVector"));var i=1-r,s=r;return this[0]=this[0]*i+n[0]*s,this[1]=this[1]*i+n[1]*s,this},r.prototype.negate=function(){return this[0]=-this[0],this[1]=-this[1],this},r.prototype.dot=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","dot","missingVector"));return this[0]*n[0]+this[1]*n[1]},r.prototype.magnitudeSquared=function(){return this.dot(this)},r.prototype.magnitude=function(){return Math.sqrt(this.magnitudeSquared())},r.prototype.normalize=function(){var e=this.magnitude(),t=1/e;return this[0]*=t,this[1]*=t,this},r.prototype.distanceToSquared=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","distanceToSquared","missingVector"));var r=this[0]-n[0],i=this[1]-n[1];return r*r+i*i},r.prototype.distanceTo=function(n){if(!n)throw new t(e.logMessage(e.LEVEL_SEVERE,"Vec2","distanceTo","missingVector"));return Math.sqrt(this.distanceToSquared(n))},r.prototype.toVec3=function(){return new n(this[0],this[1],0)},r.prototype.swap=function(e){var t=this[0];return this[0]=e[0],e[0]=t,t=this[1],this[1]=e[1],e[1]=t,this},r.prototype.toString=function(){return"("+this[0]+", "+this[1]+")"},r}),n("layer/MercatorTiledImageLayer",["../util/Color","../geom/Sector","../layer/TiledImageLayer","../geom/Vec2","../util/WWMath"],function(e,t,n,r,i){"use strict";var s=function(e,t,i,s,o,u,a){n.call(this,e,t,i,s,o,u,a),this.detectBlankImages=!1,this.testPixels=[new r(20,20),new r(235,20),new r(20,235),new r(235,235)],this.destCanvas=document.createElement("canvas"),this.destContext=this.destCanvas.getContext("2d")};return s.prototype=Object.create(n.prototype),s.prototype.createTile=function(e,r,s,o){var u=this.mapSizeForLevel(r.levelNumber),a=i.clamp(o*this.imageSize-.5,0,u),f=i.clamp(s*this.imageSize-.5,0,u),l=i.clamp(a+this.imageSize+.5,0,u),c=i.clamp(f+this.imageSize+.5,0,u),h,p,d,v,m,g;return h=a/u-.5,p=.5-c/u,d=90-360*Math.atan(Math.exp(-p*2*Math.PI))/Math.PI,v=360*h,h=l/u-.5,p=.5-f/u,m=90-360*Math.atan(Math.exp(-p*2*Math.PI))/Math.PI,g=360*h,e=new t(d,m,v,g),n.prototype.createTile.call(this,e,r,s,o)},s.prototype.createTexture=function(e,t,r){var s=e.canvas2D,o=e.ctx2D,u,a=this.destCanvas,f=this.destContext,l=f.createImageData(r.width,r.height),c=t.sector,h=i.gudermannianInverse(c.minLatitude),p=i.gudermannianInverse(c.maxLatitude),d,v,m,g,y,b,w;s.width=r.width,s.height=r.height,a.width=r.width,a.height=r.height,o.drawImage(r,0,0,r.width,r.height),u=o.getImageData(0,0,r.width,r.height);if(this.detectBlankImages&&this.isBlankImage(r,u))return this.absentResourceList.markResourceAbsentPermanently(t.imagePath),null;for(var E=0;E<1;E++)for(var S=0;S<r.height;S++){b=1-S/(r.height-1),d=b*c.deltaLatitude()+c.minLatitude,v=i.gudermannianInverse(d),w=1-(v-h)/(p-h),w=i.clamp(w,0,1),m=Math.floor(w*(r.height-1));for(var x=0;x<r.width;x++)g=4*(x+m*r.width),y=4*(x+S*r.width),l.data[y]=u.data[g],l.data[y+1]=u.data[g+1],l.data[y+2]=u.data[g+2],l.data[y+3]=u.data[g+3]}return f.putImageData(l,0,0),n.prototype.createTexture.call(this,e,t,a)},s.prototype.isBlankImage=function(e,t){var n,r,i=null;for(var s=0,o=this.testPixels.length;s<o;s++){n=this.testPixels[s],r=4*(n[0]+n[1]*e.width);if(!i)i=[t.data[r],t.data[r+1],t.data[r+2]];else if(t.data[r]!=i[0]||t.data[r+1]!=i[1]||t.data[r+2]!=i[2])return!1}return!0},s}),n("layer/BingTiledImageLayer",["../geom/Angle","../geom/Location","../geom/Sector","../layer/MercatorTiledImageLayer"],function(e,t,n,r){"use strict";var i=function(e){this.imageSize=256,r.call(this,new n(-85.05,85.05,-180,180),new t(85.05,180),23,"image/jpeg",e,this.imageSize,this.imageSize),this.displayName=e,this.pickEnabled=!1,this.detailHintOrigin=2.6,this.mapAncestorToTile=!1,this.detectBlankImages=!0,this.creditImage=WorldWind.configuration.baseUrl+"images/powered-by-bing.png"};return i.prototype=Object.create(r.prototype),i.prototype.doRender=function(e){r.prototype.doRender.call(this,e),this.inCurrentFrame&&e.screenCreditController.addImageCredit(this.creditImage)},i.prototype.createTopLevelTiles=function(e){this.topLevelTiles=[],this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),0,0)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),0,1)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),1,0)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),1,1))},i.prototype.mapSizeForLevel=function(e){return 256<<e+1},i}),n("util/BingImageryUrlBuilder",["../error/ArgumentError","../util/Logger","../util/WWUtil"],function(e,t,n){"use strict";var r=function(e,t){var n="AkttWCS8p6qzxvx5RH3qUcCPgwG9nRJ7IwlpFGb14B0rBorB5DvmXr2Y_eCUNIxH";t||(this.bingMapsKey=WorldWind.BingMapsKey,t||(this.bingMapsKey=n),t===n&&(this.bingMapsKey=n,r.showBingMapsKeyWarning())),this.imagerySet=e};return r.showBingMapsKeyWarning=function(){r.keyMessagePrinted||(r.keyMessagePrinted=!0,t.log(t.LEVEL_WARNING,"WARNING: You are using a limited use, non-production Bing Maps key.\nIf you are developing an app or a web page this violates the Bing Terms of Use.\nPlease visit https://www.microsoft.com/maps/choose-your-bing-maps-API.aspx to obtain your own key for your application.\nSpecify that key to World Wind by setting the WorldWind.BingMapsKey property to your key prior to creating any Bing Maps layers.\n"))},r.prototype.requestMetadata=function(){if(!this.metadataRetrievalInProcess){this.metadataRetrievalInProcess=!0;var e="http://dev.virtualearth.net/REST/V1/Imagery/Metadata/"+this.imagerySet+"/0,0?zl=1&key="+this.bingMapsKey,t=this;n.jsonp(e,"jsonp",function(e){t.imageUrl=e.resourceSets[0].resources[0].imageUrl;var n=document.createEvent("Event");n.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),window.dispatchEvent(n),t.metadataRetrievalInProcess=!1})}},r.prototype.urlForTile=function(n,r){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"BingImageryUrlBuilder","urlForTile","missingTile"));if(!this.imageUrl)return this.requestMetadata(),null;var i=this.quadKeyFromLevelRowColumn(n.level.levelNumber,n.row,n.column),s;return this.imagerySet==="Aerial"?s=this.imageUrl.replace(/a3/,"a"+i):this.imagerySet==="AerialWithLabels"?s=this.imageUrl.replace(/h3/,"h"+i):this.imagerySet==="Road"&&(s=this.imageUrl.replace(/r3/,"r"+i)),s},r.prototype.quadKeyFromLevelRowColumn=function(e,t,n){var r,i,s="";for(var o=e+1;o>0;o--)r=0,i=1<<o-1,(n&i)!=0&&(r+=1),(t&i)!=0&&(r+=2),s+=r.toString();return s},r}),n("layer/BingAerialLayer",["../geom/Location","../geom/Sector","../layer/BingTiledImageLayer","../util/BingImageryUrlBuilder"],function(e,t,n,r){"use strict";var i=function(e){n.call(this,"Bing Aerial"),this.urlBuilder=new r("Aerial",e)};return i.prototype=Object.create(n.prototype),i}),n("layer/BingAerialWithLabelsLayer",["../geom/Location","../geom/Sector","../layer/BingTiledImageLayer","../util/BingImageryUrlBuilder"],function(e,t,n,r){"use strict";var i=function(e){n.call(this,"Bing Aerial with Labels"),this.urlBuilder=new r("AerialWithLabels",e)};return i.prototype=Object.create(n.prototype),i}),n("layer/BingRoadsLayer",["../geom/Location","../geom/Sector","../layer/BingTiledImageLayer","../util/BingImageryUrlBuilder"],function(e,t,n,r){"use strict";var i=function(e){n.call(this,"Bing Roads"),this.urlBuilder=new r("Road",e),this.detectBlankImages=!1};return i.prototype=Object.create(n.prototype),i}),n("util/WmsUrlBuilder",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(n,r,i,s){if(!n||n.length===0)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsUrlBuilder","constructor","The WMS service address is missing."));if(!r||r.length===0)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsUrlBuilder","constructor","The WMS layer names are not specified."));this.serviceAddress=n,this.layerNames=r,this.styleNames=i?i:"",this.transparent=!0,this.wmsVersion=s&&s.length>0?s:"1.3.0",this.isWms130OrGreater=s>="1.3.0",this.crs="EPSG:4326"};return n.prototype.urlForTile=function(r,i){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsUrlBuilder","urlForTile","missingTile"));if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsUrlBuilder","urlForTile","The image format is null or undefined."));var s=r.sector,o=n.fixGetMapString(this.serviceAddress);return o.search(/service=wms/i)<0&&(o+="service=WMS"),o+="&request=GetMap",o=o+"&version="+this.wmsVersion,o=o+"&transparent="+(this.transparent?"TRUE":"FALSE"),o=o+"&layers="+this.layerNames,o=o+"&styles="+this.styleNames,o=o+"&format="+i,o=o+"&width="+r.tileWidth,o=o+"&height="+r.tileHeight,this.isWms130OrGreater?(o=o+"&crs="+this.crs,o+="&bbox=",this.crs==="CRS:84"?(o=o+s.minLongitude+","+s.minLatitude+",",o=o+s.maxLongitude+","+s.maxLatitude):(o=o+s.minLatitude+","+s.minLongitude+",",o=o+s.maxLatitude+","+s.maxLongitude)):(o=o+"&srs="+this.crs,o+="&bbox=",o=o+s.minLongitude+","+s.minLatitude+",",o=o+s.maxLongitude+","+s.maxLatitude),o=o.replace(" ","%20"),o},n.fixGetMapString=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsUrlBuilder","fixGetMapString","The specified service address is null or undefined."));var r=n.indexOf("?");return r<0?n+="?":r!==n.length-1&&(r=n.search(/&$/),r<0&&(n+="&")),n},n}),n("layer/BingWMSLayer",["../geom/Location","../geom/Sector","../layer/TiledImageLayer","../util/WmsUrlBuilder"],function(e,t,n,r){"use strict";var i=function(){n.call(this,t.FULL_SPHERE,new e(45,45),16,"image/png","BingWMS",256,256),this.displayName="Bing WMS",this.pickEnabled=!1,this.maxActiveAltitude=1e4,this.urlBuilder=new r("http://worldwind27.arc.nasa.gov/wms/virtualearth","ve","","1.3.0")};return i.prototype=Object.create(n.prototype),i}),n("layer/BMNGLayer",["../geom/Location","../geom/Sector","../layer/TiledImageLayer","../util/WmsUrlBuilder"],function(e,t,n,r){"use strict";var i=function(i){n.call(this,t.FULL_SPHERE,new e(45,45),5,"image/jpeg",i||"BMNG256",256,256),this.displayName="Blue Marble",this.pickEnabled=!1,this.urlBuilder=new r("http://worldwind25.arc.nasa.gov/wms",i||"BlueMarble-200405","","1.3.0")};return i.prototype=Object.create(n.prototype),i}),n("layer/BlueMarbleLayer",["../layer/BMNGLayer","../layer/Layer"],function(e,t){"use strict";var n=function(e,r){t.call(this,e||"Blue Marble"),this.time=r||new Date("2004-01"),this.pickEnabled=!1,this.layers={},this.layerNames=[{month:"BlueMarble-200401",time:n.availableTimes[0]},{month:"BlueMarble-200402",time:n.availableTimes[1]},{month:"BlueMarble-200403",time:n.availableTimes[2]},{month:"BlueMarble-200404",time:n.availableTimes[3]},{month:"BlueMarble-200405",time:n.availableTimes[4]},{month:"BlueMarble-200406",time:n.availableTimes[5]},{month:"BlueMarble-200407",time:n.availableTimes[6]},{month:"BlueMarble-200408",time:n.availableTimes[7]},{month:"BlueMarble-200409",time:n.availableTimes[8]},{month:"BlueMarble-200410",time:n.availableTimes[9]},{month:"BlueMarble-200411",time:n.availableTimes[10]},{month:"BlueMarble-200412",time:n.availableTimes[11]}]};return n.prototype=Object.create(t.prototype),n.availableTimes=[new Date("2004-01"),new Date("2004-02"),new Date("2004-03"),new Date("2004-04"),new Date("2004-05"),new Date("2004-06"),new Date("2004-07"),new Date("2004-08"),new Date("2004-09"),new Date("2004-10"),new Date("2004-11"),new Date("2004-12")],n.prototype.doRender=function(e){var t=this.nearestLayer(this.time);t.opacity=this.opacity,t.doRender(e),this.inCurrentFrame=t.inCurrentFrame},n.prototype.nearestLayer=function(t){var n=this.nearestLayerName(t);return this.layers[n]||(this.layers[n]=new e(n)),this.layers[n]},n.prototype.nearestLayerName=function(e){var t=e.getTime();if(t<=this.layerNames[0].time.getTime())return this.layerNames[0].month;if(t>=this.layerNames[11].time.getTime())return this.layerNames[11].month;for(var n=0;n<this.layerNames.length-1;n++){var r=this.layerNames[n].time.getTime(),i=this.layerNames[n+1].time.getTime();if(t>=r&&t<=i){var s=t-r,o=i-t;return s<o?this.layerNames[n].month:this.layerNames[n+1].month}}},n}),n("layer/BMNGLandsatLayer",["../geom/Location","../geom/Sector","../layer/TiledImageLayer","../util/WmsUrlBuilder"],function(e,t,n,r){"use strict";var i=function(){n.call(this,t.FULL_SPHERE,new e(45,45),10,"image/jpeg","BMNGLandsat256",256,256),this.displayName="Blue Marble & Landsat",this.pickEnabled=!1,this.urlBuilder=new r("http://worldwind25.arc.nasa.gov/wms","BlueMarble-200405,esat","","1.3.0")};return i.prototype=Object.create(n.prototype),i}),n("layer/RenderableLayer",["../error/ArgumentError","../layer/Layer","../util/Logger"],function(e,t,n){"use strict";var r=function(e){t.call(this,e),this.renderables=[]};return r.prototype=Object.create(t.prototype),r.prototype.addRenderable=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"RenderableLayer","addRenderable","missingRenderable"));this.renderables.push(t)},r.prototype.addRenderables=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"RenderableLayer","addRenderables","The renderables array is null or undefined."));for(var r=0,i=t.length;r<i;r++)this.addRenderable(t[r])},r.prototype.removeRenderable=function(e){var t=this.renderables.indexOf(e);t>=0&&this.renderables.splice(t,1)},r.prototype.removeAllRenderables=function(){this.renderables=[]},r.prototype.doRender=function(e){var t=e.orderedRenderables.length;for(var r=0,i=this.renderables.length;r<i;r++)try{this.renderables[r].render(e)}catch(s){n.logMessage(n.LEVEL_SEVERE,"RenderableLayer","doRender","Error while rendering shape "+this.renderables[r].displayName+".\n"+s.toString())}e.orderedRenderables.length>t&&(this.inCurrentFrame=!0)},r}),n("pick/PickedObject",[],function(){"use strict";var e=function(e,t,n,r,i){this.color=e,this.userObject=t,this.position=n,this.parentLayer=r,this.isTerrain=i,this.isOnTop=!1};return e}),n("error/UnsupportedOperationError",["../error/AbstractError"],function(e){"use strict";var t=function(t){e.call(this,"UnsupportedOperationError",t);var n;try{throw new Error}catch(r){n=r.stack}this.stack=n};return t.prototype=Object.create(e.prototype),t}),n("render/SurfaceTile",["../error/ArgumentError","../util/Logger","../geom/Matrix","../geom/Sector","../error/UnsupportedOperationError"],function(e,t,n,r,i){"use strict";var s=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfaceTile","constructor","missingSector"));this.sector=n};return s.prototype.bind=function(e){throw new i(t.logMessage(t.LEVEL_SEVERE,"SurfaceTile","bind","abstractInvocation"))},s.prototype.applyInternalTransform=function(e,n){throw new i(t.logMessage(t.LEVEL_SEVERE,"SurfaceTile","applyInternalTransform","abstractInvocation"))},s}),n("shapes/SurfaceImage",["../error/ArgumentError","../util/Logger","../pick/PickedObject","../render/SurfaceTile"],function(e,t,n,r){"use strict";var i=function(n,i){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfaceImage","constructor","missingSector"));if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfaceImage","constructor","missingImage"));r.call(this,n),this.enabled=!0,this._imageSource=i,this.opacity=1,this.displayName="Surface Image",this.imageSourceWasUpdated=!0};return i.prototype=Object.create(r.prototype),Object.defineProperties(i.prototype,{imageSource:{get:function(){return this._imageSource},set:function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfaceImage","imageSource","missingImage"));this._imageSource=n,this.imageSourceWasUpdated=!0}}}),i.prototype.bind=function(e){var t=e.gpuResourceCache.resourceForKey(this._imageSource);if(t&&!this.imageSourceWasUpdated)return t.bind(e);t=e.gpuResourceCache.retrieveTexture(e.currentGlContext,this._imageSource),this.imageSourceWasUpdated=!1;if(t)return t.bind(e)},i.prototype.applyInternalTransform=function(e,t){},i.prototype.render=function(e){if(!this.enabled||!this.sector.overlaps(e.terrain.sector))return;e.pickingMode&&(this.pickColor=e.uniquePickColor()),e.surfaceTileRenderer.renderTiles(e,[this],this.opacity*e.currentLayer.opacity);if(e.pickingMode){var t=new n(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,null,this.layer,!1);e.resolvePick(t)}e.currentLayer.inCurrentFrame=!0},i}),n("layer/BMNGOneImageLayer",["../layer/RenderableLayer","../geom/Sector","../shapes/SurfaceImage","../util/WWUtil"],function(e,t,n,r){"use strict";var i=function(){e.call(this,"Blue Marble Image");var i=new n(t.FULL_SPHERE,r.currentUrlSansFilePart()+"/../images/BMNG_world.topo.bathy.200405.3.2048x1024.jpg");this.addRenderable(i),this.pickEnabled=!1,this.minActiveAltitude=3e6};return i.prototype=Object.create(e.prototype),i}),n("util/LevelRowColumnUrlBuilder",["../error/ArgumentError","../util/Logger","../util/WWUtil"],function(e,t,n){"use strict";var r=function(e,t){this.serverAddress=e;if(!e||e.length===0)this.serverAddress=n.currentUrlSansFilePart();this.pathToData=t};return r.prototype.urlForTile=function(r,i){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsUrlBuilder","urlForTile","missingTile"));if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsUrlBuilder","urlForTile","The image format is null or undefined."));var s=this.serverAddress;return this.pathToData&&(s=s+"/"+this.pathToData),s=s+"/"+r.level.levelNumber.toString(),s=s+"/"+r.row.toString(),s=s+"/"+r.row.toString()+"_"+r.column.toString(),s=s+"."+n.suffixForMimeType(i),s=s.replace(" ","%20"),s},r}),n("layer/BMNGRestLayer",["../error/ArgumentError","../geom/Location","../util/Logger","../geom/Sector","../layer/TiledImageLayer","../util/LevelRowColumnUrlBuilder","../util/WWUtil"],function(e,t,n,r,i,s,o){"use strict";var u=function(e,n,u){var a=o.urlPath(e+"/"+n);i.call(this,r.FULL_SPHERE,new t(45,45),5,"image/jpeg",a,256,256),this.displayName=u,this.pickEnabled=!1,this.urlBuilder=new s(e,n)};return u.prototype=Object.create(i.prototype),u}),n("gesture/Touch",[],function(){"use strict";var e=function(e,t,n){this.identifier=e,this._clientX=t,this._clientY=n,this._clientStartX=t,this._clientStartY=n};return Object.defineProperties(e.prototype,{clientX:{get:function(){return this._clientX},set:function(e){this._clientX=e}},clientY:{get:function(){return this._clientY},set:function(e){this._clientY=e}},translationX:{get:function(){return this._clientX-this._clientStartX},set:function(e){this._clientStartX=this._clientX-e}},translationY:{get:function(){return this._clientY-this._clientStartY},set:function(e){this._clientStartY=this._clientY-e}}}),e}),n("gesture/GestureRecognizer",["../error/ArgumentError","../util/Logger","../gesture/Touch"],function(e,t,n){"use strict";var r=function(n,i){function o(e){s.handleEvent(e)}if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"GestureRecognizer","constructor","missingTarget"));this.target=n,this.enabled=!0,this._state=WorldWind.POSSIBLE,this._nextState=null,this._clientX=0,this._clientY=0,this._clientStartX=0,this._clientStartY=0,this._translationX=0,this._translationY=0,this._translationWeight=.4,this._mouseButtonMask=0,this._touches=[],this._touchCentroidShiftX=0,this._touchCentroidShiftY=0,this._gestureCallbacks=[],this._canRecognizeWith=[],this._requiresFailureOf=[],this._requiredToFailBy=[],i&&this._gestureCallbacks.push(i),r.allRecognizers.push(this);var s=this;window.PointerEvent?(n.addEventListener("pointerdown",o,!1),window.addEventListener("pointermove",o,!1),window.addEventListener("pointercancel",o,!1),window.addEventListener("pointerup",o,!1)):(n.addEventListener("mousedown",o,!1),window.addEventListener("mousemove",o,!1),window.addEventListener("mouseup",o,!1),n.addEventListener("touchstart",o,!1),n.addEventListener("touchmove",o,!1),n.addEventListener("touchend",o,!1),n.addEventListener("touchcancel",o,!1))};return r.allRecognizers=[],Object.defineProperties(r.prototype,{state:{get:function(){return this._state},set:function(e){this.transitionToState(e)}},clientX:{get:function(){return this._clientX},set:function(e){this._clientX=e}},clientY:{get:function(){return this._clientY},set:function(e){this._clientY=e}},translationX:{get:function(){return this._translationX},set:function(e){this._translationX=e,this._clientStartX=this._clientX,this._touchCentroidShiftX=0}},translationY:{get:function(){return this._translationY},set:function(e){this._translationY=e,this._clientStartY=this._clientY,this._touchCentroidShiftY=0}},mouseButtonMask:{get:function(){return this._mouseButtonMask}},touchCount:{get:function(){return this._touches.length}},gestureCallbacks:{get:function(){return this._gestureCallbacks}}}),r.prototype.touch=function(n){if(n<0||n>=this._touches.length)throw new e(t.logMessage(t.LEVEL_SEVERE,"GestureRecognizer","touch","indexOutOfRange"));return this._touches[n]},r.prototype.recognizeSimultaneouslyWith=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"GestureRecognizer","recognizeSimultaneouslyWith","The specified gesture recognizer is null or undefined."));var r=this._canRecognizeWith.indexOf(n);r==-1&&(this._canRecognizeWith.push(n),n._canRecognizeWith.push(this))},r.prototype.canRecognizeSimultaneouslyWith=function(e){var t=this._canRecognizeWith.indexOf(e);return t!=-1},r.prototype.requireRecognizerToFail=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"GestureRecognizer","requireRecognizerToFail","The specified gesture recognizer is null or undefined"));var r=this._requiresFailureOf.indexOf(n);r==-1&&(this._requiresFailureOf.push(n),n._requiredToFailBy.push(this))},r.prototype.requiresRecognizerToFail=function(e){var t=this._requiresFailureOf.indexOf(e);return t!=-1},r.prototype.requiredToFailByRecognizer=function(e){var t=this._requiredToFailBy.indexOf(e);return t!=-1},r.prototype.reset=function(){this._state=WorldWind.POSSIBLE,this._nextState=null,this._clientX=0,this._clientY=0,this._clientStartX=0,this._clientStartY=0,this._translationX=0,this._translationY=0,this._mouseButtonMask=0,this._touches=[],this._touchCentroidShiftX=0,this._touchCentroidShiftY=0},r.prototype.prepareToRecognize=function(){},r.prototype.mouseDown=function(e){},r.prototype.mouseMove=function(e){},r.prototype.mouseUp=function(e){},r.prototype.touchStart=function(e){},r.prototype.touchMove=function(e){},r.prototype.touchCancel=function(e){},r.prototype.touchEnd=function(e){},r.prototype.transitionToState=function(e){this._nextState=null,e==WorldWind.FAILED?(this._state=e,this.updateRecognizersWaitingForFailure(),this.resetIfEventsEnded()):e==WorldWind.RECOGNIZED?(this.tryToRecognize(e),this._state==e&&(this.prepareToRecognize(),this.callGestureCallbacks(),this.resetIfEventsEnded())):e==WorldWind.BEGAN?(this.tryToRecognize(e),this._state==e&&(this.prepareToRecognize(),this.callGestureCallbacks())):e==WorldWind.CHANGED?(this._state=e,this.callGestureCallbacks()):e==WorldWind.CANCELLED?(this._state=e,this.callGestureCallbacks(),this.resetIfEventsEnded()):e==WorldWind.ENDED&&(this._state=e,this.callGestureCallbacks(),this.resetIfEventsEnded())},r.prototype.updateRecognizersWaitingForFailure=function(){for(var e=0,t=this._requiredToFailBy.length;e<t;e++){var n=this._requiredToFailBy[e];n._nextState!=null&&n.transitionToState(n._nextState)}},r.prototype.tryToRecognize=function(e){if(r.allRecognizers.some(this.canBePreventedByRecognizer,this)){this.transitionToState(WorldWind.FAILED);return}if(r.allRecognizers.some(this.isWaitingForRecognizerToFail,this)){this._nextState=e;return}var t=r.allRecognizers.filter(this.canPreventRecognizer,this);for(var n=0,i=t.length;n<i;n++)t[n].transitionToState(WorldWind.FAILED);this._state=e},r.prototype.canPreventRecognizer=function(e){return this!=e&&this.target==e.target&&e.state==WorldWind.POSSIBLE&&(this.requiredToFailByRecognizer(e)||!this.canRecognizeSimultaneouslyWith(e))},r.prototype.canBePreventedByRecognizer=function(e){return this!=e&&this.target==e.target&&e.state==WorldWind.RECOGNIZED&&(this.requiresRecognizerToFail(e)||!this.canRecognizeSimultaneouslyWith(e))},r.prototype.isWaitingForRecognizerToFail=function(e){return this!=e&&this.target==e.target&&e.state==WorldWind.POSSIBLE&&this.requiresRecognizerToFail(e)},r.prototype.callGestureCallbacks=function(){for(var e=0,t=this._gestureCallbacks.length;e<t;e++)this._gestureCallbacks[e](this)},r.prototype.handleEvent=function(e){if(!this.enabled)return;if(e.defaultPrevented&&this.state==WorldWind.POSSIBLE)return;var n,r;try{if(e.type=="mousedown")this.handleMouseDown(e);else if(e.type=="mousemove")this.handleMouseMove(e);else if(e.type=="mouseup")this.handleMouseUp(e);else if(e.type=="touchstart")for(n=0,r=e.changedTouches.length;n<r;n++)this.handleTouchStart(e.changedTouches.item(n));else if(e.type=="touchmove")for(n=0,r=e.changedTouches.length;n<r;n++)this.handleTouchMove(e.changedTouches.item(n));else if(e.type=="touchcancel")for(n=0,r=e.changedTouches.length;n<r;n++)this.handleTouchCancel(e.changedTouches.item(n));else if(e.type=="touchend")for(n=0,r=e.changedTouches.length;n<r;n++)this.handleTouchEnd(e.changedTouches.item(n));else if(e.type=="pointerdown"&&e.pointerType=="mouse")this.handleMouseDown(e);else if(e.type=="pointermove"&&e.pointerType=="mouse")this.handleMouseMove(e);else if(e.type!="pointercancel"||e.pointerType!="mouse")e.type=="pointerup"&&e.pointerType=="mouse"?this.handleMouseUp(e):e.type=="pointerdown"&&e.pointerType=="touch"?this.handleTouchStart(e):e.type=="pointermove"&&e.pointerType=="touch"?this.handleTouchMove(e):e.type=="pointercancel"&&e.pointerType=="touch"?this.handleTouchCancel(e):e.type=="pointerup"&&e.pointerType=="touch"?this.handleTouchEnd(e):t.logMessage(t.LEVEL_INFO,"GestureRecognizer","handleEvent","Unrecognized event type: "+e.type)}catch(i){t.logMessage(t.LEVEL_SEVERE,"GestureRecognizer","handleEvent","Error handling event.\n"+i.toString())}},r.prototype.handleMouseDown=function(e){if(e.type=="mousedown"&&this._touches.length>0)return;var t=1<<e.button;if(t&this._mouseButtonMask!=0)return;this._mouseButtonMask==0&&(this._clientX=e.clientX,this._clientY=e.clientY,this._clientStartX=e.clientX,this._clientStartY=e.clientY,this._translationX=0,this._translationY=0),this._mouseButtonMask|=t,this.mouseDown(e)},r.prototype.handleMouseMove=function(e){if(this._mouseButtonMask==0)return;if(this._clientX==e.clientX&&this._clientY==e._clientY)return;var t=e.clientX-this._clientStartX,n=e.clientY-this._clientStartY,r=this._translationWeight;this._clientX=e.clientX,this._clientY=e.clientY,this._translationX=this._translationX*(1-r)+t*r,this._translationY=this._translationY*(1-r)+n*r,this.mouseMove(e)},r.prototype.handleMouseUp=function(e){var t=1<<e.button;if(t&this._mouseButtonMask==0)return;this._mouseButtonMask&=~t,this.mouseUp(e),this._mouseButtonMask==0&&this.resetIfEventsEnded()},r.prototype.handleTouchStart=function(e){var t=new n(e.identifier||e.pointerId,e.clientX,e.clientY);this._touches.push(t),this._touches.length==1?(this._clientX=e.clientX,this._clientY=e.clientY,this._clientStartX=e.clientX,this._clientStartY=e.clientY,this._translationX=0,this._translationY=0,this._touchCentroidShiftX=0,this._touchCentroidShiftY=0):this.touchesAddedOrRemoved(),this.touchStart(t)},r.prototype.handleTouchMove=function(e){var t=this.indexOfTouchWithId(e.identifier||e.pointerId);if(t==-1)return;var n=this._touches[t];if(n.clientX==e.clientX&&n.clientY==e.clientY)return;n.clientX=e.clientX,n.clientY=e.clientY;var r=this.touchCentroid(),i=r.clientX-this._clientStartX+this._touchCentroidShiftX,s=r.clientY-this._clientStartY+this._touchCentroidShiftY,o=this._translationWeight;this._clientX=r.clientX,this._clientY=r.clientY,this._translationX=this._translationX*(1-o)+i*o,this._translationY=this._translationY*(1-o)+s*o,this.touchMove(n)},r.prototype.handleTouchCancel=function(e){var t=this.indexOfTouchWithId(e.identifier||e.pointerId);if(t==-1)return;var n=this._touches[t];this._touches.splice(t,1),this.touchesAddedOrRemoved(),this.touchCancel(n),this.resetIfEventsEnded()},r.prototype.handleTouchEnd=function(e){var t=this.indexOfTouchWithId(e.identifier||e.pointerId);if(t==-1)return;var n=this._touches[t];this._touches.splice(t,1),this.touchesAddedOrRemoved(),this.touchEnd(n),this.resetIfEventsEnded()},r.prototype.resetIfEventsEnded=function(){this._state!=WorldWind.POSSIBLE&&this._mouseButtonMask==0&&this._touches.length==0&&this.reset()},r.prototype.touchesAddedOrRemoved=function(){this._touchCentroidShiftX+=this._clientX,this._touchCentroidShiftY+=this._clientY;var e=this.touchCentroid();this._clientX=e.clientX,this._clientY=e.clientY,this._touchCentroidShiftX-=this._clientX,this._touchCentroidShiftY-=this._clientY},r.prototype.touchCentroid=function(){var e=0,t=0;for(var n=0,r=this._touches.length;n<r;n++){var i=this._touches[n];e+=i.clientX/r,t+=i.clientY/r}return{clientX:e,clientY:t}},r.prototype.indexOfTouchWithId=function(e){for(var t=0,n=this._touches.length;t<n;t++)if(this._touches[t].identifier==e)return t;return-1},r}),n("gesture/ClickRecognizer",["../gesture/GestureRecognizer"],function(e){"use strict";var t=function(t,n){e.call(this,t,n),this.numberOfClicks=1,this.button=0,this.maxMouseMovement=5,this.maxClickDuration=500,this.maxClickInterval=400,this.clicks=[],this.timeout=null};return t.prototype=Object.create(e.prototype),t.prototype.reset=function(){e.prototype.reset.call(this),this.clicks=[],this.cancelFailAfterDelay()},t.prototype.mouseDown=function(e){if(this.state!=WorldWind.POSSIBLE)return;if(this.button!=e.button)this.state=WorldWind.FAILED;else{var t={clientX:this.clientX,clientY:this.clientY};this.clicks.push(t),this.failAfterDelay(this.maxClickDuration)}},t.prototype.mouseMove=function(e){if(this.state!=WorldWind.POSSIBLE)return;var t=this.translationX,n=this.translationY,r=Math.sqrt(t*t+n*n);r>this.maxMouseMovement&&(this.state=WorldWind.FAILED)},t.prototype.mouseUp=function(e){if(this.state!=WorldWind.POSSIBLE)return;if(this.mouseButtonMask!=0)return;var t=this.clicks.length;t==this.numberOfClicks?(this.clientX=this.clicks[0].clientX,this.clientY=this.clicks[0].clientY,this.state=WorldWind.RECOGNIZED):this.failAfterDelay(this.maxClickInterval)},t.prototype.touchStart=function(e){if(this.state!=WorldWind.POSSIBLE)return;this.state=WorldWind.FAILED},t.prototype.failAfterDelay=function(e){var t=this;t.timeout&&window.clearTimeout(t.timeout),t.timeout=window.setTimeout(function(){t.timeout=null,t.state==WorldWind.POSSIBLE&&(t.state=WorldWind.FAILED)},e)},t.prototype.cancelFailAfterDelay=function(){var e=this;e.timeout&&(window.clearTimeout(e.timeout),e.timeout=null)},t}),n("util/Offset",["../geom/Vec2"],function(e){"use strict";var t=function(e,t,n,r){this.x=t,this.y=r,this.xUnits=e,this.yUnits=n};return t.prototype.clone=function(){return new t(this.xUnits,this.x,this.yUnits,this.y)},t.prototype.offsetForSize=function(t,n){var r,i;return this.xUnits==WorldWind.OFFSET_FRACTION?r=t*this.x:this.xUnits==WorldWind.OFFSET_INSET_PIXELS?r=t-this.x:r=this.x,this.yUnits==WorldWind.OFFSET_FRACTION?i=n*this.y:this.yUnits==WorldWind.OFFSET_INSET_PIXELS?i=n-this.y:i=this.y,new e(r,i)},t.prototype.toString=function(){return this.xUnits+" "+this.x+" "+this.yUnits+" "+this.y},t}),n("util/ImageSource",["../error/ArgumentError","../util/Color","../util/Logger"],function(e,t,n){"use strict";var r=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"ImageSource","constructor","missingImage"));this.image=t,this.key="ImageSource "+ ++r.keyPool};return r.keyPool=0,r}),n("render/Renderable",["../util/Logger","../error/UnsupportedOperationError"],function(e,t){"use strict";var n=function(){this.displayName="Renderable",this.enabled=!0,this.pickDelegate=null};return n.prototype.render=function(n){throw new t(e.logMessage(e.LEVEL_SEVERE,"Renderable","render","abstractInvocation"))},n}),n("shapes/ScreenImage",["../error/ArgumentError","../shaders/BasicTextureProgram","../util/Color","../util/ImageSource","../util/Logger","../geom/Matrix","../util/Offset","../pick/PickedObject","../render/Renderable","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";var c=function(t,r){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"ScreenImage","constructor","missingOffset"));if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"ScreenImage","constructor","missingImage"));a.call(this),this.screenOffset=t,this._imageSource=r,this.imageColor=n.WHITE,this.imageOffset=new o(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,.5),this.imageScale=1,this.imageRotation=0,this.imageTilt=0,this.enabled=!0,this.opacity=1,this.pickDelegate=null,this.activeTexture=null,this.imageTransform=s.fromIdentity(),this.texCoordMatrix=s.fromIdentity(),this.imageBounds=null,this.layer=null};return c.matrix=s.fromIdentity(),c.prototype=Object.create(a.prototype),Object.defineProperties(c.prototype,{imageSource:{get:function(){return this._imageSource},set:function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"ScreenImage","imageSource","missingImage"));this._imageSource=t,this.imageSourceWasUpdated=!0}}}),c.prototype.render=function(e){if(!this.enabled)return;if(!e.accumulateOrderedRenderables)return;var t=null;this.lastFrameTime!==e.timestamp&&(t=this.makeOrderedRenderable(e));if(!t)return;if(!t.isVisible(e))return;t.layer=e.currentLayer,this.lastFrameTime=e.timestamp,e.addOrderedRenderable(t)},c.prototype.renderOrdered=function(e){this.drawOrderedScreenImage(e);if(e.pickingMode){var t=new u(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,null,this.layer,!1);e.resolvePick(t)}},c.prototype.makeOrderedRenderable=function(e){var t,n,r,i,s,o,u;this.activeTexture=this.getActiveTexture(e);if(!this.activeTexture||this.imageSourceWasUpdated){this.activeTexture=e.gpuResourceCache.retrieveTexture(e.currentGlContext,this._imageSource);if(!this.activeTexture)return null}return this.eyeDistance=0,t=this.activeTexture.imageWidth,n=this.activeTexture.imageHeight,r=this.imageScale,o=this.imageOffset.offsetForSize(t,n),i=e.navigatorState.viewport.width,s=e.navigatorState.viewport.height,u=this.screenOffset.offsetForSize(i,s),this.imageTransform.setTranslation(u[0]-o[0]*r,u[1]-o[1]*r,0),this.imageTransform.setScale(t*r,n*r,1),this.imageBounds=l.boundingRectForUnitQuad(this.imageTransform),this},c.prototype.getActiveTexture=function(e){return e.gpuResourceCache.resourceForKey(this._imageSource)},c.prototype.isVisible=function(e){return e.pickingMode?e.pickRectangle&&this.imageBounds.intersects(e.pickRectangle):this.imageBounds.intersects(e.navigatorState.viewport)},c.prototype.drawOrderedScreenImage=function(e){this.beginDrawing(e);try{this.doDrawOrderedScreenImage(e)}finally{this.endDrawing(e)}},c.prototype.beginDrawing=function(e){var n=e.currentGlContext,r;e.findAndBindProgram(t),r=e.currentProgram,n.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,e.unitQuadBuffer()),n.vertexAttribPointer(r.vertexTexCoordLocation,2,WebGLRenderingContext.FLOAT,!1,0,0),n.enableVertexAttribArray(r.vertexPointLocation),n.enableVertexAttribArray(r.vertexTexCoordLocation),r.loadTextureUnit(n,WebGLRenderingContext.TEXTURE0),r.loadModulateColor(n,e.pickingMode)},c.prototype.endDrawing=function(e){var t=e.currentGlContext,n=e.currentProgram;t.disableVertexAttribArray(n.vertexPointLocation),t.disableVertexAttribArray(n.vertexTexCoordLocation),e.bindProgram(null),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,null),t.bindTexture(WebGLRenderingContext.TEXTURE_2D,null),t.enable(WebGLRenderingContext.DEPTH_TEST)},c.prototype.doDrawOrderedScreenImage=function(e){var t=e.currentGlContext,n=e.currentProgram;t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,e.unitQuadBuffer3()),t.vertexAttribPointer(n.vertexPointLocation,3,WebGLRenderingContext.FLOAT,!1,0,0),c.matrix.copy(e.screenProjection),c.matrix.multiplyMatrix(this.imageTransform),c.matrix.multiplyByTranslation(.5,.5,.5),c.matrix.multiplyByRotation(1,0,0,this.imageTilt),c.matrix.multiplyByRotation(0,0,1,this.imageRotation),c.matrix.multiplyByTranslation(-0.5,-0.5,0),n.loadModelviewProjection(t,c.matrix),n.loadTextureEnabled(t,!0),e.pickingMode?(this.pickColor=e.uniquePickColor(),n.loadColor(t,this.pickColor)):(n.loadColor(t,this.imageColor),n.loadOpacity(t,this.opacity*this.layer.opacity)),this.texCoordMatrix.setToIdentity(),this.texCoordMatrix.multiplyByTextureTransform(this.activeTexture),n.loadTextureMatrix(t,this.texCoordMatrix),this.activeTexture.bind(e)&&t.drawArrays(WebGLRenderingContext.TRIANGLE_STRIP,0,4)},c}),n("shapes/Compass",["../error/ArgumentError","../util/Logger","../util/Offset","../shapes/ScreenImage"],function(e,t,n,r){"use strict";var i=function(e,t){var i=e?e:new n(WorldWind.OFFSET_FRACTION,1,WorldWind.OFFSET_FRACTION,1),s=t?t:WorldWind.configuration.baseUrl+"images/notched-compass.png";r.call(this,i,s),e||(this.imageOffset=new n(WorldWind.OFFSET_FRACTION,1.1,WorldWind.OFFSET_FRACTION,1.1)),this.size=.15};return i.prototype=Object.create(r.prototype),i.prototype.render=function(e){this.imageRotation=e.navigatorState.heading,this.imageTilt=e.navigatorState.tilt;var t=this.getActiveTexture(e);t&&(this.imageScale=.15*e.currentGlContext.drawingBufferWidth/t.imageWidth),r.prototype.render.call(this,e)},i}),n("layer/CompassLayer",["../shapes/Compass","../layer/RenderableLayer"],function(e,t){"use strict";var n=function(){t.call(this,"Compass"),this._compass=new e(null,null),this.addRenderable(this._compass)};return n.prototype=Object.create(t.prototype),Object.defineProperties(n.prototype,{compass:{get:function(){return this._compass},set:function(t){t&&t instanceof e&&(this.removeAllRenderables(),this.addRenderable(t),this._compass=t)}}}),n}),n("util/Font",["../error/ArgumentError","../util/Color","../util/Logger"],function(e,t,n){"use strict";var r=function(t,r,i,s,o,u){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"Font","constructor","missingSize"));if(t<=0)throw new e(n.logMessage(n.LEVEL_SEVERE,"Font","constructor","invalidSize"));this._size=t,this.style=r||"normal",this.variant=i||"normal",this.weight=s||"normal",this.family=o||"sans-serif",this.horizontalAlignment=u||"center"};return Object.defineProperties(r.prototype,{size:{get:function(){return this._size},set:function(e){this._fontString=null,this._size=e}},style:{get:function(){return this._style},set:function(e){this._fontString=null,this._style=e}},variant:{get:function(){return this._variant},set:function(e){this._fontString=null,this._variant=e}},weight:{get:function(){return this._weight},set:function(e){this._fontString=null,this._weight=e}},family:{get:function(){return this._family},set:function(e){this._fontString=null,this._family=e}},horizontalAlignment:{get:function(){return this._horizontalAlignment},set:function(e){this._toString=null,this._horizontalAlignment=e}},fontString:{get:function(){return this._fontString||(this._fontString=this._style+" "+this.variant+" "+this._weight+" "+this._size.toString()+"px "+this._family),this._fontString}}}),r.prototype.toString=function(){if(!this._toString||!this._fontString)this._toString=this.fontString+" "+this.horizontalAlignment;return this._toString},r}),n("shapes/TextAttributes",["../util/Color","../util/Font","../util/Offset"],function(e,t,n){"use strict";var r=function(r){this._color=r?r._color:new e(1,1,1,1),this._font=r?r._font:new t(14),this._offset=r?r._offset:new n(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,0),this._scale=r?r._scale:1,this._depthTest=r?r._depthTest:!1,this.stateKeyInvalid=!0};return r.prototype.computeStateKey=function(){return"c "+this._color.toHexString(!0)+" f "+this._font.toString()+" o "+this._offset.toString()+" s "+this._scale+" dt "+this._depthTest},Object.defineProperties(r.prototype,{stateKey:{get:function(){return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey(),this.stateKeyInvalid=!1),this._stateKey}},color:{get:function(){return this._color},set:function(e){this._color=e,this.stateKeyInvalid=!0}},font:{get:function(){return this._font},set:function(e){this._font=e,this.stateKeyInvalid=!0}},offset:{get:function(){return this._offset},set:function(e){this._offset=e,this.stateKeyInvalid=!0}},scale:{get:function(){return this._scale},set:function(e){this._scale=e,this.stateKeyInvalid=!0}},depthTest:{get:function(){return this._depthTest},set:function(e){this._depthTest=e,this.stateKeyInvalid=!0}}}),r}),n("shapes/Text",["../error/ArgumentError","../shaders/BasicTextureProgram","../util/Color","../util/Font","../util/Logger","../geom/Matrix","../pick/PickedObject","../render/Renderable","../shapes/TextAttributes","../error/UnsupportedOperationError","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){"use strict";var p=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Text","constructor","missingText"));u.call(this),this.attributes=new a(null),this.highlightAttributes=null,this.highlighted=!1,this.enabled=!0,this.text=t,this.altitudeMode=WorldWind.ABSOLUTE,this.pickDelegate=null,this.alwaysOnTop=!1,this.targetVisibility=1,this.currentVisibility=1,this.declutterGroup=0,this.markerImageSource=WorldWind.configuration.baseUrl+"images/white-dot.png",this.markerImageScale=.1,this.activeAttributes=null,this.activeTexture=null,this.imageTransform=s.fromIdentity(),this.texCoordMatrix=s.fromIdentity(),this.imageBounds=null,this.layer=null,this.depthOffset=-0.003,this.screenPoint=new c(0,0,0)};return p.matrix=s.fromIdentity(),p.glPickPoint=new c(0,0,0),p.prototype=Object.create(u.prototype),p.prototype.copy=function(e){return this.text=e.text,this.attributes=e.attributes,this.highlightAttributes=e.highlightAttributes,this.highlighted=e.highlighted,this.enabled=e.enabled,this.altitudeMode=e.altitudeMode,this.pickDelegate=e.pickDelegate,this.alwaysOnTop=e.alwaysOnTop,this.depthOffset=e.depthOffset,this.declutterGroup=e.declutterGroup,this.targetVisibility=e.targetVisibility,this.currentVisibility=e.currentVisibility,this},Object.defineProperties(p.prototype,{screenBounds:{get:function(){return this.imageBounds}}}),p.prototype.render=function(e){if(!this.enabled||!this.text||this.text.length===0)return;if(!e.accumulateOrderedRenderables)return;var t;if(this.lastFrameTime!=e.timestamp)t=this.makeOrderedRenderable(e);else{var n=this.clone();t=n.makeOrderedRenderable(e)}if(!t)return;if(!t.isVisible(e))return;t.layer=e.currentLayer,this.lastFrameTime=e.timestamp,e.addOrderedRenderable(t)},p.prototype.renderOrdered=function(e){if(this.currentVisibility===0&&this.targetVisibility===0&&!this.markerImageSource)return;this.drawOrderedText(e);if(e.pickingMode){var t=new o(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,this.position,this.layer,!1);e.resolvePick(t)}},p.prototype.makeOrderedRenderable=function(e){var t,n,r,i;this.determineActiveAttributes(e);if(!this.activeAttributes)return null;if(!this.computeScreenPointAndEyeDistance(e))return null;var s=this.activeAttributes.font,o=this.text+s.toString();return this.activeTexture=e.gpuResourceCache.resourceForKey(o),this.activeTexture||(this.activeTexture=e.textSupport.createTexture(e,this.text,s,!0),e.gpuResourceCache.putResource(o,this.activeTexture,this.activeTexture.size)),t=this.activeTexture.imageWidth,n=this.activeTexture.imageHeight,r=this.activeAttributes.scale,i=this.activeAttributes.offset.offsetForSize(t,n),this.imageTransform.setTranslation(this.screenPoint[0]-i[0]*r,this.screenPoint[1]-i[1]*r,this.screenPoint[2]),this.imageTransform.setScale(t*r,n*r,1),this.imageBounds=h.boundingRectForUnitQuad(this.imageTransform),this},p.prototype.computeScreenPointAndEyeDistance=function(e){throw new f(i.logMessage(i.LEVEL_SEVERE,"Renderable","render","abstractInvocation"))},p.prototype.determineActiveAttributes=function(e){this.highlighted&&this.highlightAttributes?this.activeAttributes=this.highlightAttributes:this.activeAttributes=this.attributes},p.prototype.isVisible=function(e){return e.pickingMode?e.pickRectangle&&this.imageBounds.intersects(e.pickRectangle):this.imageBounds.intersects(e.navigatorState.viewport)},p.prototype.drawOrderedText=function(e){this.beginDrawing(e);try{this.doDrawOrderedText(e),!e.pickingMode}finally{this.endDrawing(e)}},p.prototype.drawBatchOrderedText=function(e){var t;while((t=e.peekOrderedRenderable())&&t instanceof p){e.popOrderedRenderable();try{t.doDrawOrderedText(e)}catch(n){i.logMessage(i.LEVEL_WARNING,"Text","drawBatchOrderedText","Error occurred while rendering text using batching: "+n.message)}}},p.prototype.beginDrawing=function(e){var n=e.currentGlContext,r;e.findAndBindProgram(t),r=e.currentProgram,n.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,e.unitQuadBuffer3()),n.vertexAttribPointer(r.vertexPointLocation,3,WebGLRenderingContext.FLOAT,!1,0,0),n.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,e.unitQuadBuffer()),n.vertexAttribPointer(r.vertexTexCoordLocation,2,WebGLRenderingContext.FLOAT,!1,0,0),n.enableVertexAttribArray(r.vertexPointLocation),n.enableVertexAttribArray(r.vertexTexCoordLocation),r.loadTextureUnit(n,WebGLRenderingContext.TEXTURE0),e.pickingMode&&r.loadTextureEnabled(n,!1),r.loadModulateColor(n,!1),n.depthMask(!1),p.currentTexture=null},p.prototype.endDrawing=function(e){var t=e.currentGlContext,n=e.currentProgram;t.disableVertexAttribArray(n.vertexPointLocation),t.disableVertexAttribArray(n.vertexTexCoordLocation),e.bindProgram(null),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,null),t.bindTexture(WebGLRenderingContext.TEXTURE_2D,null),t.depthMask(!0),p.currentTexture=null},p.prototype.doDrawOrderedText=function(e){var t=e.currentGlContext,n=e.currentProgram,r;e.pickingMode&&(this.pickColor=e.uniquePickColor());if(!e.pickingMode&&this.currentVisibility!=this.targetVisibility){var i=(e.timestamp-e.previousRedrawTimestamp)/e.fadeTime;this.currentVisibility<this.targetVisibility?this.currentVisibility=Math.min(1,this.currentVisibility+i):this.currentVisibility=Math.max(0,this.currentVisibility-i),e.redrawRequested=!0}this.currentVisibility>0&&(p.matrix.copy(e.screenProjection),p.matrix.multiplyMatrix(this.imageTransform),n.loadModelviewProjection(t,p.matrix),e.pickingMode?(n.loadColor(t,this.pickColor),n.loadTextureEnabled(t,!1)):(n.loadColor(t,this.activeAttributes.color),n.loadOpacity(t,this.layer.opacity*this.currentVisibility),this.texCoordMatrix.setToIdentity(),this.activeTexture&&this.texCoordMatrix.multiplyByTextureTransform(this.activeTexture),n.loadTextureMatrix(t,this.texCoordMatrix),this.activeTexture&&this.activeTexture!=p.currentTexture&&(r=this.activeTexture.bind(e),n.loadTextureEnabled(t,r),p.currentTexture=this.activeTexture)),this.activeAttributes.depthTest||t.disable(WebGLRenderingContext.DEPTH_TEST,!1),t.drawArrays(WebGLRenderingContext.TRIANGLE_STRIP,0,4),this.activeAttributes.depthTest||t.disable(WebGLRenderingContext.DEPTH_TEST,!0));if(this.currentVisibility<1&&this.markerImageSource){var o=e.gpuResourceCache.resourceForKey(this.markerImageSource);if(!o){e.gpuResourceCache.retrieveTexture(e.currentGlContext,this.markerImageSource);return}var u=this.markerImageScale,a=s.fromIdentity();a.setTranslation(this.screenPoint[0]-u*o.imageWidth/2,this.screenPoint[1]-u*o.imageWidth/2,this.screenPoint[2]),a.setScale(o.imageWidth*u,o.imageHeight*u,1),p.matrix.copy(e.screenProjection),p.matrix.multiplyMatrix(a),n.loadModelviewProjection(t,p.matrix);if(e.pickingMode)n.loadColor(t,this.pickColor),n.loadTextureEnabled(t,!1);else{n.loadColor(t,this.activeAttributes.color),n.loadOpacity(t,this.layer.opacity*(1-this.currentVisibility));var f=s.fromIdentity();f.multiplyByTextureTransform(o),n.loadTextureMatrix(t,f),o!=p.currentTexture&&(r=o.bind(e),n.loadTextureEnabled(t,r),p.currentTexture=o)}this.activeAttributes.depthTest||t.disable(WebGLRenderingContext.DEPTH_TEST,!1),t.drawArrays(WebGLRenderingContext.TRIANGLE_STRIP,0,4),this.activeAttributes.depthTest||t.disable(WebGLRenderingContext.DEPTH_TEST,!0)}},p}),n("shapes/ScreenText",["../error/ArgumentError","../util/Logger","../util/Offset","../shapes/Text"],function(e,t,n,r){"use strict";var i=function(n,i){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"Text","constructor","missingOffset"));r.call(this,i),this.screenOffset=n,this.altitudeMode=null};return i.prototype=Object.create(r.prototype),i.prototype.render=function(e){this.lastFrameTime!=e.timestamp&&r.prototype.render.call(this,e)},i.prototype.computeScreenPointAndEyeDistance=function(e){var t=e.currentGlContext,n=this.screenOffset.offsetForSize(t.drawingBufferWidth,t.drawingBufferHeight);return this.screenPoint[0]=n[0],this.screenPoint[1]=n[1],this.screenPoint[2]=0,this.eyeDistance=0,!0},i}),n("layer/CoordinatesDisplayLayer",["../error/ArgumentError","../util/Color","../util/Font","../layer/Layer","../util/Logger","../util/Offset","../geom/Position","../shapes/ScreenImage","../shapes/ScreenText","../shapes/TextAttributes","../geom/Vec2"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";var c=function(n){function h(e){c.handleUIEvent(e)}function p(e,t){c.handleRedraw(t)}if(!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"ViewControlsLayer","constructor","missingWorldWindow"));r.call(this,"Coordinates"),this.wwd=n,this.pickEnabled=!1,this.eventType=null,this.clientX=null,this.clientY=null,this.terrainPosition=null,this.latText=new a(new s(WorldWind.OFFSET_PIXELS,0,WorldWind.OFFSET_PIXELS,0)," "),this.latText.attributes=new f(null),this.latText.attributes.color=t.YELLOW,this.lonText=new a(new s(WorldWind.OFFSET_PIXELS,0,WorldWind.OFFSET_PIXELS,0)," "),this.lonText.attributes=new f(null),this.lonText.attributes.color=t.YELLOW,this.elevText=new a(new s(WorldWind.OFFSET_PIXELS,0,WorldWind.OFFSET_PIXELS,0)," "),this.elevText.attributes=new f(null),this.elevText.attributes.color=t.YELLOW,this.eyeText=new a(new s(WorldWind.OFFSET_PIXELS,0,WorldWind.OFFSET_PIXELS,0)," "),this.eyeText.attributes=new f(null),this.eyeText.attributes.color=t.YELLOW;var o=new s(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,.5),l=WorldWind.configuration.baseUrl+"images/crosshair.png";this.crosshairImage=new u(o,l);var c=this;window.PointerEvent?(n.addEventListener("pointerdown",h),n.addEventListener("pointermove",h),n.addEventListener("pointerleave",h)):(n.addEventListener("mousedown",h),n.addEventListener("mousemove",h),n.addEventListener("mouseleave",h),n.addEventListener("touchstart",h),n.addEventListener("touchmove",h)),this.wwd.redrawCallbacks.push(p)};return c.prototype=Object.create(r.prototype),c.prototype.doRender=function(e){var t=this.terrainPosition,n=e.eyePosition,r=e.currentGlContext.canvas.clientWidth,i,o,u,a,f;r>650?(i=r/2-50,o=5,u=WorldWind.OFFSET_PIXELS,a=0):r>400?(i=60,o=5,u=WorldWind.OFFSET_INSET_PIXELS,a=1):(i=60,o=5,u=WorldWind.OFFSET_INSET_PIXELS,a=1,f=!0),this.latText.text=t?this.formatLatitude(t.latitude):null,this.latText.screenOffset=new s(WorldWind.OFFSET_PIXELS,i,u,o),this.latText.attributes.offset=new s(WorldWind.OFFSET_FRACTION,1,WorldWind.OFFSET_FRACTION,a),this.latText.render(e),i+=70,this.lonText.text=t?this.formatLongitude(t.longitude):null,this.lonText.screenOffset=new s(WorldWind.OFFSET_PIXELS,i,u,o),this.lonText.attributes.offset=new s(WorldWind.OFFSET_FRACTION,1,WorldWind.OFFSET_FRACTION,a),this.lonText.render(e),e.globe.is2D()||(i+=70,this.elevText.text=t?this.formatAltitude(t.altitude,"m"):null,this.elevText.screenOffset=new s(WorldWind.OFFSET_PIXELS,i,u,o),this.elevText.attributes.offset=new s(WorldWind.OFFSET_FRACTION,1,WorldWind.OFFSET_FRACTION,a),this.elevText.render(e)),f||(i+=40,this.eyeText.text="Eye  "+this.formatAltitude(n.altitude,n.altitude<1e3?"m":"km"),this.eyeText.screenOffset=new s(WorldWind.OFFSET_PIXELS,i,u,o),this.eyeText.attributes.offset=new s(WorldWind.OFFSET_FRACTION,0,WorldWind.OFFSET_FRACTION,a),this.eyeText.render(e)),this.eventType=="touch"&&this.crosshairImage.render(e),this.inCurrentFrame=!0},c.prototype.handleUIEvent=function(e){e.type.indexOf("pointer")!=-1?this.eventType=e.pointerType:e.type.indexOf("mouse")!=-1?this.eventType="mouse":e.type.indexOf("touch")!=-1&&(this.eventType="touch"),e.type.indexOf("leave")!=-1?(this.clientX=null,this.clientY=null):(this.clientX=e.clientX,this.clientY=e.clientY),this.wwd.redraw()},c.prototype.handleRedraw=function(e){if(e!=WorldWind.BEFORE_REDRAW)return;var t,n;(this.eventType=="mouse"||this.eventType=="pen")&&this.clientX&&this.clientY?(t=this.wwd.canvasCoordinates(this.clientX,this.clientY),t[0]>=0&&t[0]<this.wwd.canvas.width&&t[1]>=0&&t[1]<this.wwd.canvas.height&&(n=this.wwd.pickTerrain(t).terrainObject())):this.eventType=="touch"&&(t=new l(this.wwd.canvas.width/2,this.wwd.canvas.height/2),n=this.wwd.pickTerrain(t).terrainObject()),this.terrainPosition=n?n.position:null},c.prototype.formatLatitude=function(e){var t=e<0?"°S":"°N";return Math.abs(e).toFixed(2)+t},c.prototype.formatLongitude=function(e){var t=e<0?"°W":"°E";return Math.abs(e).toFixed(2)+t},c.prototype.formatAltitude=function(e,t){return t==="km"&&(e/=1e3),e.toFixed(0).replace(/\B(?=(\d{3})+(?!\d))/g,",")+" "+t},c}),n("gesture/DragRecognizer",["../gesture/GestureRecognizer"],function(e){"use strict";var t=function(t,n){e.call(this,t,n),this.button=0,this.interpretDistance=5};return t.prototype=Object.create(e.prototype),t.prototype.mouseMove=function(e){if(this.state==WorldWind.POSSIBLE)this.shouldInterpret()&&(this.shouldRecognize()?(this.translationX=0,this.translationY=0,this.state=WorldWind.BEGAN):this.state=WorldWind.FAILED);else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.CHANGED},t.prototype.mouseUp=function(e){if(this.mouseButtonMask==0)if(this.state==WorldWind.POSSIBLE)this.state=WorldWind.FAILED;else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.ENDED},t.prototype.touchStart=function(e){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},t.prototype.shouldInterpret=function(){var e=this.translationX,t=this.translationY,n=Math.sqrt(e*e+t*t);return n>this.interpretDistance},t.prototype.shouldRecognize=function(){var e=1<<this.button;return e==this.mouseButtonMask},t}),n("util/FrameStatistics",[],function(){"use strict";var e=function(){this.frameCount=0,this.frameTimeCumulative=0,this.frameTimeBase=0,this.frameTime=0,this.tessellationTime=0,this.layerRenderingTime=0,this.orderedRenderingTime=0,this.terrainTileCount=0,this.imageTileCount=0,this.renderedTileCount=0,this.tileUpdateCount=0,this.textureLoadCount=0,this.vboLoadCount=0,this.frameTimeAverage=0,this.frameRateAverage=0};return e.prototype.beginFrame=function(){this.frameTime=Date.now(),this.tessellationTime=0,this.layerRenderingTime=0,this.orderedRenderingTime=0,this.terrainTileCount=0,this.imageTileCount=0,this.renderedTileCount=0,this.tileUpdateCount=0,this.textureLoadCount=0,this.vboLoadCount=0,++this.frameCount},e.prototype.endFrame=function(){var e=Date.now();this.frameTime=e-this.frameTime,this.frameTimeCumulative+=this.frameTime,e-this.frameTimeBase>2e3&&(this.frameTimeAverage=this.frameTimeCumulative/this.frameCount,this.frameRateAverage=1e3*this.frameCount/(e-this.frameTimeBase),this.frameTimeBase=e,this.frameTimeCumulative=0,this.frameCount=0)},e.prototype.incrementRenderedTileCount=function(e){this.renderedTileCount+=e},e.prototype.setTerrainTileCount=function(e){this.terrainTileCount=e},e.prototype.incrementImageTileCount=function(e){this.imageTileCount=e},e.prototype.incrementTileUpdateCount=function(e){this.tileUpdateCount+=e},e.prototype.incrementTextureLoadCount=function(e){this.textureLoadCount+=e},e.prototype.incrementVboLoadCount=function(e){this.vboLoadCount+=e},e}),n("render/FramebufferTexture",["../error/ArgumentError","../util/Logger","../util/WWMath"],function(e,t){"use strict";var n=function(n,r,i,s){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"FramebufferTexture","constructor","missingGlContext"));if(r<0||i<0)throw new e(t.logMessage(t.LEVEL_SEVERE,"FramebufferTexture","constructor","The framebuffer width or height is less than zero."));this.width=r,this.height=i,this.depth=s,this.size=r*i*4+(s?r*i*2:0),this.framebuffer=n.createFramebuffer(),n.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,this.framebuffer),this.texture=n.createTexture(),n.bindTexture(WebGLRenderingContext.TEXTURE_2D,this.texture),n.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_MIN_FILTER,WebGLRenderingContext.LINEAR),n.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_MAG_FILTER,WebGLRenderingContext.LINEAR),n.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_WRAP_S,WebGLRenderingContext.CLAMP_TO_EDGE),n.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_WRAP_T,WebGLRenderingContext.CLAMP_TO_EDGE),n.texImage2D(WebGLRenderingContext.TEXTURE_2D,0,WebGLRenderingContext.RGBA,r,i,0,WebGLRenderingContext.RGBA,WebGLRenderingContext.UNSIGNED_BYTE,null),n.framebufferTexture2D(WebGLRenderingContext.FRAMEBUFFER,WebGLRenderingContext.COLOR_ATTACHMENT0,WebGLRenderingContext.TEXTURE_2D,this.texture,0),this.depthBuffer=null,s&&(this.depthBuffer=n.createRenderbuffer(),n.bindRenderbuffer(WebGLRenderingContext.RENDERBUFFER,this.depthBuffer),n.renderbufferStorage(WebGLRenderingContext.RENDERBUFFER,WebGLRenderingContext.DEPTH_COMPONENT16,r,i),n.framebufferRenderbuffer(WebGLRenderingContext.FRAMEBUFFER,WebGLRenderingContext.DEPTH_ATTACHMENT,WebGLRenderingContext.RENDERBUFFER,this.depthBuffer));var o=n.checkFramebufferStatus(WebGLRenderingContext.FRAMEBUFFER);o!=WebGLRenderingContext.FRAMEBUFFER_COMPLETE&&(t.logMessage(t.LEVEL_WARNING,"FramebufferTexture","constructor","Error creating framebuffer: "+o),this.framebuffer=null,this.texture=null,this.depthBuffer=null),n.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),n.bindRenderbuffer(WebGLRenderingContext.RENDERBUFFER,null),n.bindTexture(WebGLRenderingContext.TEXTURE_2D,null)};return n.prototype.bind=function(e){return this.texture&&e.currentGlContext.bindTexture(WebGLRenderingContext.TEXTURE_2D,this.texture),!!this.texture},n.prototype.bindFramebuffer=function(e){return this.framebuffer&&e.currentGlContext.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,this.framebuffer),!!this.framebuffer},n}),n("render/FramebufferTile",["../error/ArgumentError","../render/FramebufferTexture","../util/Logger","../geom/Matrix","../geom/Rectangle","../render/TextureTile"],function(e,t,n,r,i,s){"use strict";var o=function(t,i,o,u,a){if(!a||a.length<1)throw new e(n.logMessage(n.LEVEL_SEVERE,"FramebufferTile","constructor","The specified cache name is null, undefined or zero length."));s.call(this,t,i,o,u),this.modelviewProjection=r.fromIdentity(),this.modelviewProjection.setToScreenProjection(i.tileWidth,i.tileHeight),this.modelviewProjection.multiplyByScale(i.tileWidth/t.deltaLongitude(),i.tileHeight/t.deltaLatitude(),1),this.modelviewProjection.multiplyByTranslation(-t.minLongitude,-t.minLatitude,0),this.textureTransform=r.fromIdentity().setToUnitYFlip(),this.gpuCacheKey=a};return o.prototype=Object.create(s.prototype),o.prototype.bindFramebuffer=function(e){var t=e.gpuResourceCache.resourceForKey(this.gpuCacheKey);return t||(t=this.createFramebuffer(e)),t.bindFramebuffer(e)},o.prototype.createFramebuffer=function(e){var n=new t(e.currentGlContext,this.tileWidth,this.tileHeight,!1);return e.gpuResourceCache.putResource(this.gpuCacheKey,n,n.size),n},o.prototype.applyInternalTransform=function(e,t){t.multiplyMatrix(this.textureTransform)},o}),n("render/FramebufferTileController",["../error/ArgumentError","../render/FramebufferTile","../util/LevelSet","../geom/Location","../util/Logger","../cache/MemoryCache","../geom/Sector","../util/Tile"],function(e,t,n,r,i,s,o,u){"use strict";var a=function(){this.tileWidth=256,this.tileHeight=256,this.detailHint=0,this.levels=new n(o.FULL_SPHERE,new r(45,45),16,this.tileWidth,this.tileHeight),this.topLevelTiles=[],this.currentTiles=[],this.currentTimestamp=null,this.currentGlobeStateKey=null,this.tileCache=new s(5e5,4e5),this.key="FramebufferTileController "+ ++a.keyPool,this.detailHintOrigin=2.4};return a.keyPool=0,a.prototype.selectTiles=function(t,n){if(!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"FramebufferTileController","selectTiles","missingSector"));this.assembleTiles(t);var r=[];for(var s=0,o=this.currentTiles.length;s<o;s++){var u=this.currentTiles[s];u.sector.overlaps(n)&&(u.selected=!0,r.push(u))}return r},a.prototype.render=function(e){if(this.currentTiles.length==0)return;var t=[];for(var n=0,r=this.currentTiles.length;n<r;n++){var i=this.currentTiles[n];i.selected&&t.push(i)}e.surfaceTileRenderer.renderTiles(e,t,1);var s=e.currentGlContext,o=e.currentFramebuffer;try{s.clearColor(0,0,0,0);for(n=0,r=t.length;n<r;n++)i=t[n],i.selected=!1,i.bindFramebuffer(e),s.clear(WebGLRenderingContext.COLOR_BUFFER_BIT)}finally{e.bindFramebuffer(o)}},a.prototype.assembleTiles=function(e){var t=e.timestamp,n=e.globeStateKey;if(this.currentTimestamp!=t||this.currentGlobeStateKey!=n)this.doAssembleTiles(e),this.currentTimestamp=t,this.currentGlobeStateKey=n},a.prototype.doAssembleTiles=function(e){this.currentTiles=[];if(!e.terrain)return;this.topLevelTiles.length==0&&this.createTopLevelTiles();for(var t=0,n=this.topLevelTiles.length;t<n;t++){var r=this.topLevelTiles[t];r.update(e),this.isTileVisible(e,r)&&this.addTileOrDescendants(e,r)}},a.prototype.createTile=function(e,n,r,i){var s=this.key+" "+n.levelNumber+"."+r+"."+i;return new t(e,n,r,i,s)},a.prototype.createTopLevelTiles=function(){u.createTilesForLevel(this.levels.firstLevel(),this,this.topLevelTiles)},a.prototype.addTileOrDescendants=function(e,t){if(this.tileMeetsRenderingCriteria(e,t)){this.addTile(t);return}var n=t.subdivideToCache(t.level.nextLevel(),this,this.tileCache);for(var r=0,i=n.length;r<i;r++){var s=n[r];s.update(e),this.isTileVisible(e,s)&&this.addTileOrDescendants(e,s)}},a.prototype.addTile=function(e){this.currentTiles.push(e)},a.prototype.isTileVisible=function(e,t){return e.globe.projectionLimits&&!t.sector.overlaps(e.globe.projectionLimits)?!1:e.pickingMode?t.extent.intersectsFrustum(e.pickFrustum):t.extent.intersectsFrustum(e.navigatorState.frustumInModelCoordinates)},a.prototype.tileMeetsRenderingCriteria=function(e,t){var n=this.detailHintOrigin+this.detailHint;if(t.sector.minLatitude>=75||t.sector.maxLatitude<=-75)n*=.9;return t.level.isLastLevel()||!t.mustSubdivide(e,n)},a}),n("globe/ElevationImage",["../error/ArgumentError","../util/Logger","../util/WWMath"],function(e,t,n){"use strict";var r=function(n,r,i,s){if(!n||n.length<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"ElevationImage","constructor","The specified image path is null, undefined or zero length."));if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"ElevationImage","constructor","missingSector"));this.sector=r,this.imagePath=n,this.imageWidth=i,this.imageHeight=s,this.size=this.imageWidth*this.imageHeight};return r.prototype.pixel=function(e,t){return e<0||e>=this.imageWidth?0:t<0||t>=this.imageHeight?0:(t=this.imageHeight-t-1,this.imageData[e+t*this.imageWidth])},r.prototype.elevationAtLocation=function(e,t){var r=this.sector.maxLatitude,i=this.sector.minLongitude,s=this.sector.deltaLatitude(),o=this.sector.deltaLongitude(),u=(this.imageWidth-1)*(t-i)/o,a=(this.imageHeight-1)*(r-e)/s,f=Math.floor(n.clamp(u,0,this.imageWidth-1)),l=Math.floor(n.clamp(f+1,0,this.imageWidth-1)),c=Math.floor(n.clamp(a,0,this.imageHeight-1)),h=Math.floor(n.clamp(c+1,0,this.imageHeight-1)),p=this.imageData,d=p[f+c*this.imageWidth],v=p[l+c*this.imageWidth],m=p[f+h*this.imageWidth],g=p[l+h*this.imageWidth],y=u-f,b=a-c;return(1-y)*(1-b)*d+y*(1-b)*v+(1-y)*b*m+y*b*g},r.prototype.elevationsForGrid=function(r,i,s,o){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"ElevationImage","elevationsForSector","missingSector"));if(i<1||s<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"ElevationImage","elevationsForSector","The specified number of sample points is less than 1."));if(!o)throw new e(t.logMessage(t.LEVEL_SEVERE,"ElevationImage","elevationsForSector","missingResult"));var u=this.sector.minLatitude,a=this.sector.maxLatitude,f=this.sector.minLongitude,l=this.sector.maxLongitude,c=a-u,h=l-f,p=r.minLatitude,d=r.maxLatitude,v=r.minLongitude,m=r.maxLongitude,g=(d-p)/(i>1?i-1:1),y=(m-v)/(s>1?s-1:1),b,w,E,S,x=0,T=this.imageData;for(S=0,b=p;S<i;S+=1,b+=g){S===i-1&&(b=d);if(b>=u&&b<=a){var N=(this.imageHeight-1)*(a-b)/c,C=Math.floor(n.clamp(N,0,this.imageHeight-1)),k=Math.floor(n.clamp(C+1,0,this.imageHeight-1)),L=N-C;for(E=0,w=v;E<s;E+=1,w+=y){E===s-1&&(w=m);if(w>=f&&w<=l){var A=(this.imageWidth-1)*(w-f)/h,O=Math.floor(n.clamp(A,0,this.imageWidth-1)),M=Math.floor(n.clamp(O+1,0,this.imageWidth-1)),_=A-O,D=T[O+C*this.imageWidth],P=T[M+C*this.imageWidth],H=T[O+k*this.imageWidth],B=T[M+k*this.imageWidth];o[x]=(1-_)*(1-L)*D+_*(1-L)*P+(1-_)*L*H+_*L*B}x++}}else x+=s}},r.prototype.minAndMaxElevationsForSector=function(e){var t=[];if(!e)t[0]=this.minElevation,t[1]=this.maxElevation;else if(e.contains(this.sector))t[0]>this.minElevation&&(t[0]=this.minElevation),t[1]<this.maxElevation&&(t[1]=this.maxElevation);else{var r=this.sector.maxLatitude,i=this.sector.minLongitude,s=this.sector.deltaLatitude(),o=this.sector.deltaLongitude(),u=e.minLatitude,a=e.maxLatitude,f=e.minLongitude,l=e.maxLongitude,c=Math.floor((this.imageHeight-1)*(r-a)/s),h=Math.ceil((this.imageHeight-1)*(r-u)/s),p=Math.floor((this.imageWidth-1)*(f-i)/o),d=Math.ceil((this.imageWidth-1)*(l-i)/o);c=n.clamp(c,0,this.imageHeight-1),h=n.clamp(h,0,this.imageHeight-1),p=n.clamp(p,0,this.imageWidth-1),d=n.clamp(d,0,this.imageWidth-1);var v=this.imageData,m=Number.MAX_VALUE,g=-m;for(var y=c;y<=h;y++)for(var b=p;b<=d;b++){var w=v[Math.floor(b+y*this.imageWidth)];m>w&&(m=w),g<w&&(g=w)}t[0]>m&&(t[0]=m),t[1]<g&&(t[1]=g)}return t},r.prototype.findMinAndMaxElevation=function(){if(this.imageData&&this.imageData.length>0){this.minElevation=Number.MAX_VALUE,this.maxElevation=-this.minElevation;var e=this.imageData,t=this.imageWidth*this.imageHeight;for(var n=0;n<t;n++){var r=e[n];this.minElevation>r&&(this.minElevation=r),this.maxElevation<r&&(this.maxElevation=r)}}else this.minElevation=0,this.maxElevation=0},r}),n("globe/ElevationTile",["../error/ArgumentError","../util/Logger","../util/Tile"],function(e,t,n){"use strict";var r=function(r,i,s,o,u,a){if(!u||u.length<1)throw new e(t.logMessage(t.LEVEL_SEVERE,"ElevationTile","constructor","The specified image path is null, undefined or zero length."));if(!a)throw new e(t.logMessage(t.LEVEL_SEVERE,"ElevationTile","constructor","The specified cache is null or undefined."));n.call(this,r,i,s,o),this.imagePath=u,this.memoryCache=a};return r.prototype=Object.create(n.prototype),r.prototype.size=function(){return n.prototype.size.call(this)+this.imagePath.length+8},r.prototype.image=function(){return this.memoryCache.entryForKey(this.imagePath)},r}),n("globe/ElevationModel",["../util/AbsentResourceList","../geom/Angle","../error/ArgumentError","../globe/ElevationImage","../globe/ElevationTile","../util/LevelSet","../util/Logger","../cache/MemoryCache","../geom/Sector","../util/Tile","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";var c=function(t,r,i,f,l,h,p){if(!t)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","constructor","missingSector"));if(!r)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","constructor","The specified level-zero delta is null or undefined."));if(!f)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","constructor","The specified image format is null or undefined."));if(!l)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","constructor","The specified cache path is null or undefined."));if(!i||i<1)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","constructor","The specified number of levels is not greater than zero."));if(!h||!p||h<1||p<1)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","constructor","The specified tile width or height is not greater than zero."));this.coverageSector=t,this.retrievalImageFormat=f,this.cachePath=l,this.displayName="Elevations",this.timestamp=Date.now(),this.minElevation=0,this.maxElevation=0,this.pixelIsPoint=!0,this.levels=new s(this.coverageSector,r,i,h,p),this.currentTiles=[],this.currentSector=new a(0,0,0,0),this.tileCache=new u(1e6,8e5),this.imageCache=new u(1e7,8e6),this.currentRetrievals=[],this.absentResourceList=new e(3,5e3),this.id=++c.idPool,this.stateKey="elevationModel "+this.id.toString()+" "};return c.idPool=0,c.prototype.minAndMaxElevationsForSector=function(e){if(!e)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","minAndMaxElevationsForSector","missingSector"));var r=this.levels.levelForTexelSize(e.deltaLatitude()*t.DEGREES_TO_RADIANS/64);this.assembleTiles(r,e,!1);if(this.currentTiles.length==0)return null;var i=Number.MAX_VALUE,s=-i,u,a,f,l=[];for(var c=0,h=this.currentTiles.length;c<h;c++){u=this.currentTiles[c].image();if(!u)return l[0]=this.minElevation,l[1]=this.maxElevation,l;a=u.minElevation,i>a&&(i=a),f=u.maxElevation,s<f&&(s=f)}return l[0]=i,l[1]=s,l},c.prototype.elevationAtLocation=function(e,t){return this.coverageSector.containsLocation(e,t)?this.pointElevationForLocation(e,t):0},c.prototype.elevationsForGrid=function(e,t,r,i,s){if(!e)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","elevationsForSector","missingSector"));if(!s)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","elevationsForSector","missingResult"));if(!t||!r||t<1||r<1)throw new n(o.logMessage(o.LEVEL_SEVERE,"ElevationModel","constructor","The specified number of latitudinal or longitudinal positions is less than one."));var u=this.levels.levelForTexelSize(i);return this.pixelIsPoint?this.pointElevationsForGrid(e,t,r,u,s):this.areaElevationsForGrid(e,t,r,u,s)},c.prototype.pointElevationForLocation=function(e,t){var n=this.levels.lastLevel(),r=n.tileDelta.latitude,i=n.tileDelta.longitude,s=f.computeRow(r,e),o=f.computeColumn(i,t),u,a=null;for(var l=n.levelNumber;l>=0;l--){u=this.tileCache.entryForKey(l+"."+s+"."+o);if(u){a=u.image();if(a)return a.elevationAtLocation(e,t)}s=Math.floor(s/2),o=Math.floor(o/2)}return 0},c.prototype.pointElevationsForGrid=function(e,t,n,r,i){var s=0,o;this.assembleTiles(r,e,!0);if(this.currentTiles.length===0)return 0;this.currentTiles.sort(function(e,t){return e.level.levelNumber-t.level.levelNumber});for(var u=0,a=this.currentTiles.length;u<a;u++){var f=this.currentTiles[u],l=f.image();l?(l.elevationsForGrid(e,t,n,i),o=f.level.texelSize,s<o&&(s=o)):s=Number.MAX_VALUE}return s},c.prototype.areaElevationsForGrid=function(e,t,n,r,i){var s=e.minLatitude,o=e.maxLatitude,u=e.minLongitude,a=e.maxLongitude,f=e.deltaLatitude()/(t>1?t-1:1),l=e.deltaLongitude()/(n>1?n-1:1),c,h,p,d,v,m,g=0;for(v=0,c=s;v<t;v+=1,c+=f){v===t-1&&(c=o);for(m=0,h=u;m<n;m+=1,h+=l)m===n-1&&(h=a),this.coverageSector.containsLocation(c,h)&&(p=(h+180)/360,d=(c+90)/180,this.areaElevationForCoord(p,d,r.levelNumber,i,g)),g++}return r.texelSize},c.prototype.areaElevationForCoord=function(e,t,n,r,i){var s,o,u,a,f,c,h,p,d,v,m,g,y,b,w=new Float64Array(4);for(var E=n;E>=0;E--){s=this.levels.level(E),o=Math.round(s.tileWidth*360/s.tileDelta.longitude),u=Math.round(s.tileHeight*180/s.tileDelta.latitude),a=1/(2*u),f=1-a,c=o*l.fract(e),h=u*l.clamp(t,a,f),p=l.mod(Math.floor(c-.5),o),d=l.mod(p+1,o),v=Math.floor(h-.5),m=v+1,g=l.fract(c-.5),y=l.fract(h-.5),b=E==n||E==0;if(this.lookupPixels(p,d,v,m,s,b,w)){r[i]=(1-g)*(1-y)*w[0]+g*(1-y)*w[1]+(1-g)*y*w[2]+g*y*w[3];return}}},c.prototype.lookupPixels=function(e,t,n,r,i,s,o){var u=i.levelNumber,a=i.tileWidth,f=i.tileHeight,l=Math.floor(n/f),c=Math.floor(r/f),h=Math.floor(e/a),p=Math.floor(t/a),d,v,m,g;return l==c&&l==this.cachedRow&&h==p&&h==this.cachedCol?d=v=m=g=this.cachedImage:l==c&&h==p?(d=this.lookupImage(u,l,h,s),v=m=g=d,this.cachedRow=l,this.cachedCol=h,this.cachedImage=d):(d=this.lookupImage(u,l,h,s),v=this.lookupImage(u,l,p,s),m=this.lookupImage(u,c,h,s),g=this.lookupImage(u,c,p,s)),d&&v&&m&&g?(o[0]=d.pixel(e%a,n%f),o[1]=v.pixel(t%a,n%f),o[2]=m.pixel(e%a,r%f),o[3]=g.pixel(t%a,r%f),!0):!1},c.prototype.lookupImage=function(e,t,n,r){var i=this.tileForLevel(e,t,n),s=i.image();return(s==null||this.isTileImageExpired(i)&&r)&&this.retrieveTileImage(i),s},c.prototype.createTile=function(e,t,n,r){var s=this.cachePath+"/"+t.levelNumber+"/"+n+"/"+n+"_"+r+".bil";return new i(e,t,n,r,s,this.imageCache)},c.prototype.assembleTiles=function(e,t,n){this.currentTiles=[],this.currentSector.copy(t),this.currentSector.intersection(this.coverageSector);if(this.currentSector.isEmpty())return;var r=e.tileDelta.latitude,i=e.tileDelta.longitude,s=f.computeRow(r,this.currentSector.minLatitude),o=f.computeLastRow(r,this.currentSector.maxLatitude),u=f.computeColumn(i,this.currentSector.minLongitude),a=f.computeLastColumn(i,this.currentSector.maxLongitude);for(var l=s;l<=o;l++)for(var c=u;c<=a;c++)this.addTileOrAncestor(e,l,c,n)},c.prototype.addTileOrAncestor=function(e,t,n,r){var i=this.tileForLevel(e.levelNumber,t,n);this.isTileImageInMemory(i)?this.addToCurrentTiles(i):(r&&this.retrieveTileImage(i),e.isFirstLevel()?this.currentTiles.push(i):this.addAncestor(e,t,n,r))},c.prototype.addAncestor=function(e,t,n,r){var i=null,s=Math.floor(t/2),o=Math.floor(n/2);for(var u=e.levelNumber-1;u>=0;u--){i=this.tileForLevel(u,s,o);if(this.isTileImageInMemory(i)){this.addToCurrentTiles(i);return}s=Math.floor(s/2),o=Math.floor(o/2)}this.addToCurrentTiles(i),r&&this.retrieveTileImage(i)},c.prototype.addToCurrentTiles=function(e){this.currentTiles.push(e),this.isTileImageExpired(e)&&this.retrieveTileImage(e)},c.prototype.isTileImageExpired=function(e){return!(!this.expiration||this.expiration>Date.now())},c.prototype.tileForLevel=function(e,t,n){var r=e+"."+t+"."+n,i=this.tileCache.entryForKey(r);if(i)return i;var s=this.levels.level(e),o=f.computeSector(s,t,n);return i=this.createTile(o,s,t,n),this.tileCache.putEntry(r,i,i.size()),i},c.prototype.isTileImageInMemory=function(e){return this.imageCache.containsKey(e.imagePath)},c.prototype.resourceUrlForTile=function(e){return this.urlBuilder.urlForTile(e,this.retrievalImageFormat)},c.prototype.retrieveTileImage=function(e){if(this.currentRetrievals.indexOf(e.imagePath)<0){var t=this.resourceUrlForTile(e,this.retrievalImageFormat),n=new XMLHttpRequest,r=this;if(!t)return;n.open("GET",t,!0),n.responseType="arraybuffer",n.onreadystatechange=function(){if(n.readyState===4){r.removeFromCurrentRetrievals(e.imagePath);var i=n.getResponseHeader("content-type");if(n.status===200)if(i===r.retrievalImageFormat||i==="text/plain"||i==="application/octet-stream"){o.log(o.LEVEL_INFO,"Elevations retrieval succeeded: "+t),r.loadElevationImage(e,n),r.absentResourceList.unmarkResourceAbsent(e.imagePath);var s=document.createEvent("Event");s.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),window.dispatchEvent(s)}else i==="text/xml"?(r.absentResourceList.markResourceAbsent(e.imagePath),o.log(o.LEVEL_WARNING,"Elevations retrieval failed ("+n.statusText+"): "+t+".\n "+String.fromCharCode.apply(null,new Uint8Array(n.response)))):(r.absentResourceList.markResourceAbsent(e.imagePath),o.log(o.LEVEL_WARNING,"Elevations retrieval failed: "+t+". "+"Unexpected content type "+i));else r.absentResourceList.markResourceAbsent(e.imagePath),o.log(o.LEVEL_WARNING,"Elevations retrieval failed ("+n.statusText+"): "+t)}},n.onerror=function(){r.removeFromCurrentRetrievals(e.imagePath),r.absentResourceList.markResourceAbsent(e.imagePath),o.log(o.LEVEL_WARNING,"Elevations retrieval failed: "+t)},n.ontimeout=function(){r.removeFromCurrentRetrievals(e.imagePath),r.absentResourceList.markResourceAbsent(e.imagePath),o.log(o.LEVEL_WARNING,"Elevations retrieval timed out: "+t)},n.send(null),this.currentRetrievals.push(e.imagePath)}},c.prototype.removeFromCurrentRetrievals=function(e){var t=this.currentRetrievals.indexOf(e);t>-1&&this.currentRetrievals.splice(t,1)},c.prototype.loadElevationImage=function(e,t){var n=new r(e.imagePath,e.sector,e.tileWidth,e.tileHeight);this.retrievalImageFormat=="application/bil16"&&(n.imageData=new Int16Array(t.response),n.size=n.imageData.length*2),n.imageData&&(n.findMinAndMaxElevation(),this.imageCache.putEntry(e.imagePath,n,n.size),this.timestamp=Date.now())},c}),n("navigate/NavigatorState",["../error/ArgumentError","../geom/Frustum","../geom/Line","../util/Logger","../geom/Matrix","../geom/Rectangle","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a){"use strict";var f=function(e,n,r,s,o){this.modelview=e,this.projection=n,this.modelviewProjection=i.fromIdentity(),this.modelviewProjection.setToMultiply(n,e),this.viewport=r,this.heading=s,this.tilt=o,this.eyePoint=this.modelview.extractEyePoint(new u(0,0,0)),this.frustumInModelCoordinates=null;var f=i.fromIdentity();f.setToTransposeOfMatrix(this.modelview),this.frustumInModelCoordinates=t.fromProjectionMatrix(this.projection),this.frustumInModelCoordinates.transformByMatrix(f),this.frustumInModelCoordinates.normalize(),this.modelviewInv=i.fromIdentity(),this.modelviewInv.invertOrthonormalMatrix(this.modelview),this.projectionInv=i.fromIdentity(),this.projectionInv.invertMatrix(this.projection),this.modelviewProjectionInv=i.fromIdentity(),this.modelviewProjectionInv.invertMatrix(this.modelviewProjection),this.modelviewNormalTransform=i.fromIdentity().setToTransposeOfMatrix(this.modelviewInv.upper3By3());var l=new u(-1,-1,-1),c=new u(1,1,-1),h=new u(-1,-1,1),p=new u(1,1,1);l.multiplyByMatrix(this.projectionInv),c.multiplyByMatrix(this.projectionInv),h.multiplyByMatrix(this.projectionInv),p.multiplyByMatrix(this.projectionInv);var d=a.fabs(c[0]-l[0]),v=a.fabs(p[0]-h[0]),m=-l[2],g=-h[2],y=(v-d)/(g-m),b=d-y*m;this.pixelSizeScale=y/r.width,this.pixelSizeOffset=b/r.height};return f.prototype.project=function(t,n){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","project","missingPoint"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","project","missingResult"));var i=t[0],s=t[1],o=t[2],u=this.modelviewProjection,a=u[0]*i+u[1]*s+u[2]*o+u[3],f=u[4]*i+u[5]*s+u[6]*o+u[7],l=u[8]*i+u[9]*s+u[10]*o+u[11],c=u[12]*i+u[13]*s+u[14]*o+u[15],h=this.viewport;return c==0?!1:(a/=c,f/=c,l/=c,l<-1||l>1?!1:(a=a*.5+.5,f=f*.5+.5,l=l*.5+.5,a=a*h.width+h.x,f=f*h.height+h.y,n[0]=a,n[1]=f,n[2]=l,!0))},f.prototype.projectWithDepth=function(t,n,i){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","projectWithDepth","missingPoint"));if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","projectWithDepth","missingResult"));var s=t[0],o=t[1],u=t[2],f=this.modelview,l=f[0]*s+f[1]*o+f[2]*u+f[3],c=f[4]*s+f[5]*o+f[6]*u+f[7],h=f[8]*s+f[9]*o+f[10]*u+f[11],p=f[12]*s+f[13]*o+f[14]*u+f[15],d=this.projection,v=d[0]*l+d[1]*c+d[2]*h+d[3]*p,m=d[4]*l+d[5]*c+d[6]*h+d[7]*p,g=d[8]*l+d[9]*c+d[10]*h+d[11]*p,y=d[12]*l+d[13]*c+d[14]*h+d[15]*p,b=this.viewport;return y===0?!1:(v/=y,m/=y,g/=y,g<-1||g>1?!1:(g=d[8]*l+d[9]*c+d[10]*h*(1+n)+d[11]*p,g/=y,g=a.clamp(g,-1,1),v=v*.5+.5,m=m*.5+.5,g=g*.5+.5,v=v*b.width+b.x,m=m*b.height+b.y,i[0]=v,i[1]=m,i[2]=g,!0))},f.prototype.unProject=function(t,n){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","unProject","missingPoint"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","unProject","missingResult"));var i=t[0],s=t[1],o=t[2],u=this.viewport;i=(i-u.x)/u.width,s=(s-u.y)/u.height,i=i*2-1,s=s*2-1,o=o*2-1;if(o<-1||o>1)return!1;var a=this.modelviewProjectionInv,f=a[0]*i+a[1]*s+a[2]*o+a[3],l=a[4]*i+a[5]*s+a[6]*o+a[7],c=a[8]*i+a[9]*s+a[10]*o+a[11],h=a[12]*i+a[13]*s+a[14]*o+a[15];return h===0?!1:(n[0]=f/h,n[1]=l/h,n[2]=c/h,!0)},f.prototype.convertPointToWindow=function(t,n){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","convertPointToWindow","missingPoint"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","convertPointToWindow","missingResult"));return n[0]=t[0],n[1]=this.viewport.height-t[1],n},f.prototype.convertPointToViewport=function(t,n){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","convertPointToViewport","missingPoint"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","convertPointToViewport","missingResult"));return n[0]=t[0],n[1]=this.viewport.height-t[1],n},f.prototype.rayFromScreenPoint=function(t){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"NavigatorState","rayFromScreenPoint","missingPoint"));var i=this.convertPointToViewport(t,new u(0,0,0)),s=new u(0,0,0),o=new u(0,0,0);if(!this.unProject(i,s))return null;i[2]=1;if(!this.unProject(i,o))return null;var a=new u(this.eyePoint[0],this.eyePoint[1],this.eyePoint[2]),f=new u(o[0],o[1],o[2]);return f.subtract(s),f.normalize(),new n(a,f)},f.prototype.pixelSizeAtDistance=function(e){return this.pixelSizeScale*e+this.pixelSizeOffset},f}),n("globe/Terrain",["../error/ArgumentError","../util/Logger","../geom/Vec3"],function(e,t,n){"use strict";var r=function(e,t,n,r){this.globe=e,this.verticalExaggeration=r,this.sector=n.sector,this.tessellator=t,this.surfaceGeometry=n.tileArray,this.stateKey=e.stateKey+" ve "+r.toString()};return r.scratchPoint=new n(0,0,0),r.prototype.surfacePoint=function(n,i,s,o){if(!o)throw new e(t.logMessage(t.LEVEL_SEVERE,"Terrain","surfacePoint","missingResult"));for(var u=0,a=this.surfaceGeometry.length;u<a;u++)if(this.surfaceGeometry[u].sector.containsLocation(n,i)){this.surfaceGeometry[u].surfacePoint(n,i,o);if(s){var f=this.globe.surfaceNormalAtPoint(o[0],o[1],o[2],r.scratchPoint);o[0]+=f[0]*s,o[1]+=f[1]*s,o[2]+=f[2]*s}return o}var l=s+this.globe.elevationAtLocation(n,i)*this.verticalExaggeration;return this.globe.computePointFromPosition(n,i,l,o),o},r.prototype.surfacePointForMode=function(n,r,i,s,o){if(!o)throw new e(t.logMessage(t.LEVEL_SEVERE,"Terrain","surfacePointForMode","missingResult"));s||(s=WorldWind.ABSOLUTE);if(s===WorldWind.CLAMP_TO_GROUND)return this.surfacePoint(n,r,0,o);if(s===WorldWind.RELATIVE_TO_GROUND)return this.surfacePoint(n,r,i,o);var u=i*this.verticalExaggeration;return this.globe.computePointFromPosition(n,r,u,o),o},r.prototype.beginRendering=function(e){this.globe&&this.globe.tessellator&&this.globe.tessellator.beginRendering(e)},r.prototype.endRendering=function(e){this.globe&&this.globe.tessellator&&this.globe.tessellator.endRendering(e)},r.prototype.beginRenderingTile=function(n,r){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Terrain","beginRenderingTile","missingTile"));this.globe&&this.globe.tessellator&&this.globe.tessellator.beginRenderingTile(n,r)},r.prototype.endRenderingTile=function(e,t){},r.prototype.renderTile=function(n,r){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Terrain","renderTile","missingTile"));this.globe&&this.globe.tessellator&&this.globe.tessellator.renderTile(n,r)},r.prototype.pick=function(e){this.globe&&this.globe.tessellator&&this.globe.tessellator.pick(e,this.surfaceGeometry,this)},r}),n("globe/TerrainTile",["../error/ArgumentError","../util/Logger","../geom/Matrix","../util/Tile"],function(e,t,n,r){"use strict";var i=function(e,t,i,s){r.call(this,e,t,i,s),this.transformationMatrix=n.fromIdentity(),this.points=null,this.pointsStateKey=null,this.pointsVboStateKey=null,this.neighborMap={},this.neighborMap[WorldWind.NORTH]=null,this.neighborMap[WorldWind.SOUTH]=null,this.neighborMap[WorldWind.EAST]=null,this.neighborMap[WorldWind.WEST]=null,this._stateKey=null,this._elevationTimestamp=null,this.scratchArray=[]};return i.prototype=Object.create(r.prototype),Object.defineProperties(i.prototype,{stateKey:{get:function(){return this._stateKey||(this._stateKey=this.computeStateKey()),this._stateKey}}}),i.prototype.neighborLevel=function(e){return this.neighborMap[e]},i.prototype.setNeighborLevel=function(e,t){this.neighborMap[e]=t,this._stateKey=null},i.prototype.surfacePoint=function(n,r,i){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"TerrainTile","surfacePoint","missingResult"));var s=this.sector,o=s.minLatitude,u=s.maxLatitude,a=s.minLongitude,f=s.maxLongitude,l=this.tileWidth,c=this.tileHeight,h,p,d,v,m,g,y,b,w,E,S,x,T;h=(r-a)/(f-a)*l,p=(n-o)/(u-o)*c,d=h<l?Math.floor(h):l-1,v=p<c?Math.floor(p):c-1,m=l+1,g=this.points,y=this.scratchArray,b=3*(d+v*m);for(var N=0;N<6;N++)y[N]=g[b+N];b=3*(d+(v+1)*m);for(var C=6;C<12;C++)y[C]=g[b+(C-6)];return w=h<l?h-Math.floor(h):1,E=p<c?p-Math.floor(p):1,w>E?(i[0]=y[0]+w*(y[3]-y[0])+E*(y[6]-y[0]),i[1]=y[1]+w*(y[4]-y[1])+E*(y[7]-y[1]),i[2]=y[2]+w*(y[5]-y[2])+E*(y[8]-y[2])):(i[0]=y[9]+(1-w)*(y[6]-y[9])+(1-E)*(y[3]-y[9]),i[1]=y[10]+(1-w)*(y[7]-y[10])+(1-E)*(y[4]-y[10]),i[2]=y[11]+(1-w)*(y[8]-y[11])+(1-E)*(y[5]-y[11])),i[0]+=this.referencePoint[0],i[1]+=this.referencePoint[1],i[2]+=this.referencePoint[2],i},i.prototype.update=function(e){r.prototype.update.call(this,e);var t=e.globe.elevationTimestamp();this._elevationTimestamp!=t&&(this._elevationTimestamp=t,this._stateKey=null)},i.prototype.computeStateKey=function(){var e=[];return e.push(this._elevationTimestamp),e.push(this.neighborMap[WorldWind.NORTH]?this.neighborMap[WorldWind.NORTH].compare(this.level):0),e.push(this.neighborMap[WorldWind.SOUTH]?this.neighborMap[WorldWind.SOUTH].compare(this.level):0),e.push(this.neighborMap[WorldWind.EAST]?this.neighborMap[WorldWind.EAST].compare(this.level):0),e.push(this.neighborMap[WorldWind.WEST]?this.neighborMap[WorldWind.WEST].compare(this.level):0),e.join(".")},i}),n("globe/TerrainTileList",["../error/ArgumentError","../util/Logger","../geom/Sector"],function(e,t,n){"use strict";var r=function(r){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"TerrainTileList","TerrainTileList","missingTessellator"));this.tessellator=r,this.sector=null,this.tileArray=[]};return Object.defineProperties(r.prototype,{length:{get:function(){return this.tileArray.length}}}),r.prototype.addTile=function(r){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"TerrainTileList","addTile","missingTile"));this.tileArray.indexOf(r)==-1&&(this.tileArray.push(r),this.sector?this.sector.union(r.sector):(this.sector=new n(0,0,0,0),this.sector.copy(r.sector)))},r.prototype.removeAllTiles=function(){this.tileArray=[],this.sector=null},r}),n("globe/Tessellator",["../error/ArgumentError","../shaders/BasicProgram","../globe/Globe","../shaders/GpuProgram","../util/Level","../util/LevelSet","../geom/Location","../util/Logger","../geom/Matrix","../cache/MemoryCache","../navigate/NavigatorState","../error/NotYetImplementedError","../pick/PickedObject","../geom/Position","../geom/Rectangle","../geom/Sector","../globe/Terrain","../globe/TerrainTile","../globe/TerrainTileList","../util/Tile","../util/WWMath","../util/WWUtil"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E){"use strict";var S=function(){this.numRowsTilesInTopLevel=4,this.numColumnsTilesInTopLevel=8,this.maximumSubdivisionDepth=15,this.tileWidth=32,this.tileHeight=32,this.detailHintOrigin=1.1,this.detailHint=0,this.levels=new s(v.FULL_SPHERE,new o(180/this.numRowsTilesInTopLevel,360/this.numColumnsTilesInTopLevel),this.maximumSubdivisionDepth,this.tileWidth,this.tileHeight),this.topLevelTiles={},this.currentTiles=new y(this),this.tileCache=new f(5e6,4e6),this.elevationTimestamp=undefined,this.lastModelViewProjection=undefined,this.vertexPointLocation=-1,this.vertexTexCoordLocation=-1,this.modelViewProjectionMatrixLocation=-1,this.texCoords=null,this.texCoordVboCacheKey="global_tex_coords",this.indices=null,this.numIndices=null,this.indicesVboCacheKey="global_indices",this.indicesNorth=null,this.numIndicesNorth=null,this.indicesNorthVboCacheKey="global_north_indices",this.indicesSouth=null,this.numIndicesSouth=null,this.indicesSouthVboCacheKey="global_south_indices",this.indicesWest=null,this.numIndicesWest=null,this.indicesWestVboCacheKey="global_west_indices",this.indicesEast=null,this.numIndicesEast=null,this.indicesEastVboCacheKey="global_east_indices",this.indicesLoresNorth=null,this.numIndicesLoresNorth=null,this.indicesLoresNorthVboCacheKey="global_lores_north_indices",this.indicesLoresSouth=null,this.numIndicesLoresSouth=null,this.indicesLoresSouthVboCacheKey="global_lores_south_indices",this.indicesLoresWest=null,this.numIndicesLoresWest=null,this.indicesLoresWestVboCacheKey="global_lores_west_indices",this.indicesLoresEast=null,this.numIndicesLoresEast=null,this.indicesLoresEastVboCacheKey="global_lores_east_indices",this.outlineIndices=null,this.outlineIndicesVboCacheKey="global_outline_indices",this.wireframeIndices=null,this.wireframeIndicesVboCacheKey="global_wireframe_indices",this.scratchMatrix=a.fromIdentity(),this.scratchElevations=null,this.scratchPrevElevations=null,this.corners={},this.tiles=[]};return S.prototype.tessellate=function(t){if(!t)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tessellator","tessellate","missingDC"));var n=t.globe.elevationTimestamp();if(this.lastGlobeStateKey===t.globeStateKey&&this.lastVerticalExaggeration===t.verticalExaggeration&&this.elevationTimestamp===n&&this.lastModelViewProjection&&t.navigatorState.modelviewProjection.equals(this.lastModelViewProjection))return this.lastTerrain;var r=t.navigatorState;this.lastModelViewProjection=r.modelviewProjection,this.lastGlobeStateKey=t.globeStateKey,this.elevationTimestamp=n,this.lastVerticalExaggeration=t.verticalExaggeration,this.currentTiles.removeAllTiles(),(!this.topLevelTiles[t.globeStateKey]||this.topLevelTiles[t.globeStateKey].length==0)&&this.createTopLevelTiles(t),this.corners={},this.tiles=[];for(var i=0,s=this.topLevelTiles[t.globeStateKey].length;i<s;i+=1){var o=this.topLevelTiles[t.globeStateKey][i];o.update(t),this.isTileVisible(t,o)&&this.addTileOrDescendants(t,o)}return this.refineNeighbors(t),this.finishTessellating(t),this.lastTerrain=this.currentTiles.length===0?null:new m(t.globe,this,this.currentTiles,t.verticalExaggeration),this.lastTerrain},S.prototype.createTile=function(t,n,r,i){if(!t)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tile","constructor","missingSector"));if(!n)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tile","constructor","The specified level is null or undefined."));if(r<0||i<0)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tile","constructor","The specified row or column is less than zero."));return new g(t,n,r,i)},S.prototype.beginRendering=function(e){var t=e.currentProgram;if(!t){u.logMessage(u.LEVEL_INFO,"Tessellator","beginRendering","Current Program is empty");return}this.buildSharedGeometry(),this.cacheSharedGeometryVBOs(e);var n=e.currentGlContext,r=e.gpuResourceCache;this.vertexPointLocation=t.attributeLocation(n,"vertexPoint"),this.vertexTexCoordLocation=t.attributeLocation(n,"vertexTexCoord"),this.modelViewProjectionMatrixLocation=t.uniformLocation(n,"mvpMatrix"),n.enableVertexAttribArray(this.vertexPointLocation);if(this.vertexTexCoordLocation>=0){var i=r.resourceForKey(this.texCoordVboCacheKey);n.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,i),n.vertexAttribPointer(this.vertexTexCoordLocation,2,WebGLRenderingContext.FLOAT,!1,0,0),n.enableVertexAttribArray(this.vertexTexCoordLocation)}},S.prototype.endRendering=function(e){var t=e.currentGlContext;t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,null),t.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,null),this.vertexPointLocation>=0&&t.disableVertexAttribArray(this.vertexPointLocation),this.vertexTexCoordLocation>=0&&t.disableVertexAttribArray(this.vertexTexCoordLocation)},S.prototype.beginRenderingTile=function(t,n){if(!n)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tessellator","beginRenderingTile","missingTile"));var i=t.currentGlContext,s=t.gpuResourceCache;this.scratchMatrix.setToMultiply(t.navigatorState.modelviewProjection,n.transformationMatrix),r.loadUniformMatrix(i,this.scratchMatrix,this.modelViewProjectionMatrixLocation);var o=t.globeStateKey+n.tileKey,a=s.resourceForKey(o);a?n.pointsVboStateKey!=n.pointsStateKey?(i.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,a),i.bufferSubData(WebGLRenderingContext.ARRAY_BUFFER,0,n.points),n.pointsVboStateKey=n.pointsStateKey):t.currentGlContext.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,a):(a=i.createBuffer(),i.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,a),i.bufferData(WebGLRenderingContext.ARRAY_BUFFER,n.points,WebGLRenderingContext.STATIC_DRAW),t.frameStatistics.incrementVboLoadCount(1),s.putResource(o,a,n.points.length*4),n.pointsVboStateKey=n.pointsStateKey),i.vertexAttribPointer(this.vertexPointLocation,3,WebGLRenderingContext.FLOAT,!1,0,0)},S.prototype.endRenderingTile=function(e,t){},S.prototype.renderTile=function(t,n){if(!n)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tessellator","renderTile","missingTile"));var r=t.currentGlContext,i=t.gpuResourceCache,s=WebGLRenderingContext.TRIANGLE_STRIP,o=i.resourceForKey(this.indicesVboCacheKey);r.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,o),r.drawElements(s,this.numIndices,WebGLRenderingContext.UNSIGNED_SHORT,0);var a=n.level,f;f=n.neighborLevel(WorldWind.NORTH);if(f&&f.compare(a)<0){var l=i.resourceForKey(this.indicesLoresNorthVboCacheKey);r.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,l),r.drawElements(s,this.numIndicesLoresNorth,WebGLRenderingContext.UNSIGNED_SHORT,0)}else{var c=i.resourceForKey(this.indicesNorthVboCacheKey);r.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,c),r.drawElements(s,this.numIndicesNorth,WebGLRenderingContext.UNSIGNED_SHORT,0)}f=n.neighborLevel(WorldWind.SOUTH);if(f&&f.compare(a)<0){var h=i.resourceForKey(this.indicesLoresSouthVboCacheKey);r.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,h),r.drawElements(s,this.numIndicesLoresSouth,WebGLRenderingContext.UNSIGNED_SHORT,0)}else{var p=i.resourceForKey(this.indicesSouthVboCacheKey);r.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,p),r.drawElements(s,this.numIndicesSouth,WebGLRenderingContext.UNSIGNED_SHORT,0)}f=n.neighborLevel(WorldWind.WEST);if(f&&f.compare(a)<0){var d=i.resourceForKey(this.indicesLoresWestVboCacheKey);r.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,d),r.drawElements(s,this.numIndicesLoresWest,WebGLRenderingContext.UNSIGNED_SHORT,0)}else{var v=i.resourceForKey(this.indicesWestVboCacheKey);r.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,v),r.drawElements(s,this.numIndicesWest,WebGLRenderingContext.UNSIGNED_SHORT,0)}f=n.neighborLevel(WorldWind.EAST);if(f&&f.compare(a)<0){var m=i.resourceForKey(this.indicesLoresEastVboCacheKey);r.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,m),r.drawElements(s,this.numIndicesLoresEast,WebGLRenderingContext.UNSIGNED_SHORT,0)}else{var g=i.resourceForKey(this.indicesEastVboCacheKey);r.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,g),r.drawElements(s,this.numIndicesEast,WebGLRenderingContext.UNSIGNED_SHORT,0)}},S.prototype.renderWireframeTile=function(t,n){if(!n)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tessellator","renderWireframeTile","missingTile"));var r=t.currentGlContext,i=t.gpuResourceCache;this.vertexTexCoordLocation>=0&&r.disableVertexAttribArray(this.vertexTexCoordLocation);var s=i.resourceForKey(this.wireframeIndicesVboCacheKey);r.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,s),r.drawElements(WebGLRenderingContext.LINES,this.wireframeIndices.length,WebGLRenderingContext.UNSIGNED_SHORT,0)},S.prototype.renderTileOutline=function(t,n){if(!n)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tessellator","renderTileOutline","missingTile"));var r=t.currentGlContext,i=t.gpuResourceCache;this.vertexTexCoordLocation>=0&&r.disableVertexAttribArray(this.vertexTexCoordLocation);var s=i.resourceForKey(this.outlineIndicesVboCacheKey);r.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,s),r.drawElements(WebGLRenderingContext.LINE_LOOP,this.outlineIndices.length,WebGLRenderingContext.UNSIGNED_SHORT,0)},S.prototype.pick=function(t,n,r){if(!t)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tessellator","pick","missingDc"));if(!n)throw new e(u.logMessage(u.LEVEL_SEVERE,"Tessellator","pick","missingList"));var i=null,s=r||this,o=new p(0,0,0),a=[];for(var f=0,l=n.length;f<l;f++){var c=n[f];c.extent.intersectsFrustum(t.pickFrustum)&&a.push(c)}t.pickTerrainOnly||(i=t.uniquePickColor(),this.drawPickTiles(t,a,i));if(!t.regionPicking){var d=t.navigatorState.rayFromScreenPoint(t.pickPoint),v=this.computeNearestIntersection(d,a);v&&(t.globe.computePositionFromPoint(v[0],v[1],v[2],o),o.altitude=t.globe.elevationAtLocation(o.latitude,o.longitude),t.addPickedObject(new h(i,s,o,null,!0)))}},S.prototype.drawPickTiles=function(e,n,r){var i=e.currentGlContext;try{e.findAndBindProgram(t),e.currentProgram.loadColor(i,r),this.beginRendering(e);for(var s=0,o=n.length;s<o;s++){var u=n[s];this.beginRenderingTile(e,u),this.renderTile(e,u),this.endRenderingTile(e,u)}}finally{this.endRendering(e),e.bindProgram(null)}},S.prototype.computeNearestIntersection=function(e,t){var n=[];for(var r=0,i=t.length;r<i;r++)this.computeIntersections(e,t[r],n);if(n.length==0)return null;var s=Number.POSITIVE_INFINITY,o;for(r=0,i=n.length;r<i;r++){var u=e.origin.distanceToSquared(n[r]);s>u&&(s=u,o=r)}return n[o]},S.prototype.computeIntersections=function(e,t,n){var r=t.level,i,s=t.points,o,u=n.length;e.origin.subtract(t.referencePoint),this.buildSharedGeometry(t),o=this.indices,w.computeTriStripIntersections(e,s,o,n),i=t.neighborLevel(WorldWind.SOUTH),o=i&&i.compare(r)<0?this.indicesLoresSouth:this.indicesSouth,w.computeTriStripIntersections(e,s,o,n),i=t.neighborLevel(WorldWind.WEST),o=i&&i.compare(r)<0?this.indicesLoresWest:this.indicesWest,w.computeTriStripIntersections(e,s,o,n),i=t.neighborLevel(WorldWind.EAST),o=i&&i.compare(r)<0?this.indicesLoresEast:this.indicesEast,w.computeTriStripIntersections(e,s,o,n),i=t.neighborLevel(WorldWind.NORTH),o=i&&i.compare(r)<0?this.indicesLoresNorth:this.indicesNorth,w.computeTriStripIntersections(e,s,o,n),e.origin.add(t.referencePoint);for(var a=u,f=n.length;a<f;a++)n[a].add(t.referencePoint)},S.prototype.createTopLevelTiles=function(e){this.topLevelTiles[e.globeStateKey]=[],b.createTilesForLevel(this.levels.firstLevel(),this,this.topLevelTiles[e.globeStateKey])},S.prototype.addTileOrDescendants=function(e,t){if(this.tileMeetsRenderCriteria(e,t)){this.addTile(e,t);return}this.addTileDescendants(e,t)},S.prototype.addTileDescendants=function(e,t){var n=t.level.nextLevel(),r=t.subdivideToCache(n,this,this.tileCache);for(var i=0;i<r.length;i+=1){var s=r[i];s.update(e),this.levels.sector.intersects(s.sector)&&this.isTileVisible(e,s)&&this.addTileOrDescendants(e,s)}},S.prototype.addTile=function(e,t){var n=this.tiles.length;this.tiles.push(t);var r=t.sector,i=[r.maxLatitude,r.maxLongitude].toString(),s=[r.minLatitude,r.maxLongitude].toString(),o=[r.maxLatitude,r.minLongitude].toString(),u=[r.minLatitude,r.minLongitude].toString(),a;a=this.corners[u],a?a.sw=n:this.corners[u]={sw:n},a=this.corners[o],a?a.nw=n:this.corners[o]={nw:n},a=this.corners[s],a?a.se=n:this.corners[s]={se:n},a=this.corners[i],a?a.ne=n:this.corners[i]={ne:n}},S.prototype.refineNeighbors=function(e){var t={};for(var n=0,r=this.tiles.length;n<r;n+=1){var i=this.tiles[n],s=i.level.levelNumber,o=i.sector,u,a,n,r,f=[o.maxLatitude,o.maxLongitude].toString(),l=[o.minLatitude,o.maxLongitude].toString(),c=[o.maxLatitude,o.minLongitude].toString(),h=[o.minLatitude,o.minLongitude].toString();u=this.corners[f],u.hasOwnProperty("se")&&(a=u.se,this.tiles[a].level.levelNumber<s-1&&(t[a]||(t[a]=!0))),u.hasOwnProperty("nw")&&(a=u.nw,this.tiles[a].level.levelNumber<s-1&&(t[a]||(t[a]=!0))),u=this.corners[l],u.hasOwnProperty("ne")&&(a=u.ne,this.tiles[a].level.levelNumber<s-1&&(t[a]||(t[a]=!0))),u.hasOwnProperty("sw")&&(a=u.sw,this.tiles[a].level.levelNumber<s-1&&(t[a]||(t[a]=!0))),u=this.corners[c],u.hasOwnProperty("ne")&&(a=u.ne,this.tiles[a].level.levelNumber<s-1&&(t[a]||(t[a]=!0))),u.hasOwnProperty("sw")&&(a=u.sw,this.tiles[a].level.levelNumber<s-1&&(t[a]||(t[a]=!0))),u=this.corners[h],u.hasOwnProperty("se")&&(a=u.se,this.tiles[a].level.levelNumber<s-1&&(t[a]||(t[a]=!0))),u.hasOwnProperty("nw")&&(a=u.nw,this.tiles[a].level.levelNumber<s-1&&(t[a]||(t[a]=!0)))}var p=[],d=[];for(n=0,r=this.tiles.length;n<r;n+=1)i=this.tiles[n],t[n]?p.push(i):d.push(i);if(p.length>0){this.tiles=[],this.corners={};for(n=0,r=d.length;n<r;n+=1)i=d[n],this.addTile(e,i);for(n=0,r=p.length;n<r;n+=1){var i=p[n];this.addTileDescendants(e,i)}this.refineNeighbors(e)}},S.prototype.finishTessellating=function(e){for(var t=0,n=this.tiles.length;t<n;t+=1){var r=this.tiles[t];this.setNeighbors(r),this.regenerateTileGeometryIfNeeded(e,r),this.currentTiles.addTile(r)}},S.prototype.setNeighbors=function(e){var t=e.sector,n=[t.maxLatitude,t.maxLongitude].toString(),r=[t.minLatitude,t.maxLongitude].toString(),i=[t.maxLatitude,t.minLongitude].toString(),s=[t.minLatitude,t.minLongitude].toString(),o=this.corners[n],u=this.corners[r],a=this.corners[i],f=this.corners[s],l=-1,c=-1,h=-1,p=-1;o.hasOwnProperty("se")?l=o.se:a.hasOwnProperty("sw")&&(l=a.sw),u.hasOwnProperty("ne")?c=u.ne:f.hasOwnProperty("nw")&&(c=f.nw),o.hasOwnProperty("nw")?h=o.nw:u.hasOwnProperty("sw")&&(h=u.sw),a.hasOwnProperty("ne")?p=a.ne:f.hasOwnProperty("se")&&(p=f.se),e.setNeighborLevel(WorldWind.NORTH,l>=0?this.tiles[l].level:null),e.setNeighborLevel(WorldWind.SOUTH,c>=0?this.tiles[c].level:null),e.setNeighborLevel(WorldWind.EAST,h>=0?this.tiles[h].level:null),e.setNeighborLevel(WorldWind.WEST,p>=0?this.tiles[p].level:null)},S.prototype.isTileVisible=function(e,t){return e.globe.projectionLimits&&!t.sector.overlaps(e.globe.projectionLimits)?!1:t.extent.intersectsFrustum(e.navigatorState.frustumInModelCoordinates)},S.prototype.tileMeetsRenderCriteria=function(e,t){var n=this.detailHintOrigin+this.detailHint;if(t.sector.minLatitude>=75||t.sector.maxLatitude<=-75)n*=.5;return t.level.isLastLevel()||!t.mustSubdivide(e,n)},S.prototype.regenerateTileGeometryIfNeeded=function(e,t){var n=e.globeStateKey+t.stateKey+e.verticalExaggeration;if(!t.points||t.pointsStateKey!=n)this.regenerateTileGeometry(e,t),t.pointsStateKey=n},S.prototype.regenerateTileGeometry=function(e,t){var n=t.tileHeight+1,r=t.tileWidth+1,i=t.referencePoint,s=this.scratchElevations;s||(s=new Float64Array(n*r),this.scratchElevations=s),t.points||(t.points=new Float32Array(n*r*3)),E.fillArray(s,0),e.globe.elevationsForGrid(t.sector,n,r,t.texelSize,s),this.mustAlignNeighborElevations(e,t)&&this.alignNeighborElevations(e,t,s),E.multiplyArray(s,e.verticalExaggeration),e.globe.computePointsForGrid(t.sector,n,r,s,i,t.points),t.transformationMatrix.setTranslation(i[0],i[1],i[2])},S.prototype.mustAlignNeighborElevations=function(e,t){var n=t.level,r=t.neighborLevel(WorldWind.NORTH),i=t.neighborLevel(WorldWind.SOUTH),s=t.neighborLevel(WorldWind.EAST),o=t.neighborLevel(WorldWind.WEST);return r&&r.compare(n)<0||i&&i.compare(n)<0||s&&s.compare(n)<0||o&&o.compare(n)<0},S.prototype.alignNeighborElevations=function(e,t,n){var r=t.tileHeight+1,i=t.tileWidth+1,s=t.level,o=Math.floor(r/2)+1,u=Math.floor(i/2)+1,a=s.previousLevel(),f=this.scratchPrevElevations,l,c,h,p;f||(f=new Float64Array(o*u),this.scratchPrevElevations=f),E.fillArray(f,0),e.globe.elevationsForGrid(t.sector,o,u,a.texelSize,f),l=t.neighborLevel(WorldWind.NORTH);if(l&&l.compare(s)<0){h=(r-1)*i,p=(o-1)*u;for(c=0;c<u;c++,h+=2,p+=1)n[h]=f[p],c<u-1&&(n[h+1]=.5*(f[p]+f[p+1]))}l=t.neighborLevel(WorldWind.SOUTH);if(l&&l.compare(s)<0){h=0,p=0;for(c=0;c<u;c++,h+=2,p+=1)n[h]=f[p],c<u-1&&(n[h+1]=.5*(f[p]+f[p+1]))}l=t.neighborLevel(WorldWind.EAST);if(l&&l.compare(s)<0){h=i-1,p=u-1;for(c=0;c<o;c++,h+=2*i,p+=u)n[h]=f[p],c<o-1&&(n[h+i]=.5*(f[p]+f[p+u]))}l=t.neighborLevel(WorldWind.WEST);if(l&&l.compare(s)<0){h=0,p=0;for(c=0;c<o;c++,h+=2*i,p+=u)n[h]=f[p],c<o-1&&(n[h+i]=.5*(f[p]+f[p+u]))}},S.prototype.buildSharedGeometry=function(){var e=this.levels.tileWidth,t=this.levels.tileHeight;this.texCoords||this.buildTexCoords(e,t),this.indices||this.buildIndices(e,t),this.wireframeIndices||this.buildWireframeIndices(e,t),this.outlineIndices||this.buildOutlineIndices(e,t)},S.prototype.buildTexCoords=function(e,t){var n=e+1,r=t+1,i=1/e,s=1/t,o=new Float32Array(n*r*2),u=0;for(var a=0,f=0;a<r;a++,f+=s){a==r-1&&(f=1);for(var l=0,c=0;l<n;l++,c+=i)l==n-1&&(c=1),o[u++]=c,o[u++]=f}this.texCoords=o},S.prototype.buildIndices=function(e,t){var n,r=t+1,i=e+1,s=t/2,o=e/2,u=2*(r-3)*(i-2)+2*(r-3),a=new Int16Array(u),f=0;for(var l=1;l<i-2;l+=1){for(var c=1;c<r-1;c+=1)n=l+c*i,a[f++]=n,a[f++]=n+1;a[f++]=n+1,n=l+1+1*i,a[f++]=n}this.indices=a,this.numIndices=u,u=2*i-2,a=new Int16Array(u),f=0,c=r-1,l=i-1,n=l+c*i,a[f++]=n;for(l=i-2;l>0;l-=1)n=l+c*i,a[f++]=n,a[f++]=n-i;l=0,n=l+c*i,a[f++]=n,this.indicesNorth=a,this.numIndicesNorth=u,u=2*i-2,a=new Int16Array(u),f=0,c=0,l=0,n=l+c*i,a[f++]=n;for(l=1;l<i-1;l+=1)n=l+c*i,a[f++]=n,a[f++]=n+i;l=i-1,n=l+c*i,a[f++]=n,this.indicesSouth=a,this.numIndicesSouth=u,u=2*r-2,a=new Int16Array(u),f=0,l=0,c=r-1,n=l+c*i,a[f++]=n;for(c=r-2;c>0;c-=1)n=l+c*i,a[f++]=n,a[f++]=n+1;c=0,n=l+c*i,a[f++]=n,this.indicesWest=a,this.numIndicesWest=u,u=2*r-2,a=new Int16Array(u),f=0,l=i-1,c=0,n=l+c*i,a[f++]=n;for(c=1;c<r-1;c+=1)n=l+c*i,a[f++]=n,a[f++]=n-1;c=r-1,n=l+c*i,a[f++]=n,this.indicesEast=a,this.numIndicesEast=u,u=2*i-2,a=new Int16Array(u),f=0,c=r-1,l=i-1,n=l+c*i,a[f++]=n;for(l=i-2;l>0;l-=1)n=(l+1&-2)+c*i,a[f++]=n,n=l+(c-1)*i,a[f++]=n;l=0,n=l+c*i,a[f++]=n,this.indicesLoresNorth=a,this.numIndicesLoresNorth=u,u=2*i-2,a=new Int16Array(u),f=0,c=0,l=0,n=l+c*i,a[f++]=n;for(l=1;l<i-1;l+=1)n=(l&-2)+c*i,a[f++]=n,n=l+(c+1)*i,a[f++]=n;l=i-1,n=l+c*i,a[f++]=n,this.indicesLoresSouth=a,this.numIndicesLoresSouth=u,u=2*r-2,a=new Int16Array(u),f=0,l=0,c=r-1,n=l+c*i,a[f++]=n;for(c=r-2;c>0;c-=1)n=l+(c+1&-2)*i,a[f++]=n,n=l+1+c*i,a[f++]=n;c=0,n=l+c*i,a[f++]=n,this.indicesLoresWest=a,this.numIndicesLoresWest=u,u=2*r-2,a=new Int16Array(u),f=0,l=i-1,c=0,n=l+c*i,a[f++]=n;for(c=1;c<r-1;c+=1)n=l+(c&-2)*i,a[f++]=n,n=l-1+c*i,a[f++]=n;c=r-1,n=l+c*i,a[f++]=n,this.indicesLoresEast=a,this.numIndicesLoresEast=u},S.prototype.buildWireframeIndices=function(e,t){var n=t+1,r=e+1,i=2*e*n+2*t*r,s=new Int16Array(i),o=r,u=0,a,f,l;for(f=0;f<n;f+=1)for(a=0;a<e;a+=1)l=a+f*o,s[u]=l,s[u+1]=l+1,u+=2;for(a=0;a<r;a+=1)for(f=0;f<t;f+=1)l=a+f*o,s[u]=l,s[u+1]=l+o,u+=2;this.wireframeIndices=s},S.prototype.buildOutlineIndices=function(e,t){var n=t+1,r=e+1,i=2*(n-2)+2*r+1,s=new Int16Array(i),o=n,u=0,a,f,l;f=0;for(a=0;a<r;a+=1)l=a+f*r,s[u]=l,u+=1;a=r-1;for(f=1;f<n;f+=1)l=a+f*r,s[u]=l,u+=1;f=n-1;for(a=r-1;a>=0;a-=1)l=a+f*r,s[u]=l,u+=1;a=0;for(f=n-1;f>=0;f-=1)l=a+f*r,s[u]=l,u+=1;this.outlineIndices=s},S.prototype.cacheSharedGeometryVBOs=function(e){var t=e.currentGlContext,n=e.gpuResourceCache,r=n.resourceForKey(this.texCoordVboCacheKey);r||(r=t.createBuffer(),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,r),t.bufferData(WebGLRenderingContext.ARRAY_BUFFER,this.texCoords,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.texCoordVboCacheKey,r,this.texCoords.length*4/2));var i=n.resourceForKey(this.indicesVboCacheKey);i||(i=t.createBuffer(),t.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,i),t.bufferData(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,this.indices,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesVboCacheKey,i,this.indices.length*2));var s=n.resourceForKey(this.indicesNorthVboCacheKey);s||(s=t.createBuffer(),t.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,s),t.bufferData(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,this.indicesNorth,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesNorthVboCacheKey,s,this.indicesNorth.length*2));var o=n.resourceForKey(this.indicesSouthVboCacheKey);o||(o=t.createBuffer(),t.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,o),t.bufferData(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,this.indicesSouth,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesSouthVboCacheKey,o,this.indicesSouth.length*2));var u=n.resourceForKey(this.indicesWestVboCacheKey);u||(u=t.createBuffer(),t.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,u),t.bufferData(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,this.indicesWest,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesWestVboCacheKey,u,this.indicesWest.length*2));var a=n.resourceForKey(this.indicesEastVboCacheKey);a||(a=t.createBuffer(),t.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,a),t.bufferData(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,this.indicesEast,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesEastVboCacheKey,a,this.indicesEast.length*2));var f=n.resourceForKey(this.indicesLoresNorthVboCacheKey);f||(f=t.createBuffer(),t.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,f),t.bufferData(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,this.indicesLoresNorth,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesLoresNorthVboCacheKey,f,this.indicesLoresNorth.length*2));var l=n.resourceForKey(this.indicesLoresSouthVboCacheKey);l||(l=t.createBuffer(),t.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,l),t.bufferData(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,this.indicesLoresSouth,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesLoresSouthVboCacheKey,l,this.indicesLoresSouth.length*2));var c=n.resourceForKey(this.indicesLoresWestVboCacheKey);c||(c=t.createBuffer(),t.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,c),t.bufferData(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,this.indicesLoresWest,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesLoresWestVboCacheKey,c,this.indicesLoresWest.length*2));var h=n.resourceForKey(this.indicesLoresEastVboCacheKey);h||(h=t.createBuffer(),t.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,h),t.bufferData(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,this.indicesLoresEast,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.indicesLoresEastVboCacheKey,h,this.indicesLoresEast.length*2));var p=n.resourceForKey(this.outlineIndicesVboCacheKey);p||(p=t.createBuffer(),t.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,p),t.bufferData(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,this.outlineIndices,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.outlineIndicesVboCacheKey,p,this.outlineIndices.length*2));var d=n.resourceForKey(this.wireframeIndicesVboCacheKey);d||(d=t.createBuffer(),t.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,d),t.bufferData(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,this.wireframeIndices,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),n.putResource(this.wireframeIndicesVboCacheKey,d,this.wireframeIndices.length*2))},S}),n("globe/Globe",["../geom/Angle","../error/ArgumentError","../globe/ElevationModel","../geom/Line","../geom/Location","../util/Logger","../geom/Position","../geom/Sector","../globe/Tessellator","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";var c=function(e){if(!e)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","constructor","Elevation model is null or undefined."));this.elevationModel=e,this.equatorialRadius=6378137,this.polarRadius=6356752.3,this.eccentricitySquared=.00669437999013,this.tessellator=new a,this.scratchPosition=new o(0,0,0),this.scratchPoint=new f(0,0,0),this.id=++c.idPool,this._stateKey="globe "+this.id.toString()+" "};return c.idPool=0,Object.defineProperties(c.prototype,{stateKey:{get:function(){return this._stateKey+this.elevationModel.stateKey}}}),c.prototype.is2D=function(){return!1},c.prototype.computePointFromPosition=function(n,r,i,o){if(!o)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","computePointFromPosition","missingResult"));var u=Math.cos(n*e.DEGREES_TO_RADIANS),a=Math.sin(n*e.DEGREES_TO_RADIANS),f=Math.cos(r*e.DEGREES_TO_RADIANS),l=Math.sin(r*e.DEGREES_TO_RADIANS),c=this.equatorialRadius/Math.sqrt(1-this.eccentricitySquared*a*a);return o[0]=(c+i)*u*l,o[1]=(c*(1-this.eccentricitySquared)+i)*a,o[2]=(c+i)*u*f,o},c.prototype.computePointFromLocation=function(e,n,r){if(!r)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","computePointFromLocation","missingResult"));return this.computePointFromPosition(e,n,0,r)},c.prototype.computePointsForGrid=function(n,r,i,o,u,a){if(!n)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","computePointsFromPositions","missingSector"));if(r<1||i<1)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","computePointsFromPositions","Number of latitude or longitude locations is less than one."));var l=r*i;if(!o||o.length<l)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","computePointsFromPositions","Elevations array is null, undefined or insufficient length."));if(!a||a.length<l)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","computePointsFromPositions","Result array is null, undefined or insufficient length."));var c=n.minLatitude*e.DEGREES_TO_RADIANS,h=n.maxLatitude*e.DEGREES_TO_RADIANS,p=n.minLongitude*e.DEGREES_TO_RADIANS,d=n.maxLongitude*e.DEGREES_TO_RADIANS,v=(h-c)/(r>1?r-1:1),m=(d-p)/(i>1?i-1:1),g=u?u:new f(0,0,0),y,b,w=0,E=0,S,x,T,N,C,k,L=new Float64Array(i),A=new Float64Array(i);for(b=0,x=p;b<i;b++,x+=m)b===i-1&&(x=d),L[b]=Math.cos(x),A[b]=Math.sin(x);for(y=0,S=c;y<r;y++,S+=v){y===r-1&&(S=h),C=Math.cos(S),k=Math.sin(S),T=this.equatorialRadius/Math.sqrt(1-this.eccentricitySquared*k*k);for(b=0;b<i;b++)N=o[w++],a[E++]=(T+N)*C*A[b]-g[0],a[E++]=(T*(1-this.eccentricitySquared)+N)*k-g[1],a[E++]=(T+N)*C*L[b]-g[2]}return a},c.prototype.computePositionFromPoint=function(n,r,i,o){if(!o)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","computePositionFromPoint","missingResult"));var u=i,a=n,f=r,c=u*u+a*a,h=Math.sqrt(c),p=this.equatorialRadius,d=1/(p*p),v=this.eccentricitySquared,m=v*v,g=c*d,y=f*f*(1-v)*d,b=(g+y-m)/6,w,E,S,x=8*b*b*b+m*g*y,T,N,C,k,L,A,O,M,_,D,P,H;return x>0||y!=0?(x>0?(T=Math.sqrt(x),N=Math.sqrt(m*g*y),x>10*v?(C=l.cbrt((T+N)*(T+N)),S=b+.5*C+2*b*b/C):S=b+.5*l.cbrt((T+N)*(T+N))+.5*l.cbrt((T-N)*(T-N))):(T=Math.sqrt(-x),N=Math.sqrt(-8*b*b*b),C=Math.sqrt(m*g*y),k=2*Math.atan2(C,T+N)/3,S=-4*b*Math.sin(k)*Math.cos(Math.PI/6+k)),L=Math.sqrt(S*S+m*y),A=v*(S+L-y)/(2*L),O=(S+L)/(Math.sqrt(A*A+S+L)+A),M=O*h/(O+v),_=Math.sqrt(M*M+f*f),w=(O+v-1)*_/O,E=2*Math.atan2(f,_+M)):(T=Math.sqrt(1-v),N=Math.sqrt(v-g),D=Math.sqrt(v),w=-p*T*N/D,E=N/(D*N+T*Math.sqrt(g))),H=Math.sqrt(2),(H-1)*a<h+u?P=2*Math.atan2(a,h+u):h+a<(H+1)*u?P=-Math.PI*.5+2*Math.atan2(u,h-a):P=Math.PI*.5-2*Math.atan2(u,h+a),o.latitude=e.RADIANS_TO_DEGREES*E,o.longitude=e.RADIANS_TO_DEGREES*P,o.altitude=w,o},c.prototype.radiusAt=function(t,n){var r=Math.sin(t*e.DEGREES_TO_RADIANS),i=this.equatorialRadius/Math.sqrt(1-this.eccentricitySquared*r*r);return i*Math.sqrt(1+(this.eccentricitySquared*this.eccentricitySquared-2*this.eccentricitySquared)*r*r)},c.prototype.surfaceNormalAtLocation=function(n,r,i){if(!i)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","surfaceNormalAtLocation","missingResult"));var o=Math.cos(n*e.DEGREES_TO_RADIANS),u=Math.cos(r*e.DEGREES_TO_RADIANS),a=Math.sin(n*e.DEGREES_TO_RADIANS),f=Math.sin(r*e.DEGREES_TO_RADIANS),l=this.equatorialRadius*this.equatorialRadius,c=this.polarRadius*this.polarRadius;return i[0]=o*f/l,i[1]=(1-this.eccentricitySquared)*a/c,i[2]=o*u/l,i.normalize()},c.prototype.surfaceNormalAtPoint=function(e,n,r,i){if(!i)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","surfaceNormalAtPoint","missingResult"));var o=this.equatorialRadius*this.equatorialRadius,u=this.polarRadius*this.polarRadius;return i[0]=e/o,i[1]=n/u,i[2]=r/o,i.normalize()},c.prototype.northTangentAtLocation=function(n,r,i){if(!i)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","northTangentAtLocation","missingResult"));var o=Math.cos(n*e.DEGREES_TO_RADIANS),u=Math.cos(r*e.DEGREES_TO_RADIANS),a=Math.sin(n*e.DEGREES_TO_RADIANS),f=Math.sin(r*e.DEGREES_TO_RADIANS);return i[0]=-a*f,i[1]=o,i[2]=-a*u,i.normalize()},c.prototype.northTangentAtPoint=function(e,n,r,i){if(!i)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","northTangentAtPoint","missingResult"));return this.computePositionFromPoint(e,n,r,this.scratchPosition),this.northTangentAtLocation(this.scratchPosition.latitude,this.scratchPosition.longitude,i)},c.prototype.intersectsFrustum=function(e){if(!e)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","intersectsFrustum","missingFrustum"));return e.far.distance<=this.equatorialRadius?!1:e.left.distance<=this.equatorialRadius?!1:e.right.distance<=this.equatorialRadius?!1:e.top.distance<=this.equatorialRadius?!1:e.bottom.distance<=this.equatorialRadius?!1:e.near.distance<=this.equatorialRadius?!1:!0},c.prototype.intersectsLine=function(e,n){if(!e)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","intersectWithRay","missingLine"));if(!n)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","intersectsLine","missingResult"));return l.computeEllipsoidalGlobeIntersection(e,this.equatorialRadius,this.polarRadius,n)},c.prototype.elevationTimestamp=function(){return this.elevationModel.timestamp},c.prototype.minElevation=function(){return this.elevationModel.minElevation},c.prototype.maxElevation=function(){return this.elevationModel.maxElevation},c.prototype.minAndMaxElevationsForSector=function(e){if(!e)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","minAndMaxElevationsForSector","missingSector"));return this.elevationModel.minAndMaxElevationsForSector(e)},c.prototype.elevationAtLocation=function(e,t){return this.elevationModel.elevationAtLocation(e,t)},c.prototype.elevationsForGrid=function(e,n,r,i,o){if(!e)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","elevationsForSector","missingSector"));if(n<=0||r<=0)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","elevationsForSector","numLat or numLon is less than 1"));if(!o||o.length<n*r)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","elevationsForSector","missingArray"));return this.elevationModel.elevationsForGrid(e,n,r,i,o)},c}),n("cache/GpuResourceCache",["../util/AbsentResourceList","../error/ArgumentError","../util/ImageSource","../util/Logger","../cache/MemoryCache","../render/Texture"],function(e,t,n,r,i,s){"use strict";var o=function(n,s){if(!n||n<1)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","constructor","Specified cache capacity is undefined, 0 or negative."));if(!s||s<0||s>=n)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","constructor","Specified cache low-water value is undefined, negative or not less than the capacity."));this.entries=new i(n,s),this.cacheKeyPool=0,this.currentRetrievals={},this.absentResourceList=new e(3,6e4)};return Object.defineProperties(o.prototype,{capacity:{get:function(){return this.entries.capacity}},lowWater:{get:function(){return this.entries.lowWater}},usedCapacity:{get:function(){return this.entries.usedCapacity}},freeCapacity:{get:function(){return this.entries.freeCapacity}}}),o.prototype.generateCacheKey=function(){return"GpuResourceCache "+ ++this.cacheKeyPool},o.prototype.putResource=function(e,i,s){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","putResource","missingKey."));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","putResource","missingResource."));if(!s||s<1)throw new t(r.logMessage(r.LEVEL_SEVERE,"GpuResourceCache","putResource","The specified resource size is undefined or less than 1."));var o={resource:i};this.entries.putEntry(e instanceof n?e.key:e,o,s)},o.prototype.resourceForKey=function(e){var t=e instanceof n?this.entries.entryForKey(e.key):this.entries.entryForKey(e);return t?t.resource:null},o.prototype.containsResource=function(e){return this.entries.containsKey(e instanceof n?e.key:e)},o.prototype.removeResource=function(e){this.entries.removeEntry(e instanceof n?e.key:e)},o.prototype.clear=function(){this.entries.clear(!1)},o.prototype.retrieveTexture=function(e,t){if(!t)return null;if(t instanceof n){var i=new s(e,t.image);return this.putResource(t.key,i,i.size),i}if(this.currentRetrievals[t]||this.absentResourceList.isResourceAbsent(t))return null;var o=this,u=new Image;return u.onload=function(){r.log(r.LEVEL_INFO,"Image retrieval succeeded: "+t);var n=new s(e,u);o.putResource(t,n,n.size),delete o.currentRetrievals[t],o.absentResourceList.unmarkResourceAbsent(t);var i=document.createEvent("Event");i.initEvent(WorldWind.REDRAW_EVENT_TYPE,!0,!0),window.dispatchEvent(i)},u.onerror=function(){delete o.currentRetrievals[t],o.absentResourceList.markResourceAbsent(t),r.log(r.LEVEL_WARNING,"Image retrieval failed: "+t)},this.currentRetrievals[t]=t,u.crossOrigin="anonymous",u.src=t,null},o}),n("pick/PickedObjectList",[],function(){"use strict";var e=function(){this.objects=[]};return e.prototype.hasNonTerrainObjects=function(){return this.objects.length>1||this.objects.length===1&&this.terrainObject()==null},e.prototype.terrainObject=function(){for(var e=0,t=this.objects.length;e<t;e++)if(this.objects[e].isTerrain)return this.objects[e];return null},e.prototype.add=function(e){e&&this.objects.push(e)},e.prototype.clear=function(){this.objects=[]},e.prototype.topPickedObject=function(){var e=this.objects.length;if(e>1)for(var t=0;t<e;t++)if(this.objects[[t].isOnTop])return this.objects[t];return e>0?this.objects[0]:null},e}),n("render/ScreenCreditController",["../error/ArgumentError","../shaders/BasicTextureProgram","../util/Color","../util/Font","../util/Logger","../geom/Matrix","../util/Offset","../pick/PickedObject","../render/Renderable","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";var c=function(){this.imageUrls=[],this.stringCredits=[],this.imageCreditSize=64,this.margin=5,this.opacity=.5,this.creditFont=new r(14)};return c.scratchMatrix=s.fromIdentity(),c.imageTransform=s.fromIdentity(),c.texCoordMatrix=s.fromIdentity(),c.prototype.clear=function(){this.imageUrls=[],this.stringCredits=[]},c.prototype.addImageCredit=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"ScreenCreditController","addImageCredit","missingUrl"));this.imageUrls.indexOf(t)===-1&&this.imageUrls.push(t)},c.prototype.addStringCredit=function(t,r){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"ScreenCreditController","addStringCredit","missingText"));if(!r)throw new e(i.logMessage(i.LEVEL_SEVERE,"ScreenCreditController","addStringCredit","missingColor"));this.stringCredits.indexOf(t)===-1&&this.stringCredits.push({text:t,color:r||n.WHITE})},c.prototype.drawCredits=function(e){if(this.imageUrls.length===0&&this.stringCredits.length===0)return;if(e.pickingMode)return;if(e.timestamp==this.lastFrameTimestamp)return;this.lastFrameTimestamp=e.timestamp,this.beginDrawingCredits(e);var t=e.navigatorState.viewport.width-(this.margin+this.imageCreditSize),n,r=0;for(var i=0;i<this.imageUrls.length;i++)n=this.drawImageCredit(e,this.imageUrls[i],t,this.margin),n>0&&(t-=this.margin+this.imageCreditSize,r=l.max(n,r));var s=r+this.margin;for(var o=0;o<this.stringCredits.length;o++)this.drawStringCredit(e,this.stringCredits[o],s),s+=this.margin+15;this.endDrawingCredits(e)},c.prototype.beginDrawingCredits=function(e){var n=e.currentGlContext,r;e.findAndBindProgram(t),r=e.currentProgram,n.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,e.unitQuadBuffer3()),n.vertexAttribPointer(r.vertexPointLocation,3,WebGLRenderingContext.FLOAT,!1,0,0),n.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,e.unitQuadBuffer()),n.vertexAttribPointer(r.vertexTexCoordLocation,2,WebGLRenderingContext.FLOAT,!1,0,0),n.enableVertexAttribArray(r.vertexPointLocation),n.enableVertexAttribArray(r.vertexTexCoordLocation),r.loadTextureUnit(n,WebGLRenderingContext.TEXTURE0),r.loadModulateColor(n,!1)},c.prototype.endDrawingCredits=function(e){var t=e.currentGlContext,n=e.currentProgram;t.disableVertexAttribArray(n.vertexPointLocation),t.disableVertexAttribArray(n.vertexTexCoordLocation),e.bindProgram(null),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,null),t.bindTexture(WebGLRenderingContext.TEXTURE_2D,null),t.enable(WebGLRenderingContext.DEPTH_TEST)},c.prototype.drawImageCredit=function(e,t,r,i){var s,o,u,a,f,l;return a=e.gpuResourceCache.resourceForKey(t),a?(s=a.imageWidth,o=a.imageHeight,s<=this.imageCreditSize&&this.imageHeight<=this.imageCreditSize?u=1:s>=o?u=this.imageCreditSize/s:u=this.imageCreditSize/o,c.imageTransform.setTranslation(r,i,0),c.imageTransform.setScale(u*s,u*o,1),f=e.currentGlContext,l=e.currentProgram,c.scratchMatrix.copy(e.screenProjection),c.scratchMatrix.multiplyMatrix(c.imageTransform),l.loadModelviewProjection(f,c.scratchMatrix),l.loadTextureEnabled(f,!0),l.loadColor(f,n.WHITE),l.loadOpacity(f,this.opacity),c.texCoordMatrix.setToIdentity(),c.texCoordMatrix.multiplyByTextureTransform(a),l.loadTextureMatrix(f,c.texCoordMatrix),a.bind(e)&&f.drawArrays(WebGLRenderingContext.TRIANGLE_STRIP,0,4),o):(e.gpuResourceCache.retrieveTexture(e.currentGlContext,t),0)},c.prototype.drawStringCredit=function(e,t,n){var r,i,s,o,u,a,f;return o=t.text+this.creditFont.toString(),s=e.gpuResourceCache.resourceForKey(o),s||(s=e.textSupport.createTexture(e,t.text,this.creditFont,!1),e.gpuResourceCache.putResource(o,s,s.size)),r=s.imageWidth,i=s.imageHeight,f=e.navigatorState.viewport.width-(r+this.margin),c.imageTransform.setTranslation(f,n,0),c.imageTransform.setScale(r,i,1),u=e.currentGlContext,a=e.currentProgram,c.scratchMatrix.copy(e.screenProjection),c.scratchMatrix.multiplyMatrix(c.imageTransform),a.loadModelviewProjection(u,c.scratchMatrix),a.loadTextureEnabled(u,!0),a.loadColor(u,t.color),a.loadOpacity(u,this.opacity),c.texCoordMatrix.setToIdentity(),c.texCoordMatrix.multiplyByTextureTransform(s),a.loadTextureMatrix(u,c.texCoordMatrix),s.bind(e)&&u.drawArrays(WebGLRenderingContext.TRIANGLE_STRIP,0,4),!0},c}),n("shapes/ShapeAttributes",["../util/Color","../util/ImageSource"],function(e,t){"use strict";var n=function(t){this._drawInterior=t?t._drawInterior:!0,this._drawOutline=t?t._drawOutline:!0,this._enableLighting=t?t._enableLighting:!1,this._interiorColor=t?t._interiorColor:e.WHITE,this._outlineColor=t?t._outlineColor:e.RED,this._outlineWidth=t?t._outlineWidth:1,this._outlineStippleFactor=t?t._outlineStippleFactor:0,this._outlineStipplePattern=t?t._outlineStipplePattern:61680,this._imageSource=t?t._imageSource:null,this._depthTest=t?t._depthTest:!0,this._drawVerticals=t?t._drawVerticals:!1,this._applyLighting=t?t._applyLighting:!1,this.stateKeyInvalid=!0};return n.prototype.computeStateKey=function(){return"di "+this._drawInterior+" do "+this._drawOutline+" el "+this._enableLighting+" ic "+this._interiorColor.toHexString(!0)+" oc "+this._outlineColor.toHexString(!0)+" ow "+this._outlineWidth+" osf "+this._outlineStippleFactor+" osp "+this._outlineStipplePattern+" is "+(this._imageSource?this.imageSource instanceof t?this.imageSource.key:this.imageSource:"null")+" dt "+this._depthTest+" dv "+this._drawVerticals+" li "+this._applyLighting},Object.defineProperties(n.prototype,{stateKey:{get:function(){return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey(),this.stateKeyInvalid=!1),this._stateKey}},drawInterior:{get:function(){return this._drawInterior},set:function(e){this._drawInterior=e,this.stateKeyInvalid=!0}},drawOutline:{get:function(){return this._drawOutline},set:function(e){this._drawOutline=e,this.stateKeyInvalid=!0}},enableLighting:{get:function(){return this._enableLighting},set:function(e){this._enableLighting=e,this.stateKeyInvalid=!0}},interiorColor:{get:function(){return this._interiorColor},set:function(e){this._interiorColor=e,this.stateKeyInvalid=!0}},outlineColor:{get:function(){return this._outlineColor},set:function(e){this._outlineColor=e,this.stateKeyInvalid=!0}},outlineWidth:{get:function(){return this._outlineWidth},set:function(e){this._outlineWidth=e,this.stateKeyInvalid=!0}},outlineStipplePattern:{get:function(){return this._outlineStipplePattern},set:function(e){this._outlineStipplePattern=e,this.stateKeyInvalid=!0}},outlineStippleFactor:{get:function(){return this._outlineStippleFactor},set:function(e){this._outlineStippleFactor=e,this.stateKeyInvalid=!0}},imageSource:{get:function(){return this._imageSource},set:function(e){this._imageSource=e,this.stateKeyInvalid=!0}},depthTest:{get:function(){return this._depthTest},set:function(e){this._depthTest=e,this.stateKeyInvalid=!0}},drawVerticals:{get:function(){return this._drawVerticals},set:function(e){this._drawVerticals=e,this.stateKeyInvalid=!0}},applyLighting:{get:function(){return this._applyLighting},set:function(e){this._applyLighting=e,this.stateKeyInvalid=!0}}}),n}),n("shapes/SurfaceShape",["../error/AbstractError","../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger","../error/NotYetImplementedError","../pick/PickedObject","../render/Renderable","../geom/Sector","../shapes/ShapeAttributes","../error/UnsupportedOperationError","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l,c){"use strict";var h=function(e){u.call(this),this._displayName="Surface Shape",this._attributes=e?e:new f(null),this._highlightAttributes=null,this._highlighted=!1,this._enabled=!0,this._pathType=WorldWind.GREAT_CIRCLE,this._maximumNumEdgeIntervals=h.DEFAULT_NUM_EDGE_INTERVALS,this._polarThrottle=h.DEFAULT_POLAR_THROTTLE,this._sector=null,this.pickDelegate=null,this._sectors=[],this._locations=null,this._boundaries=null,this._interiorGeometry=null,this._outlineGeometry=null,this._isInteriorInhibited=!1,this.stateKeyInvalid=!0,this._attributesStateKey=null,this.isPrepared=!1,this.layer=null,this.pickColor=null};return h.prototype=Object.create(u.prototype),Object.defineProperties(h.prototype,{stateKey:{get:function(){if(!this._attributesStateKey)this._highlighted?!this._highlightAttributes||(this._attributesStateKey=this._highlightAttributes.stateKey):!this._attributes||(this._attributesStateKey=this._attributes.stateKey),!this._attributesStateKey||(this.stateKeyInvalid=!0);else{var e=null;this._highlighted?!this._highlightAttributes||(e=this._highlightAttributes.stateKey):!this._attributes||(e=this._attributes.stateKey),e!=this._attributesStateKey&&(this._attributesStateKey=e,this.stateKeyInvalid=!0)}return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey()),this._stateKey}},displayName:{get:function(){return this._displayName},set:function(e){this.stateKeyInvalid=!0,this._displayName=e}},attributes:{get:function(){return this._attributes},set:function(e){this.stateKeyInvalid=!0,this._attributes=e,this._attributesStateKey=e.stateKey}},highlightAttributes:{get:function(){return this._highlightAttributes},set:function(e){this.stateKeyInvalid=!0,this._highlightAttributes=e}},highlighted:{get:function(){return this._highlighted},set:function(e){this.stateKeyInvalid=!0,this._highlighted=e}},enabled:{get:function(){return this._enabled},set:function(e){this.stateKeyInvalid=!0,this._enabled=e}},pathType:{get:function(){return this._pathType},set:function(e){this.stateKeyInvalid=!0,this._pathType=e}},maximumNumEdgeIntervals:{get:function(){return this._maximumNumEdgeIntervals},set:function(e){this.stateKeyInvalid=!0,this._maximumNumEdgeIntervals=e}},polarThrottle:{get:function(){return this._polarThrottle},set:function(e){this.stateKeyInvalid=!0,this._polarThrottle=e}},sector:{get:function(){return this._sector}}}),h.staticStateKey=function(e){return e.stateKeyInvalid=!1,e.highlighted?e._highlightAttributes?e._attributesStateKey=e._highlightAttributes.stateKey:e._attributes?e._attributesStateKey=e._attributes.stateKey:e._attributesStateKey=null:e._attributes?e._attributesStateKey=e._attributes.stateKey:e._attributesStateKey=null,"dn "+e.displayName+" at "+(e._attributesStateKey?e._attributesStateKey:"null")+" hi "+e.highlighted+" en "+e.enabled+" pt "+e.pathType+" ne "+e.maximumNumEdgeIntervals+" po "+e.polarThrottle+" se "+"["+e.sector.minLatitude+","+e.sector.maxLatitude+","+e.sector.minLongitude+","+e.sector.maxLongitude+"]"},h.prototype.computeStateKey=function(){return h.staticStateKey(this)},h.prototype.area=function(e,t){throw new s(i.logMessage(i.LEVEL_SEVERE,"SurfaceShape","area","notYetImplemented"))},h.prototype.computeBoundaries=function(t){throw new e(i.logMessage(i.LEVEL_SEVERE,"SurfaceShape","computeBoundaries","abstractInvocation"))},h.prototype.render=function(e){this.layer=e.currentLayer,this.prepareBoundaries(e),e.surfaceShapeTileBuilder.insertSurfaceShape(this)},h.prototype.interpolateLocations=function(e){var t=e[0],n=t,r,i=!0,s=!0,o=0,u=!0,a,f;this._locations=[t];for(a=1,f=e.length;a<f;a+=1){r=n,s=i,n=e[a],i=n.latitude==t.latitude&&n.longitude==t.longitude,u=!0;if(i||s)o+=1,o>2&&(u=!1);u&&this.interpolateEdge(r,n,this._locations),this._locations.push(n),r=n}!this._isInteriorInhibited&&(r.latitude!=t.latitude||r.longitude!=t.longitude)&&(this.interpolateEdge(r,t,this._locations),this._locations.push(t))},h.prototype.interpolateEdge=function(e,t,n){var i=r.greatCircleDistance(e,t),s=Math.round(this._maximumNumEdgeIntervals*i/Math.PI),o,u;if(s>0){o=1/s,u=e;for(var a=this.throttledStep(o,u);a<1;a+=this.throttledStep(o,u))u=new r(0,0),r.interpolateAlongPath(this._pathType,a,e,t,u),n.push(u)}},h.prototype.throttledStep=function(e,n){var r=Math.cos(n.latitude*t.DEGREES_TO_RADIANS);r*=r;var i=this._polarThrottle/(1+this._polarThrottle);return e*(1-i+i*r)},h.prototype.prepareBoundaries=function(e){if(this.isPrepared)return;this._boundaries||this.computeBoundaries(e),this._locations||this.interpolateLocations(this._boundaries),this.prepareGeometry(e),this.prepareSectors(),this.isPrepared=!0},h.prototype.computeSectors=function(e){return this._sectors&&this._sectors.length>0?this._sectors:(this.prepareBoundaries(e),this._sectors)},h.prototype.prepareSectors=function(){var e=this._boundaries;if(!e)return;this._sector=new a(-90,90,-180,180),this._sector.setToBoundingSector(e);var t=this.containsPole(e);t!=r.poles.NONE?(t==r.poles.NORTH?this._sector=new a(this._sector.minLatitude,90,-180,180):this._sector=new a(-90,this._sector.maxLatitude,-180,180),this._sectors=[this._sector]):r.locationsCrossDateLine(e)?this._sectors=a.splitBoundingSectors(e):this._sector.isEmpty()||(this._sectors=[this._sector]);if(!this._sectors)return;if(this._pathType===WorldWind.GREAT_CIRCLE)for(var n=0,i=this._sectors.length;n<i;n+=1){var s=this._sectors[n],o=r.greatCircleArcExtremeLocations(e),u=Math.min(s.minLatitude,o[0].latitude),f=Math.max(s.maxLatitude,o[1].latitude);this._sectors[n]=new a(u,f,s.minLongitude,s.maxLongitude)}},h.prototype.prepareGeometry=function(e){var t;this._interiorGeometry=[],this._outlineGeometry=[];var n=this._locations,i=this.containsPole(n);if(i!=r.poles.NONE){var s=this.cutAlongDateLine(n,i,e.globe);this._interiorGeometry.push(s),t=this.repeatAroundDateline(n),this._outlineGeometry.push(t[0]),t.length>1&&this._outlineGeometry.push(t[1])}else r.locationsCrossDateLine(n)?(t=this.repeatAroundDateline(n),this._interiorGeometry.push(t[0]),this._interiorGeometry.push(t[1]),this._outlineGeometry.push(t[0]),this._outlineGeometry.push(t[1])):(this._interiorGeometry.push(n),this._outlineGeometry.push(n))},h.prototype.containsPole=function(e){var t=!1,n=90,i=-90,s=e[0];for(var o=1,u=e.length;o<u;o+=1){var a=e[o];r.locationsCrossDateLine([s,a])&&(t=!t),n=Math.min(n,a.latitude),i=Math.max(i,a.latitude),s=a}var f=e[0];return r.locationsCrossDateLine([f,s])&&(t=!t),t?n>0?r.poles.NORTH:i<0?r.poles.SOUTH:Math.abs(i)>=Math.abs(n)?r.poles.NORTH:r.poles.SOUTH:r.poles.NONE},h.prototype.cutAlongDateLine=function(e,t,n){if(t==r.poles.NONE)return e;var i=[],s=t==r.poles.NORTH?90:-90,o=e[e.length-1];for(var u=0,a=e.length;u<a;u+=1){var f=e[u];i.push(o);if(r.locationsCrossDateLine([o,f])){var l=r.intersectionWithMeridian(o,f,180,n),h=c.signum(o.longitude),p=l,d=180*h,v=-d;i.push(new r(p,d)),i.push(new r(s,d)),i.push(new r(s,v)),i.push(new r(p,v))}o=f}return i.push(o),i},h.prototype.repeatAroundDateline=function(e){var t=0,n=!1,i=[],s=e[0];i.push(s);for(var o=1,u=e.length;o<u;o+=1){var a=e[o];r.locationsCrossDateLine([s,a])&&(t==0&&(t=s.longitude<0?-360:360),n=!n),n?i.push(new r(a.latitude,a.longitude+t)):i.push(a),s=a}var f=[i];if(t!=0){var l=i;i=[];for(o=0,u=l.length;o<u;o+=1){var c=l[o];i.push(new r(c.latitude,c.longitude-t))}f.push(i)}return f},h.prototype.resetPickColor=function(){this.pickColor=null},h.prototype.renderToTexture=function(e,t,n,r,i,s){var u,a,f=[],l,c,h=e.pickingMode,p=this._highlighted?this._highlightAttributes||this._attributes:this._attributes;h&&!this.pickColor&&(this.pickColor=e.uniquePickColor());if(!this._isInteriorInhibited&&p.drawInterior){t.fillStyle=h?this.pickColor.toHexString(!1):p.interiorColor.toHexString(!1);for(u=0,a=this._interiorGeometry.length;u<a;u+=1){l=0,c=this._outlineGeometry[u].length*2,f.splice(0,f.length);if(this.transformPath(this._interiorGeometry[u],n,r,i,s,f)){t.beginPath(),t.moveTo(f[l++],f[l++]);while(l<c)t.lineTo(f[l++],f[l++]);t.closePath(),t.fill()}}}if(p.drawOutline&&p.outlineWidth>0){t.lineWidth=4*p.outlineWidth,t.strokeStyle=h?this.pickColor.toHexString(!1):p.outlineColor.toHexString(!1);var d=this._attributes.outlineStipplePattern,v=this._attributes.outlineStippleFactor;for(u=0,a=this._outlineGeometry.length;u<a;u+=1){f.splice(0,f.length);if(this.transformPath(this._outlineGeometry[u],n,r,i,s,f)){var m=f[0],g=f[1],y=m,b=g,w=m,E=g,S=!0,x=!0,T=0;for(l=2,c=f.length;l<c;){y=w,b=E,S=x,w=f[l++],E=f[l++],x=w==m&&E==g;if(S||x){T+=1;if(T>2)continue}t.beginPath(),t.moveTo(y,b),t.lineTo(w,E),t.stroke()}}}}if(h){var N=new o(this.pickColor.clone(),this._pickDelegate?this._pickDelegate:this,null,this.layer,!1);e.resolvePick(N)}},h.prototype.transformPath=function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E=4,S,x,T,N,C;T=0,x=e[0],l=x.longitude*t+r,c=x.latitude*n+i,S=!0,d=m=o=a=l,v=g=u=f=c,s[T++]=a,s[T++]=f;for(N=1,C=e.length;N<C;N+=1){x=e[N],h=a,p=f,a=x.longitude*t+r,f=x.latitude*n+i,S=a==l&&f==c,y=a-o,b=f-u,w=y*y+b*b;if(S||w>=E){d=Math.min(d,a),m=Math.max(m,a),v=Math.min(v,f),g=Math.max(g,f);if(s[T-2]!=h||s[T-1]!=p)s[T++]=h,s[T++]=p;s[T++]=a,s[T++]=f,o=a,u=f}}return m-d>=2||g-v>=2},h.DEFAULT_NUM_EDGE_INTERVALS=128,h.DEFAULT_POLAR_THROTTLE=10,h}),n("shapes/SurfaceShapeTile",["../geom/Angle","../error/ArgumentError","../util/Level","../util/Logger","../geom/Sector","../render/Texture","../render/TextureTile"],function(e,t,n,r,i,s,o){"use strict";var u=function(e,t,n,r){o.call(this,e,t,n,r),this.surfaceShapes=[],this.sector=e,this.cacheKey=null,this.pickSequence=0,this.surfaceShapeStateKeys=[],this.prevSurfaceShapes=[],this.createCtx2D()};return u.prototype=Object.create(o.prototype),u.prototype.clearShapes=function(){var e=this.prevSurfaceShapes;this.prevSurfaceShapes=this.surfaceShapes,this.surfaceShapes=e,this.surfaceShapes.splice(0,this.surfaceShapes.length)},u.prototype.hasShapes=function(){return this.surfaceShapes.length>0},u.prototype.getShapes=function(){return this.surfaceShapes},u.prototype.setShapes=function(e){this.surfaceShapes=e},u.prototype.getSector=function(){return this.sector},u.prototype.addSurfaceShape=function(e){this.surfaceShapes.push(e),this.surfaceShapeStateKeys.push(e.stateKey)},u.prototype.addAllSurfaceShapes=function(e){for(var t=0,n=e.length;t<n;t+=1){var r=e[t];this.addAllSurfaceShapes(r)}},u.prototype.needsUpdate=function(e){var t,n,r,i;if(this.prevSurfaceShapes.length!=this.surfaceShapes.length)return!0;for(t=0,n=this.prevSurfaceShapes;t<n;t+=1){r=this.prevSurfaceShapes[t];if(this.surfaceShapes.indexOf(r)<0)return!0}for(t=0,n=this.surfaceShapes;t<n;t+=1){r=this.surfaceShapes[t];if(this.prevSurfaceShapes.indexOf(r)<0)return!0}for(t=0,n=this.surfaceShapes.length;t<n;t+=1){r=this.surfaceShapes[t],i=this.surfaceShapeStateKeys[t];if(i!=r.stateKey)return!0}return this.hasTexture(e)?!1:!0},u.prototype.hasTexture=function(e){if(e.pickingMode)return!1;var t=e.gpuResourceCache;this.gpuCacheKey||(this.gpuCacheKey=this.getCacheKey());var n=t.resourceForKey(this.gpuCacheKey);return!!n},u.prototype.updateTexture=function(e){var t=e.currentGlContext,n=u.canvas;n.width=this.tileWidth,n.height=this.tileHeight;var r=u.ctx2D,i=this.tileWidth/this.sector.deltaLongitude(),o=-this.tileHeight/this.sector.deltaLatitude(),a=-this.sector.minLongitude*i,f=-this.sector.maxLatitude*o;for(var l=0,c=this.surfaceShapes.length;l<c;l+=1){var h=this.surfaceShapes[l];this.surfaceShapeStateKeys[l]=h.stateKey,h.renderToTexture(e,r,i,o,a,f)}var p=new s(t,n),d=e.gpuResourceCache;return this.gpuCacheKey=this.getCacheKey(),d.putResource(this.gpuCacheKey,p,p.size),p},u.prototype.getCacheKey=function(){return this.cacheKey||(this.cacheKey="SurfaceShapeTile:"+this.tileKey+","+this.pickSequence.toString()),this.cacheKey},u.prototype.createCtx2D=function(){u.ctx2D||(u.canvas=document.createElement("canvas"),u.ctx2D=u.canvas.getContext("2d"))},u.canvas=null,u.ctx2D=null,u}),n("shapes/SurfaceShapeTileBuilder",["../error/ArgumentError","../render/DrawContext","../globe/Globe","../shaders/GpuProgram","../util/Level","../util/LevelSet","../geom/Location","../util/Logger","../geom/Matrix","../cache/MemoryCache","../navigate/NavigatorState","../error/NotYetImplementedError","../pick/PickedObject","../geom/Rectangle","../geom/Sector","../shapes/SurfaceShape","../shapes/SurfaceShapeTile","../globe/Terrain","../globe/TerrainTile","../globe/TerrainTileList","../render/TextureTile","../util/Tile"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E){"use strict";var S=function(){this.numRowsTilesInTopLevel=4,this.numColumnsTilesInTopLevel=8,this.maximumSubdivisionDepth=15,this.tileWidth=256,this.tileHeight=256,this.levels=new s(d.FULL_SPHERE,new o(180/this.numRowsTilesInTopLevel,360/this.numColumnsTilesInTopLevel),this.maximumSubdivisionDepth,this.tileWidth,this.tileHeight),this.surfaceShapes=[],this.surfaceShapeTiles=[],this.topLevelTiles=[],this.sector=new d(-90,90,-180,180),this.SPLIT_SCALE=2.9,this.tileCache=new f(5e5,4e5)};return S.prototype.clear=function(){this.surfaceShapeTiles.splice(0,this.surfaceShapeTiles.length),this.surfaceShapes.splice(0,this.surfaceShapes.length)},S.prototype.insertSurfaceShape=function(e){this.surfaceShapes.push(e)},S.prototype.doRender=function(e){if(e.pickingMode){for(var t=0,n=this.surfaceShapes.length;t<n;t+=1)this.surfaceShapes[t].resetPickColor();S.pickSequence+=1;var r=this.surfaceShapeTiles,i=this.topLevelTiles;this.surfaceShapeTiles=[],this.topLevelTiles=[],this.buildTiles(e),e.deepPicking?this.doDeepPickingRender(e):e.surfaceTileRenderer.renderTiles(e,this.surfaceShapeTiles,1),this.surfaceShapeTiles=r,this.topLevelTiles=i}else this.buildTiles(e),e.surfaceTileRenderer.renderTiles(e,this.surfaceShapeTiles,1)},S.prototype.doDeepPickingRender=function(e){var t,n,r,i,s,o,u,a,f,l=[];for(s=0,o=e.objectsAtPickPoint.objects.length;s<o;s+=1)u=e.objectsAtPickPoint.objects[s],u.userObject instanceof v&&(a=u.userObject,l.indexOf(a)<0&&(l.push(a),e.objectsAtPickPoint.objects.splice(s,1),s-=1,o-=1));if(l.length<=0)return;var c=[];for(r=0,i=l.length;r<i;r+=1){a=l[r];for(t=0,n=this.surfaceShapeTiles.length;t<n;t+=1)f=this.surfaceShapeTiles[t],f.setShapes([a]),f.updateTexture(e);e.surfaceTileRenderer.renderTiles(e,this.surfaceShapeTiles,1);var p=e.readPickColor(e.pickPoint);!!p&&a.pickColor.equals(p)&&(u=new h(a.pickColor.clone(),a._pickDelegate?a._pickDelegate:a,null,a.layer,!1),c.push(u))}for(s=0,o=e.objectsAtPickPoint.objects.length;s<o;s+=1)u=e.objectsAtPickPoint.objects[s],u.userObject instanceof v&&(e.objectsAtPickPoint.objects.splice(s,1),s-=1,o-=1);for(s=0,o=c.length;s<o;s+=1)u=c[s],e.objectsAtPickPoint.objects.push(u)},S.prototype.buildTiles=function(t){if(!t)throw new e(u.logMessage(u.LEVEL_SEVERE,"SurfaceShapeTileBuilder","buildTiles","missingDc"));if(!this.surfaceShapes||this.surfaceShapes.length<1)return;this.assembleTiles(t),this.surfaceShapes.splice(0,this.surfaceShapes.length);for(var n=0,r=this.surfaceShapeTiles.length;n<r;n+=1){var i=this.surfaceShapeTiles[n];i.clearShapes()}},S.prototype.assembleTiles=function(e){var t,n,r,i,s,o,u;this.topLevelTiles.length<1&&this.createTopLevelTiles();var a={};for(n=0,r=this.surfaceShapes.length;n<r;n+=1){var f=this.surfaceShapes[n],l=f.computeSectors(e);if(!l)continue;for(o=0,u=l.length;o<u;o+=1){var c=l[o];for(i=0,s=this.topLevelTiles.length;i<s;i+=1){t=this.topLevelTiles[i];if(t.sector.intersects(c)){var h=t.tileKey;a[h]=t,t.addSurfaceShape(f)}}}}for(var p in a)a.hasOwnProperty(p)&&(t=a[p],this.addTileOrDescendants(e,this.levels,null,t))},S.prototype.addTileOrDescendants=function(e,t,n,r){if(!this.intersectsFrustum(e,r)){r.clearShapes();return}n!=null&&this.addIntersectingShapes(e,n,r);if(!r.hasShapes())return;if(this.meetsRenderCriteria(e,t,r)){this.addTile(e,r);return}var i=t.level(r.level.levelNumber+1),s=e.pickingMode?r.subdivide(i,this):r.subdivideToCache(i,this,this.tileCache);for(var o=0,u=s.length;o<u;o+=1){var a=s[o];this.addTileOrDescendants(e,t,r,a)}r.clearShapes()},S.prototype.addIntersectingShapes=function(e,t,n){if(!t.hasShapes())return;if(!n.sector.intersects(t.sector))return;if(n.getSector().contains(t.sector))n.addAllSurfaceShapes(t.getShapes());else{var r=t.getShapes();for(var i=0,s=r.length;i<s;i+=1){var o=r[i],u=o.computeSectors(e);if(!u)continue;for(var a=0,f=u.length;a<f;a+=1){var l=u[a];if(n.getSector().intersects(l)){n.addSurfaceShape(o);break}}}}},S.prototype.addTile=function(e,t){e.pickingMode&&(t.pickSequence=S.pickSequence),t.needsUpdate(e)&&t.updateTexture(e),this.surfaceShapeTiles.push(t)},S.prototype.createTile=function(e,t,n,r){return new m(e,t,n,r)},S.prototype.createTopLevelTiles=function(){E.createTilesForLevel(this.levels.firstLevel(),this,this.topLevelTiles)},S.prototype.intersectsFrustum=function(e,t){return e.globe.projectionLimits&&!t.sector.overlaps(e.globe.projectionLimits)?!1:(t.update(e),t.extent.intersectsFrustum(e.pickingMode?e.pickFrustum:e.navigatorState.frustumInModelCoordinates))},S.prototype.meetsRenderCriteria=function(e,t,n){return n.level.levelNumber==t.lastLevel().levelNumber||!n.mustSubdivide(e,this.SPLIT_SCALE)},S.pickSequence=0,S}),n("shaders/SurfaceTileRendererProgram",["../error/ArgumentError","../util/Color","../shaders/GpuProgram","../util/Logger"],function(e,t,n,r){"use strict";var i=function(e){var t="attribute vec4 vertexPoint;\nattribute vec4 vertexTexCoord;\nuniform mat4 mvpMatrix;\nuniform mat4 texSamplerMatrix;\nuniform mat4 texMaskMatrix;\nvarying vec2 texSamplerCoord;\nvarying vec2 texMaskCoord;\nvoid main() {\ngl_Position = mvpMatrix * vertexPoint;\ntexSamplerCoord = (texSamplerMatrix * vertexTexCoord).st;\ntexMaskCoord = (texMaskMatrix * vertexTexCoord).st;\n}",r="precision mediump float;\nuniform sampler2D texSampler;\nuniform float opacity;\nuniform vec4 color;\nuniform bool modulateColor;\nvarying vec2 texSamplerCoord;\nvarying vec2 texMaskCoord;\nbool isOutsideTextureImage(const vec2 coord) {\n    return coord.x < 0.0 || coord.x > 1.0 || coord.y < 0.0 || coord.y > 1.0;\n}\nvoid main(void) {\nif (isOutsideTextureImage(texMaskCoord)) {\n    discard;\n} else if (modulateColor) {\n    gl_FragColor = color * floor(texture2D(texSampler, texSamplerCoord).a + 0.5);\n} else {\n    gl_FragColor = texture2D(texSampler, texSamplerCoord) * opacity;\n}\n}";n.call(this,e,t,r),this.vertexPointLocation=this.attributeLocation(e,"vertexPoint"),this.vertexTexCoordLocation=this.attributeLocation(e,"vertexTexCoord"),this.mvpMatrixLocation=this.uniformLocation(e,"mvpMatrix"),this.colorLocation=this.uniformLocation(e,"color"),this.modulateColorLocation=this.uniformLocation(e,"modulateColor"),this.texSamplerMatrixLocation=this.uniformLocation(e,"texSamplerMatrix"),this.texMaskMatrixLocation=this.uniformLocation(e,"texMaskMatrix"),this.texSamplerLocation=this.uniformLocation(e,"texSampler"),this.opacityLocation=this.uniformLocation(e,"opacity"),this.vertexPointLocation=-1};return i.key="WorldWindGpuSurfaceTileRenderingProgram",i.prototype=Object.create(n.prototype),i.prototype.loadModelviewProjection=function(t,i){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"SurfaceTileRendererProgram","loadModelviewProjection","missingMatrix"));n.loadUniformMatrix(t,i,this.mvpMatrixLocation)},i.prototype.loadTexSamplerMatrix=function(t,i){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"SurfaceTileRendererProgram","loadTexSamplerMatrix","missingMatrix"));n.loadUniformMatrix(t,i,this.texSamplerMatrixLocation)},i.prototype.loadTexMaskMatrix=function(t,i){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"SurfaceTileRendererProgram","loadTexMaskMatrix","missingMatrix"));n.loadUniformMatrix(t,i,this.texMaskMatrixLocation)},i.prototype.loadTexSampler=function(e,t){e.uniform1i(this.texSamplerLocation,t-WebGLRenderingContext.TEXTURE0)},i.prototype.loadOpacity=function(e,t){e.uniform1f(this.opacityLocation,t)},i.prototype.loadColor=function(t,i){if(!i)throw new e(r.logMessage(r.LEVEL_SEVERE,"SurfaceTileRendererProgram","loadColor","missingColor"));n.loadUniformColor(t,i,this.colorLocation)},i.prototype.loadModulateColor=function(e,t){n.loadUniformInteger(e,t?1:0,this.modulateColorLocation)},i}),n("render/SurfaceTileRenderer",["../error/ArgumentError","../util/Logger","../geom/Matrix","../shapes/SurfaceShapeTile","../shaders/SurfaceTileRendererProgram"],function(e,t,n,r,i){"use strict";var s=function(){this.texMaskMatrix=n.fromIdentity(),this.texSamplerMatrix=n.fromIdentity(),this.isSurfaceShapeTileRendering=!1};return s.prototype.renderTiles=function(n,i,s){if(!i)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfaceTileRenderer","renderTiles","Specified surface tiles array is null or undefined."));if(i.length<1)return;var o=n.terrain,u=n.currentGlContext,a=0,f,l,c,h;if(!o)return;this.isSurfaceShapeTileRendering=i[0]instanceof r,s*=n.surfaceOpacity,f=this.beginRendering(n,s),o.beginRendering(n);try{for(var p=0,d=o.surfaceGeometry.length;p<d;p++){l=o.surfaceGeometry[p],c=l.sector,o.beginRenderingTile(n,l);try{for(var v=0,m=i.length;v<m;v++)h=i[v],h.sector.overlaps(c)&&h.bind(n)&&(n.pickingMode&&h.pickColor&&f.loadColor(u,h.pickColor),this.applyTileState(n,l,h),o.renderTile(n,l),++a)}catch(g){console.log(g)}finally{o.endRenderingTile(n,l)}}}catch(g){console.log(g)}finally{o.endRendering(n),this.endRendering(n),n.frameStatistics.incrementRenderedTileCount(a)}},s.prototype.beginRendering=function(e,t){var n=e.currentGlContext,r=e.findAndBindProgram(i);return r.loadTexSampler(n,WebGLRenderingContext.TEXTURE0),e.pickingMode&&!this.isSurfaceShapeTileRendering?r.loadModulateColor(n,!0):(r.loadModulateColor(n,!1),r.loadOpacity(n,t)),r},s.prototype.endRendering=function(e){var t=e.currentGlContext;t.bindTexture(WebGLRenderingContext.TEXTURE_2D,null),e.bindProgram(null)},s.prototype.applyTileState=function(e,t,n){var r=e.currentGlContext,i=e.currentProgram,s=t.sector,o=s.deltaLatitude(),u=s.deltaLongitude(),a=n.sector,f=a.deltaLatitude(),l=a.deltaLongitude(),c=f>0?f:1,h=l>0?l:1,p=u/h,d=o/c,v=-(a.minLongitude-s.minLongitude)/h,m=-(a.minLatitude-s.minLatitude)/c;this.texMaskMatrix.set(p,0,0,v,0,d,0,m,0,0,1,0,0,0,0,1),this.texSamplerMatrix.setToUnitYFlip(),n.applyInternalTransform(e,this.texSamplerMatrix),this.texSamplerMatrix.multiplyMatrix(this.texMaskMatrix),i.loadTexSamplerMatrix(r,this.texSamplerMatrix),i.loadTexMaskMatrix(r,this.texMaskMatrix)},s}),n("render/TextSupport",["../error/ArgumentError","../shaders/BasicTextureProgram","../util/Color","../util/Logger","../geom/Matrix","../render/Texture","../geom/Vec2"],function(e,t,n,r,i,s,o){"use strict";var u=function(){this.canvas2D=document.createElement("canvas"),this.ctx2D=this.canvas2D.getContext("2d"),this.lineSpacing=.15,this.strokeStyle="rgba(0, 0, 0, 0.5)",this.strokeWidth=4};return u.prototype.textSize=function(e,t,n){if(e.length===0)return new o(0,0);this.ctx2D.font=t.fontString;var r=e.split("\n"),i=r.length*t.size*(1+this.lineSpacing),s=0;for(var u=0;u<r.length;u++)s=Math.max(s,this.ctx2D.measureText(r[u]).width);return n&&(s+=this.strokeWidth,i+=this.strokeWidth),new o(s,i)},u.prototype.createTexture=function(e,t,r,i){var o=e.currentGlContext,u=this.ctx2D,a=this.canvas2D,f=this.textSize(t,r,i),l=t.split("\n"),c=i?this.strokeWidth/2:0,h=e.pixelScale,p,d;a.width=Math.ceil(f[0])*h,a.height=Math.ceil(f[1])*h,u.scale(h,h),u.font=r.fontString,u.textBaseline="top",u.textAlign=r.horizontalAlignment,u.fillStyle=n.WHITE.toHexString(!1),u.strokeStyle=this.strokeStyle,u.lineWidth=this.strokeWidth,u.lineCap="round",u.lineJoin="round",r.horizontalAlignment==="left"?u.translate(c,0):r.horizontalAlignment==="right"?u.translate(f[0]-c,0):u.translate(f[0]/2,0);for(var v=0;v<l.length;v++)i&&u.strokeText(l[v],0,0),u.fillText(l[v],0,0),u.translate(0,r.size*(1+this.lineSpacing)+c);return new s(o,a)},u}),n("render/DrawContext",["../error/ArgumentError","../util/Color","../util/FrameStatistics","../render/FramebufferTexture","../render/FramebufferTileController","../geom/Frustum","../globe/Globe","../shaders/GpuProgram","../cache/GpuResourceCache","../layer/Layer","../util/Logger","../geom/Matrix","../navigate/NavigatorState","../pick/PickedObjectList","../geom/Plane","../geom/Position","../geom/Rectangle","../render/ScreenCreditController","../geom/Sector","../shapes/SurfaceShape","../shapes/SurfaceShapeTileBuilder","../render/SurfaceTileRenderer","../render/TextSupport","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N){"use strict";var C=function(n){if(!n)throw new e(l.logMessage(l.LEVEL_SEVERE,"Texture","constructor","missingGlContext"));this.currentGlContext=n,this.canvas2D=document.createElement("canvas"),this.ctx2D=this.canvas2D.getContext("2d"),this.clearColor=t.TRANSPARENT,this.gpuResourceCache=new a(WorldWind.configuration.gpuCacheSize,.8*WorldWind.configuration.gpuCacheSize),this.surfaceTileRenderer=new E,this.surfaceShapeTileBuilder=new w,this.surfaceShapeTileController=new i,this.screenCreditController=new g,this.textSupport=new S,this.currentFramebuffer=null,this.currentProgram=null,this.orderedRenderingMode=!1,this.orderedRenderables=[],this.orderedRenderablesCounter=0,this.timestamp=Date.now(),this.previousRedrawTimestamp=this.timestamp,this.redrawRequested=!1,this.globe=null,this.globeStateKey=null,this.layers=null,this.currentLayer=null,this.navigatorState=null,this.eyePosition=new v(0,0,0),this.screenProjection=c.fromIdentity(),this.terrain=null,this.verticalExaggeration=1,this.fadeTime=500,this.surfaceOpacity=1,this.frameStatistics=null,this.pickingMode=!1,this.pickTerrainOnly=!1,this.deepPicking=!1,this.regionPicking=!1,this.pickPoint=null,this.pickRectangle=null,this.pickFramebuffer=null,this.pickFrustum=null,this.pickColor=new t(0,0,0,1),this.objectsAtPickPoint=new p,this.pixelScale=1};return C.unitCubeKey="DrawContextUnitCubeKey",C.unitCubeElementsKey="DrawContextUnitCubeElementsKey",C.unitQuadKey="DrawContextUnitQuadKey",C.unitQuadKey3="DrawContextUnitQuadKey3",C.prototype.reset=function(){this.screenCreditController.clear(),this.orderedRenderingMode=!1,this.orderedRenderables=[],this.orderedRenderablesCounter=0;var e=this.timestamp;this.timestamp=Date.now(),this.timestamp===e&&++this.timestamp,this.redrawRequested=!1,this.globe=null,this.globeStateKey=null,this.layers=null,this.currentLayer=null,this.navigatorState=null,this.terrain=null,this.verticalExaggeration=1,this.frameStatistics=null,this.accumulateOrderedRenderables=!0,this.pickingMode=!1,this.pickTerrainOnly=!1,this.deepPicking=!1,this.regionPicking=!1,this.pickPoint=null,this.pickRectangle=null,this.pickFrustum=null,this.pickColor=new t(0,0,0,1),this.objectsAtPickPoint.clear()},C.prototype.update=function(){var e=this.currentGlContext,t=this.navigatorState.eyePoint;this.globeStateKey=this.globe.stateKey,this.globe.computePositionFromPoint(t[0],t[1],t[2],this.eyePosition),this.screenProjection.setToScreenProjection(e.drawingBufferWidth,e.drawingBufferHeight)},C.prototype.contextLost=function(){this.gpuResourceCache.clear(),this.pickFramebuffer=null,this.currentFramebuffer=null,this.currentProgram=null},C.prototype.contextRestored=function(){this.gpuResourceCache.clear()},C.prototype.bindFramebuffer=function(e){var t=this.currentGlContext;e?e.bindFramebuffer(this):t.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this.currentFramebuffer=e},C.prototype.bindProgram=function(e){var t=this.currentGlContext;e?e.bind(t):t.useProgram(null),this.currentProgram=e},C.prototype.findAndBindProgram=function(t){if(!t)throw new e(l.logMessage(l.LEVEL_SEVERE,"DrawContext","findAndBindProgram","The specified program constructor is null or undefined."));var n=this.currentGlContext,r=this.gpuResourceCache.resourceForKey(t.key);if(r)this.bindProgram(r);else try{r=new t(n),this.bindProgram(r),this.gpuResourceCache.putResource(t.key,r,r.size)}catch(i){l.log(l.LEVEL_SEVERE,"Error attempting to create GPU program.")}return r},C.prototype.addOrderedRenderable=function(e){if(e){var t={orderedRenderable:e,insertionOrder:this.orderedRenderablesCounter++,eyeDistance:e.eyeDistance,globeStateKey:this.globeStateKey};this.globe.continuous&&(t.globeOffset=this.globe.offset),this.orderedRenderables.push(t)}},C.prototype.addOrderedRenderableToBack=function(e){if(e){var t={orderedRenderable:e,insertionOrder:this.orderedRenderablesCounter++,eyeDistance:Number.MAX_VALUE,globeStateKey:this.globeStateKey};this.globe.continuous&&(t.globeOffset=this.globe.offset),this.orderedRenderables.push(t)}},C.prototype.peekOrderedRenderable=function(){return this.orderedRenderables.length>0?this.orderedRenderables[this.orderedRenderables.length-1].orderedRenderable:null},C.prototype.popOrderedRenderable=function(){if(this.orderedRenderables.length>0){var e=this.orderedRenderables.pop();return this.globeStateKey=e.globeStateKey,this.globe.continuous&&(this.globe.offset=e.globeOffset),e.orderedRenderable}return null},C.prototype.sortOrderedRenderables=function(){this.orderedRenderables.sort(function(e,t){var n=e.eyeDistance,r=t.eyeDistance;if(n<r)return-1;if(n>r)return 1;var i=e.insertionOrder,s=t.insertionOrder;return i>s?-1:i<s?1:0})},C.prototype.readPickColor=function(e){var n=this.navigatorState.convertPointToViewport(e,new x(0,0)),r=new Uint8Array(4);return this.currentGlContext.readPixels(n[0],n[1],1,1,WebGLRenderingContext.RGBA,WebGLRenderingContext.UNSIGNED_BYTE,r),this.clearColor.equalsBytes(r)?null:t.colorFromByteArray(r)},C.prototype.readPickColors=function(e){var n=this.currentGlContext,r=new Uint8Array(e.width*e.height*4),i={},s,o=new t(0,0,0,0),u=n.getParameter(WebGLRenderingContext.PACK_ALIGNMENT);n.pixelStorei(WebGLRenderingContext.PACK_ALIGNMENT,1),this.currentGlContext.readPixels(e.x,e.y,e.width,e.height,WebGLRenderingContext.RGBA,WebGLRenderingContext.UNSIGNED_BYTE,r),n.pixelStorei(WebGLRenderingContext.PACK_ALIGNMENT,u);for(var a=0,f=e.width*e.height;a<f;a++){var l=a*4;s=t.colorFromBytes(r[l],r[l+1],r[l+2],r[l+3]);if(s.equals(this.clearColor)||s.equals(o))continue;i[s.toByteString()]=s}return i},C.prototype.resolvePick=function(e){if(e.userObject instanceof b||!this.deepPicking||!!this.regionPicking)this.addPickedObject(e);else{var t=this.readPickColor(this.pickPoint);if(!t)return null;e.color.equals(t)&&this.addPickedObject(e)}},C.prototype.addPickedObject=function(e){e&&this.objectsAtPickPoint.add(e)},C.prototype.uniquePickColor=function(){var e=this.pickColor.nextColor().clone();return e.equals(this.clearColor)?e.nextColor():e},C.prototype.makePickFramebuffer=function(){var e=this.currentGlContext,t=e.drawingBufferWidth,n=e.drawingBufferHeight;if(!this.pickFramebuffer||this.pickFramebuffer.width!=t||this.pickFramebuffer.height!=n)this.pickFramebuffer=new r(e,t,n,!0);return this.pickFramebuffer},C.prototype.makePickFrustum=function(){if(!this.pickPoint&&!this.pickRectangle)return!1;var e,t,n,r,i,o,u,a,f,l,c,h,p,v,g,y,b,w,E,S,C,k=new T(0,0,0),L=2,A=new T(0,0,0),O,M=this.pickRectangle,_=this.navigatorState.viewport;M||(O=this.navigatorState.convertPointToViewport(this.pickPoint,new x(0,0)),M=new m(O[0]-L,O[1]-L,2*L,2*L));var D=M.x,P=M.x+M.width,H=M.y,B=M.y+M.height;return P<0||B<0||D>_.x+_.width||H>_.y+_.height?!1:(M.x=N.clamp(D,_.x,_.x+_.width),M.y=N.clamp(H,_.y,_.y+_.height),M.width=N.clamp(P,_.x,_.x+_.width)-M.x,M.height=N.clamp(B,_.y,_.y+_.height)-M.y,this.pickRectangle=M,A[0]=M.x,A[1]=M.y,A[2]=0,this.navigatorState.unProject(A,e=new T(0,0,0)),A[0]=M.x,A[1]=M.y,A[2]=1,this.navigatorState.unProject(A,t=new T(0,0,0)),A[0]=M.x+M.width,A[1]=M.y,A[2]=0,this.navigatorState.unProject(A,n=new T(0,0,0)),A[0]=M.x+M.width,A[1]=M.y,A[2]=1,this.navigatorState.unProject(A,r=new T(0,0,0)),A[0]=M.x,A[1]=M.y+M.height,A[2]=0,this.navigatorState.unProject(A,i=new T(0,0,0)),A[0]=M.x,A[1]=M.y+M.height,A[2]=1,this.navigatorState.unProject(A,o=new T(0,0,0)),A[0]=M.x+M.width,A[1]=M.y+M.height,A[2]=0,this.navigatorState.unProject(A,u=new T(0,0,0)),A[0]=M.x+M.width,A[1]=M.y+M.height,A[2]=1,this.navigatorState.unProject(A,a=new T(0,0,0)),C=new T(o[0]-e[0],o[1]-e[1],o[2]-e[2]),k.set(i[0]-t[0],i[1]-t[1],i[2]-t[2]),f=C.cross(k),g=new d(f[0],f[1],f[2],-f.dot(e)),g.normalize(),C=new T(u[0]-r[0],u[1]-r[1],u[2]-r[2]),k.set(a[0]-n[0],a[1]-n[1],a[2]-n[2]),l=C.cross(k),y=new d(l[0],l[1],l[2],-l.dot(n)),y.normalize(),C=new T(o[0]-u[0],o[1]-u[1],o[2]-u[2]),k.set(a[0]-i[0],a[1]-i[1],a[2]-i[2]),c=C.cross(k),b=new d(c[0],c[1],c[2],-c.dot(i)),b.normalize(),C=new T(r[0]-e[0],r[1]-e[1],r[2]-e[2]),k.set(t[0]-n[0],t[1]-n[1],t[2]-n[2]),h=C.cross(k),w=new d(h[0],h[1],h[2],-h.dot(n)),w.normalize(),C=new T(i[0]-n[0],i[1]-n[1],i[2]-n[2]),k.set(u[0]-e[0],u[1]-e[1],u[2]-e[2]),p=C.cross(k),E=new d(p[0],p[1],p[2],-p.dot(e)),E.normalize(),C=new T(a[0]-t[0],a[1]-t[1],a[2]-t[2]),k.set(o[0]-r[0],o[1]-r[1],o[2]-r[2]),v=C.cross(k),S=new d(v[0],v[1],v[2],-v.dot(t)),S.normalize(),this.pickFrustum=new s(g,y,w,b,E,S),!0)},C.prototype.isSmall=function(e,t){if(!e)return!1;var n=this.navigatorState.eyePoint.distanceTo(e.center),r=this.navigatorState.pixelSizeAtDistance(n);return 2*e.radius<t*r},C.prototype.unitCubeBuffer=function(){var e=this.gpuResourceCache.resourceForKey(C.unitCubeKey);if(!e){var t=this.currentGlContext,n=new Float32Array(24),r=0;n[r++]=0,n[r++]=1,n[r++]=0,n[r++]=0,n[r++]=0,n[r++]=0,n[r++]=1,n[r++]=1,n[r++]=0,n[r++]=1,n[r++]=0,n[r++]=0,n[r++]=0,n[r++]=1,n[r++]=1,n[r++]=0,n[r++]=0,n[r++]=1,n[r++]=1,n[r++]=1,n[r++]=1,n[r++]=1,n[r++]=0,n[r]=1,e=t.createBuffer(),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,e),t.bufferData(WebGLRenderingContext.ARRAY_BUFFER,n,WebGLRenderingContext.STATIC_DRAW),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,null),this.frameStatistics.incrementVboLoadCount(1),this.gpuResourceCache.putResource(C.unitCubeKey,e,n.length*4)}return e},C.prototype.unitCubeElements=function(){var e=this.gpuResourceCache.resourceForKey(C.unitCubeElementsKey);if(!e){var t=this.currentGlContext,n=new Int16Array(60),r=0;n[r++]=1,n[r++]=0,n[r++]=3,n[r++]=3,n[r++]=0,n[r++]=2,n[r++]=4,n[r++]=5,n[r++]=6,n[r++]=6,n[r++]=5,n[r++]=7,n[r++]=5,n[r++]=1,n[r++]=7,n[r++]=7,n[r++]=1,n[r++]=3,n[r++]=6,n[r++]=2,n[r++]=4,n[r++]=4,n[r++]=2,n[r++]=0,n[r++]=4,n[r++]=0,n[r++]=5,n[r++]=5,n[r++]=0,n[r++]=1,n[r++]=7,n[r++]=3,n[r++]=6,n[r++]=6,n[r++]=3,n[r++]=2,n[r++]=0,n[r++]=1,n[r++]=1,n[r++]=3,n[r++]=3,n[r++]=2,n[r++]=2,n[r++]=0,n[r++]=4,n[r++]=5,n[r++]=5,n[r++]=7,n[r++]=7,n[r++]=6,n[r++]=6,n[r++]=4,n[r++]=0,n[r++]=4,n[r++]=5,n[r++]=1,n[r++]=2,n[r++]=6,n[r++]=7,n[r]=3,e=t.createBuffer(),t.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,e),t.bufferData(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,n,WebGLRenderingContext.STATIC_DRAW),t.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,null),this.frameStatistics.incrementVboLoadCount(1),this.gpuResourceCache.putResource(C.unitCubeElementsKey,e,n.length*2)}return e},C.prototype.unitQuadBuffer=function(){var e=this.gpuResourceCache.resourceForKey(C.unitQuadKey);if(!e){var t=this.currentGlContext,n=new Float32Array(8);n[0]=0,n[1]=1,n[2]=0,n[3]=0,n[4]=1,n[5]=1,n[6]=1,n[7]=0,e=t.createBuffer(),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,e),t.bufferData(WebGLRenderingContext.ARRAY_BUFFER,n,WebGLRenderingContext.STATIC_DRAW),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,null),this.frameStatistics.incrementVboLoadCount(1),this.gpuResourceCache.putResource(C.unitQuadKey,e,n.length*4)}return e},C.prototype.unitQuadBuffer3=function(){var e=this.gpuResourceCache.resourceForKey(C.unitQuadKey3);if(!e){var t=this.currentGlContext,n=new Float32Array(12);n[0]=0,n[1]=1,n[2]=0,n[3]=0,n[4]=0,n[5]=0,n[6]=1,n[7]=1,n[8]=0,n[9]=1,n[10]=0,n[11]=0,e=t.createBuffer(),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,e),t.bufferData(WebGLRenderingContext.ARRAY_BUFFER,n,WebGLRenderingContext.STATIC_DRAW),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,null),this.frameStatistics.incrementVboLoadCount(1),this.gpuResourceCache.putResource(C.unitQuadKey3,e,n.length*4)}return e},C.prototype.surfacePointForMode=function(t,n,r,i,s){if(!s)throw new e(l.logMessage(l.LEVEL_SEVERE,"DrawContext","surfacePointForMode","missingResult"));if(this.terrain)this.terrain.surfacePointForMode(t,n,r,i,s);else{var o=r+this.globe.elevationAtLocation(t,n)*this.verticalExaggeration;this.globe.computePointFromPosition(t,n,o,s)}return s},C}),n("globe/EarthElevationModel",["../geom/Location","../geom/Sector","../globe/ElevationModel","../util/WmsUrlBuilder"],function(e,t,n,r){"use strict";var i=function(){n.call(this,t.FULL_SPHERE,new e(45,45),12,"application/bil16","EarthElevations256",256,256),this.displayName="Earth Elevation Model",this.minElevation=-11e3,this.maxElevation=8850,this.pixelIsPoint=!1,this.urlBuilder=new r("http://worldwind26.arc.nasa.gov/elev","GEBCO,aster_v2,USGS-NED","","1.3.0")};return i.prototype=Object.create(n.prototype),i}),n("globe/EarthRestElevationModel",["../geom/Location","../geom/Sector","../globe/ElevationModel","../util/LevelRowColumnUrlBuilder"],function(e,t,n,r){"use strict";var i=function(i,s,o){n.call(this,t.FULL_SPHERE,new e(20,20),12,"application/bil16","EarthElevations",150,150),this.displayName=o,this.minElevation=-11e3,this.maxElevation=8850,this.urlBuilder=new r(i,s)};return i.prototype=Object.create(n.prototype),i}),n("shapes/AbstractShape",["../error/ArgumentError","../util/Logger","../geom/Matrix","../cache/MemoryCache","../render/Renderable","../shapes/ShapeAttributes","../error/UnsupportedOperationError","../geom/Vec3"],function(e,t,n,r,i,s,o,u){"use strict";var a=function(e){i.call(this),this._attributes=e?e:new s(null),this._highlightAttributes=null,this.highlighted=!1,this._altitudeMode=WorldWind.ABSOLUTE,this.referencePosition=null,this.shapeDataCache=new r(3,2),this.currentData=null,this.activeAttributes=null,this.expirationInterval=2e3,this.useSurfaceShapeFor2D=!1,this.scratchMatrix=n.fromIdentity()};return a.prototype=Object.create(i.prototype),Object.defineProperties(a.prototype,{attributes:{get:function(){return this._attributes},set:function(e){this._attributes=e,this.surfaceShape&&(this.surfaceShape.attributes=this._attributes)}},highlightAttributes:{get:function(){return this._highlightAttributes},set:function(e){this._highlightAttributes=e,this.surfaceShape&&(this.surfaceShape.highlightAttributes=this._highlightAttributes)}},altitudeMode:{get:function(){return this._altitudeMode},set:function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"AbstractShape","altitudeMode","missingAltitudeMode"));this._altitudeMode=n,this.reset()}}}),a.prototype.reset=function(){this.shapeDataCache.clear(!1),this.surfaceShape=null},a.prototype.updateSurfaceShape=function(){this.surfaceShape.displayName=this.displayName,this.surfaceShape.highlighted=this.highlighted,this.surfaceShape.enabled=this.enabled,this.surfaceShape.pathType=this.pathType,this.surfaceShape.pickDelegate=this.pickDelegate?this.pickDelegate:this},a.prototype.createSurfaceShape=function(){return null},a.prototype.render=function(e){if(!this.enabled)return;if(!e.accumulateOrderedRenderables)return;if(e.globe.is2D()&&this.useSurfaceShapeFor2D){this.surfaceShape||(this.surfaceShape=this.createSurfaceShape(),this.surfaceShape&&(this.surfaceShape.attributes=this._attributes,this.surfaceShape.highlightAttributes=this._highlightAttributes));if(this.surfaceShape){this.updateSurfaceShape(),this.surfaceShape.render(e);return}}if(!e.terrain&&this.altitudeMode!=WorldWind.ABSOLUTE)return;this.establishCurrentData(e);if(e.globe.projectionLimits&&!this.isWithinProjectionLimits(e))return;if(this.currentData.extent&&!this.intersectsFrustum(e))return;this.determineActiveAttributes(e);if(!this.activeAttributes)return;var t=this.makeOrderedRenderable(e);if(t){if(!this.intersectsFrustum(e))return;if(e.isSmall(this.currentData.extent,1))return;t.layer=e.currentLayer,e.addOrderedRenderable(t)}},a.prototype.renderOrdered=function(e){this.currentData=this.shapeDataCache.entryForKey(e.globeStateKey),this.beginDrawing(e);try{this.doRenderOrdered(e)}finally{this.endDrawing(e)}},a.prototype.makeOrderedRenderable=function(e){var t=this.doMakeOrderedRenderable(e);return this.currentData.verticalExaggeration=e.verticalExaggeration,t},a.prototype.doMakeOrderedRenderable=function(e){throw new o(t.logMessage(t.LEVEL_SEVERE,"AbstractShape","makeOrderedRenderable","abstractInvocation"))},a.prototype.doRenderOrdered=function(e){throw new o(t.logMessage(t.LEVEL_SEVERE,"AbstractShape","doRenderOrdered","abstractInvocation"))},a.prototype.beginDrawing=function(e){},a.prototype.endDrawing=function(e){},a.prototype.intersectsFrustum=function(e){return this.currentData&&this.currentData.extent?e.pickingMode?this.currentData.extent.intersectsFrustum(e.pickFrustum):this.currentData.extent.intersectsFrustum(e.navigatorState.frustumInModelCoordinates):!0},a.prototype.establishCurrentData=function(e){this.currentData=this.shapeDataCache.entryForKey(e.globeStateKey),this.currentData||(this.currentData=this.createShapeDataObject(),this.resetExpiration(this.currentData),this.shapeDataCache.putEntry(e.globeStateKey,this.currentData,1)),this.currentData.isExpired=!this.isShapeDataCurrent(e,this.currentData)},a.prototype.createShapeDataObject=function(){return{transformationMatrix:n.fromIdentity(),referencePoint:new u(0,0,0)}},a.prototype.resetExpiration=function(e){e.expiryTime=Date.now()+this.expirationInterval+1e3*Math.random()},a.prototype.isShapeDataCurrent=function(e,t){return t.verticalExaggeration===e.verticalExaggeration&&t.expiryTime>Date.now()},a.prototype.determineActiveAttributes=function(e){this.highlighted&&this._highlightAttributes?this.activeAttributes=this.highlightAttributes:this.activeAttributes=this._attributes},a.prototype.isWithinProjectionLimits=function(e){return!0},a.prototype.applyMvpMatrix=function(e){this.scratchMatrix.copy(e.navigatorState.modelviewProjection),this.scratchMatrix.multiplyMatrix(this.currentData.transformationMatrix),e.currentProgram.loadModelviewProjection(e.currentGlContext,this.scratchMatrix)},a.prototype.applyMvpMatrixForOutline=function(e){this.scratchMatrix.copy(e.navigatorState.projection),this.scratchMatrix.offsetProjectionDepth(-0.001),this.scratchMatrix.multiplyMatrix(e.navigatorState.modelview),this.scratchMatrix.multiplyMatrix(this.currentData.transformationMatrix),e.currentProgram.loadModelviewProjection(e.currentGlContext,this.scratchMatrix)},a}),n("shapes/SurfacePolygon",["../error/ArgumentError","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceShape"],function(e,t,n,r){"use strict";var i=function(n,i){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfacePolygon","constructor","The specified boundary array is null or undefined."));r.call(this,i);var s=null;if(n.length>0&&n[0].latitude)s=n.slice(0),s.push(n[0]),this._boundariesSpecifiedSimply=!0;else if(n.length>1){var o=null;s=[];for(var u=0;u<n.length;u++){var a=n[u][0];for(var f=0;f<n[u].length;f++)s.push(n[u][f]);s.push(a),o?s.push(o):o=s[s.length-1]}}else n.length===1&&(s=n[0].slice(0),s.push(n[0][0]));this._boundaries=s};return i.prototype=Object.create(r.prototype),Object.defineProperties(i.prototype,{}),i.staticStateKey=function(e){var t=r.staticStateKey(e);return t},i.prototype.computeStateKey=function(){return i.staticStateKey(this)},i}),n("shapes/GeographicMesh",["../shapes/AbstractShape","../error/ArgumentError","../shaders/BasicTextureProgram","../geom/BoundingBox","../util/Color","../util/ImageSource","../geom/Location","../util/Logger","../geom/Matrix","../pick/PickedObject","../geom/Position","../shapes/ShapeAttributes","../shapes/SurfacePolygon","../geom/Vec2","../geom/Vec3"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){"use strict";var v=function(n,r){if(!n)throw new t(u.logMessage(u.LEVEL_SEVERE,"GeographicMesh","constructor","missingPositions"));if(n.length<2||n[0].length<2)throw new t(u.logMessage(u.LEVEL_SEVERE,"GeographicMesh","constructor","Number of positions is insufficient."));var i=n[0].length;for(var s=1;s<n.length;s++)if(n[s].length!==i)throw new t(u.logMessage(u.LEVEL_SEVERE,"GeographicMesh","constructor","Array lengths are inconsistent."));e.call(this,r),this.pickTransparentImagePixels=!0,this._positions=n,this.numRows=n.length,this.numColumns=n[0].length,this._textureCoordinates=null,this.referencePosition=this.determineReferencePosition(this._positions)};return v.prototype=Object.create(e.prototype),Object.defineProperties(v.prototype,{positions:{get:function(){return this._positions},set:function(e){if(!e)throw new t(u.logMessage(u.LEVEL_SEVERE,"GeographicMesh","positions","missingPositions"));if(e.length<2||e[0].length<2)throw new t(u.logMessage(u.LEVEL_SEVERE,"GeographicMesh","positions","Number of positions is insufficient."));var n=e[0].length;for(var r=1;r<e.length;r++)if(e[r].length!==n)throw new t(u.logMessage(u.LEVEL_SEVERE,"GeographicMesh","positions","Array lengths are inconsistent."));this.numRows=e.length,this.numColumns=e[0].length,this._positions=e,this.referencePosition=this.determineReferencePosition(this._positions),this.reset(),this.meshIndices=null,this.outlineIndices=null}},textureCoordinates:{get:function(){return this._textureCoordinates},set:function(e){if(e&&e.length!=this.numRows)throw new t(u.logMessage(u.LEVEL_SEVERE,"GeographicMesh","textureCoordinates","Number of texture coordinate rows is inconsistent with the currently specified positions."));for(var n=0;n<this.numRows;n++)if(e[n].length!==this.numColumns)throw new t(u.logMessage(u.LEVEL_SEVERE,"GeographicMesh","textureCoordinates","Texture coordinate row lengths are inconsistent with the currently specified positions."));this._textureCoordinates=e,this.reset(),this.texCoords=null}}}),v.prototype.determineReferencePosition=function(e){return e[0][0]},v.prototype.mustGenerateGeometry=function(e){return this.currentData.meshPoints?this.currentData.drawInterior!==this.activeAttributes.drawInterior?!0:this.activeAttributes.applyLighting&&!this.currentData.normals?!0:this.activeAttributes.imageSource&&!this.texCoords?!0:this.altitudeMode===WorldWind.ABSOLUTE?!1:this.currentData.isExpired:!0},v.prototype.createSurfaceShape=function(){var e=[];for(var t=0;t<this.numColumns;t++)e.push(this._positions[0][t]);for(var n=1;n<this.numRows;n++)e.push(this._positions[n][this.numColumns-1]);for(t=this.numColumns-2;t>=0;t--)e.push(this._positions[this.numRows-1][t]);for(n=this.numRows-2;n>0;n--)e.push(this._positions[n][0]);return new h(e,null)},v.prototype.doMakeOrderedRenderable=function(e){if(!this.activeAttributes.drawInterior&&!this.activeAttributes.drawOutline)return null;if(!this.mustGenerateGeometry(e))return this;var t=this.currentData,n=t.referencePoint;return e.surfacePointForMode(this.referencePosition.latitude,this.referencePosition.longitude,this.referencePosition.altitude,this._altitudeMode,n),t.transformationMatrix.setToTranslation(n[0],n[1],n[2]),this.computeMeshPoints(e,t),this.activeAttributes.imageSource&&(this._textureCoordinates?this.texCoords||this.computeTexCoords(t):this.computeCanonicalTexCoords(t)),this.outlineIndices||(this.computeMeshIndices(t),this.computeOutlineIndices(t)),this.activeAttributes.applyLighting&&this.computeNormals(t),t.drawInterior=this.activeAttributes.drawInterior,this.resetExpiration(t),t.extent||(t.extent=new r),t.extent.setToPoints(t.meshPoints),t.extent.translate(t.referencePoint),this},v.prototype.computeMeshPoints=function(e,t){var n=Number.MAX_VALUE,r=e.navigatorState.eyePoint,i=new Float32Array(this.numRows*this.numColumns*3),s=new d(0,0,0),o=0,u,a;for(var f=0;f<this._positions.length;f++)for(var l=0,c=this._positions[f].length;l<c;l++)u=this._positions[f][l],e.surfacePointForMode(u.latitude,u.longitude,u.altitude,this.altitudeMode,s),a=s.distanceToSquared(r),a<n&&(n=a),s.subtract(this.currentData.referencePoint),i[o++]=s[0],i[o++]=s[1],i[o++]=s[2];this.currentData.eyeDistance=Math.sqrt(n),t.meshPoints=i,t.refreshVertexBuffer=!0},v.prototype.computeTexCoords=function(e){var t=new Float32Array(2*this.numRows*this.numColumns),n=0;for(var r=0;r<this._textureCoordinates.length;r++)for(var i=0,s=this._textureCoordinates[r].length;i<s;i++){var o=this._textureCoordinates[r][i];t[n++]=o[0],t[n++]=o[1]}this.texCoords=t,e.refreshTexCoordBuffer=!0},v.prototype.computeCanonicalTexCoords=function(e){var t=new Float32Array(2*this.numRows*this.numColumns),n=1/(this.numRows-1),r=1/(this.numColumns-1),i=0;for(var s=0;s<this._positions.length;s++){var o=s===this.numRows-1?1:s*n;for(var u=0,a=this._positions[s].length;u<a;u++)t[i++]=u===this.numColumns-1?1:u*r,t[i++]=o}this.texCoords=t,e.refreshTexCoordBuffer=!0},v.prototype.computeMeshIndices=function(e){var t=new Int16Array((this.numRows-1)*(this.numColumns-1)*6),n=0;for(var r=0;r<this.numRows-1;r++)for(var i=0;i<this.numColumns-1;i++){var s=r*this.numColumns+i;t[n++]=s,t[n++]=s+1,t[n++]=s+this.numColumns,t[n++]=s+1,t[n++]=s+1+this.numColumns,t[n++]=s+this.numColumns}this.meshIndices=t,e.refreshMeshIndices=!0},v.prototype.computeOutlineIndices=function(e){var t=new Int16Array(2*this.numRows+2*this.numColumns),n=0;for(var r=0;r<this.numColumns;r++)t[n++]=r;for(var i=1;i<this.numRows;i++)t[n++]=(i+1)*this.numColumns-1;for(r=this.numRows*this.numColumns-2;r>=(this.numRows-1)*this.numColumns;r--)t[n++]=r;for(i=this.numRows-2;i>=0;i--)t[n++]=i*this.numColumns;this.outlineIndices=t,e.refreshOutlineIndices=!0},v.prototype.computeNormals=function(e){var t=new Float32Array(e.meshPoints.length),n=this.meshIndices,r=e.meshPoints,i=[],s=[new d(0,0,0),new d(0,0,0),new d(0,0,0)],o;for(var u=0;u<n.length;u+=3){for(var a=0;a<3;a++)o=n[u+a],s[a].set(r[3*o],r[3*o+1],r[3*o+2]);var f=d.computeTriangleNormal(s[0],s[1],s[2]);for(a=0;a<3;a++)o=n[u+a],i[o]||(i[o]=[]),i[o].push(f)}f=new d(0,0,0);for(u=0;u<i.length;u++)i[u]?(d.average(i[u],f),f.normalize(),t[u*3]=f[0],t[u*3+1]=f[1],t[u*3+2]=f[2]):(t[u*3]=0,t[u*3+1]=0,t[u*3+2]=0);e.normals=t,e.refreshNormalsBuffer=!0},v.prototype.doRenderOrdered=function(e){var t=e.currentGlContext,n=e.currentProgram,r=this.currentData,i=!!this.activeAttributes.imageSource,s,o,u,a,l;e.pickingMode&&(a=e.uniquePickColor()),r.pointsVboCacheKey||(r.pointsVboCacheKey=e.gpuResourceCache.generateCacheKey()),s=e.gpuResourceCache.resourceForKey(r.pointsVboCacheKey),s||(s=t.createBuffer(),e.gpuResourceCache.putResource(r.pointsVboCacheKey,s,r.meshPoints.length*4),r.refreshVertexBuffer=!0),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,s),r.refreshVertexBuffer&&(t.bufferData(WebGLRenderingContext.ARRAY_BUFFER,r.meshPoints,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),r.refreshVertexBuffer=!1),t.vertexAttribPointer(n.vertexPointLocation,3,WebGLRenderingContext.FLOAT,!1,0,0),n.loadTextureEnabled(t,!1);if(this.activeAttributes.drawInterior){var c=!e.pickingMode&&r.normals&&this.activeAttributes.applyLighting;this.applyMvpMatrix(e),r.meshIndicesVboCacheKey||(r.meshIndicesVboCacheKey=e.gpuResourceCache.generateCacheKey()),s=e.gpuResourceCache.resourceForKey(r.meshIndicesVboCacheKey),s||(s=t.createBuffer(),e.gpuResourceCache.putResource(r.meshIndicesVboCacheKey,s,this.meshIndices.length*2),r.refreshMeshIndices=!0),t.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,s),r.refreshMeshIndices&&(t.bufferData(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,this.meshIndices,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),r.refreshMeshIndices=!1),u=this.activeAttributes.interiorColor,o=u.alpha*e.currentLayer.opacity,t.depthMask(o>=1||e.pickingMode),n.loadColor(t,e.pickingMode?a:u),n.loadOpacity(t,e.pickingMode?o>0?1:0:o),i&&(!e.pickingMode||!this.pickTransparentImagePixels)&&(this.activeTexture=e.gpuResourceCache.resourceForKey(this.activeAttributes.imageSource),this.activeTexture||(this.activeTexture=e.gpuResourceCache.retrieveTexture(e.currentGlContext,this.activeAttributes.imageSource)),l=this.activeTexture&&this.activeTexture.bind(e),l&&(r.texCoordsVboCacheKey||(r.texCoordsVboCacheKey=e.gpuResourceCache.generateCacheKey()),s=e.gpuResourceCache.resourceForKey(r.texCoordsVboCacheKey),s||(s=t.createBuffer(),e.gpuResourceCache.putResource(r.texCoordsVboCacheKey,s,this.texCoords.length*4),r.refreshTexCoordBuffer=!0),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,s),r.refreshTexCoordBuffer&&(t.bufferData(WebGLRenderingContext.ARRAY_BUFFER,this.texCoords,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),r.refreshTexCoordBuffer=!1),n.loadTextureEnabled(t,!0),t.enableVertexAttribArray(n.vertexTexCoordLocation),t.vertexAttribPointer(n.vertexTexCoordLocation,2,WebGLRenderingContext.FLOAT,!1,0,0),n.loadTextureUnit(t,WebGLRenderingContext.TEXTURE0),n.loadModulateColor(t,e.pickingMode))),c&&(n.loadApplyLighting(t,!0),r.normalsVboCacheKey||(r.normalsVboCacheKey=e.gpuResourceCache.generateCacheKey()),s=e.gpuResourceCache.resourceForKey(r.normalsVboCacheKey),s||(s=t.createBuffer(),e.gpuResourceCache.putResource(r.normalsVboCacheKey,s,r.normals.length*4),r.refreshNormalsBuffer=!0),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,s),r.refreshNormalsBuffer&&(t.bufferData(WebGLRenderingContext.ARRAY_BUFFER,r.normals,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),r.refreshNormalsBuffer=!1),t.enableVertexAttribArray(n.normalVectorLocation),t.vertexAttribPointer(n.normalVectorLocation,3,WebGLRenderingContext.FLOAT,!1,0,0)),t.drawElements(WebGLRenderingContext.TRIANGLES,this.meshIndices.length,WebGLRenderingContext.UNSIGNED_SHORT,0),i&&t.disableVertexAttribArray(n.vertexTexCoordLocation),c&&(n.loadApplyLighting(t,!1),t.disableVertexAttribArray(n.normalVectorLocation))}this.activeAttributes.drawOutline&&(n.loadTextureEnabled(t,!1),t.disableVertexAttribArray(n.vertexTexCoordLocation),this.applyMvpMatrixForOutline(e),u=this.activeAttributes.outlineColor,o=u.alpha*e.currentLayer.opacity,t.depthMask(o>=1||e.pickingMode),n.loadColor(t,e.pickingMode?a:u),n.loadOpacity(t,e.pickingMode?1:o),t.lineWidth(this.activeAttributes.outlineWidth),r.outlineIndicesVboCacheKey||(r.outlineIndicesVboCacheKey=e.gpuResourceCache.generateCacheKey()),s=e.gpuResourceCache.resourceForKey(r.outlineIndicesVboCacheKey),s||(s=t.createBuffer(),e.gpuResourceCache.putResource(r.outlineIndicesVboCacheKey,s,this.outlineIndices.length*2),r.refreshOutlineIndices=!0),t.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,s),r.refreshOutlineIndices&&(t.bufferData(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,this.outlineIndices,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),r.refreshOutlineIndices=!1),t.drawElements(WebGLRenderingContext.LINE_STRIP,this.outlineIndices.length,WebGLRenderingContext.UNSIGNED_SHORT,0));if(e.pickingMode){var h=new f(a,this.pickDelegate?this.pickDelegate:this,null,e.currentLayer,!1);e.resolvePick(h)}},v.prototype.beginDrawing=function(e){var t=e.currentGlContext;if(this.activeAttributes.drawInterior){t.disable(WebGLRenderingContext.CULL_FACE),e.findAndBindProgram(n);var r=!e.pickMode&&this.currentData.normals&&this.activeAttributes.applyLighting;r&&e.currentProgram.loadModelviewInverse(t,e.navigatorState.modelviewNormalTransform)}t.enableVertexAttribArray(e.currentProgram.vertexPointLocation)},v.prototype.endDrawing=function(e){var t=e.currentGlContext;t.disableVertexAttribArray(e.currentProgram.vertexPointLocation),e.bindProgram(null),t.depthMask(!0),t.lineWidth(1),t.enable(WebGLRenderingContext.CULL_FACE)},v}),n("projections/GeographicProjection",["../error/ArgumentError","../util/Logger","../geom/Sector","../error/UnsupportedOperationError"],function(e,t,n,r){"use strict";var i=function(e,t,n){this.displayName=e||"Geographic Projection",this.continuous=t,this.projectionLimits=n};return i.prototype.geographicToCartesian=function(e,n,i,s,o,u){throw new r(t.logMessage(t.LEVEL_SEVERE,"GeographicProjection","geographicToCartesian","abstractInvocation"))},i.prototype.geographicToCartesianGrid=function(e,n,i,s,o,u,a,f){throw new r(t.logMessage(t.LEVEL_SEVERE,"GeographicProjection","geographicToCartesianGrid","abstractInvocation"))},i.prototype.cartesianToGeographic=function(e,n,i,s,o,u){throw new r(t.logMessage(t.LEVEL_SEVERE,"GeographicProjection","cartesianToGeographic","abstractInvocation"))},i.prototype.northTangentAtLocation=function(n,r,i,s){if(!s)throw new e(t.logMessage(t.LEVEL_SEVERE,"ProjectionEquirectangular","northTangentAtLocation","missingResult"));return s[0]=0,s[1]=1,s[2]=0,s},i.prototype.northTangentAtPoint=function(n,r,i,s,o,u){if(!u)throw new e(t.logMessage(t.LEVEL_SEVERE,"ProjectionEquirectangular","northTangentAtPoint","missingResult"));return u[0]=0,u[1]=1,u[2]=0,u},i}),n("shapes/GeographicText",["../error/ArgumentError","../util/Logger","../shapes/Text","../geom/Vec3"],function(e,t,n,r){"use strict";var i=function(r,i){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"Text","constructor","missingPosition"));n.call(this,i),this.position=r,this.declutterGroup=1};return i.placePoint=new r(0,0,0),i.prototype=Object.create(n.prototype),i.prototype.clone=function(){var e=new i(this.position,this.text);return e.copy(this),e.pickDelegate=this.pickDelegate?this.pickDelegate:this,e},i.prototype.render=function(e){if(e.globe.projectionLimits&&!e.globe.projectionLimits.containsLocation(this.position.latitude,this.position.longitude))return;n.prototype.render.call(this,e)},i.prototype.computeScreenPointAndEyeDistance=function(e){return e.surfacePointForMode(this.position.latitude,this.position.longitude,this.position.altitude,this.altitudeMode,i.placePoint),e.navigatorState.frustumInModelCoordinates.containsPoint(i.placePoint)?(this.eyeDistance=this.alwaysOnTop?0:e.navigatorState.eyePoint.distanceTo(i.placePoint),e.navigatorState.projectWithDepth(i.placePoint,this.depthOffset,this.screenPoint)?!0:!1):!1},i}),n("projections/ProjectionEquirectangular",["../geom/Angle","../error/ArgumentError","../projections/GeographicProjection","../util/Logger","../geom/Vec3"],function(e,t,n,r,i){"use strict";var s=function(){n.call(this,"Equirectangular",!0,null)};return s.prototype=Object.create(n.prototype),Object.defineProperties(s.prototype,{stateKey:{get:function(){return"projection equirectangular "}}}),s.prototype.geographicToCartesian=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesian","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesian","missingResult"));return a[0]=n.equatorialRadius*s*e.DEGREES_TO_RADIANS+(u?u[0]:0),a[1]=n.equatorialRadius*i*e.DEGREES_TO_RADIANS,a[2]=o,a},s.prototype.geographicToCartesianGrid=function(n,s,o,u,a,f,l,c){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesianGrid","missingGlobe"));if(!s)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesianGrid","missingSector"));if(!a||a.length<o*u)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesianGrid","The specified elevations array is null, undefined or insufficient length"));if(!c)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","geographicToCartesianGrid","missingResult"));var h=n.equatorialRadius,p=s.minLatitude*e.DEGREES_TO_RADIANS,d=s.maxLatitude*e.DEGREES_TO_RADIANS,v=s.minLongitude*e.DEGREES_TO_RADIANS,m=s.maxLongitude*e.DEGREES_TO_RADIANS,g=(d-p)/(o>1?o-1:1),y=(m-v)/(u>1?u-1:1),b=f?f:new i(0,0,0),w=l?l[0]:0,E,S,x=0,T=0,N,C,k;for(E=0,N=p;E<o;E++,N+=g){E===o-1&&(N=d),k=h*N-b[1];for(S=0,C=v;S<u;S++,C+=y)S===u-1&&(C=m),c[T++]=h*C-b[0]+w,c[T++]=k,c[T++]=a[x++]-b[2]}return c},s.prototype.cartesianToGeographic=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","cartesianToGeographic","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionEquirectangular","cartesianToGeographic","missingResult"));return a.latitude=s/n.equatorialRadius*e.RADIANS_TO_DEGREES,a.longitude=(i-(u?u[0]:0))/n.equatorialRadius*e.RADIANS_TO_DEGREES,a.altitude=o,a},s}),n("globe/ZeroElevationModel",["../error/ArgumentError","../globe/ElevationModel","../geom/Location","../util/Logger","../geom/Sector"],function(e,t,n,r,i){"use strict";var s=function(){t.call(this,i.FULL_SPHERE,new n(45,45),1," "," ",150,150),this.displayName="Zero Elevations",this.timestamp=Date.now(),this.minElevation=0,this.maxElevation=0};return s.prototype=Object.create(t.prototype),s.prototype.minAndMaxElevationsForSector=function(e){return[0,0]},s.prototype.elevationAtLocation=function(e,t){return 0},s.prototype.elevationsForGrid=function(t,n,i,s,o){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"ZeroElevationModel","elevationsForSector","missingSector"));if(n<=0||i<=0)throw new e(r.logMessage(r.LEVEL_SEVERE,"ZeroElevationModel","elevationsForSector","numLat or numLon is less than 1"));if(!o||o.length<n*i)throw new e(r.logMessage(r.LEVEL_SEVERE,"ZeroElevationModel","elevationsForSector","missingArray"));for(var u=0,a=o.length;u<a;u++)o[u]=0;return 0},s}),n("globe/Globe2D",["../geom/Angle","../error/ArgumentError","../geom/BoundingBox","../projections/GeographicProjection","../globe/Globe","../util/Logger","../projections/ProjectionEquirectangular","../geom/Sector","../globe/Tessellator","../geom/Vec3","../globe/ZeroElevationModel"],function(e,t,n,r,i,s,o,u,a,f,l){"use strict";var c=function(){i.call(this,new l),this._projection=new o,this._offset=0,this.offsetVector=new f(0,0,0)};return c.prototype=Object.create(i.prototype),Object.defineProperties(c.prototype,{continuous:{get:function(){return this.projection.continuous}},projection:{get:function(){return this._projection},set:function(e){if(!e)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe2D","projection","missingProjection"));this.projection!=e&&(this.tessellator=new a),this._projection=e}},projectionLimits:{get:function(){return this._projection.projectionLimits}},offset:{get:function(){return this._offset},set:function(e){this._offset=e,this.offsetVector[0]=e*2*Math.PI*this.equatorialRadius}},stateKey:{get:function(){return this._stateKey+this.elevationModel.stateKey+"offset "+this.offset.toString()+" "+this.projection.stateKey}}}),c.prototype.is2D=function(){return!0},c.prototype.computePointFromPosition=function(e,n,r,i){if(!i)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe2D","computePointFromPosition","missingResult"));return this.projection.geographicToCartesian(this,e,n,r,this.offsetVector,i)},c.prototype.computePointsForGrid=function(e,t,n,r,i,s){return this.projection.geographicToCartesianGrid(this,e,t,n,r,i,this.offsetVector,s)},c.prototype.computePositionFromPoint=function(e,n,r,i){if(!i)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe2D","computePositionFromPoint","missingResult"));return this.projection.cartesianToGeographic(this,e,n,r,this.offsetVector,i),i.longitude<-180?i.longitude+=360:i.longitude>180&&(i.longitude-=360),i},c.prototype.surfaceNormalAtLocation=function(e,n,r){if(!r)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe2D","surfaceNormalAtLocation","missingResult"));return r[0]=0,r[1]=0,r[2]=1,r},c.prototype.surfaceNormalAtPoint=function(e,n,r,i){if(!i)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","surfaceNormalAtPoint","missingResult"));return i[0]=0,i[1]=0,i[2]=1,i},c.prototype.northTangentAtLocation=function(e,n,r){if(!r)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","northTangentAtLocation","missingResult"));return this.projection.northTangentAtLocation(this,e,n,r)},c.prototype.northTangentAtPoint=function(e,n,r,i){if(!i)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe2D","northTangentAtPoint","missingResult"));return this.projection.northTangentAtPoint(this,e,n,r,this.offsetVector,i)},c.prototype.intersectsFrustum=function(e){if(!e)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe2D","intersectsFrustum","missingFrustum"));var r=new n;return r.setToSector(u.FULL_SPHERE,this,this.elevationModel.minElevation,this.elevationModel.maxElevation),r.intersectsFrustum(e)},c.prototype.intersectsLine=function(e,n){if(!e)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","intersectWithRay","missingLine"));if(!n)throw new t(s.logMessage(s.LEVEL_SEVERE,"Globe","intersectsLine","missingResult"));var r=e.direction[0],i=e.direction[1],o=e.direction[2],u=e.origin[0],a=e.origin[1],f=e.origin[2],l;return o==0&&f!=0?!1:(l=-f/o,l<0?!1:(n[0]=u+r*l,n[1]=a+i*l,n[2]=f+o*l,!0))},c}),n("util/GoToAnimator",["../geom/Location","../util/Logger","../geom/Position","../geom/Vec3"],function(e,t,n,r){"use strict";var i=function(e){if(!e)throw new ArgumentError(t.logMessage(t.LEVEL_SEVERE,"GoToAnimator","constructor","missingWorldWindow"));this.wwd=e,this.animationFrequency=20,this.travelTime=3e3,this.cancelled=!1};return i.prototype.cancel=function(){this.cancelled=!0},i.prototype.goTo=function(i,s){if(!i)throw new ArgumentError(t.logMessage(t.LEVEL_SEVERE,"GoToAnimator","goTo","missingPosition"));this.completionCallback=s,this.cancelled=!1,this.targetPosition=new n(i.latitude,i.longitude,i.altitude||this.wwd.navigator.range),this.startPosition=new n(this.wwd.navigator.lookAtLocation.latitude,this.wwd.navigator.lookAtLocation.longitude,this.wwd.navigator.range),this.startTime=Date.now();var o=this.travelTime,u=e.greatCircleDistance(this.startPosition,this.targetPosition),a,f=this.wwd.globe.computePointFromLocation(this.startPosition.latitude,this.startPosition.longitude,new r(0,0,0)),l=this.wwd.globe.computePointFromLocation(this.targetPosition.latitude,this.targetPosition.longitude,new r(0,0,0));this.maxAltitude=f.distanceTo(l);var c=this.wwd.navigator.currentState().pixelSizeAtDistance(this.startPosition.altitude)*this.wwd.canvas.clientWidth/this.wwd.globe.equatorialRadius;u<=2*c&&(this.maxAltitude=this.startPosition.altitude),this.maxAltitudeReachedTime=this.maxAltitude<=this.wwd.navigator.range?Date.now():null,this.maxAltitude>this.startPosition.altitude?(a=Math.max(0,this.maxAltitude-this.startPosition.altitude),a+=Math.abs(this.targetPosition.altitude-this.maxAltitude)):a=Math.abs(this.targetPosition.altitude-this.startPosition.altitude);var h=Math.max(u,a/this.wwd.globe.equatorialRadius);if(h===0)return;h<2*c&&(o=Math.min(h/c*this.travelTime,this.travelTime)),o=Math.max(1,o),this.panVelocity=u/o,this.rangeVelocity=a/o;var p=this,d=function(){if(p.cancelled){p.completionCallback&&p.completionCallback(p);return}p.update()?setTimeout(d,p.animationFrequency):p.completionCallback&&p.completionCallback(p)};setTimeout(d,this.animationFrequency)},i.prototype.update=function(){var e=new n(this.wwd.navigator.lookAtLocation.latitude,this.wwd.navigator.lookAtLocation.longitude,this.wwd.navigator.range),t=this.updateRange(e);return t=this.updateLocation(e)||t,this.wwd.redraw(),t},i.prototype.updateRange=function(e){var t=!1,n,r;return this.maxAltitudeReachedTime?(r=Date.now()-this.maxAltitudeReachedTime,this.maxAltitude>this.targetPosition.altitude?(n=this.maxAltitude-this.rangeVelocity*r,n=Math.max(n,this.targetPosition.altitude)):(n=this.maxAltitude+this.rangeVelocity*r,n=Math.min(n,this.targetPosition.altitude)),this.wwd.navigator.range=n,t=Math.abs(this.wwd.navigator.range-this.targetPosition.altitude)>1):(r=Date.now()-this.startTime,n=Math.min(this.startPosition.altitude+this.rangeVelocity*r,this.maxAltitude),Math.abs(this.wwd.navigator.range-n)<1&&(this.maxAltitudeReachedTime=Date.now()),this.wwd.navigator.range=n,t=!0),t},i.prototype.updateLocation=function(t){var n=Date.now()-this.startTime,r=e.greatCircleDistance(this.startPosition,t),i=e.greatCircleDistance(t,this.targetPosition),s=e.greatCircleAzimuth(t,this.targetPosition),o=this.panVelocity*n,u=Math.min(o-r,i),a=e.greatCircleLocation(t,s,u,new e(0,0)),f=!1;return this.wwd.navigator.lookAtLocation.latitude=a.latitude,this.wwd.navigator.lookAtLocation.longitude=a.longitude,u<1/this.wwd.globe.equatorialRadius&&(f=!0),!f},i}),n("util/HighlightController",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"HighlightController","constructor","missingWorldWindow"));this.worldWindow=n;var r=[],i=function(e){var t=e.clientX,i=e.clientY,s=r.length>0;for(var o=0;o<r.length;o++)r[o].highlighted=!1;r=[];var u=n.pick(n.canvasCoordinates(t,i));u.objects.length>0&&(s=!0);if(u.objects.length>0)for(var a=0;a<u.objects.length;a++)u.objects[a].isTerrain||(u.objects[a].userObject.highlighted=!0,r.push(u.objects[a].userObject));s&&n.redraw()};this.worldWindow.addEventListener("mousemove",i);var s=new WorldWind.TapRecognizer(this.worldWindow,i)};return n}),n("layer/LandsatRestLayer",["../error/ArgumentError","../geom/Location","../util/Logger","../geom/Sector","../layer/TiledImageLayer","../util/LevelRowColumnUrlBuilder","../util/WWUtil"],function(e,t,n,r,i,s,o){"use strict";var u=function(e,n,u){var a=o.urlPath(e+"/"+n);i.call(this,r.FULL_SPHERE,new t(36,36),10,"image/png",a,512,512),this.displayName=u,this.pickEnabled=!1,this.urlBuilder=new s(e,n)};return u.prototype=Object.create(i.prototype),u}),n("navigate/Navigator",["../error/ArgumentError","../util/Logger","../geom/Matrix","../navigate/NavigatorState","../geom/Position","../error/UnsupportedOperationError","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u){"use strict";var a=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"Navigator","constructor","missingWorldWindow"));this.worldWindow=n,this.heading=0,this.tilt=0,this.roll=0,this.nearDistance=1,this.farDistance=1e7};return a.prototype.currentState=function(){throw new s(t.logMessage(t.LEVEL_SEVERE,"Navigator","currentState","abstractInvocation"))},a.prototype.currentStateForModelview=function(s){if(!s)throw new e(t.logMessage(t.LEVEL_SEVERE,"Navigator","currentStateForModelview","missingMatrix"));var a=this.worldWindow.globe,f=u.max(a.equatorialRadius,a.polarRadius),l=s.extractEyePoint(new o(0,0,0)),c=a.computePositionFromPoint(l[0],l[1],l[2],new i(0,0,0)),h=this.worldWindow.viewport,p=this.worldWindow.depthBits,d,v,m=n.fromIdentity();return this.farDistance=u.horizonDistanceForGlobeRadius(f,c.altitude),this.farDistance<1e3&&(this.farDistance=1e3),this.nearDistance=u.perspectiveNearDistanceForFarDistance(this.farDistance,10,p),d=c.altitude-a.elevationAtLocation(c.latitude,c.longitude),d>0&&(v=u.perspectiveNearDistance(h.width,h.height,d),this.nearDistance>v&&(this.nearDistance=v)),this.nearDistance<1&&(this.nearDistance=1),m.setToPerspectiveProjection(h.width,h.height,this.nearDistance,this.farDistance),new r(s,m,h,this.heading,this.tilt)},a}),n("gesture/PanRecognizer",["../gesture/GestureRecognizer"],function(e){"use strict";var t=function(t,n){e.call(this,t,n),this.minNumberOfTouches=1,this.maxNumberOfTouches=Number.MAX_VALUE,this.interpretDistance=20};return t.prototype=Object.create(e.prototype),t.prototype.mouseDown=function(e){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},t.prototype.touchMove=function(e){if(this.state==WorldWind.POSSIBLE)this.shouldInterpret()&&(this.shouldRecognize()?this.state=WorldWind.BEGAN:this.state=WorldWind.FAILED);else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.CHANGED},t.prototype.touchEnd=function(e){if(this.touchCount==0)if(this.state==WorldWind.POSSIBLE)this.state=WorldWind.FAILED;else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.ENDED},t.prototype.touchCancel=function(e){if(this.touchCount==0)if(this.state==WorldWind.POSSIBLE)this.state=WorldWind.FAILED;else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.CANCELLED},t.prototype.prepareToRecognize=function(){this.translationX=0,this.translationY=0},t.prototype.shouldInterpret=function(){var e=this.translationX,t=this.translationY,n=Math.sqrt(e*e+t*t);return n>this.interpretDistance},t.prototype.shouldRecognize=function(){var e=this.touchCount;return e!=0&&e>=this.minNumberOfTouches&&e<=this.maxNumberOfTouches},t}),n("gesture/PinchRecognizer",["../gesture/GestureRecognizer"],function(e){"use strict";var t=function(t,n){e.call(this,t,n),this._scale=1,this._offsetScale=1,this.referenceDistance=0,this.interpretThreshold=20,this.weight=.4,this.pinchTouches=[]};return t.prototype=Object.create(e.prototype),Object.defineProperties(t.prototype,{scale:{get:function(){return this._scale*this._offsetScale}}}),t.prototype.reset=function(){e.prototype.reset.call(this),this._scale=1,this._offsetScale=1,this.referenceDistance=0,this.pinchTouches=[]},t.prototype.mouseDown=function(e){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},t.prototype.touchStart=function(e){this.pinchTouches.length<2&&this.pinchTouches.push(e)==2&&(this.referenceDistance=this.currentPinchDistance(),this._offsetScale*=this._scale,this._scale=1)},t.prototype.touchMove=function(e){if(this.pinchTouches.length==2)if(this.state==WorldWind.POSSIBLE)this.shouldRecognize()&&(this.state=WorldWind.BEGAN);else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED){var t=this.currentPinchDistance(),n=Math.abs(t/this.referenceDistance),r=this.weight;this._scale=this._scale*(1-r)+n*r,this.state=WorldWind.CHANGED}},t.prototype.touchEnd=function(e){var t=this.pinchTouches.indexOf(e);t!=-1&&this.pinchTouches.splice(t,1);if(this.touchCount==0)if(this.state==WorldWind.POSSIBLE)this.state=WorldWind.FAILED;else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.ENDED},t.prototype.touchCancel=function(e){var t=this.pinchTouches.indexOf(e);t!=-1&&this.pinchTouches.splice(t,1);if(this.touchCount==0)if(this.state==WorldWind.POSSIBLE)this.state=WorldWind.FAILED;else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.CANCELLED},t.prototype.prepareToRecognize=function(){this.referenceDistance=this.currentPinchDistance(),this._scale=1},t.prototype.shouldRecognize=function(){var e=this.currentPinchDistance();return Math.abs(e-this.referenceDistance)>this.interpretThreshold},t.prototype.currentPinchDistance=function(){var e=this.pinchTouches[0],t=this.pinchTouches[1],n=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.sqrt(n*n+r*r)},t}),n("gesture/RotationRecognizer",["../geom/Angle","../gesture/GestureRecognizer"],function(e,t){"use strict";var n=function(e,n){t.call(this,e,n),this._rotation=0,this._offsetRotation=0,this.referenceAngle=0,this.interpretThreshold=20,this.weight=.4,this.rotationTouches=[]};return n.prototype=Object.create(t.prototype),Object.defineProperties(n.prototype,{rotation:{get:function(){return this._rotation+this._offsetRotation}}}),n.prototype.reset=function(){t.prototype.reset.call(this),this._rotation=0,this._offsetRotation=0,this.referenceAngle=0,this.rotationTouches=[]},n.prototype.mouseDown=function(e){this.state==WorldWind.POSSIBLE&&(this.state=WorldWind.FAILED)},n.prototype.touchStart=function(e){this.rotationTouches.length<2&&this.rotationTouches.push(e)==2&&(this.referenceAngle=this.currentTouchAngle(),this._offsetRotation+=this._rotation,this._rotation=0)},n.prototype.touchMove=function(t){if(this.rotationTouches.length==2)if(this.state==WorldWind.POSSIBLE)this.shouldRecognize()&&(this.state=WorldWind.BEGAN);else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED){var n=this.currentTouchAngle(),r=e.normalizedDegrees(n-this.referenceAngle),i=this.weight;this._rotation=this._rotation*(1-i)+r*i,this.state=WorldWind.CHANGED}},n.prototype.touchEnd=function(e){var t=this.rotationTouches.indexOf(e);t!=-1&&this.rotationTouches.splice(t,1);if(this.touchCount==0)if(this.state==WorldWind.POSSIBLE)this.state=WorldWind.FAILED;else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.ENDED},n.prototype.touchCancel=function(e){var t=this.rotationTouches.indexOf(e);if(t!=-1){this.rotationTouches.splice(t,1);if(this.touchCount==0)if(this.state==WorldWind.POSSIBLE)this.state=WorldWind.FAILED;else if(this.state==WorldWind.BEGAN||this.state==WorldWind.CHANGED)this.state=WorldWind.CANCELLED}},n.prototype.prepareToRecognize=function(){this.referenceAngle=this.currentTouchAngle(),this._rotation=0},n.prototype.shouldRecognize=function(){var t=this.currentTouchAngle(),n=e.normalizedDegrees(t-this.referenceAngle);return Math.abs(n)>this.interpretThreshold},n.prototype.currentTouchAngle=function(){var t=this.rotationTouches[0],n=this.rotationTouches[1],r=t.clientX-n.clientX,i=t.clientY-n.clientY;return Math.atan2(i,r)*e.RADIANS_TO_DEGREES},n}),n("gesture/TiltRecognizer",["../gesture/PanRecognizer"],function(e){"use strict";var t=function(t,n){e.call(this,t,n),this.maxTouchDistance=250,this.maxTouchDivergence=50};return t.LEFT=1,t.RIGHT=2,t.UP=4,t.DOWN=8,t.prototype=Object.create(e.prototype),t.prototype.shouldInterpret=function(){for(var e=0,t=this.touchCount;e<t;e++){var n=this.touch(e),r=n.translationX,i=n.translationY,s=Math.sqrt(r*r+i*i);if(s>this.interpretDistance)return!0}return!1},t.prototype.shouldRecognize=function(){var e=this.touchCount;if(e<2)return!1;var n=this.touch(0),r=this.touch(1),i=n.clientX-r.clientX,s=n.clientY-r.clientY,o=Math.sqrt(i*i+s*s);if(o>this.maxTouchDistance)return!1;var u=n.translationX-r.translationX,a=n.translationY-r.translationY,f=Math.sqrt(u*u+a*a);if(f>this.maxTouchDivergence)return!1;var l=t.UP|t.DOWN,c=this.touchDirection(n)&l,h=this.touchDirection(r)&l;return(c&h)!=0},t.prototype.touchDirection=function(e){var n=e.translationX,r=e.translationY,i=0;return Math.abs(n)>Math.abs(r)?(i|=n<0?t.LEFT:0,i|=n>0?t.RIGHT:0):(i|=r<0?t.UP:0,i|=r>0?t.DOWN:0),i},t}),n("navigate/LookAtNavigator",["../geom/Angle","../gesture/DragRecognizer","../geom/Frustum","../gesture/GestureRecognizer","../geom/Line","../geom/Location","../util/Logger","../geom/Matrix","../navigate/Navigator","../gesture/PanRecognizer","../gesture/PinchRecognizer","../geom/Position","../gesture/RotationRecognizer","../gesture/TiltRecognizer","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m){"use strict";var g=function(e){function n(e){e.preventDefault()}a.call(this,e),e.addEventListener("mousedown",n),e.addEventListener("touchstart",n),e.addEventListener("contextmenu",n),e.addEventListener("wheel",n),window.PointerEvent&&e.canvas.style.setProperty("touch-action","none"),this.lookAtLocation=new s(30,-110),this.range=1e7,this.enable2DLimits=!0;var r=this;this.primaryDragRecognizer=new t(e,function(e){r.handlePanOrDrag(e)}),this.secondaryDragRecognizer=new t(e,function(e){r.handleSecondaryDrag(e)}),this.secondaryDragRecognizer.button=2,this.panRecognizer=new f(e,function(e){r.handlePanOrDrag(e)}),this.pinchRecognizer=new l(e,function(e){r.handlePinch(e)}),this.rotationRecognizer=new h(e,function(e){r.handleRotation(e)}),this.tiltRecognizer=new p(e,function(e){r.handleTilt(e)}),e.addEventListener("wheel",function(e){r.handleWheelEvent(e)}),this.panRecognizer.recognizeSimultaneouslyWith(this.pinchRecognizer),this.panRecognizer.recognizeSimultaneouslyWith(this.rotationRecognizer),this.pinchRecognizer.recognizeSimultaneouslyWith(this.rotationRecognizer),this.panRecognizer.requireRecognizerToFail(this.tiltRecognizer),this.pinchRecognizer.requireRecognizerToFail(this.tiltRecognizer),this.rotationRecognizer.requireRecognizerToFail(this.tiltRecognizer),this.beginPoint=new d(0,0),this.lastPoint=new d(0,0),this.beginHeading=0,this.beginTilt=0,this.beginRange=0,this.lastRotation=0};return g.prototype=Object.create(a.prototype),g.prototype.currentState=function(){this.applyLimits();var e=this.worldWindow.globe,t=new c(this.lookAtLocation.latitude,this.lookAtLocation.longitude,0),n=u.fromIdentity();return n.multiplyByLookAtModelview(t,this.range,this.heading,this.tilt,this.roll,e),this.currentStateForModelview(n)},g.prototype.handlePanOrDrag=function(e){this.worldWindow.globe.is2D()?this.handlePanOrDrag2D(e):this.handlePanOrDrag3D(e)},g.prototype.handlePanOrDrag3D=function(t){var n=t.state,r=t.translationX,i=t.translationY;if(n==WorldWind.BEGAN)this.lastPoint.set(0,0);else if(n==WorldWind.CHANGED){var s=this.worldWindow.canvas,o=this.worldWindow.globe,u=m.max(o.equatorialRadius,o.polarRadius),a=m.max(1,this.range),f=m.perspectivePixelSize(s.clientWidth,s.clientHeight,a),l=(i-this.lastPoint[1])*f,c=-(r-this.lastPoint[0])*f,h=l/u*e.RADIANS_TO_DEGREES,p=c/u*e.RADIANS_TO_DEGREES,d=Math.sin(this.heading*e.DEGREES_TO_RADIANS),v=Math.cos(this.heading*e.DEGREES_TO_RADIANS);this.lookAtLocation.latitude+=h*v-p*d,this.lookAtLocation.longitude+=h*d+p*v,this.lastPoint.set(r,i),this.applyLimits(),this.worldWindow.redraw()}},g.prototype.handlePanOrDrag2D=function(e){var t=e.state,n=e.clientX,r=e.clientY,i=e.translationX,s=e.translationY;if(t==WorldWind.BEGAN)this.beginPoint.set(n,r),this.lastPoint.set(n,r);else if(t==WorldWind.CHANGED){var o=this.lastPoint[0],a=this.lastPoint[1],f=this.beginPoint[0]+i,l=this.beginPoint[1]+s;this.lastPoint.set(f,l);var c=this.currentState(),h=this.worldWindow.globe,p=c.rayFromScreenPoint(this.worldWindow.canvasCoordinates(o,a)),d=new v(0,0,0),m=new v(0,0,0),g=new v(0,0,0);if(!h.intersectsLine(p,d))return;p=c.rayFromScreenPoint(this.worldWindow.canvasCoordinates(f,l));if(!h.intersectsLine(p,m))return;var y=u.fromIdentity();y.copy(c.modelview),y.multiplyByTranslation(m[0]-d[0],m[1]-d[1],m[2]-d[2]),y.extractEyePoint(p.origin),y.extractForwardVector(p.direction);if(!h.intersectsLine(p,g))return;var b=y.extractViewingParameters(g,this.roll,h,{});this.lookAtLocation.copy(b.origin),this.range=b.range,this.heading=b.heading,this.tilt=b.tilt,this.roll=b.roll,this.applyLimits(),this.worldWindow.redraw()}},g.prototype.handleSecondaryDrag=function(e){var t=e.state,n=e.translationX,r=e.translationY;if(t==WorldWind.BEGAN)this.beginHeading=this.heading,this.beginTilt=this.tilt;else if(t==WorldWind.CHANGED){var i=180*n/this.worldWindow.canvas.clientWidth,s=90*r/this.worldWindow.canvas.clientHeight;this.heading=this.beginHeading+i,this.tilt=this.beginTilt+s,this.applyLimits(),this.worldWindow.redraw()}},g.prototype.handlePinch=function(e){var t=e.state,n=e.scale;t==WorldWind.BEGAN?this.beginRange=this.range:t==WorldWind.CHANGED&&n!=0&&(this.range=this.beginRange/n,this.applyLimits(),this.worldWindow.redraw())},g.prototype.handleRotation=function(e){var t=e.state,n=e.rotation;t==WorldWind.BEGAN?this.lastRotation=0:t==WorldWind.CHANGED&&(this.heading-=n-this.lastRotation,this.lastRotation=n,this.applyLimits(),this.worldWindow.redraw())},g.prototype.handleTilt=function(e){var t=e.state,n=e.translationY;if(t==WorldWind.BEGAN)this.beginTilt=this.tilt;else if(t==WorldWind.CHANGED){var r=-90*n/this.worldWindow.canvas.clientHeight;this.tilt=this.beginTilt+r,this.applyLimits(),this.worldWindow.redraw()}},g.prototype.handleWheelEvent=function(e){var t;e.deltaMode==WheelEvent.DOM_DELTA_PIXEL?t=e.deltaY:e.deltaMode==WheelEvent.DOM_DELTA_LINE?t=e.deltaY*40:e.deltaMode==WheelEvent.DOM_DELTA_PAGE&&(t=e.deltaY*400);var n=1+t/1e3;this.range*=n,this.applyLimits(),this.worldWindow.redraw()},g.prototype.applyLimits=function(){this.lookAtLocation.latitude=m.clamp(this.lookAtLocation.latitude,-90,90),this.lookAtLocation.longitude=e.normalizedDegreesLongitude(this.lookAtLocation.longitude),this.range=m.clamp(this.range,1,Number.MAX_VALUE),this.heading=e.normalizedDegrees(this.heading),this.tilt=m.clamp(this.tilt,0,90),this.roll=e.normalizedDegrees(this.roll);if(this.worldWindow.globe.is2D()&&this.enable2DLimits){var t=2*Math.PI*this.worldWindow.globe.equatorialRadius;this.range=m.clamp(this.range,1,t),this.tilt=0}},g}),n("cache/MemoryCacheListener",["../util/Logger","../error/UnsupportedOperationError"],function(e,t){"use strict";var n=function(){};return n.prototype.entryRemoved=function(n,r){throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCacheListener","entryRemoved","abstractInvocation"))},n.prototype.removalError=function(n,r,i){throw new t(e.logMessage(e.LEVEL_SEVERE,"MemoryCacheListener","removalError","abstractInvocation"))},n}),n("util/NominatimGeocoder",["../util/Logger"],function(e){"use strict";var t=function(){this.service="http://open.mapquestapi.com/nominatim/v1/search/"};return t.prototype.lookup=function(e,t){var n=this.service+e.replace(" ","%20")+"?format=json",r=new XMLHttpRequest,i=this;r.open("GET",n,!0),r.onreadystatechange=function(){if(r.readyState===4&&r.status===200){var e=JSON.parse(r.responseText);t(i,e)}},r.send(null)},t}),n("layer/OpenStreetMapImageLayer",["../geom/Angle","../util/Color","../geom/Location","../geom/Sector","../layer/MercatorTiledImageLayer"],function(e,t,n,r,i){"use strict";var s=function(e){this.imageSize=256,e=e||"Open Street Map",i.call(this,new r(-85.05,85.05,-180,180),new n(85.05,180),19,"image/png",e,this.imageSize,this.imageSize),this.displayName=e,this.pickEnabled=!1,this.detailHintOrigin=2.9,this.destCanvas=document.createElement("canvas"),this.destContext=this.destCanvas.getContext("2d"),this.mapAncestorToTile=!1,this.urlBuilder={urlForTile:function(e,t){return"http://otile1.mqcdn.com/tiles/1.0.0/osm/"+(e.level.levelNumber+1)+"/"+e.column+"/"+e.row+".png"}}};return s.prototype=Object.create(i.prototype),s.prototype.doRender=function(e){i.prototype.doRender.call(this,e),this.inCurrentFrame&&(e.screenCreditController.addStringCredit("©OpenStreetMap",t.DARK_GRAY),e.screenCreditController.addStringCredit("Tiles Courtesy of MapQuest",t.DARK_GRAY))},s.prototype.createTopLevelTiles=function(e){this.topLevelTiles=[],this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),0,0)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),0,1)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),1,0)),this.topLevelTiles.push(this.createTile(null,this.levels.firstLevel(),1,1))},s.prototype.mapSizeForLevel=function(e){return 256<<e+1},s}),n("shapes/SurfacePolyline",["../error/ArgumentError","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceShape"],function(e,t,n,r){"use strict";var i=function(n,i){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfacePolyline","constructor","The specified locations array is null or undefined."));r.call(this,i),this._boundaries=n,this._isInteriorInhibited=!0};return i.prototype=Object.create(r.prototype),i.staticStateKey=function(e){var t=r.staticStateKey(e);return t},i.prototype.computeStateKey=function(){return i.staticStateKey(this)},i}),n("shapes/Path",["../shapes/AbstractShape","../error/ArgumentError","../shaders/BasicTextureProgram","../geom/BoundingBox","../util/Color","../geom/Location","../util/Logger","../geom/Matrix","../pick/PickedObject","../geom/Position","../shapes/ShapeAttributes","../shapes/SurfacePolyline","../geom/Vec2","../geom/Vec3"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){"use strict";var d=function(n,r){if(!n)throw new t(o.logMessage(o.LEVEL_SEVERE,"Path","constructor","missingPositions"));e.call(this,r),this._positions=n,this._pathType=WorldWind.GREAT_CIRCLE,this._terrainConformance=10,this._numSubSegments=10,this.referencePosition=this.determineReferencePosition(this._positions),this.scratchPoint=new p(0,0,0)};return d.prototype=Object.create(e.prototype),Object.defineProperties(d.prototype,{positions:{get:function(){return this._positions},set:function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Path","constructor","missingPositions"));this._positions=e,this.referencePosition=this.determineReferencePosition(this._positions),this.reset()}},followTerrain:{get:function(){return this._followTerrain},set:function(e){this._followTerrain=e,this.reset()}},terrainConformance:{get:function(){return this._terrainConformance},set:function(e){this._terrainConformance=e,this.reset()}},numSubSegments:{get:function(){return this._numSubSegments},set:function(e){this._numSubSegments=e>=0?e:0,this.reset()}},pathType:{get:function(){return this._pathType},set:function(e){this._pathType=e,this.reset()}},extrude:{get:function(){return this._extrude},set:function(e){this._extrude=e,this.reset()}}}),d.prototype.determineReferencePosition=function(e){return e.length>0?e[0]:null},d.prototype.mustGenerateGeometry=function(e){return this.currentData.tessellatedPoints?this.currentData.drawInterior!==this.activeAttributes.drawInterior||this.currentData.drawVerticals!==this.activeAttributes.drawVerticals?!0:!this.followTerrain&&this.currentData.numSubSegments!==this.numSubSegments?!0:this.followTerrain&&this.currentData.terrainConformance!==this.terrainConformance?!0:this.altitudeMode===WorldWind.ABSOLUTE?!1:this.currentData.isExpired:!0},d.prototype.createSurfaceShape=function(){return new c(this.positions,null)},d.prototype.doMakeOrderedRenderable=function(e){if(!this.referencePosition)return null;if(!this.mustGenerateGeometry(e))return this;var t=this.currentData.referencePoint;e.surfacePointForMode(this.referencePosition.latitude,this.referencePosition.longitude,this.referencePosition.altitude,this._altitudeMode,t),this.currentData.transformationMatrix.setToTranslation(t[0],t[1],t[2]);var n=this.makeTessellatedPositions(e);if(n.length<2)return null;var i=this.computeRenderedPath(e,n);return this.currentData.tessellatedPoints=i,this.currentData.drawInterior=this.activeAttributes.drawInterior,this.currentData.drawVerticals=this.activeAttributes.drawVerticals,this.currentData.numSubSegments=this.numSubSegments,this.currentData.terrainConformance=this.terrainConformance,this.resetExpiration(this.currentData),this.currentData.fillVbo=!0,this.currentData.extent||(this.currentData.extent=new r),this.currentData.extent.setToPoints(i),this.currentData.extent.translate(this.currentData.referencePoint),this},d.prototype.makeTessellatedPositions=function(e){var t=[],n=e.navigatorState,r=this.mustDrawVerticals(e),i=new p(0,0,0),s=new p(0,0,0),o=this._positions[0],u,a,f;r&&(this.currentData.verticalIndices=new Int16Array(this.positions.length*2),this.currentData.verticalIndices[0]=0,this.currentData.verticalIndices[1]=1),t.push(o),e.surfacePointForMode(o.latitude,o.longitude,o.altitude,this._altitudeMode,i);for(var l=1,c=this._positions.length;l<c;l++){u=this._positions[l],e.surfacePointForMode(u.latitude,u.longitude,u.altitude,this._altitudeMode,s),a=n.eyePoint.distanceTo(i),f=n.pixelSizeAtDistance(a),i.distanceTo(s)<f*8&&this.altitudeMode!==WorldWind.ABSOLUTE?t.push(u):this.makeSegment(e,o,u,i,s,t),o=u,i.copy(s);if(r){var h=2*(t.length-1);this.currentData.verticalIndices[l*2]=h,this.currentData.verticalIndices[l*2+1]=h+1}}return t},d.prototype.makeSegment=function(e,t,n,r,i,o){var u=e.navigatorState,a=u.eyePoint,l=new s(0,0),c=0,h,p,d,v,m,g;if(this._pathType===WorldWind.LINEAR&&!this._followTerrain){r.equals(i)||o.push(n);return}this._pathType===WorldWind.LINEAR?d=s.linearDistance(t,n):this._pathType===WorldWind.RHUMB_LINE?d=s.rhumbDistance(t,n):d=s.greatCircleDistance(t,n),this._altitudeMode!==WorldWind.CLAMP_TO_GROUND&&(c=.5*(t.altitude+n.altitude)),h=d*(e.globe.equatorialRadius+c*e.verticalExaggeration);if(h<=0)return;this._pathType===WorldWind.LINEAR?p=s.linearAzimuth(t,n):this._pathType===WorldWind.RHUMB_LINE?p=s.rhumbAzimuth(t,n):p=s.greatCircleAzimuth(t,n),this.scratchPoint.copy(r);for(v=0,m=0;v<1;){this._followTerrain?m+=this._terrainConformance*u.pixelSizeAtDistance(this.scratchPoint.distanceTo(a)):m+=h/this._numSubSegments;if(h<m||h-m<1e-9)break;v=m/h,g=v*d,this._pathType===WorldWind.LINEAR?s.linearLocation(t,p,g,l):this._pathType===WorldWind.RHUMB_LINE?s.rhumbLocation(t,p,g,l):s.greatCircleLocation(t,p,g,l),l.altitude=(1-v)*t.altitude+v*n.altitude,o.push(new f(l.latitude,l.longitude,l.altitude)),this._followTerrain&&e.surfacePointForMode(l.latitude,l.longitude,l.altitude,WorldWind.CLAMP_TO_GROUND,this.scratchPoint)}o.push(n)},d.prototype.computeRenderedPath=function(e,t){var n=this.mustDrawInterior(e)||this.mustDrawVerticals(e),r=Number.MAX_VALUE,i=e.navigatorState.eyePoint,s=(n?2:1)*t.length,o=new Float32Array(s*3),u=n?6:3,a=new p(0,0,0),f,l,c,h;this._followTerrain&&this.altitudeMode!==WorldWind.CLAMP_TO_GROUND?f=WorldWind.RELATIVE_TO_GROUND:f=this.altitudeMode;for(var d=0,v=t.length;d<v;d++)l=t[d],e.surfacePointForMode(l.latitude,l.longitude,l.altitude,f,a),h=a.distanceToSquared(i),h<r&&(r=h),a.subtract(this.currentData.referencePoint),c=u*d,o[c]=a[0],o[c+1]=a[1],o[c+2]=a[2],n&&(e.surfacePointForMode(l.latitude,l.longitude,0,WorldWind.CLAMP_TO_GROUND,a),h=a.distanceToSquared(i),h<r&&(r=h),a.subtract(this.currentData.referencePoint),o[c+3]=a[0],o[c+4]=a[1],o[c+5]=a[2]);return this.currentData.pointBufferHasExtrusionPoints=n,this.currentData.eyeDistance=Math.sqrt(r),o},d.prototype.mustDrawInterior=function(e){return this.activeAttributes.drawInterior&&this._extrude&&this._altitudeMode!==WorldWind.CLAMP_TO_GROUND},d.prototype.mustDrawVerticals=function(e){return this.activeAttributes.drawOutline&&this.activeAttributes.drawVerticals&&this.altitudeMode!==WorldWind.CLAMP_TO_GROUND},d.prototype.doRenderOrdered=function(e){var t=e.currentGlContext,n=e.currentProgram,r=this.currentData,i=r.tessellatedPoints.length/3,s,o,u,f,l,c;this.applyMvpMatrix(e),r.vboCacheKey||(r.vboCacheKey=e.gpuResourceCache.generateCacheKey()),s=e.gpuResourceCache.resourceForKey(r.vboCacheKey),s||(s=t.createBuffer(),e.gpuResourceCache.putResource(this.currentData.vboCacheKey,s,r.tessellatedPoints.length*4),r.fillVbo=!0),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,s),r.fillVbo&&(t.bufferData(WebGLRenderingContext.ARRAY_BUFFER,r.tessellatedPoints,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1)),n.loadTextureEnabled(t,!1),e.pickingMode&&(f=e.uniquePickColor()),this.mustDrawInterior(e)&&(u=this.activeAttributes.interiorColor,o=u.alpha*e.currentLayer.opacity,o<1&&!e.pickingMode&&t.depthMask(!1),n.loadColor(t,e.pickingMode?f:u),n.loadOpacity(t,e.pickingMode?o>0?1:0:o),t.vertexAttribPointer(n.vertexPointLocation,3,WebGLRenderingContext.FLOAT,!1,0,0),t.drawArrays(WebGLRenderingContext.TRIANGLE_STRIP,0,i)),this.activeAttributes.drawOutline&&((this.mustDrawVerticals(e)&&this.mustDrawInterior(e)||this.altitudeMode===WorldWind.CLAMP_TO_GROUND)&&this.applyMvpMatrixForOutline(e),u=this.activeAttributes.outlineColor,o=u.alpha*e.currentLayer.opacity,o<1&&!e.pickingMode&&t.depthMask(!1),n.loadColor(t,e.pickingMode?f:u),n.loadOpacity(t,e.pickingMode?1:o),t.lineWidth(this.activeAttributes.outlineWidth),this.currentData.pointBufferHasExtrusionPoints?(l=24,c=i/2):(l=12,c=i),t.vertexAttribPointer(n.vertexPointLocation,3,WebGLRenderingContext.FLOAT,!1,l,0),t.drawArrays(WebGLRenderingContext.LINE_STRIP,0,c),this.mustDrawVerticals(e)&&(r.verticalIndicesVboCacheKey||(r.verticalIndicesVboCacheKey=e.gpuResourceCache.generateCacheKey()),s=e.gpuResourceCache.resourceForKey(r.verticalIndicesVboCacheKey),s||(s=t.createBuffer(),e.gpuResourceCache.putResource(r.verticalIndicesVboCacheKey,s,r.verticalIndices.length*4),r.fillVbo=!0),t.bindBuffer(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,s),r.fillVbo&&(t.bufferData(WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,r.verticalIndices,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1)),t.vertexAttribPointer(n.vertexPointLocation,3,WebGLRenderingContext.FLOAT,!1,0,0),t.drawElements(WebGLRenderingContext.LINES,r.verticalIndices.length,WebGLRenderingContext.UNSIGNED_SHORT,0))),r.fillVbo=!1;if(e.pickingMode){var h=new a(f,this.pickDelegate?this.pickDelegate:this,null,e.currentLayer,!1);e.resolvePick(h)}},d.prototype.beginDrawing=function(e){var t=e.currentGlContext;this.mustDrawInterior(e)&&t.disable(WebGLRenderingContext.CULL_FACE),e.findAndBindProgram(n),t.enableVertexAttribArray(e.currentProgram.vertexPointLocation)},d.prototype.endDrawing=function(e){var t=e.currentGlContext;t.disableVertexAttribArray(e.currentProgram.vertexPointLocation),e.bindProgram(null),t.depthMask(!0),t.lineWidth(1),t.enable(WebGLRenderingContext.CULL_FACE)},d}),n("shapes/PlacemarkAttributes",["../util/Color","../util/Font","../util/Offset","../shapes/ShapeAttributes","../shapes/TextAttributes"],function(e,t,n,r,i){"use strict";var s=function(t){this._imageColor=t?t._imageColor:new e(1,1,1,1),this._imageOffset=t?t._imageOffset:new n(WorldWind.OFFSET_FRACTION,.5,WorldWind.OFFSET_FRACTION,.5),this._imageScale=t?t._imageScale:1,this._imageSource=t?t._imageSource:null,this._depthTest=t?t._depthTest:!0,this._labelAttributes=t?t._labelAttributes:new i(null),this._drawLeaderLine=t?t._drawLeaderLine:!1,this._leaderLineAttributes=t?t._leaderLineAttributes:new r(null),this.stateKeyInvalid=!0};return s.prototype.computeStateKey=function(){return"ic "+this._imageColor.toHexString(!0)+" io "+this._imageOffset.toString()+" is "+this._imageScale+" ip "+this._imageSource+" dt "+this._depthTest+" la "+this._labelAttributes.stateKey+" dll "+this._drawLeaderLine+" lla "+this._leaderLineAttributes.stateKey},Object.defineProperties(s.prototype,{stateKey:{get:function(){return this.stateKeyInvalid&&(this._stateKey=this.computeStateKey(),this.stateKeyInvalid=!1),this._stateKey}},imageColor:{get:function(){return this._imageColor},set:function(e){this._imageColor=e,this.stateKeyInvalid=!0}},imageOffset:{get:function(){return this._imageOffset},set:function(e){this._imageOffset=e,this.stateKeyInvalid=!0}},imageScale:{get:function(){return this._imageScale},set:function(e){this._imageScale=e,this.stateKeyInvalid=!0}},imageSource:{get:function(){return this._imageSource},set:function(e){this._imageSource=e,this.stateKeyInvalid=!0}},depthTest:{get:function(){return this._depthTest},set:function(e){this._depthTest=e,this.stateKeyInvalid=!0}},labelAttributes:{get:function(){return this._labelAttributes},set:function(e){this._labelAttributes=e,this.stateKeyInvalid=!0}},drawLeaderLine:{get:function(){return this._drawLeaderLine},set:function(e){this._drawLeaderLine=e,this.stateKeyInvalid=!0}},leaderLineAttributes:{get:function(){return this._leaderLineAttributes},set:function(e){this._leaderLineAttributes=e,this.stateKeyInvalid=!0}}}),s}),n("shapes/Placemark",["../error/ArgumentError","../shaders/BasicTextureProgram","../util/Color","../util/Font","../util/Logger","../geom/Matrix","../pick/PickedObject","../shapes/PlacemarkAttributes","../render/Renderable","../geom/Vec2","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o,u,a,f,l,c){"use strict";var h=function(t,n,r){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"Placemark","constructor","missingPosition"));a.call(this),this.attributes=r?r:new u(null),this.highlightAttributes=null,this.highlighted=!1,this.position=t,this.eyeDistanceScaling=n,this.eyeDistanceScalingThreshold=1e6,this.eyeDistanceScalingLabelThreshold=1.5*this.eyeDistanceScalingThreshold,this.label=null,this.altitudeMode=WorldWind.ABSOLUTE,this.alwaysOnTop=!1,this.enableLeaderLinePicking=!1,this.updateImage=!0,this.declutterGroup=2,this.targetVisibility=1,this.currentVisibility=1,this.imageRotation=0,this.imageTilt=0,this.imageRotationReference=WorldWind.RELATIVE_TO_SCREEN,this.imageTiltReference=WorldWind.RELATIVE_TO_SCREEN,this.activeAttributes=null,this.activeTexture=null,this.labelTexture=null,this.placePoint=new l(0,0,0),this.groundPoint=new l(0,0,0),this.imageTransform=s.fromIdentity(),this.labelTransform=s.fromIdentity(),this.texCoordMatrix=s.fromIdentity(),this.imageBounds=null,this.layer=null,this.depthOffset=-0.003};return h.screenPoint=new l(0,0,0),h.matrix=s.fromIdentity(),h.scratchPoint=new l(0,0,0),h.prototype=Object.create(a.prototype),Object.defineProperties(h.prototype,{screenBounds:{get:function(){return this.labelBounds}}}),h.prototype.copy=function(e){return this.position=e.position,this.attributes=e.attributes,this.highlightAttributes=e.highlightAttributes,this.highlighted=e.highlighted,this.enabled=e.enabled,this.label=e.label,this.altitudeMode=e.altitudeMode,this.pickDelegate=e.pickDelegate,this.alwaysOnTop=e.alwaysOnTop,this.depthOffset=e.depthOffset,this.targetVisibility=e.targetVisibility,this.currentVisibility=e.currentVisibility,this.imageRotation=e.imageRotation,this.imageTilt=e.imageTilt,this.imageRotationReference=e.imageRotationReference,this.imageTiltReference=e.imageTiltReference,this},h.prototype.clone=function(){var e=new h(this.position);return e.copy(this),e.pickDelegate=this.pickDelegate?this.pickDelegate:this,e},h.prototype.render=function(e){if(!this.enabled)return;if(!e.accumulateOrderedRenderables)return;if(e.globe.projectionLimits&&!e.globe.projectionLimits.containsLocation(this.position.latitude,this.position.longitude))return;var t;if(this.lastFrameTime!==e.timestamp)t=this.makeOrderedRenderable(e);else{var n=this.clone();t=n.makeOrderedRenderable(e)}if(!t)return;if(!t.isVisible(e))return;t.layer=e.currentLayer,this.lastFrameTime=e.timestamp,e.addOrderedRenderable(t)},h.prototype.renderOrdered=function(e){this.drawOrderedPlacemark(e);if(e.pickingMode){var t=new o(this.pickColor.clone(),this.pickDelegate?this.pickDelegate:this,this.position,this.layer,!1);e.pickPoint&&this.mustDrawLabel()&&this.labelBounds.containsPoint(e.navigatorState.convertPointToViewport(e.pickPoint,h.scratchPoint))&&(t.labelPicked=!0),e.resolvePick(t)}},h.prototype.makeOrderedRenderable=function(e){var t,n,r,i;this.determineActiveAttributes(e);if(!this.activeAttributes)return null;e.surfacePointForMode(this.position.latitude,this.position.longitude,this.position.altitude,this.altitudeMode,this.placePoint),this.eyeDistance=this.alwaysOnTop?0:e.navigatorState.eyePoint.distanceTo(this.placePoint),this.mustDrawLeaderLine(e)&&e.surfacePointForMode(this.position.latitude,this.position.longitude,0,this.altitudeMode,this.groundPoint);if(!e.navigatorState.projectWithDepth(this.placePoint,this.depthOffset,h.screenPoint))return null;var s=this.eyeDistanceScaling?Math.max(0,Math.min(1,this.eyeDistanceScalingThreshold/this.eyeDistance)):1;this.activeTexture?(t=this.activeTexture.originalImageWidth,n=this.activeTexture.originalImageHeight,r=this.activeAttributes.imageScale*s,i=this.activeAttributes.imageOffset.offsetForSize(t,n),this.imageTransform.setTranslation(h.screenPoint[0]-i[0]*r,h.screenPoint[1]-i[1]*r,h.screenPoint[2]),this.imageTransform.setScale(t*r,n*r,1)):(r=this.activeAttributes.imageScale*s,i=this.activeAttributes.imageOffset.offsetForSize(r,r),this.imageTransform.setTranslation(h.screenPoint[0]-i[0],h.screenPoint[1]-i[1],h.screenPoint[2]),this.imageTransform.setScale(r,r,1)),this.imageBounds=c.boundingRectForUnitQuad(this.imageTransform);if(this.mustDrawLabel()){var o=this.activeAttributes.labelAttributes.font,u=this.label+o.toString();this.labelTexture=e.gpuResourceCache.resourceForKey(u),this.labelTexture||(this.labelTexture=e.textSupport.createTexture(e,this.label,o,!0),e.gpuResourceCache.putResource(u,this.labelTexture,this.labelTexture.size)),t=this.labelTexture.imageWidth,n=this.labelTexture.imageHeight,r=this.activeAttributes.labelAttributes.scale*s,i=this.activeAttributes.labelAttributes.offset.offsetForSize(t,n),this.labelTransform.setTranslation(h.screenPoint[0]-i[0]*r,h.screenPoint[1]-i[1]*r,h.screenPoint[2]),this.labelTransform.setScale(t*r,n*r,1),this.labelBounds=c.boundingRectForUnitQuad(this.labelTransform)}return this},h.prototype.determineActiveAttributes=function(e){this.highlighted&&this.highlightAttributes?this.activeAttributes=this.highlightAttributes:this.activeAttributes=this.attributes;if(this.activeAttributes&&this.activeAttributes.imageSource){this.activeTexture=e.gpuResourceCache.resourceForKey(this.activeAttributes.imageSource);if(!this.activeTexture||this.updateImage)this.activeTexture=e.gpuResourceCache.retrieveTexture(e.currentGlContext,this.activeAttributes.imageSource),this.updateImage=!1}},h.prototype.isVisible=function(e){return e.pickingMode?e.pickRectangle&&(this.imageBounds.intersects(e.pickRectangle)||this.mustDrawLabel()&&this.labelBounds.intersects(e.pickRectangle)||this.mustDrawLeaderLine(e)&&e.pickFrustum.intersectsSegment(this.groundPoint,this.placePoint)):this.imageBounds.intersects(e.navigatorState.viewport)||this.mustDrawLabel()&&this.labelBounds.intersects(e.navigatorState.viewport)||this.mustDrawLeaderLine(e)&&e.navigatorState.frustumInModelCoordinates.intersectsSegment(this.groundPoint,this.placePoint)},h.prototype.drawOrderedPlacemark=function(e){this.beginDrawing(e);try{this.doDrawOrderedPlacemark(e),e.pickingMode||this.drawBatchOrderedPlacemarks(e)}finally{this.endDrawing(e)}},h.prototype.drawBatchOrderedPlacemarks=function(e){var t;while((t=e.peekOrderedRenderable())&&t.doDrawOrderedPlacemark){e.popOrderedRenderable();try{t.doDrawOrderedPlacemark(e)}catch(n){i.logMessage(i.LEVEL_WARNING,"Placemark","drawBatchOrderedPlacemarks","Error occurred while rendering placemark using batching: "+n.message)}}},h.prototype.beginDrawing=function(e){var n=e.currentGlContext,r;e.findAndBindProgram(t),r=e.currentProgram,n.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,e.unitQuadBuffer()),n.vertexAttribPointer(r.vertexTexCoordLocation,2,WebGLRenderingContext.FLOAT,!1,0,0),n.enableVertexAttribArray(r.vertexPointLocation),n.enableVertexAttribArray(r.vertexTexCoordLocation),r.loadTextureUnit(n,WebGLRenderingContext.TEXTURE0),r.loadModulateColor(n,e.pickingMode)},h.prototype.endDrawing=function(e){var t=e.currentGlContext,n=e.currentProgram;t.disableVertexAttribArray(n.vertexPointLocation),t.disableVertexAttribArray(n.vertexTexCoordLocation),e.bindProgram(null),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,null),t.bindTexture(WebGLRenderingContext.TEXTURE_2D,null)},h.prototype.doDrawOrderedPlacemark=function(e){var t=e.currentGlContext,n=e.currentProgram,r=!0,i;e.pickingMode&&(this.pickColor=e.uniquePickColor()),this.eyeDistanceScaling&&this.eyeDistance>this.eyeDistanceScalingLabelThreshold&&(this.targetVisibility=0);if(!e.pickingMode&&this.mustDrawLabel()&&this.currentVisibility!=this.targetVisibility){var s=(e.timestamp-e.previousRedrawTimestamp)/e.fadeTime;this.currentVisibility<this.targetVisibility?this.currentVisibility=Math.min(1,this.currentVisibility+s):this.currentVisibility=Math.max(0,this.currentVisibility-s),e.redrawRequested=!0}n.loadOpacity(t,e.pickingMode?1:this.layer.opacity);if(this.mustDrawLeaderLine(e)){this.leaderLinePoints||(this.leaderLinePoints=new Float32Array(6)),this.leaderLinePoints[0]=this.groundPoint[0],this.leaderLinePoints[1]=this.groundPoint[1],this.leaderLinePoints[2]=this.groundPoint[2],this.leaderLinePoints[3]=this.placePoint[0],this.leaderLinePoints[4]=this.placePoint[1],this.leaderLinePoints[5]=this.placePoint[2],this.leaderLineCacheKey||(this.leaderLineCacheKey=e.gpuResourceCache.generateCacheKey());var o=e.gpuResourceCache.resourceForKey(this.leaderLineCacheKey);o||(o=t.createBuffer(),e.gpuResourceCache.putResource(this.leaderLineCacheKey,o,this.leaderLinePoints.length*4)),n.loadTextureEnabled(t,!1),n.loadColor(t,e.pickingMode?this.pickColor:this.activeAttributes.leaderLineAttributes.outlineColor),h.matrix.copy(e.navigatorState.modelviewProjection),n.loadModelviewProjection(t,h.matrix),this.activeAttributes.leaderLineAttributes.depthTest||t.disable(WebGLRenderingContext.DEPTH_TEST),t.lineWidth(this.activeAttributes.leaderLineAttributes.outlineWidth),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,o),t.bufferData(WebGLRenderingContext.ARRAY_BUFFER,this.leaderLinePoints,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),t.vertexAttribPointer(n.vertexPointLocation,3,WebGLRenderingContext.FLOAT,!1,0,0),t.drawArrays(WebGLRenderingContext.LINES,0,2)}this.activeAttributes.depthTest||(r=!1,t.disable(WebGLRenderingContext.DEPTH_TEST)),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,e.unitQuadBuffer3()),t.vertexAttribPointer(n.vertexPointLocation,3,WebGLRenderingContext.FLOAT,!1,0,0),h.matrix.copy(e.screenProjection),h.matrix.multiplyMatrix(this.imageTransform);var u=this.imageRotationReference===WorldWind.RELATIVE_TO_GLOBE?e.navigatorState.heading-this.imageRotation:-this.imageRotation;h.matrix.multiplyByTranslation(.5,.5,0),h.matrix.multiplyByRotation(0,0,1,u),h.matrix.multiplyByTranslation(-0.5,-0.5,0);var a=this.imageTiltReference===WorldWind.RELATIVE_TO_GLOBE?e.navigatorState.tilt+this.imageTilt:this.imageTilt;h.matrix.multiplyByRotation(-1,0,0,a),n.loadModelviewProjection(t,h.matrix),n.loadTextureEnabled(t,!0),e.pickingMode?n.loadColor(t,this.pickColor):n.loadColor(t,this.activeAttributes.imageColor),this.texCoordMatrix.setToIdentity(),this.activeTexture&&this.texCoordMatrix.multiplyByTextureTransform(this.activeTexture),n.loadTextureMatrix(t,this.texCoordMatrix),this.activeTexture?(i=this.activeTexture.bind(e),n.loadTextureEnabled(t,i)):n.loadTextureEnabled(t,!1),t.drawArrays(WebGLRenderingContext.TRIANGLE_STRIP,0,4),this.mustDrawLabel()&&this.currentVisibility>0&&(n.loadOpacity(t,e.pickingMode?1:this.layer.opacity*this.currentVisibility),h.matrix.copy(e.screenProjection),h.matrix.multiplyMatrix(this.labelTransform),n.loadModelviewProjection(t,h.matrix),!e.pickingMode&&this.labelTexture?(this.texCoordMatrix.setToIdentity(),this.texCoordMatrix.multiplyByTextureTransform(this.labelTexture),n.loadTextureMatrix(t,this.texCoordMatrix),n.loadColor(t,this.activeAttributes.labelAttributes.color),i=this.labelTexture.bind(e),n.loadTextureEnabled(t,i)):(n.loadTextureEnabled(t,!1),n.loadColor(t,this.pickColor)),this.activeAttributes.labelAttributes.depthTest?r||(r=!0,t.enable(WebGLRenderingContext.DEPTH_TEST)):(r=!1,t.disable(WebGLRenderingContext.DEPTH_TEST)),t.drawArrays(WebGLRenderingContext.TRIANGLE_STRIP,0,4)),r||t.enable(WebGLRenderingContext.DEPTH_TEST)},h.prototype.mustDrawLabel=function(){return this.label&&this.label.length>0&&this.activeAttributes.labelAttributes},h.prototype.mustDrawLeaderLine=function(e){return this.activeAttributes.drawLeaderLine&&this.activeAttributes.leaderLineAttributes&&(!e.pickingMode||this.enableLeaderLinePicking)},h});var r={};return r.DEBUG=!1,r.assert=function(e,t){if(r.DEBUG&&!e)throw new Error("Assertion failed"+(t?": "+t:""))},r.GLU_TESS_MAX_COORD=1e150,r.TRUE_PROJECT=!1,r.TESS_MAX_CACHE=100,r.GLU_TESS_DEFAULT_TOLERANCE=0,r.windingRule={GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},r.primitiveType={GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},r.errorType={GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},r.gluEnum={GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901},r.PQHandle,r.PQKey,r.geom={},r.geom.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},r.geom.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},r.geom.edgeEval=function(e,t,n){var r=t.s-e.s,i=n.s-t.s;return r+i>0?r<i?t.t-e.t+(e.t-n.t)*(r/(r+i)):t.t-n.t+(n.t-e.t)*(i/(r+i)):0},r.geom.edgeSign=function(e,t,n){var r=t.s-e.s,i=n.s-t.s;return r+i>0?(t.t-n.t)*r+(t.t-e.t)*i:0},r.geom.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},r.geom.transEval=function(e,t,n){var r=t.t-e.t,i=n.t-t.t;return r+i>0?r<i?t.s-e.s+(e.s-n.s)*(r/(r+i)):t.s-n.s+(n.s-e.s)*(i/(r+i)):0},r.geom.transSign=function(e,t,n){var r=t.t-e.t,i=n.t-t.t;return r+i>0?(t.s-n.s)*r+(t.s-e.s)*i:0},r.geom.edgeGoesLeft=function(e){return r.geom.vertLeq(e.dst(),e.org)},r.geom.edgeGoesRight=function(e){return r.geom.vertLeq(e.org,e.dst())},r.geom.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},r.geom.vertCCW=function(e,t,n){return e.s*(t.t-n.t)+t.s*(n.t-e.t)+n.s*(e.t-t.t)>=0},r.geom.interpolate_=function(e,t,n,r){return e=e<0?0:e,n=n<0?0:n,e<=n?n===0?(t+r)/2:t+(r-t)*(e/(e+n)):r+(t-r)*(n/(e+n))},r.geom.edgeIntersect=function(e,t,n,i,s){var o,u,a;r.geom.vertLeq(e,t)||(a=e,e=t,t=a),r.geom.vertLeq(n,i)||(a=n,n=i,i=a),r.geom.vertLeq(e,n)||(a=e,e=n,n=a,a=t,t=i,i=a),r.geom.vertLeq(n,t)?r.geom.vertLeq(t,i)?(o=r.geom.edgeEval(e,n,t),u=r.geom.edgeEval(n,t,i),o+u<0&&(o=-o,u=-u),s.s=r.geom.interpolate_(o,n.s,u,t.s)):(o=r.geom.edgeSign(e,n,t),u=-r.geom.edgeSign(e,i,t),o+u<0&&(o=-o,u=-u),s.s=r.geom.interpolate_(o,n.s,u,i.s)):s.s=(n.s+t.s)/2,r.geom.transLeq(e,t)||(a=e,e=t,t=a),r.geom.transLeq(n,i)||(a=n,n=i,i=a),r.geom.transLeq(e,n)||(a=e,e=n,n=a,a=t,t=i,i=a),r.geom.transLeq(n,t)?r.geom.transLeq(t,i)?(o=r.geom.transEval(e,n,t),u=r.geom.transEval(n,t,i),o+u<0&&(o=-o,u=-u),s.t=r.geom.interpolate_(o,n.t,u,t.t)):(o=r.geom.transSign(e,n,t),u=-r.geom.transSign(e,i,t),o+u<0&&(o=-o,u=-u),s.t=r.geom.interpolate_(o,n.t,u,i.t)):s.t=(n.t+t.t)/2},r.mesh={},r.mesh.makeEdge=function(e){var t=r.mesh.makeEdgePair_(e.eHead);return r.mesh.makeVertex_(t,e.vHead),r.mesh.makeVertex_(t.sym,e.vHead),r.mesh.makeFace_(t,e.fHead),t},r.mesh.meshSplice=function(e,t){var n=!1,i=!1;if(e===t)return;t.org!==e.org&&(i=!0,r.mesh.killVertex_(t.org,e.org)),t.lFace!==e.lFace&&(n=!0,r.mesh.killFace_(t.lFace,e.lFace)),r.mesh.splice_(t,e),i||(r.mesh.makeVertex_(t,e.org),e.org.anEdge=e),n||(r.mesh.makeFace_(t,e.lFace),e.lFace.anEdge=e)},r.mesh.deleteEdge=function(e){var t=e.sym,n=!1;e.lFace!==e.rFace()&&(n=!0,r.mesh.killFace_(e.lFace,e.rFace())),e.oNext===e?r.mesh.killVertex_(e.org,null):(e.rFace().anEdge=e.oPrev(),e.org.anEdge=e.oNext,r.mesh.splice_(e,e.oPrev()),n||r.mesh.makeFace_(e,e.lFace)),t.oNext===t?(r.mesh.killVertex_(t.org,null),r.mesh.killFace_(t.lFace,null)):(e.lFace.anEdge=t.oPrev(),t.org.anEdge=t.oNext,r.mesh.splice_(t,t.oPrev())),r.mesh.killEdge_(e)},r.mesh.addEdgeVertex=function(e){var t=r.mesh.makeEdgePair_(e),n=t.sym;return r.mesh.splice_(t,e.lNext),t.org=e.dst(),r.mesh.makeVertex_(n,t.org),t.lFace=n.lFace=e.lFace,t},r.mesh.splitEdge=function(e){var t=r.mesh.addEdgeVertex(e),n=t.sym;return r.mesh.splice_(e.sym,e.sym.oPrev()),r.mesh.splice_(e.sym,n),e.sym.org=n.org,n.dst().anEdge=n.sym,n.sym.lFace=e.rFace(),n.winding=e.winding,n.sym.winding=e.sym.winding,n},r.mesh.connect=function(e,t){var n=!1,i=r.mesh.makeEdgePair_(e),s=i.sym;return t.lFace!==e.lFace&&(n=!0,r.mesh.killFace_(t.lFace,e.lFace)),r.mesh.splice_(i,e.lNext),r.mesh.splice_(s,t),i.org=e.dst(),s.org=t.org,i.lFace=s.lFace=e.lFace,e.lFace.anEdge=s,n||r.mesh.makeFace_(i,e.lFace),i},r.mesh.zapFace=function(e){var t=e.anEdge,n=t.lNext,i;do{i=n,n=i.lNext,i.lFace=null;if(i.rFace()===null){i.oNext===i?r.mesh.killVertex_(i.org,null):(i.org.anEdge=i.oNext,r.mesh.splice_(i,i.oPrev()));var s=i.sym;s.oNext===s?r.mesh.killVertex_(s.org,null):(s.org.anEdge=s.oNext,r.mesh.splice_(s,s.oPrev())),r.mesh.killEdge_(i)}}while(i!==t);var o=e.prev,u=e.next;u.prev=o,o.next=u},r.mesh.meshUnion=function(e,t){var n=e.fHead,r=e.vHead,i=e.eHead,s=t.fHead,o=t.vHead,u=t.eHead;return s.next!==s&&(n.prev.next=s.next,s.next.prev=n.prev,s.prev.next=n,n.prev=s.prev),o.next!==o&&(r.prev.next=o.next,o.next.prev=r.prev,o.prev.next=r,r.prev=o.prev),u.next!==u&&(i.sym.next.sym.next=u.next,u.next.sym.next=i.sym.next,u.sym.next.sym.next=i,i.sym.next=u.sym.next),e},r.mesh.deleteMesh=function(e){},r.mesh.makeEdgePair_=function(e){var t=new r.GluHalfEdge,n=new r.GluHalfEdge,i=e.sym.next;return n.next=i,i.sym.next=t,t.next=e,e.sym.next=n,t.sym=n,t.oNext=t,t.lNext=n,n.sym=t,n.oNext=n,n.lNext=t,t},r.mesh.splice_=function(e,t){var n=e.oNext,r=t.oNext;n.sym.lNext=t,r.sym.lNext=e,e.oNext=r,t.oNext=n},r.mesh.makeVertex_=function(e,t){var n=t.prev,i=new r.GluVertex(t,n);n.next=i,t.prev=i,i.anEdge=e;var s=e;do s.org=i,s=s.oNext;while(s!==e)},r.mesh.makeFace_=function(e,t){var n=t.prev,i=new r.GluFace(t,n);n.next=i,t.prev=i,i.anEdge=e,i.inside=t.inside;var s=e;do s.lFace=i,s=s.lNext;while(s!==e)},r.mesh.killEdge_=function(e){var t=e.next,n=e.sym.next;t.sym.next=n,n.sym.next=t},r.mesh.killVertex_=function(e,t){var n=e.anEdge,r=n;do r.org=t,r=r.oNext;while(r!==n);var i=e.prev,s=e.next;s.prev=i,i.next=s},r.mesh.killFace_=function(e,t){var n=e.anEdge,r=n;do r.lFace=t,r=r.lNext;while(r!==n);var i=e.prev,s=e.next;s.prev=i,i.next=s},r.normal={},r.normal.S_UNIT_X_=1,r.normal.S_UNIT_Y_=0,r.normal.projectPolygon=function(e){var t=!1,n=[e.normal[0],e.normal[1],e.normal[2]];n[0]===0&&n[1]===0&&n[2]===0&&(r.normal.computeNormal_(e,n),t=!0);var i=e.sUnit,s=e.tUnit,o=r.normal.longAxis_(n);if(r.TRUE_PROJECT){r.normal.normalize_(n),i[o]=0,i[(o+1)%3]=r.normal.S_UNIT_X_,i[(o+2)%3]=r.normal.S_UNIT_Y_;var u=r.normal.dot_(i,n);i[0]-=u*n[0],i[1]-=u*n[1],i[2]-=u*n[2],r.normal.normalize_(i),s[0]=n[1]*i[2]-n[2]*i[1],s[1]=n[2]*i[0]-n[0]*i[2],s[2]=n[0]*i[1]-n[1]*i[0],r.normal.normalize_(s)}else i[o]=0,i[(o+1)%3]=r.normal.S_UNIT_X_,i[(o+2)%3]=r.normal.S_UNIT_Y_,s[o]=0,s[(o+1)%3]=n[o]>0?-r.normal.S_UNIT_Y_:r.normal.S_UNIT_Y_,s[(o+2)%3]=n[o]>0?r.normal.S_UNIT_X_:-r.normal.S_UNIT_X_;var a=e.mesh.vHead;for(var f=a.next;f!==a;f=f.next)f.s=r.normal.dot_(f.coords,i),f.t=r.normal.dot_(f.coords,s);t&&r.normal.checkOrientation_(e)},r.normal.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},r.normal.normalize_=function(e){var t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];t=Math.sqrt(t),e[0]/=t,e[1]/=t,e[2]/=t},r.normal.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},r.normal.computeNormal_=function(e,t){var n=[-2*r.GLU_TESS_MAX_COORD,-2*r.GLU_TESS_MAX_COORD,-2*r.GLU_TESS_MAX_COORD],i=[2*r.GLU_TESS_MAX_COORD,2*r.GLU_TESS_MAX_COORD,2*r.GLU_TESS_MAX_COORD],s=[],o=[],u,a=e.mesh.vHead;for(u=a.next;u!==a;u=u.next)for(var f=0;f<3;++f){var l=u.coords[f];l<i[f]&&(i[f]=l,o[f]=u),l>n[f]&&(n[f]=l,s[f]=u)}var c=0;n[1]-i[1]>n[0]-i[0]&&(c=1),n[2]-i[2]>n[c]-i[c]&&(c=2);if(i[c]>=n[c]){t[0]=0,t[1]=0,t[2]=1;return}var h=0,p=o[c],d=s[c],v=[0,0,0],m=[p.coords[0]-d.coords[0],p.coords[1]-d.coords[1],p.coords[2]-d.coords[2]],g=[0,0,0];for(u=a.next;u!==a;u=u.next){g[0]=u.coords[0]-d.coords[0],g[1]=u.coords[1]-d.coords[1],g[2]=u.coords[2]-d.coords[2],v[0]=m[1]*g[2]-m[2]*g[1],v[1]=m[2]*g[0]-m[0]*g[2],v[2]=m[0]*g[1]-m[1]*g[0];var y=v[0]*v[0]+v[1]*v[1]+v[2]*v[2];y>h&&(h=y,t[0]=v[0],t[1]=v[1],t[2]=v[2])}h<=0&&(t[0]=t[1]=t[2]=0,t[r.normal.longAxis_(m)]=1)},r.normal.checkOrientation_=function(e){var t=0,n=e.mesh.fHead;for(var r=n.next;r!==n;r=r.next){var i=r.anEdge;if(i.winding<=0)continue;do t+=(i.org.s-i.dst().s)*(i.org.t+i.dst().t),i=i.lNext;while(i!==r.anEdge)}if(t<0){var s=e.mesh.vHead;for(var o=s.next;o!==s;o=o.next)o.t=-o.t;e.tUnit[0]=-e.tUnit[0],e.tUnit[1]=-e.tUnit[1],e.tUnit[2]=-e.tUnit[2]}},r.render={},r.render.renderMesh=function(e,t,n){var i=!1,s=-1;for(var o=t.fHead.prev;o!==t.fHead;o=o.prev)if(o.inside){i||(e.callBeginOrBeginData(r.primitiveType.GL_TRIANGLES),i=!0);var u=o.anEdge;do{if(n){var a=u.rFace().inside?0:1;s!==a&&(s=a,e.callEdgeFlagOrEdgeFlagData(!!s))}e.callVertexOrVertexData(u.org.data),u=u.lNext}while(u!==o.anEdge)}i&&e.callEndOrEndData()},r.render.renderBoundary=function(e,t){for(var n=t.fHead.next;n!==t.fHead;n=n.next)if(n.inside){e.callBeginOrBeginData(r.primitiveType.GL_LINE_LOOP);var i=n.anEdge;do e.callVertexOrVertexData(i.org.data),i=i.lNext;while(i!==n.anEdge);e.callEndOrEndData()}},r.sweep={},r.sweep.SENTINEL_COORD_=4*r.GLU_TESS_MAX_COORD,r.sweep.TOLERANCE_NONZERO_=!1,r.sweep.computeInterior=function(e){e.fatalError=!1,r.sweep.removeDegenerateEdges_(e),r.sweep.initPriorityQ_(e),r.sweep.initEdgeDict_(e);var t;while((t=e.pq.extractMin())!==null){for(;;){var n=e.pq.minimum();if(n===null||!r.geom.vertEq(n,t))break;n=e.pq.extractMin(),r.sweep.spliceMergeVertices_(e,t.anEdge,n.anEdge)}r.sweep.sweepEvent_(e,t)}var i=e.dict.getMin().getKey();e.event=i.eUp.org,r.sweep.doneEdgeDict_(e),r.sweep.donePriorityQ_(e),r.sweep.removeDegenerateFaces_(e.mesh),e.mesh.checkMesh()},r.sweep.addWinding_=function(e,t){e.winding+=t.winding,e.sym.winding+=t.sym.winding},r.sweep.edgeLeq_=function(e,t,n){var i=e.event,s=t.eUp,o=n.eUp;if(s.dst()===i)return o.dst()===i?r.geom.vertLeq(s.org,o.org)?r.geom.edgeSign(o.dst(),s.org,o.org)<=0:r.geom.edgeSign(s.dst(),o.org,s.org)>=0:r.geom.edgeSign(o.dst(),i,o.org)<=0;if(o.dst()===i)return r.geom.edgeSign(s.dst(),i,s.org)>=0;var u=r.geom.edgeEval(s.dst(),i,s.org),a=r.geom.edgeEval(o.dst(),i,o.org);return u>=a},r.sweep.deleteRegion_=function(e,t){t.fixUpperEdge,t.eUp.activeRegion=null,e.dict.deleteNode(t.nodeUp),t.nodeUp=null},r.sweep.fixUpperEdge_=function(e,t){r.mesh.deleteEdge(e.eUp),e.fixUpperEdge=!1,e.eUp=t,t.activeRegion=e},r.sweep.topLeftRegion_=function(e){var t=e.eUp.org;do e=e.regionAbove();while(e.eUp.org===t);if(e.fixUpperEdge){var n=r.mesh.connect(e.regionBelow().eUp.sym,e.eUp.lNext);r.sweep.fixUpperEdge_(e,n),e=e.regionAbove()}return e},r.sweep.topRightRegion_=function(e){var t=e.eUp.dst();do e=e.regionAbove();while(e.eUp.dst()===t);return e},r.sweep.addRegionBelow_=function(e,t,n){var i=new r.ActiveRegion;return i.eUp=n,i.nodeUp=e.dict.insertBefore(t.nodeUp,i),n.activeRegion=i,i},r.sweep.isWindingInside_=function(e,t){switch(e.windingRule){case r.windingRule.GLU_TESS_WINDING_ODD:return(t&1)!==0;case r.windingRule.GLU_TESS_WINDING_NONZERO:return t!==0;case r.windingRule.GLU_TESS_WINDING_POSITIVE:return t>0;case r.windingRule.GLU_TESS_WINDING_NEGATIVE:return t<0;case r.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return t>=2||t<=-2}return!1},r.sweep.computeWinding_=function(e,t){t.windingNumber=t.regionAbove().windingNumber+t.eUp.winding,t.inside=r.sweep.isWindingInside_(e,t.windingNumber)},r.sweep.finishRegion_=function(e,t){var n=t.eUp,i=n.lFace;i.inside=t.inside,i.anEdge=n,r.sweep.deleteRegion_(e,t)},r.sweep.finishLeftRegions_=function(e,t,n){var i=t,s=t.eUp;while(i!==n){i.fixUpperEdge=!1;var o=i.regionBelow(),u=o.eUp;if(u.org!==s.org){if(!o.fixUpperEdge){r.sweep.finishRegion_(e,i);break}u=r.mesh.connect(s.lPrev(),u.sym),r.sweep.fixUpperEdge_(o,u)}s.oNext!==u&&(r.mesh.meshSplice(u.oPrev(),u),r.mesh.meshSplice(s,u)),r.sweep.finishRegion_(e,i),s=o.eUp,i=o}return s},r.sweep.addRightEdges_=function(e,t,n,i,s,o){var u=!0,a=n;do r.sweep.addRegionBelow_(e,t,a.sym),a=a.oNext;while(a!==i);s===null&&(s=t.regionBelow().eUp.rPrev());var f=t,l=s,c;for(;;){c=f.regionBelow(),a=c.eUp.sym;if(a.org!==l.org)break;a.oNext!==l&&(r.mesh.meshSplice(a.oPrev(),a),r.mesh.meshSplice(l.oPrev(),a)),c.windingNumber=f.windingNumber-a.winding,c.inside=r.sweep.isWindingInside_(e,c.windingNumber),f.dirty=!0,!u&&r.sweep.checkForRightSplice_(e,f)&&(r.sweep.addWinding_(a,l),r.sweep.deleteRegion_(e,f),r.mesh.deleteEdge(l)),u=!1,f=c,l=a}f.dirty=!0,o&&r.sweep.walkDirtyRegions_(e,f)},r.sweep.callCombine_=function(e,t,n,i,s){var o=[t.coords[0],t.coords[1],t.coords[2]];t.data=null,t.data=e.callCombineOrCombineData(o,n,i),t.data===null&&(s?e.fatalError||(e.callErrorOrErrorData(r.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),e.fatalError=!0):t.data=n[0])},r.sweep.spliceMergeVertices_=function(e,t,n){var i=[null,null,null,null],s=[.5,.5,0,0];i[0]=t.org.data,i[1]=n.org.data,r.sweep.callCombine_(e,t.org,i,s,!1),r.mesh.meshSplice(t,n)},r.sweep.vertexWeights_=function(e,t,n,i,s){var o=r.geom.vertL1dist(t,e),u=r.geom.vertL1dist(n,e),a=s,f=s+1;i[a]=.5*u/(o+u),i[f]=.5*o/(o+u),e.coords[0]+=i[a]*t.coords[0]+i[f]*n.coords[0],e.coords[1]+=i[a]*t.coords[1]+i[f]*n.coords[1],e.coords[2]+=i[a]*t.coords[2]+i[f]*n.coords[2]},r.sweep.getIntersectData_=function(e,t,n,i,s,o){var u=[0,0,0,0],a=[n.data,i.data,s.data,o.data];t.coords[0]=t.coords[1]=t.coords[2]=0,r.sweep.vertexWeights_(t,n,i,u,0),r.sweep.vertexWeights_(t,s,o,u,2),r.sweep.callCombine_(e,t,a,u,!0)},r.sweep.checkForRightSplice_=function(e,t){var n=t.regionBelow(),i=t.eUp,s=n.eUp;if(r.geom.vertLeq(i.org,s.org)){if(r.geom.edgeSign(s.dst(),i.org,s.org)>0)return!1;r.geom.vertEq(i.org,s.org)?i.org!==s.org&&(e.pq.remove(i.org.pqHandle),r.sweep.spliceMergeVertices_(e,s.oPrev(),i)):(r.mesh.splitEdge(s.sym),r.mesh.meshSplice(i,s.oPrev()),t.dirty=n.dirty=!0)}else{if(r.geom.edgeSign(i.dst(),s.org,i.org)<0)return!1;t.regionAbove().dirty=t.dirty=!0,r.mesh.splitEdge(i.sym),r.mesh.meshSplice(s.oPrev(),i)}return!0},r.sweep.checkForLeftSplice_=function(e,t){var n=t.regionBelow(),i=t.eUp,s=n.eUp,o;if(r.geom.vertLeq(i.dst(),s.dst())){if(r.geom.edgeSign(i.dst(),s.dst(),i.org)<0)return!1;t.regionAbove().dirty=t.dirty=!0,o=r.mesh.splitEdge(i),r.mesh.meshSplice(s.sym,o),o.lFace.inside=t.inside}else{if(r.geom.edgeSign(s.dst(),i.dst(),s.org)>0)return!1;t.dirty=n.dirty=!0,o=r.mesh.splitEdge(s),r.mesh.meshSplice(i.lNext,s.sym),o.rFace().inside=t.inside}return!0},r.sweep.checkForIntersect_=function(e,t){var n=t.regionBelow(),i=t.eUp,s=n.eUp,o=i.org,u=s.org,a=i.dst(),f=s.dst(),l=new r.GluVertex;if(o===u)return!1;var c=Math.min(o.t,a.t),h=Math.max(u.t,f.t);if(c>h)return!1;if(r.geom.vertLeq(o,u)){if(r.geom.edgeSign(f,o,u)>0)return!1}else if(r.geom.edgeSign(a,u,o)<0)return!1;r.geom.edgeIntersect(a,o,f,u,l),r.geom.vertLeq(l,e.event)&&(l.s=e.event.s,l.t=e.event.t);var p=r.geom.vertLeq(o,u)?o:u;r.geom.vertLeq(p,l)&&(l.s=p.s,l.t=p.t);if(r.geom.vertEq(l,o)||r.geom.vertEq(l,u))return r.sweep.checkForRightSplice_(e,t),!1;if(!r.geom.vertEq(a,e.event)&&r.geom.edgeSign(a,e.event,l)>=0||!r.geom.vertEq(f,e.event)&&r.geom.edgeSign(f,e.event,l)<=0){if(f===e.event)return r.mesh.splitEdge(i.sym),r.mesh.meshSplice(s.sym,i),t=r.sweep.topLeftRegion_(t),i=t.regionBelow().eUp,r.sweep.finishLeftRegions_(e,t.regionBelow(),n),r.sweep.addRightEdges_(e,t,i.oPrev(),i,i,!0),!0;if(a===e.event){r.mesh.splitEdge(s.sym),r.mesh.meshSplice(i.lNext,s.oPrev()),n=t,t=r.sweep.topRightRegion_(t);var d=t.regionBelow().eUp.rPrev();return n.eUp=s.oPrev(),s=r.sweep.finishLeftRegions_(e,n,null),r.sweep.addRightEdges_(e,t,s.oNext,i.rPrev(),d,!0),!0}return r.geom.edgeSign(a,e.event,l)>=0&&(t.regionAbove().dirty=t.dirty=!0,r.mesh.splitEdge(i.sym),i.org.s=e.event.s,i.org.t=e.event.t),r.geom.edgeSign(f,e.event,l)<=0&&(t.dirty=n.dirty=!0,r.mesh.splitEdge(s.sym),s.org.s=e.event.s,s.org.t=e.event.t),!1}return r.mesh.splitEdge(i.sym),r.mesh.splitEdge(s.sym),r.mesh.meshSplice(s.oPrev(),i),i.org.s=l.s,i.org.t=l.t,i.org.pqHandle=e.pq.insert(i.org),r.sweep.getIntersectData_(e,i.org,o,a,u,f),t.regionAbove().dirty=t.dirty=n.dirty=!0,!1},r.sweep.walkDirtyRegions_=function(e,t){var n=t.regionBelow();for(;;){while(n.dirty)t=n,n=n.regionBelow();if(!t.dirty){n=t,t=t.regionAbove();if(t===null||!t.dirty)return}t.dirty=!1;var i=t.eUp,s=n.eUp;i.dst()!==s.dst()&&r.sweep.checkForLeftSplice_(e,t)&&(n.fixUpperEdge?(r.sweep.deleteRegion_(e,n),r.mesh.deleteEdge(s),n=t.regionBelow(),s=n.eUp):t.fixUpperEdge&&(r.sweep.deleteRegion_(e,t),r.mesh.deleteEdge(i),t=n.regionAbove(),i=t.eUp));if(i.org!==s.org)if(i.dst()!==s.dst()&&!t.fixUpperEdge&&!n.fixUpperEdge&&(i.dst()===e.event||s.dst()===e.event)){if(r.sweep.checkForIntersect_(e,t))return}else r.sweep.checkForRightSplice_(e,t);i.org===s.org&&i.dst()===s.dst()&&(r.sweep.addWinding_(s,i),r.sweep.deleteRegion_(e,t),r.mesh.deleteEdge(i),t=n.regionAbove())}},r.sweep.connectRightVertex_=function(e,t,n){var i=n.oNext,s=t.regionBelow(),o=t.eUp,u=s.eUp,a=!1;o.dst()!==u.dst()&&r.sweep.checkForIntersect_(e,t),r.geom.vertEq(o.org,e.event)&&(r.mesh.meshSplice(i.oPrev(),o),t=r.sweep.topLeftRegion_(t),i=t.regionBelow().eUp,r.sweep.finishLeftRegions_(e,t.regionBelow(),s),a=!0),r.geom.vertEq(u.org,e.event)&&(r.mesh.meshSplice(n,u.oPrev()),n=r.sweep.finishLeftRegions_(e,s,null),a=!0);if(a){r.sweep.addRightEdges_(e,t,n.oNext,i,i,!0);return}var f;r.geom.vertLeq(u.org,o.org)?f=u.oPrev():f=o,f=r.mesh.connect(n.lPrev(),f),r.sweep.addRightEdges_(e,t,f,f.oNext,f.oNext,!1),f.sym.activeRegion.fixUpperEdge=!0,r.sweep.walkDirtyRegions_(e,t)},r.sweep.connectLeftDegenerate_=function(e,t,n){var i=t.eUp;if(r.geom.vertEq(i.org,n)){r.sweep.TOLERANCE_NONZERO_&&r.sweep.spliceMergeVertices_(e,i,n.anEdge);return}if(!r.geom.vertEq(i.dst(),n)){r.mesh.splitEdge(i.sym),t.fixUpperEdge&&(r.mesh.deleteEdge(i.oNext),t.fixUpperEdge=!1),r.mesh.meshSplice(n.anEdge,i),r.sweep.sweepEvent_(e,n);return}if(r.sweep.TOLERANCE_NONZERO_){t=r.sweep.topRightRegion_(t);var s=t.regionBelow(),o=s.eUp.sym,u=o.oNext,a=u;s.fixUpperEdge&&(r.sweep.deleteRegion_(e,s),r.mesh.deleteEdge(o),o=u.oPrev()),r.mesh.meshSplice(n.anEdge,o),r.geom.edgeGoesLeft(u)||(u=null),r.sweep.addRightEdges_(e,t,o.oNext,a,u,!0)}},r.sweep.connectLeftVertex_=function(e,t){var n=new r.ActiveRegion;n.eUp=t.anEdge.sym;var i=e.dict.search(n).getKey(),s=i.regionBelow(),o=i.eUp,u=s.eUp;if(r.geom.edgeSign(o.dst(),t,o.org)===0){r.sweep.connectLeftDegenerate_(e,i,t);return}var a=r.geom.vertLeq(u.dst(),o.dst())?i:s,f;if(i.inside||a.fixUpperEdge){if(a===i)f=r.mesh.connect(t.anEdge.sym,o.lNext);else{var l=r.mesh.connect(u.dNext(),t.anEdge);f=l.sym}a.fixUpperEdge?r.sweep.fixUpperEdge_(a,f):r.sweep.computeWinding_(e,r.sweep.addRegionBelow_(e,i,f)),r.sweep.sweepEvent_(e,t)}else r.sweep.addRightEdges_(e,i,t.anEdge,t.anEdge,null,!0)},r.sweep.sweepEvent_=function(e,t){e.event=t;var n=t.anEdge;while(n.activeRegion===null){n=n.oNext;if(n===t.anEdge){r.sweep.connectLeftVertex_(e,t);return}}var i=r.sweep.topLeftRegion_(n.activeRegion),s=i.regionBelow(),o=s.eUp,u=r.sweep.finishLeftRegions_(e,s,null);u.oNext===o?r.sweep.connectRightVertex_(e,i,u):r.sweep.addRightEdges_(e,i,u.oNext,o,o,!0)},r.sweep.addSentinel_=function(e,t){var n=new r.ActiveRegion,i=r.mesh.makeEdge(e.mesh);i.org.s=r.sweep.SENTINEL_COORD_,i.org.t=t,i.dst().s=-r.sweep.SENTINEL_COORD_,i.dst().t=t,e.event=i.dst(),n.eUp=i,n.windingNumber=0,n.inside=!1,n.fixUpperEdge=!1,n.sentinel=!0,n.dirty=!1,n.nodeUp=e.dict.insert(n)},r.sweep.initEdgeDict_=function(e){e.dict=new r.Dict(e,r.sweep.edgeLeq_),r.sweep.addSentinel_(e,-r.sweep.SENTINEL_COORD_),r.sweep.addSentinel_(e,r.sweep.SENTINEL_COORD_)},r.sweep.doneEdgeDict_=function(e){var t=0,n;while((n=e.dict.getMin().getKey())!==null)!n.sentinel,r.sweep.deleteRegion_(e,n);e.dict=null},r.sweep.removeDegenerateEdges_=function(e){var t=e.mesh.eHead,n;for(var i=t.next;i!==t;i=n){n=i.next;var s=i.lNext;r.geom.vertEq(i.org,i.dst())&&i.lNext.lNext!==i&&(r.sweep.spliceMergeVertices_(e,s,i),r.mesh.deleteEdge(i),i=s,s=i.lNext);if(s.lNext===i){if(s!==i){if(s===n||s===n.sym)n=n.next;r.mesh.deleteEdge(s)}if(i===n||i===n.sym)n=n.next;r.mesh.deleteEdge(i)}}},r.sweep.initPriorityQ_=function(e){var t=new r.PriorityQ(r.geom.vertLeq);e.pq=t;var n=e.mesh.vHead,i;for(i=n.next;i!==n;i=i.next)i.pqHandle=t.insert(i);t.init()},r.sweep.donePriorityQ_=function(e){e.pq.deleteQ(),e.pq=null},r.sweep.removeDegenerateFaces_=function(e){var t;for(var n=e.fHead.next;n!==e.fHead;n=t){t=n.next;var i=n.anEdge;i.lNext.lNext===i&&(r.sweep.addWinding_(i.oNext,i),r.mesh.deleteEdge(i))}},r.tessmono={},r.tessmono.tessellateMonoRegion_=function(e){var t=e.anEdge;for(;r.geom.vertLeq(t.dst(),t.org);t=t.lPrev());for(;r.geom.vertLeq(t.org,t.dst());t=t.lNext);var n=t.lPrev(),i;while(t.lNext!==n)if(r.geom.vertLeq(t.dst(),n.org)){while(n.lNext!==t&&(r.geom.edgeGoesLeft(n.lNext)||r.geom.edgeSign(n.org,n.dst(),n.lNext.dst())<=0))i=r.mesh.connect(n.lNext,n),n=i.sym;n=n.lPrev()}else{while(n.lNext!==t&&(r.geom.edgeGoesRight(t.lPrev())||r.geom.edgeSign(t.dst(),t.org,t.lPrev().org)>=0))i=r.mesh.connect(t,t.lPrev()),t=i.sym;t=t.lNext}while(n.lNext.lNext!==t)i=r.mesh.connect(n.lNext,n),n=i.sym},r.tessmono.tessellateInterior=function(e){var t;for(var n=e.fHead.next;n!==e.fHead;n=t)t=n.next,n.inside&&r.tessmono.tessellateMonoRegion_(n)},r.tessmono.discardExterior=function(e){var t;for(var n=e.fHead.next;n!==e.fHead;n=t)t=n.next,n.inside||r.mesh.zapFace(n)},r.tessmono.setWindingNumber=function(e,t,n){var i;for(var s=e.eHead.next;s!==e.eHead;s=i)i=s.next,s.rFace().inside!==s.lFace.inside?s.winding=s.lFace.inside?t:-t:n?r.mesh.deleteEdge(s):s.winding=0},r.Dict=function(e,t){this.head_=new r.DictNode,this.frame_=e,this.leq_=t},r.Dict.prototype.deleteDict_=function(){},r.Dict.prototype.insertBefore=function(e,t){do e=e.prev;while(e.key!==null&&!this.leq_(this.frame_,e.key,t));var n=new r.DictNode(t,e.next,e);return e.next.prev=n,e.next=n,n},r.Dict.prototype.insert=function(e){return this.insertBefore(this.head_,e)},r.Dict.prototype.deleteNode=function(e){e.next.prev=e.prev,e.prev.next=e.next},r.Dict.prototype.search=function(e){var t=this.head_;do t=t.next;while(t.key!==null&&!this.leq_(this.frame_,e,t.key));return t},r.Dict.prototype.getMin=function(){return this.head_.next},r.Dict.prototype.getMax=function(){return this.head_.prev},r.DictNode=function(e,t,n){this.key=e||null,this.next=t||this,this.prev=n||this},r.DictNode.prototype.getKey=function(){return this.key},r.DictNode.prototype.getSuccessor=function(){return this.next},r.DictNode.prototype.getPredecessor=function(){return this.prev},r.CachedVertex=function(){this.coords=[0,0,0],this.data=null},r.GluTesselator=function(){this.state=r.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.callError_=null,this.normal=[0,0,0],this.sUnit=[0,0,0],this.tUnit=[0,0,0],this.relTolerance=r.GLU_TESS_DEFAULT_TOLERANCE,this.windingRule=r.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.callCombine_=null,this.boundaryOnly=!1,this.callBegin_=null,this.callEdgeFlag_=null,this.callVertex_=null,this.callEnd_=null,this.callMesh_=null,this.callBeginData_=null,this.callEdgeFlagData_=null,this.callVertexData_=null,this.callEndData_=null,this.callErrorData_=null,this.callCombineData_=null,this.polygonData_=null,this.emptyCache=!1,this.cacheCount=0,this.cache=new Array(r.TESS_MAX_CACHE);for(var e=0;e<r.TESS_MAX_CACHE;e++)this.cache[e]=new r.CachedVertex},r.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},r.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(r.GluTesselator.tessState_.T_DORMANT)},r.GluTesselator.prototype.gluTessProperty=function(e,t){switch(e){case r.gluEnum.GLU_TESS_TOLERANCE:if(t<0||t>1)break;this.relTolerance=t;return;case r.gluEnum.GLU_TESS_WINDING_RULE:var n=t;switch(n){case r.windingRule.GLU_TESS_WINDING_ODD:case r.windingRule.GLU_TESS_WINDING_NONZERO:case r.windingRule.GLU_TESS_WINDING_POSITIVE:case r.windingRule.GLU_TESS_WINDING_NEGATIVE:case r.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:this.windingRule=n;return;default:}break;case r.gluEnum.GLU_TESS_BOUNDARY_ONLY:this.boundaryOnly=!!t;return;default:this.callErrorOrErrorData(r.gluEnum.GLU_INVALID_ENUM);return}this.callErrorOrErrorData(r.gluEnum.GLU_INVALID_VALUE)},r.GluTesselator.prototype.gluGetTessProperty=function(e){switch(e){case r.gluEnum.GLU_TESS_TOLERANCE:return this.relTolerance;case r.gluEnum.GLU_TESS_WINDING_RULE:var t=this.windingRule;return t;case r.gluEnum.GLU_TESS_BOUNDARY_ONLY:return this.boundaryOnly;default:this.callErrorOrErrorData(r.gluEnum.GLU_INVALID_ENUM)}return!1},r.GluTesselator.prototype.gluTessNormal=function(e,t,n){this.normal[0]=e,this.normal[1]=t,this.normal[2]=n},r.GluTesselator.prototype.gluTessCallback=function(e,t){var n=t?t:null;switch(e){case r.gluEnum.GLU_TESS_BEGIN:this.callBegin_=n;return;case r.gluEnum.GLU_TESS_BEGIN_DATA:this.callBeginData_=n;return;case r.gluEnum.GLU_TESS_EDGE_FLAG:this.callEdgeFlag_=n;return;case r.gluEnum.GLU_TESS_EDGE_FLAG_DATA:this.callEdgeFlagData_=n;return;case r.gluEnum.GLU_TESS_VERTEX:this.callVertex_=n;return;case r.gluEnum.GLU_TESS_VERTEX_DATA:this.callVertexData_=n;return;case r.gluEnum.GLU_TESS_END:this.callEnd_=n;return;case r.gluEnum.GLU_TESS_END_DATA:this.callEndData_=n;return;case r.gluEnum.GLU_TESS_ERROR:this.callError_=n;return;case r.gluEnum.GLU_TESS_ERROR_DATA:this.callErrorData_=n;return;case r.gluEnum.GLU_TESS_COMBINE:this.callCombine_=n;return;case r.gluEnum.GLU_TESS_COMBINE_DATA:this.callCombineData_=n;return;case r.gluEnum.GLU_TESS_MESH:this.callMesh_=n;return;default:this.callErrorOrErrorData(r.gluEnum.GLU_INVALID_ENUM);return}},r.GluTesselator.prototype.gluTessVertex=function(e,t){var n=!1,i=[0,0,0];this.requireState_(r.GluTesselator.tessState_.T_IN_CONTOUR),this.emptyCache&&(this.emptyCache_(),this.lastEdge_=null);for(var s=0;s<3;++s){var o=e[s];o<-r.GLU_TESS_MAX_COORD&&(o=-r.GLU_TESS_MAX_COORD,n=!0),o>r.GLU_TESS_MAX_COORD&&(o=r.GLU_TESS_MAX_COORD,n=!0),i[s]=o}n&&this.callErrorOrErrorData(r.errorType.GLU_TESS_COORD_TOO_LARGE);if(this.mesh===null){if(this.cacheCount<r.TESS_MAX_CACHE){this.cacheVertex_(i,t);return}this.emptyCache_()}this.addVertex_(i,t)},r.GluTesselator.prototype.gluTessBeginPolygon=function(e){this.requireState_(r.GluTesselator.tessState_.T_DORMANT),this.state=r.GluTesselator.tessState_.T_IN_POLYGON,this.cacheCount=0,this.emptyCache=!1,this.mesh=null,this.polygonData_=e},r.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(r.GluTesselator.tessState_.T_IN_POLYGON),this.state=r.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null,this.cacheCount>0&&(this.emptyCache=!0)},r.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(r.GluTesselator.tessState_.T_IN_CONTOUR),this.state=r.GluTesselator.tessState_.T_IN_POLYGON},r.GluTesselator.prototype.gluTessEndPolygon=function(){this.requireState_(r.GluTesselator.tessState_.T_IN_POLYGON),this.state=r.GluTesselator.tessState_.T_DORMANT,this.mesh===null&&this.emptyCache_(),r.normal.projectPolygon(this),r.sweep.computeInterior(this);if(!this.fatalError){var e=this.mesh;this.boundaryOnly?r.tessmono.setWindingNumber(e,1,!0):r.tessmono.tessellateInterior(e),this.mesh.checkMesh();if(this.callBegin_||this.callEnd_||this.callVertex_||this.callEdgeFlag_||this.callBeginData_||this.callEndData_||this.callVertexData_||this.callEdgeFlagData_)if(this.boundaryOnly)r.render.renderBoundary(this,this.mesh);else{var t=!!this.callEdgeFlag_||!!this.callEdgeFlagData_;r.render.renderMesh(this,this.mesh,t)}if(this.callMesh_){r.tessmono.discardExterior(this.mesh),this.callMesh_(this.mesh),this.mesh=null,this.polygonData_=null;return}}r.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},r.GluTesselator.prototype.makeDormant_=function(){this.mesh&&r.mesh.deleteMesh(this.mesh),this.state=r.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null},r.GluTesselator.prototype.requireState_=function(e){this.state!==e&&this.gotoState_(e)},r.GluTesselator.prototype.gotoState_=function(e){while(this.state!==e)if(this.state<e)switch(this.state){case r.GluTesselator.tessState_.T_DORMANT:this.callErrorOrErrorData(r.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case r.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorOrErrorData(r.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state){case r.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorOrErrorData(r.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case r.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorOrErrorData(r.errorType.GLU_TESS_MISSING_END_POLYGON),this.makeDormant_()}},r.GluTesselator.prototype.addVertex_=function(e,t){var n=this.lastEdge_;n===null?(n=r.mesh.makeEdge(this.mesh),r.mesh.meshSplice(n,n.sym)):(r.mesh.splitEdge(n),n=n.lNext),n.org.data=t,n.org.coords[0]=e[0],n.org.coords[1]=e[1],n.org.coords[2]=e[2],n.winding=1,n.sym.winding=-1,this.lastEdge_=n},r.GluTesselator.prototype.cacheVertex_=function(e,t){var n=this.cache[this.cacheCount];n.data=t,n.coords[0]=e[0],n.coords[1]=e[1],n.coords[2]=e[2],++this.cacheCount},r.GluTesselator.prototype.emptyCache_=function(){this.mesh=new r.GluMesh;for(var e=0;e<this.cacheCount;e++){var t=this.cache[e];this.addVertex_(t.coords,t.data)}this.cacheCount=0,this.emptyCache=!1},r.GluTesselator.prototype.callBeginOrBeginData=function(e){this.callBeginData_?this.callBeginData_(e,this.polygonData_):this.callBegin_&&this.callBegin_(e)},r.GluTesselator.prototype.callVertexOrVertexData=function(e){this.callVertexData_?this.callVertexData_(e,this.polygonData_):this.callVertex_&&this.callVertex_(e)},r.GluTesselator.prototype.callEdgeFlagOrEdgeFlagData=function(e){this.callEdgeFlagData_?this.callEdgeFlagData_(e,this.polygonData_):this.callEdgeFlag_&&this.callEdgeFlag_(e)},r.GluTesselator.prototype.callEndOrEndData=function(){this.callEndData_?this.callEndData_(this.polygonData_):this.callEnd_&&this.callEnd_()},r.GluTesselator.prototype.callCombineOrCombineData=function(e,t,n){var r;return this.callCombineData_?r=this.callCombineData_(e,t,n,this.polygonData_):this.callCombine_&&(r=this.callCombine_(e,t,n)),r===undefined&&(r=null),r},r.GluTesselator.prototype.callErrorOrErrorData=function(e){this.callErrorData_?this.callErrorData_(e,this.polygonData_):this.callError_&&this.callError_(e)},r.GluFace=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.inside=!1},r.GluHalfEdge=function(e){this.next=e||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},r.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},r.GluHalfEdge.prototype.dst=function(){return this.sym.org},r.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},r.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},r.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},r.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},r.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},r.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},r.GluMesh=function(){this.vHead=new r.GluVertex,this.fHead=new r.GluFace,this.eHead=new r.GluHalfEdge,this.eHeadSym=new r.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},r.GluMesh.prototype.checkMesh=function(){if(!r.DEBUG)return;var e=this.fHead,t=this.vHead,n=this.eHead,i,s,o=e;for(o=e;(s=o.next)!==e;o=s){i=s.anEdge;do i=i.lNext;while(i!==s.anEdge)}var u,a=t;for(a=t;(u=a.next)!==t;a=u){i=u.anEdge;do i=i.oNext;while(i!==u.anEdge)}var f=n;for(f=n;(i=f.next)!==n;f=i);},r.GluVertex=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=null},r.PQHandleElem=function(){this.key=null,this.node=0},r.PQHandleElem.realloc=function(e,t){var n=new Array(t),i=0;if(e!==null)for(;i<e.length;i++)n[i]=e[i];for(;i<t;i++)n[i]=new r.PQHandleElem;return n},r.PQNode=function(){this.handle=0},r.PQNode.realloc=function(e,t){var n=new Array(t),i=0;if(e!==null)for(;i<e.length;i++)n[i]=e[i];for(;i<t;i++)n[i]=new r.PQNode;return n},r.PriorityQ=function(e){this.keys_=r.PriorityQ.prototype.PQKeyRealloc_(null,r.PriorityQ.INIT_SIZE_),this.order_=null,this.size_=0,this.max_=r.PriorityQ.INIT_SIZE_,this.initialized_=!1,this.leq_=e,this.heap_=new r.PriorityQHeap(this.leq_)},r.PriorityQ.INIT_SIZE_=32,r.PriorityQ.prototype.deleteQ=function(){this.heap_.deleteHeap(),this.heap_=null,this.order_=null,this.keys_=null},r.PriorityQ.prototype.init=function(){this.order_=[];for(var e=0;e<this.size_;e++)this.order_[e]=e;var t=function(e,t){return function(n,r){return t(e[n],e[r])?1:-1}}(this.keys_,this.leq_);this.order_.sort(t),this.max_=this.size_,this.initialized_=!0,this.heap_.init();if(r.DEBUG){var n=0,i=n+this.size_-1;for(e=n;e<i;++e);}},r.PriorityQ.prototype.insert=function(e){if(this.initialized_)return this.heap_.insert(e);var t=this.size_;return++this.size_>=this.max_&&(this.max_*=2,this.keys_=r.PriorityQ.prototype.PQKeyRealloc_(this.keys_,this.max_)),this.keys_[t]=e,-(t+1)},r.PriorityQ.prototype.PQKeyRealloc_=function(e,t){var n=new Array(t),r=0;if(e!==null)for(;r<e.length;r++)n[r]=e[r];for(;r<t;r++)n[r]=null;return n},r.PriorityQ.prototype.keyLessThan_=function(e,t){var n=this.keys_[e],r=this.keys_[t];return!this.leq_(r,n)},r.PriorityQ.prototype.keyGreaterThan_=function(e,t){var n=this.keys_[e],r=this.keys_[t];return!this.leq_(n,r)},r.PriorityQ.prototype.extractMin=function(){if(this.size_===0)return this.heap_.extractMin();var e=this.keys_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var t=this.heap_.minimum();if(this.leq_(t,e))return this.heap_.extractMin()}do--this.size_;while(this.size_>0&&this.keys_[this.order_[this.size_-1]]===null);return e},r.PriorityQ.prototype.minimum=function(){if(this.size_===0)return this.heap_.minimum();var e=this.keys_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var t=this.heap_.minimum();if(this.leq_(t,e))return t}return e},r.PriorityQ.prototype.isEmpty_=function(){return this.size_===0&&this.heap_.isEmpty()},r.PriorityQ.prototype.remove=function(e){if(e>=0){this.heap_.remove(e);return}e=-(e+1),this.keys_[e]=null;while(this.size_>0&&this.keys_[this.order_[this.size_-1]]===null)--this.size_},r.PriorityQHeap=function(e){this.nodes_=r.PQNode.realloc(null,r.PriorityQHeap.INIT_SIZE_+1),this.handles_=r.PQHandleElem.realloc(null,r.PriorityQHeap.INIT_SIZE_+1),this.size_=0,this.max_=r.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.leq_=e,this.nodes_[1].handle=1},r.PriorityQHeap.INIT_SIZE_=32,r.PriorityQHeap.prototype.deleteHeap=function(){this.handles_=null,this.nodes_=null},r.PriorityQHeap.prototype.init=function(){for(var e=this.size_;e>=1;--e)this.floatDown_(e);this.initialized_=!0},r.PriorityQHeap.prototype.insert=function(e){var t=++this.size_;t*2>this.max_&&(this.max_*=2,this.nodes_=r.PQNode.realloc(this.nodes_,this.max_+1),this.handles_=r.PQHandleElem.realloc(this.handles_,this.max_+1));var n;return this.freeList_===0?n=t:(n=this.freeList_,this.freeList_=this.handles_[n].node),this.nodes_[t].handle=n,this.handles_[n].node=t,this.handles_[n].key=e,this.initialized_&&this.floatUp_(t),n},r.PriorityQHeap.prototype.isEmpty=function(){return this.size_===0},r.PriorityQHeap.prototype.minimum=function(){return this.handles_[this.nodes_[1].handle].key},r.PriorityQHeap.prototype.extractMin=function(){var e=this.nodes_,t=this.handles_,n=e[1].handle,r=t[n].key;return this.size_>0&&(e[1].handle=e[this.size_].handle,t[e[1].handle].node=1,t[n].key=null,t[n].node=this.freeList_,this.freeList_=n,--this.size_>0&&this.floatDown_(1)),r},r.PriorityQHeap.prototype.remove=function(e){var t=this.nodes_,n=this.handles_,r=n[e].node;t[r].handle=t[this.size_].handle,n[t[r].handle].node=r,r<=--this.size_&&(r<=1||this.leq_(n[t[r>>1].handle].key,n[t[r].handle].key)?this.floatDown_(r):this.floatUp_(r)),n[e].key=null,n[e].node=this.freeList_,this.freeList_=e},r.PriorityQHeap.prototype.floatDown_=function(e){var t=this.nodes_,n=this.handles_,r=t[e].handle;for(;;){var i=e<<1;i<this.size_&&this.leq_(n[t[i+1].handle].key,n[t[i].handle].key)&&++i;var s=t[i].handle;if(i>this.size_||this.leq_(n[r].key,n[s].key)){t[e].handle=r,n[r].node=e;break}t[e].handle=s,n[s].node=e,e=i}},r.PriorityQHeap.prototype.floatUp_=function(e){var t=this.nodes_,n=this.handles_,r=t[e].handle;for(;;){var i=e>>1,s=t[i].handle;if(i===0||this.leq_(n[s].key,n[r].key)){t[e].handle=r,n[r].node=e;break}t[e].handle=s,n[s].node=e,e=i}},r.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},r.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},r.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()},typeof module!="undefined"&&(module.exports=r),n("util/libtess",function(){}),n("shapes/Polygon",["../shapes/AbstractShape","../error/ArgumentError","../shaders/BasicTextureProgram","../geom/BoundingBox","../util/Color","../util/ImageSource","../geom/Location","../util/Logger","../geom/Matrix","../pick/PickedObject","../geom/Position","../shapes/ShapeAttributes","../shapes/SurfacePolygon","../geom/Vec2","../geom/Vec3","../util/libtess"],function(e,t,n,i,s,o,u,a,f,l,c,h,p,d,v,m){"use strict";var g=function(n,r){if(!n)throw new t(a.logMessage(a.LEVEL_SEVERE,"Polygon","constructor","missingBoundaries"));e.call(this,r),n.length>0&&n[0].latitude&&(n=[n],this._boundariesSpecifiedSimply=!0),this._boundaries=n,this._textureCoordinates=null,this.referencePosition=this.determineReferencePosition(this._boundaries),this._extrude=!1,this.scratchPoint=new v(0,0,0)};return g.prototype=Object.create(e.prototype),Object.defineProperties(g.prototype,{boundaries:{get:function(){return this._boundariesSpecifiedSimply?this._boundaries[0]:this._boundaries},set:function(e){if(!e)throw new t(a.logMessage(a.LEVEL_SEVERE,"Polygon","boundaries","missingBoundaries"));e.length>0&&e[0].latitude&&(e=[e],this._boundariesSpecifiedSimply=!0),this._boundaries=e,this.referencePosition=this.determineReferencePosition(this._boundaries),this.reset()}},textureCoordinates:{get:function(){return this._textureCoordinates},set:function(e){this._textureCoordinates=e,this.reset()}},extrude:{get:function(){return this._extrude},set:function(e){this._extrude=e,this.reset()}}}),g.prototype.determineReferencePosition=function(e){return e.length>0&&e[0].length>2?e[0][0]:null},g.prototype.mustGenerateGeometry=function(e){return this.currentData.boundaryPoints?this.currentData.drawInterior!==this.activeAttributes.drawInterior?!0:this.altitudeMode===WorldWind.ABSOLUTE?!1:this.currentData.isExpired:!0},g.prototype.hasCapTexture=function(){return this.textureCoordinates&&this.capImageSource()},g.prototype.capImageSource=function(){return this.activeAttributes.imageSource?typeof this.activeAttributes.imageSource=="string"||this.activeAttributes.imageSource instanceof o?this.activeAttributes.imageSource:Array.isArray(this.activeAttributes.imageSource)&&this.activeAttributes.imageSource[0]&&(typeof this.activeAttributes.imageSource[0]=="string"||this.activeAttributes.imageSource instanceof o)?this.activeAttributes.imageSource[0]:null:null},g.prototype.hasSideTextures=function(){return this.activeAttributes.imageSource&&Array.isArray(this.activeAttributes.imageSource)&&this.activeAttributes.imageSource.length>1},g.prototype.sideImageSource=function(e){if(e===0||this.activeAttributes.imageSource.length===2)return this.activeAttributes.imageSource[1];var t=this.activeAttributes.imageSource.length-1;return e=Math.min(e+1,t),this.activeAttributes.imageSource[e]},g.prototype.createSurfaceShape=function(){return new p(this.boundaries,null)},g.prototype.doMakeOrderedRenderable=function(e){if(!this.referencePosition)return null;if(!this.activeAttributes.drawInterior&&!this.activeAttributes.drawOutline)return null;if(!this.mustGenerateGeometry(e))return this;var t=this.currentData,n=t.referencePoint;e.surfacePointForMode(this.referencePosition.latitude,this.referencePosition.longitude,this.referencePosition.altitude,this._altitudeMode,n),t.transformationMatrix.setToTranslation(n[0],n[1],n[2]);var r=[];for(var s=0;s<this._boundaries.length;s++)r[s]=this._boundaries[s].slice(0),r[s].push(this._boundaries[s][0]);var o=this.computeBoundaryPoints(e,r);if(this.activeAttributes.drawInterior){var u=this.tessellatePolygon(e,o);if(u){t.capTriangles=new Float32Array(u.length);for(var a=0,f=u.length;a<f;a++)t.capTriangles[a]=u[a]}}t.boundaryPoints=o,t.drawInterior=this.activeAttributes.drawInterior,this.resetExpiration(t),t.refreshBuffers=!0,t.extent||(t.extent=new i);if(o.length===1)t.extent.setToPoints(o[0]);else{var l=[];for(s=0;s<o.length;s++)for(var c=0;c<o[s].length;c++)l.push(o[s][c]);t.extent.setToPoints(l)}return t.extent.translate(t.referencePoint),this},g.prototype.computeBoundaryPoints=function(e,t){var n=Number.MAX_VALUE,r=e.navigatorState.eyePoint,i=[],s=this._extrude?6:3,o=new v(0,0,0),u,a,f,l;for(var c=0;c<t.length;c++){u=(this._extrude?2:1)*t[c].length,i[c]=new Float32Array(u*3);for(var h=0,p=t[c].length;h<p;h++)a=t[c][h],e.surfacePointForMode(a.latitude,a.longitude,a.altitude,this.altitudeMode,o),l=o.distanceToSquared(r),l<n&&(n=l),o.subtract(this.currentData.referencePoint),f=s*h,i[c][f]=o[0],i[c][f+1]=o[1],i[c][f+2]=o[2],this._extrude&&(e.surfacePointForMode(a.latitude,a.longitude,0,WorldWind.CLAMP_TO_GROUND,o),l=o.distanceToSquared(r),l<n&&(n=l),o.subtract(this.currentData.referencePoint),i[c][f+3]=o[0],i[c][f+4]=o[1],i[c][f+5]=o[2])}return this.currentData.eyeDistance=Math.sqrt(n),i},g.prototype.tessellatePolygon=function(e,t){var n=[],i=0,s=this._extrude?6:3,o=this.hasCapTexture(),u,f;this.polygonTessellator||(this.polygonTessellator=new r.GluTesselator,this.polygonTessellator.gluTessCallback(r.gluEnum.GLU_TESS_VERTEX_DATA,function(e,t){t[t.length]=e[0],t[t.length]=e[1],t[t.length]=e[2],o&&(t[t.length]=e[3],t[t.length]=e[4])}),this.polygonTessellator.gluTessCallback(r.gluEnum.GLU_TESS_COMBINE,function(e,t,n){var r=[e[0],e[1],e[2]];if(o)for(var i=3;i<=4;i++){var s=0;for(var u=0;u<4;u++)n[u]>0&&(s+=n[u]*t[u][i]);r[i]=s}return r}),this.polygonTessellator.gluTessCallback(r.gluEnum.GLU_TESS_ERROR,function(e){i=e,a.logMessage(a.LEVEL_WARNING,"Polygon","tessellatePolygon","Tessellation error "+e+".")})),f=v.computeBufferNormal(t[0],s),f||(f=new v(0,0,0),e.globe.surfaceNormalAtLocation(this.referencePosition.latitude,this.referencePosition.longitude,f)),this.polygonTessellator.gluTessNormal(f[0],f[1],f[2]),this.polygonTessellator.gluTessBeginPolygon(n);for(var l=0;l<t.length;l++){var c=0;this.polygonTessellator.gluTessBeginContour();var h=t[l];for(var p=0;p<h.length;p+=s)u=[h[p],h[p+1],h[p+2]],o&&(c<this.textureCoordinates[l].length?(u[3]=this.textureCoordinates[l][c][0],u[4]=this.textureCoordinates[l][c][1]):(u[3]=this.textureCoordinates[l][0][0],u[4]=this.textureCoordinates[l][1][1]),++c),this.polygonTessellator.gluTessVertex(u,u);this.polygonTessellator.gluTessEndContour()}return this.polygonTessellator.gluTessEndPolygon(),i===0?n:null},g.prototype.mustDrawVerticals=function(e){return this._extrude&&this.activeAttributes.drawOutline&&this.activeAttributes.drawVerticals&&this.altitudeMode!==WorldWind.CLAMP_TO_GROUND},g.prototype.doRenderOrdered=function(e){var t=e.currentGlContext,n=e.currentProgram,r=this.currentData,i=r.refreshBuffers,s=this.hasCapTexture(),o=this.hasSideTextures(),u,a,f,c,h,p,d,v;e.pickingMode&&(h=e.uniquePickColor()),n.loadTextureEnabled(t,!1),this.activeAttributes.drawInterior&&r.capTriangles&&r.capTriangles.length>0&&(this.applyMvpMatrix(e),r.capVboCacheKey||(r.capVboCacheKey=e.gpuResourceCache.generateCacheKey()),a=e.gpuResourceCache.resourceForKey(r.capVboCacheKey),a||(a=t.createBuffer(),e.gpuResourceCache.putResource(r.capVboCacheKey,a,r.capTriangles.length*4),i=!0),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,a),i&&(t.bufferData(WebGLRenderingContext.ARRAY_BUFFER,r.capTriangles,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1)),c=this.activeAttributes.interiorColor,f=c.alpha*e.currentLayer.opacity,t.depthMask(f>=1||e.pickingMode),n.loadColor(t,e.pickingMode?h:c),n.loadOpacity(t,e.pickingMode?f>0?1:0:f),p=s?20:12,s&&!e.pickingMode&&(this.activeTexture=e.gpuResourceCache.resourceForKey(this.capImageSource()),this.activeTexture||(this.activeTexture=e.gpuResourceCache.retrieveTexture(e.currentGlContext,this.capImageSource())),v=this.activeTexture&&this.activeTexture.bind(e),v&&(n.loadTextureEnabled(t,!0),t.enableVertexAttribArray(n.vertexTexCoordLocation),t.vertexAttribPointer(n.vertexTexCoordLocation,2,WebGLRenderingContext.FLOAT,!1,p,12),n.loadTextureUnit(t,WebGLRenderingContext.TEXTURE0),n.loadModulateColor(t,e.pickingMode))),t.vertexAttribPointer(n.vertexPointLocation,3,WebGLRenderingContext.FLOAT,!1,p,0),t.drawArrays(WebGLRenderingContext.TRIANGLES,0,4*(r.capTriangles.length/p)));if(this._extrude&&this.activeAttributes.drawInterior||this.activeAttributes.drawOutline){r.boundaryVboCacheKeys||(this.currentData.boundaryVboCacheKeys=[]),n.loadTextureEnabled(t,!1),t.disableVertexAttribArray(n.vertexTexCoordLocation);for(var m=0;m<r.boundaryPoints.length;m++)u=r.boundaryPoints[m].length/3,r.boundaryVboCacheKeys[m]||(r.boundaryVboCacheKeys[m]=e.gpuResourceCache.generateCacheKey()),a=e.gpuResourceCache.resourceForKey(r.boundaryVboCacheKeys[m]),a||(a=t.createBuffer(),e.gpuResourceCache.putResource(r.boundaryVboCacheKeys[m],a,u*12),i=!0),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,a),i&&(t.bufferData(WebGLRenderingContext.ARRAY_BUFFER,r.boundaryPoints[m],WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1)),this.activeAttributes.drawInterior&&this._extrude&&(!o||e.pickingMode)&&(this.applyMvpMatrix(e),c=this.activeAttributes.interiorColor,f=c.alpha*e.currentLayer.opacity,t.depthMask(f>=1||e.pickingMode),n.loadColor(t,e.pickingMode?h:c),n.loadOpacity(t,e.pickingMode?f>0?1:0:f),t.vertexAttribPointer(n.vertexPointLocation,3,WebGLRenderingContext.FLOAT,!1,0,0),t.drawArrays(WebGLRenderingContext.TRIANGLE_STRIP,0,u)),this.activeAttributes.drawOutline&&(this.applyMvpMatrixForOutline(e),n.loadTextureEnabled(t,!1),c=this.activeAttributes.outlineColor,f=c.alpha*e.currentLayer.opacity,t.depthMask(f>=1||e.pickingMode),n.loadColor(t,e.pickingMode?h:c),n.loadOpacity(t,e.pickingMode?1:f),t.lineWidth(this.activeAttributes.outlineWidth),this._extrude?(p=24,d=u/2):(p=12,d=u),t.vertexAttribPointer(n.vertexPointLocation,3,WebGLRenderingContext.FLOAT,!1,p,0),t.drawArrays(WebGLRenderingContext.LINE_STRIP,0,d),this.mustDrawVerticals(e)&&(t.vertexAttribPointer(n.vertexPointLocation,3,WebGLRenderingContext.FLOAT,!1,0,0),t.drawArrays(WebGLRenderingContext.LINES,0,u-2)));r.refreshBuffers=!1;if(o&&this.activeAttributes.drawInterior&&this._extrude&&!e.pickingMode){this.applyMvpMatrix(e),c=this.activeAttributes.interiorColor,f=c.alpha*e.currentLayer.opacity,t.depthMask(f>=1||e.pickingMode),n.loadColor(t,e.pickingMode?h:c),n.loadOpacity(t,e.pickingMode?f>0?1:0:f),t.bindBuffer(WebGLRenderingContext.ARRAY_BUFFER,t.createBuffer());var g=new Float32Array(20);for(m=0;m<r.boundaryPoints.length;m++){u=r.boundaryPoints[m].length/3;var y=r.boundaryPoints[m].length/6-1,b=r.boundaryPoints[m];for(var w=0;w<y;w++){var E=this.sideImageSource(w),S=e.gpuResourceCache.resourceForKey(E);E&&!S&&(S=e.gpuResourceCache.retrieveTexture(e.currentGlContext,E)),v=S&&S.bind(e),v?(n.loadTextureEnabled(t,!0),n.loadTextureUnit(t,WebGLRenderingContext.TEXTURE0),t.enableVertexAttribArray(n.vertexTexCoordLocation)):(n.loadTextureEnabled(t,!1),t.disableVertexAttribArray(n.vertexTexCoordLocation)),g[0]=b[w*6],g[1]=b[w*6+1],g[2]=b[w*6+2],g[3]=0,g[4]=1,g[5]=b[w*6+3],g[6]=b[w*6+4],g[7]=b[w*6+5],g[8]=0,g[9]=0,g[10]=b[w*6+6],g[11]=b[w*6+7],g[12]=b[w*6+8],g[13]=1,g[14]=1,g[15]=b[w*6+9],g[16]=b[w*6+10],g[17]=b[w*6+11],g[18]=1,g[19]=0,t.bufferData(WebGLRenderingContext.ARRAY_BUFFER,g,WebGLRenderingContext.STATIC_DRAW),e.frameStatistics.incrementVboLoadCount(1),t.vertexAttribPointer(n.vertexTexCoordLocation,2,WebGLRenderingContext.FLOAT,!1,20,12),t.vertexAttribPointer(n.vertexPointLocation,3,WebGLRenderingContext.FLOAT,!1,20,0),t.drawArrays(WebGLRenderingContext.TRIANGLE_STRIP,0,4)}}}}if(e.pickingMode){var x=new l(h,this.pickDelegate?this.pickDelegate:this,null,e.currentLayer,!1);e.resolvePick(x)}},g.prototype.beginDrawing=function(e){var t=e.currentGlContext;this.activeAttributes.drawInterior&&t.disable(WebGLRenderingContext.CULL_FACE),e.findAndBindProgram(n),t.enableVertexAttribArray(e.currentProgram.vertexPointLocation)},g.prototype.endDrawing=function(e){var t=e.currentGlContext;t.disableVertexAttribArray(e.currentProgram.vertexPointLocation),e.bindProgram(null),t.depthMask(!0),t.lineWidth(1),t.enable(WebGLRenderingContext.CULL_FACE)},g}),n("projections/ProjectionMercator",["../geom/Angle","../error/ArgumentError","../projections/GeographicProjection","../util/Logger","../geom/Sector","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o){"use strict";var u=function(){n.call(this,"Mercator",!0,new i(-78,78,-180,180))};return u.prototype=Object.create(n.prototype),u.prototype.geographicToCartesian=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesian","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesian","missingResult"));i>this.projectionLimits.maxLatitude&&(i=this.projectionLimits.maxLatitude),i<this.projectionLimits.minLatitude&&(i=this.projectionLimits.minLatitude);var f=Math.sqrt(n.eccentricitySquared),l=Math.sin(i*e.DEGREES_TO_RADIANS),c=(1+l)/(1-l)*Math.pow((1-f*l)/(1+f*l),f);return a[0]=n.equatorialRadius*s*e.DEGREES_TO_RADIANS+(u?u[0]:0),a[1]=.5*n.equatorialRadius*Math.log(c),a[2]=o,a},Object.defineProperties(u.prototype,{stateKey:{get:function(){return"projection mercator "}}}),u.prototype.geographicToCartesianGrid=function(n,i,u,a,f,l,c,h){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesianGrid","missingGlobe"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesianGrid","missingSector"));if(!f||f.length<u*a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesianGrid","The specified elevations array is null, undefined or insufficient length"));if(!h)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","geographicToCartesianGrid","missingResult"));var p=n.equatorialRadius,d=Math.sqrt(n.eccentricitySquared),v=i.minLatitude*e.DEGREES_TO_RADIANS,m=i.maxLatitude*e.DEGREES_TO_RADIANS,g=i.minLongitude*e.DEGREES_TO_RADIANS,y=i.maxLongitude*e.DEGREES_TO_RADIANS,b=(m-v)/(u>1?u-1:1),w=(y-g)/(a>1?a-1:1),E=this.projectionLimits.minLatitude*e.DEGREES_TO_RADIANS,S=this.projectionLimits.maxLatitude*e.DEGREES_TO_RADIANS,x=l?l:new s(0,0,0),T=c?c[0]:0,N,C,k=0,L=0,A,O,M,_,D,P;for(N=0,A=v;N<u;N++,A+=b){N===u-1&&(A=m),M=o.clamp(A,E,S),_=Math.sin(M),D=(1+_)/(1-_)*Math.pow((1-d*_)/(1+d*_),d),P=p*Math.log(D)*.5-x[1];for(C=0,O=g;C<a;C++,O+=w)C===a-1&&(O=y),h[L++]=p*O-x[0]+T,h[L++]=P,h[L++]=f[k++]-x[2]}return h},u.prototype.cartesianToGeographic=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","cartesianToGeographic","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionMercator","cartesianToGeographic","missingResult"));var f=n.eccentricitySquared,l=f*f,c=l*f,h=c*f,p=Math.pow(Math.E,-s/n.equatorialRadius),d=Math.PI/2-2*Math.atan(p),v=f/2+5*l/24+c/12+13*h/360,m=7*l/48+29*c/240+811*h/11520,g=7*c/120+81*h/1120,y=4279*h/161280,b=d-m+y,w=v-3*g,E=2*m-8*y,S=4*g,x=8*y,T=Math.sin(2*d),N=b+T*(w+T*(E+T*(S+x*T)));return a.latitude=N*e.RADIANS_TO_DEGREES,a.longitude=(i-(u?u[0]:0))/n.equatorialRadius*e.RADIANS_TO_DEGREES,a.altitude=o,a},u}),n("projections/ProjectionPolarEquidistant",["../geom/Angle","../error/ArgumentError","../projections/GeographicProjection","../util/Logger"],function(e,t,n,r){"use strict";var i=function(e){n.call(this,"Polar Equidistant",!1,null),this._pole=e,this.north=e!=="South",this.displayName=this.north?"North Polar":"South Polar",this._stateKey="projection polar equidistant "+this._pole+" "};return i.prototype=Object.create(n.prototype),Object.defineProperties(i.prototype,{pole:{get:function(){return this._pole},set:function(e){this._pole=e,this.north=this._pole!=="South",this._stateKey="projection polar equidistant "+this._pole+" "}},stateKey:{get:function(){return this._stateKey}}}),i.prototype.geographicToCartesian=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesian","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesian","missingResult"));if(this.north&&i===90||!this.north&&i===-90)a[0]=0,a[1]=0,a[2]=o;else{var f=this.north?-1:1,l=n.equatorialRadius*(Math.PI/2+i*e.DEGREES_TO_RADIANS*f);a[0]=l*Math.sin(s*e.DEGREES_TO_RADIANS),a[1]=l*Math.cos(s*e.DEGREES_TO_RADIANS)*f,a[2]=o}return a},i.prototype.geographicToCartesianGrid=function(n,i,s,o,u,a,f,l){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesianGrid","missingGlobe"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesianGrid","missingSector"));if(!u||u.length<s*o)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesianGrid","The specified elevations array is null, undefined or insufficient length"));if(!l)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","geographicToCartesianGrid","missingResult"));var c=n.equatorialRadius,h=i.minLatitude*e.DEGREES_TO_RADIANS,p=i.maxLatitude*e.DEGREES_TO_RADIANS,d=i.minLongitude*e.DEGREES_TO_RADIANS,v=i.maxLongitude*e.DEGREES_TO_RADIANS,m=(p-h)/(s>1?s-1:1),g=(v-d)/(o>1?o-1:1),y=this.north?-1:1,b=a?a:new Vec3(0,0,0),w=Math.PI/2,E,S,x=0,T=0,N=new Float64Array(o),C=new Float64Array(o),k,L,A;for(S=0,L=d;S<o;S++,L+=g)S===o-1&&(L=v),N[S]=Math.cos(L),C[S]=Math.sin(L);for(E=0,k=h;E<s;E++,k+=m){E===s-1&&(k=p),A=c*(w+k*y);if(this.north&&k===w||!this.north&&k===-w)A=0;for(S=0;S<o;S++)l[T++]=A*C[S]-b[0],l[T++]=A*N[S]*y-b[1],l[T++]=u[x++]-b[2]}return l},i.prototype.cartesianToGeographic=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","cartesianToGeographic","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","cartesianToGeographic","missingResult"));var f=Math.sqrt(i*i+s*s),l;return f<1e-4?(a.latitude=this.north?90:-90,a.longitude=0,a.altitude=o):(l=f/n.equatorialRadius,l>Math.PI&&(l=Math.PI),a.latitude=Math.asin(Math.cos(l)*(this.north?1:-1))*e.RADIANS_TO_DEGREES,a.longitude=Math.atan2(i,s*(this.north?-1:1))*e.RADIANS_TO_DEGREES,a.altitude=o),a},i.prototype.northTangentAtLocation=function(n,i,s,o){if(!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","northTangentAtLocation","missingResult"));return o[0]=Math.sin(s*e.DEGREES_TO_RADIANS)*(this.north?-1:1),o[1]=Math.cos(s*e.DEGREES_TO_RADIANS),o[2]=0,o},i.prototype.northTangentAtPoint=function(e,n,i,s,o,u){if(!u)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","northTangentAtLocation","missingResult"));var a=Math.sqrt(n*n+i*i);return a<1e-4?(u[0]=0,u[1]=1,u[2]=0):(u[0]=n/a*(this.north?-1:1),u[1]=i/a*(this.north?-1:1),u[2]=0),u},i}),n("projections/ProjectionUPS",["../geom/Angle","../error/ArgumentError","../projections/GeographicProjection","../util/Logger","../geom/Sector","../geom/Vec3","../util/WWMath"],function(e,t,n,r,i,s,o){"use strict";var u=function(e){this.north=e!=="South";var t=this.north?new i(0,90,-180,180):new i(-90,0,-180,180);n.call(this,"Uniform Polar Stereographic",!1,t),this._pole=e,this.displayName=this.north?"North UPS":"South UPS",this._stateKey="projection ups "+this._pole+" "};return u.prototype=Object.create(n.prototype),Object.defineProperties(u.prototype,{pole:{get:function(){return this._pole},set:function(e){this._pole=e,this.north=this._pole!=="South",this.projectionLimits=this.north?new i(0,90,-180,180):new i(-90,0,-180,180),this._stateKey="projection ups "+this._pole+" "}},stateKey:{get:function(){return this._stateKey}}}),u.prototype.geographicToCartesian=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesian","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesian","missingResult"));if(this.north&&i===90||!this.north&&i===-90)a[0]=0,a[1]=0,a[2]=o;else{var f=this.north?1:-1,l=i*e.DEGREES_TO_RADIANS,c=s*e.DEGREES_TO_RADIANS,h=.994,p=Math.sqrt(n.eccentricitySquared),d=Math.sqrt(Math.pow(1+p,1+p)*Math.pow(1-p,1-p)),v,m,g;if(this.north&&l<0||!this.north&&l>0)l=0;v=Math.sin(l*f),m=Math.sqrt((1-v)/(1+v)*Math.pow((1+p*v)/(1-p*v),p)),g=2*n.equatorialRadius*h*m/d,a[0]=g*Math.sin(c),a[1]=-g*Math.cos(c)*f,a[2]=o}return a},u.prototype.geographicToCartesianGrid=function(n,i,u,a,f,l,c,h){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesianGrid","missingGlobe"));if(!i)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesianGrid","missingSector"));if(!f||f.length<u*a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesianGrid","The specified elevations array is null, undefined or insufficient length"));if(!h)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","geographicToCartesianGrid","missingResult"));var p=n.equatorialRadius,d=i.minLatitude*e.DEGREES_TO_RADIANS,v=i.maxLatitude*e.DEGREES_TO_RADIANS,m=i.minLongitude*e.DEGREES_TO_RADIANS,g=i.maxLongitude*e.DEGREES_TO_RADIANS,y=(v-d)/(u>1?u-1:1),b=(g-m)/(a>1?a-1:1),w=this.projectionLimits.minLatitude*e.DEGREES_TO_RADIANS,E=this.projectionLimits.maxLatitude*e.DEGREES_TO_RADIANS,S=.994,x=Math.sqrt(n.eccentricitySquared),T=Math.sqrt(Math.pow(1+x,1+x)*Math.pow(1-x,1-x)),N=this.north?1:-1,C=l?l:new s(0,0,0),k,L,A=0,O=0,M,_,D,P,H,B;for(k=0,M=d;k<u;k++,M+=y){k===u-1&&(M=v),D=o.clamp(M,w,E),P=Math.sin(D*N),H=Math.sqrt((1-P)/(1+P)*Math.pow((1+x*P)/(1-x*P),x)),B=2*p*S*H/T;for(L=0,_=m;L<a;L++,_+=b)L===a-1&&(_=g),h[O++]=B*Math.sin(_)-C[0],h[O++]=-B*Math.cos(_)*N-C[1],h[O++]=f[A++]-C[2]}return h},u.prototype.cartesianToGeographic=function(n,i,s,o,u,a){if(!n)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","cartesianToGeographic","missingGlobe"));if(!a)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","cartesianToGeographic","missingResult"));var f=Math.atan2(i,s*(this.north?-1:1)),l=.994,c=Math.sqrt(n.eccentricitySquared),h=Math.sqrt(i*i+s*s),p=Math.sqrt(Math.pow(1+c,1+c)*Math.pow(1-c,1-c)),d=h*p/(2*n.equatorialRadius*l),v=n.eccentricitySquared,m=v*v,g=m*v,y=g*v,b=Math.PI/2-2*Math.atan(d),w=v/2+5*m/24+g/12+13*y/360,E=7*m/48+29*g/240+811*y/11520,S=7*g/120+81*y/1120,x=4279*y/161280,T=b-E+x,N=w-3*S,C=2*E-8*x,k=4*S,L=8*x,A=Math.sin(2*b),O=T+A*(N+A*(C+A*(k+L*A)));return O*=this.north?1:-1,a.latitude=O*e.RADIANS_TO_DEGREES,a.longitude=f*e.RADIANS_TO_DEGREES,a.altitude=o,a},u.prototype.northTangentAtLocation=function(n,i,s,o){if(!o)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionUPS","northTangentAtLocation","missingResult"));return o[0]=Math.sin(s*e.DEGREES_TO_RADIANS)*(this.north?-1:1),o[1]=Math.cos(s*e.DEGREES_TO_RADIANS),o[2]=0,o},u.prototype.northTangentAtPoint=function(e,n,i,s,o,u){if(!u)throw new t(r.logMessage(r.LEVEL_SEVERE,"ProjectionPolarEquidistant","northTangentAtLocation","missingResult"));var a=Math.sqrt(n*n+i*i);return a<1e-4?(u[0]=0,u[1]=1,u[2]=0):(u[0]=n/a*(this.north?-1:1),u[1]=i/a*(this.north?-1:1),u[2]=0),u},u}),n("util/ByteBuffer",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(r){if(!r)throw new e(t.logMessage(t.LEVEL_SEVERE,"ByteBuffer","constructor","missingArray"));this.array=r,this.data=new DataView(r),this.position=0,this._order=n.LITTLE_ENDIAN};return n.prototype.getByte=function(){var e=this.data.getUint8(this.position);return this.position+=n.BYTE_SIZE,e},n.prototype.getByteArray=function(e){var t=new Uint8Array(this.array,this.position,e);return this.position+=n.BYTE_SIZE*e,t},n.prototype.getInt16=function(){var e=this.data.getInt16(this.position,this._order);return this.position+=n.INT16_SIZE,e},n.prototype.getInt16Array=function(e){var t=new Int16Array(this.array,this.position,e);return this.position+=n.INT16_SIZE*e,t},n.prototype.getInt32=function(){var e=this.data.getInt32(this.position,this._order);return this.position+=n.INT32_SIZE,e},n.prototype.getInt32Array=function(e){var t=new Int32Array(this.array,this.position,e);return this.position+=n.INT32_SIZE*e,t},n.prototype.getFloat=function(){var e=this.data.getFloat32(this.position,this._order);return this.position+=n.FLOAT_SIZE,e},n.prototype.getFloatArray=function(e){var t=new Float32Array(this.array,this.position,e);return this.position+=n.FLOAT_SIZE*e,t},n.prototype.getDouble=function(){var e=this.data.getFloat64(this.position,this._order);return this.position+=n.DOUBLE_SIZE,e},n.prototype.getDoubleArray=function(e){var t;if(this.position%8!=0){var r=this.array.slice(this.position,this.position+e*n.DOUBLE_SIZE);t=new Float64Array(r)}else t=new Float64Array(this.array,this.position,e);return this.position+=n.DOUBLE_SIZE*e,t},n.prototype.skipBytes=function(e){this.position+=e*n.BYTE_SIZE},n.prototype.skipInt16s=function(e){this.position+=e*n.INT16_SIZE},n.prototype.skipInt32s=function(e){this.position+=e*n.INT32_SIZE},n.prototype.skipFloats=function(e){this.position+=e*n.FLOAT_SIZE},n.prototype.skipDoubles=function(e){this.position+=e*n.DOUBLE_SIZE},n.prototype.seek=function(e){this.position=e},n.prototype.order=function(e){this._order=e},n.prototype.limit=function(){return this.data.byteLength},n.prototype.hasRemaining=function(){return this.position<this.data.byteLength},n.BIG_ENDIAN=!1,n.LITTLE_ENDIAN=!0,n.BYTE_SIZE=1,n.INT16_SIZE=2,n.INT32_SIZE=4,n.FLOAT_SIZE=4,n.DOUBLE_SIZE=8,n}),n("formats/shapefile/DBaseField",["../../error/ArgumentError","../../util/ByteBuffer","../../formats/shapefile/DBaseFile","../../util/Logger"],function(e,t,n,r){"use strict";var i=function(t,n){if(!t)throw new e(r.logMessage(r.LEVEL_SEVERE,"DBaseField","constructor","missingAttributeName"));if(!n)throw new e(r.logMessage(r.LEVEL_SEVERE,"DBaseField","constructor","missingBuffer"));this.name=null,this.type=null,this.typeCode=-1,this.length=-1,this.decimals=-1,this.readFieldDescriptor(t,n)};return i.prototype.getName=function(){return this.name},i.prototype.getType=function(){return this.type},i.prototype.getLength=function(){return this.length},i.prototype.getDecimals=function(){return this.decimals},i.prototype.readFieldDescriptor=function(e,n){n.order(t.LITTLE_ENDIAN);var s=n.position;this.name=e.readNullTerminatedString(n,i.FIELD_NAME_LENGTH),n.seek(s+i.FIELD_NAME_LENGTH),this.typeCode=String.fromCharCode(n.getByte()),this.type=i.getFieldType(this.typeCode);if(this.type==null)throw new Error(r.log(r.LEVEL_SEVERE,"Shapefile dBase encountered unsupported field type: "+this.typeCode));n.skipBytes(4),this.length=n.getByte(),this.decimals=n.getByte(),n.seek(s+i.FIELD_DESCRIPTOR_LENGTH)},i.getFieldType=function(e){switch(e){case"C":return i.TYPE_CHAR;case"D":return i.TYPE_DATE;case"F":return i.TYPE_NUMBER;case"L":return i.TYPE_BOOLEAN;case"N":return i.TYPE_NUMBER;default:return null}},i.prototype.toString=function(){return this.name+"("+this.typeCode+")"},i.TYPE_CHAR="DBase.FieldTypeChar",i.TYPE_NUMBER="DBase.FieldTypeNumber",i.TYPE_DATE="DBase.FieldTypeDate",i.TYPE_BOOLEAN="DBase.FieldTypeBoolean",i.FIELD_NAME_LENGTH=11,i.FIELD_DESCRIPTOR_LENGTH=32,i}),n("formats/shapefile/DBaseRecord",["../../error/ArgumentError","../../util/ByteBuffer","../../formats/shapefile/DBaseField","../../formats/shapefile/DBaseFile","../../util/Logger"],function(e,t,n,r,i){"use strict";var s=function(t,n,r){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"DBaseRecord","constructor","missingAttributeName"));if(!n)throw new e(i.logMessage(i.LEVEL_SEVERE,"DBaseRecord","constructor","missingBuffer"));this.deleted=!1,this.recordNumber=r,this.values=null,this.readFromBuffer(t,n,r)};return s.prototype.isDeleted=function(){return this.deleted},s.prototype.getRecordNumber=function(){return this.recordNumber},s.prototype.readFromBuffer=function(e,r,s){r.order(t.LITTLE_ENDIAN),this.recordNumber=s;var o=r.getByte();this.deleted=o==42;var u=e.getFields();this.values={};for(var a=0,f=u.length;a<f;a+=1){var l=u[a],c=l.getName(),h=e.readNullTerminatedString(r,l.getLength()).trim();try{if(l.getType()==n.TYPE_BOOLEAN){var p=h.charAt(0);this.values[c]=p=="t"||p=="T"||p=="Y"||p=="y"}else l.getType()==n.TYPE_CHAR?this.values[c]=h:l.getType()==n.TYPE_DATE?this.values[c]=new Date(h):l.getType()==n.TYPE_NUMBER&&(this.values[c]=+h)}catch(d){i.log(i.LEVEL_WARNING,"Shapefile attribute parsing error:"+l.toString()+" -> "+h.toString()+" ["+d+"]")}}},s}),n("formats/shapefile/DBaseFile",["../../error/ArgumentError","../../util/ByteBuffer","../../formats/shapefile/DBaseField","../../formats/shapefile/DBaseRecord","../../util/Logger"],function(e,t,n,r,i){"use strict";var s=function(t){if(!t)throw new e(i.logMessage(i.LEVEL_SEVERE,"DBaseFile","constructor","missingUrl"));this.url=t,this.header=null,this.fields=null,this.buffer=null,this.boolean=!0,this.numRecordsRead=0,this._completionCallback=null};return s.prototype.getLastModificationDate=function(){return this.header.lastModificationDate},s.prototype.getNumberOfRecords=function(){return this.header.numberOfRecords},s.prototype.getHeaderLength=function(){return this.header.headerLength},s.prototype.getRecordLength=function(){return this.header.recordLength},s.prototype.getNumberOfFields=function(){return(this.header.headerLength-1-s.FIXED_HEADER_LENGTH)/s.FIELD_DESCRIPTOR_LENGTH},s.prototype.getFields=function(){return this.fields},s.prototype.hasNext=function(){return this.numRecordsRead<this.header.numberOfRecords},s.prototype.nextRecord=function(){return this.numRecordsRead>=this.getNumberOfRecords()?null:this.readNextRecord(this._buffer,this.numRecordsRead)},s.prototype.load=function(e){this._completionCallback=e,this.requestUrl(this.url)},s.prototype.requestUrl=function(e){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onreadystatechange=function(){n.readyState===4&&(n.status===200?(this._buffer=new t(n.response),this.parse(),!this._completionCallback||this._completionCallback(this)):(i.log(i.LEVEL_WARNING,"DBaseFile retrieval failed ("+n.statusText+"): "+e),!this._completionCallback||this._completionCallback(this)))}.bind(this),n.onerror=function(){i.log(i.LEVEL_WARNING,"DBaseFile retrieval failed: "+e),!this._completionCallback||this._completionCallback(this)},n.ontimeout=function(){i.log(i.LEVEL_WARNING,"DBaseFile retrieval timed out: "+e),!this._completionCallback||this._completionCallback(this)},n.send(null)},s.prototype.parse=function(){this.header=this.readHeader(this._buffer),this.fields=this.readFieldDescriptors(this._buffer,this.getNumberOfFields())},s.prototype.readHeader=function(e){var n=e.position;e.order(t.LITTLE_ENDIAN);var r=e.getByte();if(r>5)throw new Error("???");var i=e.getByte(),o=e.getByte(),u=e.getByte(),a=e.getInt32(),f=e.getInt16(),l=e.getInt16(),c={year:1900+i,month:o-1,day:u},h={fileCode:r,lastModificationDate:c,numberOfRecords:a,headerLength:f,recordLength:l};return e.seek(n+s.FIXED_HEADER_LENGTH),h},s.prototype.readFieldDescriptors=function(e,t){var r=e.position,i=[];for(var o=0;o<t;o+=1)i[o]=new n(this,e);var u=this.header.headerLength-s.FIXED_HEADER_LENGTH;return e.seek(r+u),i},s.prototype.readNextRecord=function(){return this.readRecordFromBuffer(this._buffer,++this.numRecordsRead)},s.prototype.readNextRecord=function(e,t){return new r(this,e,t)},s.prototype.readNullTerminatedString=function(e,t){if(t<=0)return 0;var n="";for(var r=0;r<t;r+=1){var i=e.getByte();if(i==0)break;n+=String.fromCharCode(i)}return this.isStringEmpty(n)?"":n},s.prototype.isStringEmpty=function(e){return e.length<=0||s.isStringFilled(e,32)||s.isStringFilled(e,42)},s.isStringFilled=function(e,t){if(e.length<=0)return!1;for(var n=0;n<e.length;n++)if(e.charAt(n)!=t)return!1;return!0},s.FIXED_HEADER_LENGTH=32,s.FIELD_DESCRIPTOR_LENGTH=32,s}),n("formats/shapefile/PrjFile",["../../error/ArgumentError","../../util/Logger","../../error/NotYetImplementedError"],function(e,t,n){"use strict";var r=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"DBaseFile","constructor","missingUrl"));this._url=n,this._completionCallback=null,this._params=null};return Object.defineProperties(r.prototype,{url:{get:function(){return this._url}},coordinateSystem:{get:function(){return this.params?this.params[r.COORDINATE_SYSTEM]:null}},params:{get:function(){return this._params}}}),r.prototype.load=function(e){this._completionCallback=e,this.requestUrl(this._url)},r.prototype.requestUrl=function(e){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onreadystatechange=function(){if(n.readyState===4){if(n.status===200){var r=String.fromCharCode.apply(null,new Uint8Array(n.response));this._params=this.decodeOGCCoordinateSystem(r)}else t.log(t.LEVEL_WARNING,"PrjFile retrieval failed ("+n.statusText+"): "+e);!this._completionCallback||this._completionCallback(this)}}.bind(this),n.onerror=function(){t.log(t.LEVEL_WARNING,"PrjFile retrieval failed: "+e),!this._completionCallback||this._completionCallback(this)}.bind(this),n.ontimeout=function(){t.log(t.LEVEL_WARNING,"PrjFile retrieval timed out: "+e),!this._completionCallback||this._completionCallback(this)}.bind(this),n.send(null)},r.prototype.decodeOGCCoordinateSystem=function(i){i||new e(t.logMessage(t.LEVEL_SEVERE,"PrjFile","decodeOGCCoordinateSystem","missingText"));var s={};i=i.trim().toUpperCase();if(r.GEOGCS_WKT_PATTERN.test(i))s[r.COORDINATE_SYSTEM]=r.COORDINATE_SYSTEM_GEOGRAPHIC;else{var o=i.match(r.PROJCS_WKT_PATTERN);if(!!o)throw s[PrfFile.COORDINATE_SYSTEM]=r.COORDINATE_SYSTEM_PROJECTED,new n(t.log(t.LEVEL_SEVERE,"PrjFile implementation  for projected coordinate systems in incomplete."));s[r.COORDINATE_SYSTEM]=r.COORDINATE_SYSTEM_UNKNOWN}return s},r.prototype.isUnknownCoordinateSystem=function(){return!this.params||this.params.coordinateSystem===r.COORDINATE_SYSTEM_UNKNOWN},r.prototype.isKnownCoordinateSystem=function(){return!!this.params&&this.params.coordinateSystem!==r.COORDINATE_SYSTEM_UNKNOWN},r.prototype.isGeographicCoordinateSystem=function(){return!!this.params&&this.params.coordinateSystem===r.COORDINATE_SYSTEM_GEOGRAPHIC},r.prototype.isProjectedCoordinateSystem=function(){return!!this.params&&this.params.coordinateSystem===r.COORDINATE_SYSTEM_PROJECTED},r.GEOGCS_WKT_PATTERN=new RegExp("\\{*GEOGCS[\\[\\(](.*)[\\]\\)]\\}*"),r.PROJCS_WKT_PATTERN=new RegExp("\\{*PROJCS[\\[\\(](.*)[\\]\\)]\\}*"),r.UTM_NAME_WKT_PATTERN=new RegExp(".*UTM.*ZONE.*?(\\d+).*?([\\w\\s]+).*?"),r.COORDINATE_SYSTEM="Coordinate_system",r.COORDINATE_SYSTEM_GEOGRAPHIC="Coordinate_system_geographic",r.COORDINATE_SYSTEM_PROJECTED="Coordinate_system_projected",r.COORDINATE_SYSTEM_UNKNOWN="Coordinate_system_unknown",r.PROJECTION_NAME="Projection_name",r.PROJECTION_UTM="Projection_UTM",r.PROJECTION_ZONE="Projection_zone",r.PROJECTION_HEMISPHERE="Projection_hemisphere",r.PROJECTION_HEMISPHERE_NORTH="Projection_hemisphere_north",r.PROJECTION_HEMISPHERE_SOUTH="Projection_hemisphere_south",r}),n("formats/shapefile/ShapefileRecord",["../../geom/Angle","../../error/ArgumentError","../../util/ByteBuffer","../../geom/Location","../../util/Logger","../../formats/shapefile/Shapefile"],function(e,t,n,r,i,s){"use strict";var o=function(e,n){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"ShapefileRecord","constructor","The specified shapefile is null or undefined"));if(!n)throw new t(i.logMessage(i.LEVEL_SEVERE,"ShapefileRecord","constructor","The specified buffer is null or undefined"));this._shapefile=e,this._recordNumber=-1,this._attributes={},this._numberOfParts=0,this._firstPartNumber=0,this._lastPartNumber=0,this._numberOfPoints=0,this._boundingRectangle=[],this._zRange=null,this._zValues=null,this._mRange=null,this._mValues=null,this._contentLengthInBytes=-1,this._buffer=n,this._isNormalized=!1,this._parts=[],this.readRecord()};return Object.defineProperties(o.prototype,{shapefile:{get:function(){return this._shapefile}},recordNumber:{get:function(){return this._recordNumber}},attributes:{get:function(){return this._attributes}},numberOfParts:{get:function(){return this._numberOfParts}},firstPartNumber:{get:function(){return this._firstPartNumber}},lastPartNumber:{get:function(){return this._lastPartNumber}},numberOfPoints:{get:function(){return this._numberOfPoints}},boundingRectangle:{get:function(){return this._boundingRectangle}},zRange:{get:function(){return this._zRange}},zValues:{get:function(){return this._zValues}},mRange:{get:function(){return this._mRange}},mValues:{get:function(){return this._mValues}}}),o.prototype.pointBuffer=function(e){return e>=0&&e<this._parts.length?this._parts[e]:null},o.prototype.readRecord=function(){this.readHeader(),this._buffer.order(n.LITTLE_ENDIAN);var e=this._buffer.getInt32(),t=this.shapefile.getShapeType(e);this.validateShapeType(t),this.readContents()},o.prototype.readHeader=function(){this._buffer.order(n.BIG_ENDIAN),this._recordNumber=this._buffer.getInt32(),this._contentLengthInBytes=this._buffer.getInt32()*2},o.prototype.validateShapeType=function(e){if(e!==this.shapefile.NULL&&e!==this.shapefile.shapeType)throw new Error(i.log(i.LEVEL_SEVERE,"Shapefile record is not supported."))},o.prototype.readNullContents=function(){this._numberOfParts=0,this._numberOfPoints=0,this._parts=null,this._boundingRectangle=null,this._buffer.seek(this._contentLengthInBytes-n.INT32_SIZE)},o.prototype.readPointContents=function(){this._numberOfParts=1,this._firstPartNumber=0,this._lastPartNumber=this._numberOfParts-1,this._numberOfPoints=1,this._parts=[this._buffer.getDoubleArray(2)];var e=this._parts[0][1],t=this._parts[0][0];this._boundingRectangle=[e,e,t,t],this.isZType()&&this.readZ(!0),this.isMeasureType()&&this.readOptionalMeasures(!0)},o.prototype.readPolylineContents=function(){var e=this.shapefile.readBoundingRectangle(this._buffer);this._boundingRectangle=e.coords,this._isNormalized=e.isNormalized,this._numberOfParts=this._buffer.getInt32(),this._firstPartNumber=0,this._lastPartNumber=this._numberOfParts-1,this._numberOfPoints=this._buffer.getInt32();if(this._numberOfParts>0&&this._numberOfPoints>0){var t=this._buffer.getInt32Array(this.numberOfParts);for(var n=0;n<this.numberOfParts;n+=1){var r=n==this.numberOfParts-1?this._numberOfPoints-t[n]:t[n+1]-t[n];this._parts[n]=this._buffer.getDoubleArray(r*2),o.normalizeLocations(this._parts[n])}}this.isZType()&&this.readZ(!1),this.isMeasureType()&&this.readOptionalMeasures(!1)},o.prototype.readMultiPointContents=function(){var e=this.shapefile.readBoundingRectangle(this._buffer);this._boundingRectangle=e.coords,this._isNormalized=e.isNormalized,this._numberOfParts=1,this._numberOfPoints=this._buffer.getInt32(),this._parts=[this._buffer.getDoubleArray(this._numberOfPoints*2)],o.normalizeLocations(this._parts[0]),this.isZType()&&this.readZ(!1),this.isMeasureType()&&this.readOptionalMeasures(!1)},o.prototype.readZ=function(e){if(e){this._zValues=this._buffer.getDoubleArray(1);var t=this._zValues[0];this._zRange=[t,t]}else this._zRange=this._buffer.getDoubleArray(2),this._zValues=this._buffer.getDoubleArray(this.numberOfPoints)},o.prototype.readOptionalMeasures=function(e){if(this._buffer.hasRemaining()&&this._buffer.limit()-this._buffer.position>=this.numberOfPoints*8)if(e){this._mValues=this._buffer.getDoubleArray(1);var t=this._mValues[0];this._mRange=[t,t]}else this._mRange=this._buffer.getDoubleArray(2),this._mValues=this._buffer.getDoubleArray(this.numberOfPoints)},o.normalizeLocations=function(t){for(var n=0,r=t.length;n<r;n+=2){var i=t[n],s=t[n+1];t[n]=e.normalizedDegreesLongitude(i),t[n+1]=e.normalizedDegreesLatitude(s)}},o.prototype.isPointType=function(){return this.shapefile.isPointType()},o.prototype.isMultiPointType=function(){return this.shapefile.isMultiPointType()},o.prototype.isPolylineType=function(){return this.shapefile.isPolylineType()},o.prototype.isPolygonType=function(){return this.shapefile.isPolygonType()},o.prototype.isZType=function(){return this.shapefile.isZType()},o.prototype.isMeasureType=function(){return this.shapefile.isMeasureType()},o.prototype.setAttributes=function(e){this._attributes=e},o.RECORD_HEADER_LENGTH=8,o}),n("formats/shapefile/ShapefileRecordMultiPoint",["../../util/ByteBuffer","../../formats/shapefile/Shapefile","../../formats/shapefile/ShapefileRecord"],function(e,t,n){"use strict";var r=function(e,t){n.call(this,e,t)};return r.prototype=Object.create(n.prototype),r.prototype.readContents=function(){this.readMultiPointContents()},r}),n("formats/shapefile/ShapefileRecordNull",["../../formats/shapefile/Shapefile","../../formats/shapefile/ShapefileRecord"],function(e,t){"use strict";var n=function(e,n){t.call(this,e,n)};return n.prototype=Object.create(t.prototype),n.prototype.readContents=function(){this.readNullContents()},n}),n("formats/shapefile/ShapefileRecordPoint",["../../formats/shapefile/Shapefile","../../formats/shapefile/ShapefileRecord"],function(e,t){"use strict";var n=function(e,n){t.call(this,e,n)};return n.prototype=Object.create(t.prototype),n.prototype.readContents=function(){this.readPointContents()},n}),n("formats/shapefile/ShapefileRecordPolygon",["../../formats/shapefile/Shapefile","../../formats/shapefile/ShapefileRecord"],function(e,t){"use strict";var n=function(e,n){t.call(this,e,n)};return n.prototype=Object.create(t.prototype),n.prototype.readContents=function(){this.readPolylineContents()},n}),n("formats/shapefile/ShapefileRecordPolyline",["../../formats/shapefile/Shapefile","../../formats/shapefile/ShapefileRecord"],function(e,t){"use strict";var n=function(e,n){t.call(this,e,n)};return n.prototype=Object.create(t.prototype),n.prototype.readContents=function(){this.readPolylineContents()},n}),n("formats/shapefile/Shapefile",["../../geom/Angle","../../error/ArgumentError","../../util/ByteBuffer","../../util/Color","../../formats/shapefile/DBaseFile","../../geom/Location","../../util/Logger","../../error/NotYetImplementedError","../../shapes/Path","../../shapes/Placemark","../../shapes/PlacemarkAttributes","../../shapes/Polygon","../../geom/Position","../../formats/shapefile/PrjFile","../../layer/RenderableLayer","../../shapes/ShapeAttributes","../../formats/shapefile/ShapefileRecord","../../formats/shapefile/ShapefileRecordMultiPoint","../../formats/shapefile/ShapefileRecordNull","../../formats/shapefile/ShapefileRecordPoint","../../formats/shapefile/ShapefileRecordPolygon","../../formats/shapefile/ShapefileRecordPolyline","../../shapes/SurfacePolygon","../../shapes/SurfacePolyline"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x){"use strict";var T=function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Shapefile","constructor","missingUrl"));this._url=e,this._shapeType=null,this._layer=null,this._shapeConfigurationCallback=this.defaultShapeConfigurationCallback,this._parserCompletionCallback=this.defaultParserCompletionCallback,this._buffer=null,this.attributeFile=new i(e.replace(".shp",".dbf")),this.projectionFile=new p(e.replace(".shp",".prj")),this.defaultPlacemarkAttributes=new l(null),this.defaultShapeAttributes=new v(null)};return Object.defineProperties(T.prototype,{url:{get:function(){return this._url}},shapeType:{get:function(){return this._shapeType}},layer:{get:function(){return this._layer}},parserCompletionCallback:{get:function(){return this._parserCompletionCallback}},shapeConfigurationCallback:{get:function(){return this._shapeConfigurationCallback}}}),T.prototype.load=function(e,t,n){e&&(this._parserCompletionCallback=e),t&&(this._shapeConfigurationCallback=t),this._layer=n||new d;var r=function(){var e=function(){this.requestUrl(this.url)}.bind(this);this.attributeFile.load(e)}.bind(this);this.projectionFile.load(r)},T.prototype.defaultParserCompletionCallback=function(e){this.addRenderablesForShapefile(this.layer)},T.prototype.defaultShapeConfigurationCallback=function(e,t){var n={},r=e.values.name||e.values.Name||e.values.NAME;r&&(n.name=r);if(t.isPointType())n.attributes=this.defaultPlacemarkAttributes;else if(t.isMultiPointType())n.attributes=this.defaultPlacemarkAttributes;else if(t.isPolylineType())n.attributes=this.defaultShapeAttributes;else if(t.isPolygonType()){n.attributes=this.defaultShapeAttributes;var i=e.values.height||e.values.Height||e.values.HEIGHT;i&&(n.height=i)}return n},T.prototype.addRenderablesForShapefile=function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Shapefile","addRenderablesForShapefile","missingLayer"));this.isPointType()?this.addRenderablesForPoints(e):this.isMultiPointType()?this.addRenderablesForMultiPoints(e):this.isPolylineType()?this.addRenderablesForPolylines(e):this.isPolygonType()&&this.addRenderablesForPolygons(e)},T.prototype.addRenderablesForPoints=function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Shapefile","addRenderablesForPoints","missingLayer"));for(var n=this.next();!!n;n=this.next()){var r=this.shapeConfigurationCallback(n.attributes,n),i=r&&r.altitude?r.altitude:0;if(!r)continue;for(var s=0,u=n.numberOfParts;s<u;s+=1){var a=n.pointBuffer(s);for(var l=0,c=a.length;l<c;l+=2){var p=a[l],d=a[l+1],v=new h(d,p,i),m=new f(v,!1,r.attributes);m.altitudeMode=r.altitudeMode||WorldWind.RELATIVE_TO_GROUND,r.highlightAttributes&&(m.highlightAttributes=r.highlightAttributes),r.name&&(m.label=r.name),e.addRenderable(m)}}}},T.prototype.addRenderablesForMultiPoints=function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Shapefile","addRenderablesForMultiPoints","missingLayer"));for(var n=this.next();!!n;n=this.next()){var r=this.shapeConfigurationCallback(n.attributes,n),i=r&&r.altitude?r.altitude:0;if(!r)continue;for(var s=0,u=n.numberOfParts;s<u;s+=1){var a=n.pointBuffer(s);for(var l=0,c=a.length;l<c;l+=2){var p=a[l],d=a[l+1],v=new h(d,p,i),m=new f(v,!1,r.attributes);m.altitudeMode=r.altitudeMode||WorldWind.RELATIVE_TO_GROUND,r.highlightAttributes&&(m.highlightAttributes=r.highlightAttributes),r.name&&(m.label=r.name),e.addRenderable(m)}}}},T.prototype.addRenderablesForPolylines=function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Shapefile","addRenderablesForPolylines","missingLayer"));for(var n=this.next();!!n;n=this.next()){var r=this.shapeConfigurationCallback(n.attributes,n),i=r&&r.altitude?r.altitude:0;if(!r)continue;for(var u=0,f=n.numberOfParts;u<f;u+=1){var l=n.pointBuffer(u),c=[];for(var p=0,d=l.length;p<d;p+=2){var v=l[p],m=l[p+1],g=i?new h(m,v,i):new s(m,v);c.push(g)}var y;i?(y=new a(c,r.attributes),y.altitudeMode=r.altitudeMode||WorldWind.RELATIVE_TO_GROUND):y=new x(c,r.attributes),r.highlightAttributes&&(y.highlightAttributes=r.highlightAttributes),r.name&&(y.displayName=r.name),e.addRenderable(y)}}},T.prototype.addRenderablesForPolygons=function(e){if(!e)throw new t(o.logMessage(o.LEVEL_SEVERE,"Shapefile","addRenderablesForPolygons","missingLayer"));for(var n=this.next();!!n;n=this.next()){var r=this.shapeConfigurationCallback(n.attributes,n),i=[],u,a=r.height,f=r.altitude;for(var l=0,p=n.numberOfParts;l<p;l+=1){var d=n.pointBuffer(l),v=[];for(var m=0,g=d.length-2;m<g;m+=2){var y=d[m],b=d[m+1];a?u=new h(b,y,a):f?u=new h(b,y,f):u=new s(b,y),v.push(u)}i.push(v)}var w;a?(w=new c(i,r.attributes),w.extrude=!0,w.altitudeMode=r.altitudeMode||WorldWind.RELATIVE_TO_GROUND):f?(w=new c(i,r.attributes),w.altitudeMode=r.altitudeMode||WorldWind.RELATIVE_TO_GROUND):w=new S(i,r.attributes),r.highlightAttributes&&(w.highlightAttributes=r.highlightAttributes),r.name&&(w.displayName=r.name),e.addRenderable(w)}},T.prototype.next=function(){while(this._buffer.position<this._buffer.limit()){var e=this.readRecord(this._buffer);if(!(e instanceof y))return e}return null},T.prototype.requestUrl=function(e){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onreadystatechange=function(){t.readyState===4&&(t.status===200?(this._buffer=new n(t.response),this.parse()):o.log(o.LEVEL_WARNING,"Shapefile retrieval failed ("+t.statusText+"): "+e),!this._parserCompletionCallback||this._parserCompletionCallback(this))}.bind(this),t.onerror=function(){o.log(o.LEVEL_WARNING,"Shapefile retrieval failed: "+e),!this._parserCompletionCallback||this._parserCompletionCallback(this)},t.ontimeout=function(){o.log(o.LEVEL_WARNING,"Shapefile retrieval timed out: "+e),!this._parserCompletionCallback||this._parserCompletionCallback(this)},t.send(null)},T.prototype.parse=function(){try{var e=this.readHeader(this._buffer);this._shapeType=e.shapeType}catch(t){console.log(t)}finally{}},T.prototype.readHeader=function(e){e.order(n.BIG_ENDIAN);var t=e.getInt32();if(t!=T.FILE_CODE)throw new Error(o.log(o.LEVEL_SEVERE,"Shapefile header is invalid"));e.skipInt32s(5);var r=e.getInt32();e.order(n.LITTLE_ENDIAN);var i=e.getInt32(),s=e.getInt32(),u=this.readBoundingRectangle(e),a=this.getShapeType(s);if(a==null)throw new Error(o.log(o.LEVEL_SEVERE,"Shapefile type is unsupported: "+s.toString()));var f={fileLength:r*2,version:i,shapeType:a,boundingRectangle:u.coords,normalizePoints:u.isNormalized};return e.skipDoubles(4),f},T.prototype.readBoundingRectangle=function(e){return this.projectionFile?this.projectionFile.isGeographicCoordinateSystem()?this.readGeographicBoundingRectangle(e):this.projectionFile.isProjectedCoordinateSystem()?this.readProjectedBoundingRectangle(e):this.readUnspecifiedBoundingRectangle(e):this.readUnspecifiedBoundingRectangle(e)},T.prototype.readUnspecifiedBoundingRectangle=function(e){var t=this.readBoundingRectangleCoordinates(e);return{coords:t,isNormalized:!1}},T.prototype.readGeographicBoundingRectangle=function(t){var n=this.readBoundingRectangleCoordinates(t),r=!1,i=0;n[0]<-90&&(i=e.normalizedDegreesLatitude(n[0]),n[0]=90,r=!0,n[1]<i&&(n[1]=i)),n[1]>90&&(i=e.normalizedDegreesLatitude(n[1]),n[1]=90,r=!0,n[0]>i&&(n[0]=i));if(n[2]<-180||n[3]>180)n[2]=-180,n[3]=180,r=!0;return{coords:n,isNormalized:r}},T.prototype.readProjectedBoundingRectangle=function(e){throw new u(o.log(o.LEVEL_SEVERE,"Shapefile.readProjectedBoundingRectangle() not yet implemented"))},T.prototype.readBoundingRectangleCoordinates=function(e){var t=e.getDouble(),n=e.getDouble(),r=e.getDouble(),i=e.getDouble();return[n,i,t,r]},T.prototype.readRecord=function(e){var t=this.createRecord(e);if(t!=null&&this.attributeFile!=null&&this.attributeFile.hasNext()){var n=this.attributeFile.nextRecord();t.setAttributes(n)}return t},T.prototype.createRecord=function(e){return this.isNullType()?this.createNull(e):this.isPointType()?this.createPoint(e):this.isMultiPointType()?this.createMultiPoint(e):this.isPolygonType()?this.createPolygon(e):this.isPolylineType()?this.createPolyline(e):null},T.prototype.createNull=function(e){return new y(this,e)},T.prototype.createPoint=function(e){return new b(this,e)},T.prototype.createMultiPoint=function(e){return new g(this,e)},T.prototype.createPolyline=function(e){return new E(this,e)},T.prototype.createPolygon=function(e){return new w(this,e)},T.prototype.getShapeType=function(e){switch(e){case 0:return T.NULL;case 1:return T.POINT;case 3:return T.POLYLINE;case 5:return T.POLYGON;case 8:return T.MULTI_POINT;case 11:return T.POINT_Z;case 13:return T.POLYLINE_Z;case 15:return T.POLYGON_Z;case 18:return T.MULTI_POINT_Z;case 21:return T.POINT_M;case 23:return T.POLYLINE_M;case 25:return T.POLYGON_M;case 28:return T.MULTI_POINT_M;default:return null}},T.prototype.isMeasureType=function(){return T.measureTypes.hasOwnProperty(this._shapeType)},T.prototype.isZType=function(){return T.zTypes.hasOwnProperty(this._shapeType)},T.prototype.isNullType=function(){return this._shapeType===T.NULL},T.prototype.isPointType=function(){return T.pointTypes.hasOwnProperty(this._shapeType)},T.prototype.isMultiPointType=function(){return T.multiPointTypes.hasOwnProperty(this._shapeType)},T.prototype.isPolylineType=function(){return T.polylineTypes.hasOwnProperty(this._shapeType)},T.prototype.isPolygonType=function(){return T.polygonTypes.hasOwnProperty(this._shapeType)},T.NULL="null",T.POINT="point",T.MULTI_POINT="multiPoint",T.POLYLINE="polyline",T.POLYGON="polygon",T.POINT_M=T.POINT+"M",T.MULTI_POINT_M=T.MULTI_POINT+"M",T.POLYLINE_M=T.POLYLINE+"M",T.POLYGON_M=T.POLYGON+"M",T.POINT_Z=T.POINT+"Z",T.MULTI_POINT_Z=T.MULTI_POINT+"Z",T.POLYLINE_Z=T.POLYLINE+"Z",T.POLYGON_Z=T.POLYGON+"Z",T.SHAPE_MULTI_PATCH="multiPatch",T.measureTypes={pointM:T.POINT_M,pointZ:T.POINT_Z,multiPointM:T.MULTI_POINT_M,multiPointZ:T.MULTI_POINT_Z,polylineM:T.POLYLINE_M,polylineZ:T.POLYLINE_Z,polygonM:T.POLYGON_M,polygonZ:T.POLYGON_Z},T.zTypes={pointZ:T.POINT_Z,multiPointZ:T.MULTI_POINT_Z,polylineZ:T.POLYLINE_Z,polygonZ:T.POLYGON_Z},T.pointTypes={point:T.POINT,pointZ:T.POINT_Z,pointM:T.POINT_M},T.multiPointTypes={multiPoint:T.MULTI_POINT,multiPointZ:T.MULTI_POINT_Z,multiPointM:T.MULTI_POINT_M},T.polylineTypes={polyline:T.POLYLINE,polylineZ:T.POLYLINE_Z,polylineM:T.POLYLINE_M},T.polygonTypes={polygon:T.POLYGON,polygonZ:T.POLYGON_Z,polygonM:T.POLYGON_M},T.FILE_CODE=9994,T}),n("layer/ShowTessellationLayer",["../shaders/BasicProgram","../layer/Layer"],function(e,t){"use strict";var n=function(){t.call(this,"Show Tessellation"),this.enableTerrainGeometry=!0,this.enableTerrainExtent=!1};return n.prototype=Object.create(t.prototype),n.prototype.doRender=function(e){try{this.beginRendering(e),this.enableTerrainGeometry&&this.drawTerrainGeometry(e),this.enableTerrainExtent&&this.drawTerrainExtent(e)}finally{this.endRendering(e)}},n.prototype.beginRendering=function(e){var t=e.currentGlContext;t.depthMask(!1)},n.prototype.endRendering=function(e){var t=e.currentGlContext;t.depthMask(!0)},n.prototype.drawTerrainGeometry=function(t){if(!t.terrain||!t.terrain.tessellator)return;var n=t.currentGlContext,r=t.terrain,i=r.tessellator,s=r.surfaceGeometry,o,u;try{o=t.findAndBindProgram(e),i.beginRendering(t);for(var a=0,f=s.length;a<f;a++)u=s[a],i.beginRenderingTile(t,u),o.loadColorComponents(n,1,1,1,.3),i.renderWireframeTile(t,u),o.loadColorComponents(n,1,0,0,.6),i.renderTileOutline(t,u),i.endRenderingTile(t,u)}finally{i.endRendering(t),t.bindProgram(null)}},n.prototype.drawTerrainExtent=function(e){var t=e.terrain.surfaceGeometry,n;for(var r=0,i=t.length;r<i;r++)n=t[r],n.extent.render(e)},n}),n("shapes/SurfaceEllipse",["../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceShape","../util/WWMath"],function(e,t,n,r,i,s,o){"use strict";var u=function(e,n,i,o,a){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"SurfaceEllipse","constructor","missingLocation"));if(n<0||i<0)throw new t(r.logMessage(r.LEVEL_SEVERE,"SurfaceEllipse","constructor","Radius is negative."));s.call(this,a),this._center=e,this._majorRadius=n,this._minorRadius=i,this._heading=o,this._intervals=u.DEFAULT_NUM_INTERVALS};return u.prototype=Object.create(s.prototype),Object.defineProperties(u.prototype,{center:{get:function(){return this._center},set:function(e){this.stateKeyInvalid=!0,this._center=e}},majorRadius:{get:function(){return this._majorRadius},set:function(e){this.stateKeyInvalid=!0,this._majorRadius=e}},minorRadius:{get:function(){return this._minorRadius},set:function(e){this.stateKeyInvalid=!0,this._minorRadius=e}},heading:{get:function(){return this._heading},set:function(e){this.stateKeyInvalid=!0,this._heading=e}},intervals:{get:function(){return this._intervals},set:function(e){this.stateKeyInvalid=!0,this._intervals=e}}}),u.staticStateKey=function(e){var t=s.staticStateKey(e);return t+" ce "+e.center.toString()+" ma "+e.majorRadius.toString()+" mi "+e.minorRadius.toString()+" he "+e.heading.toString()+" in "+e.intervals.toString()},u.prototype.computeStateKey=function(){return u.staticStateKey(this)},u.prototype.computeBoundaries=function(t){if(this.majorRadius==0&&this.minorRadius==0)return null;var r=t.globe,i=1+Math.max(u.MIN_NUM_INTERVALS,this.intervals),s=2*Math.PI/(i-1),a=r.radiusAt(this.center.latitude,this.center.longitude);this._boundaries=new Array(i);for(var f=0;f<i;f++){var l=f!=i-1?f*s:0,c=this.majorRadius*Math.cos(l),h=this.minorRadius*Math.sin(l),p=Math.sqrt(c*c+h*h),d=Math.PI/2-(Math.acos(c/p)*o.signum(h)-this.heading*e.DEGREES_TO_RADIANS);this._boundaries[f]=n.greatCircleLocation(this.center,d*e.RADIANS_TO_DEGREES,p/a,new n(0,0))}},u.MIN_NUM_INTERVALS=8,u.DEFAULT_NUM_INTERVALS=64,u}),n("shapes/SurfaceCircle",["../error/ArgumentError","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceEllipse"],function(e,t,n,r){"use strict";var i=function(n,i,s){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfaceCircle","constructor","missingLocation"));if(i<0)throw new e(t.logMessage(t.LEVEL_SEVERE,"SurfaceCircle","constructor","Radius is negative"));r.call(this,n,i,i,0,s),this._radius=i};return i.prototype=Object.create(r.prototype),Object.defineProperties(i.prototype,{radius:{get:function(){return this._radius},set:function(e){this.stateKeyInvalid=!0,this._radius=e}}}),i.staticStateKey=function(e){var t=r.staticStateKey(e);return t+" ra "+e.radius.toString()},i.prototype.computeStateKey=function(){return i.staticStateKey(this)},i}),n("shapes/SurfaceRectangle",["../geom/Angle","../error/ArgumentError","../geom/Location","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceShape","../util/WWMath"],function(e,t,n,r,i,s,o){"use strict";var u=function(e,n,i,o,u){if(!e)throw new t(r.logMessage(r.LEVEL_SEVERE,"SurfaceRectangle","constructor","missingLocation"));if(n<0||i<0)throw new t(r.logMessage(r.LEVEL_SEVERE,"SurfaceRectangle","constructor","Size is negative."));s.call(this,u),this._center=e,this._width=n,this._height=i,this._heading=o};return u.prototype=Object.create(s.prototype),Object.defineProperties(u.prototype,{center:{get:function(){return this._center},set:function(e){this.stateKeyInvalid=!0,this._center=e}},width:{get:function(){return this._width},set:function(e){this.stateKeyInvalid=!0,this._width=e}},height:{get:function(){return this._height},set:function(e){this.stateKeyInvalid=!0,this._height=e}},heading:{get:function(){return this._heading},set:function(e){this.stateKeyInvalid=!0,this._heading=e}}}),u.staticStateKey=function(e){var t=s.staticStateKey(e);return t+" ce "+e.center.toString()+" wi "+e.width.toString()+" he "+e.height.toString()+" hd "+e.heading.toString()},u.prototype.computeStateKey=function(){return u.staticStateKey(this)},u.prototype.computeBoundaries=function(e){var t=.5*this.width,n=.5*this.height,r=e.globe.radiusAt(this.center.latitude,this.center.longitude);this._boundaries=new Array(4),this.addLocation(0,-t,-n,r),this.addLocation(1,t,-n,r),this.addLocation(2,t,n,r),this.addLocation(3,-t,n,r)},u.prototype.addLocation=function(t,r,i,s){var u=Math.sqrt(r*r+i*i),a=Math.PI/2-(Math.acos(r/u)*o.signum(i)-this.heading*e.DEGREES_TO_RADIANS);this._boundaries[t]=n.greatCircleLocation(this.center,a*e.RADIANS_TO_DEGREES,u/s,new n(0,0))},u}),n("shapes/SurfaceSector",["../error/ArgumentError","../geom/Location","../util/Logger","../shapes/ShapeAttributes","../shapes/SurfaceShape"],function(e,t,n,r,i){"use strict";var s=function(t,r){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"SurfaceSector","constructor","missingSector"));i.call(this,r),this._sector=t};return s.prototype=Object.create(i.prototype),s.staticStateKey=function(e){var t=i.staticStateKey(e);return t},s.prototype.computeStateKey=function(){return s.staticStateKey(this)},s.prototype.computeBoundaries=function(e){var n=this._sector;this._boundaries=new Array(4),this._boundaries[0]=new t(n.minLatitude,n.minLongitude),this._boundaries[1]=new t(n.maxLatitude,n.minLongitude),this._boundaries[2]=new t(n.maxLatitude,n.maxLongitude),this._boundaries[3]=new t(n.minLatitude,n.maxLongitude)},s}),n("gesture/TapRecognizer",["../gesture/GestureRecognizer"],function(e){"use strict";var t=function(t,n){e.call(this,t,n),this.numberOfTaps=1,this.numberOfTouches=1,this.maxTouchMovement=20,this.maxTapDuration=500,this.maxTapInterval=400,this.taps=[],this.timeout=null};return t.prototype=Object.create(e.prototype),t.prototype.reset=function(){e.prototype.reset.call(this),this.taps=[],this.cancelFailAfterDelay()},t.prototype.mouseDown=function(e){if(this.state!=WorldWind.POSSIBLE)return;this.state=WorldWind.FAILED},t.prototype.touchStart=function(e){if(this.state!=WorldWind.POSSIBLE)return;var t;this.touchCount>this.numberOfTouches?this.state=WorldWind.FAILED:this.touchCount==1?(t={touchCount:this.touchCount,clientX:this.clientX,clientY:this.clientY},this.taps.push(t),this.failAfterDelay(this.maxTapDuration)):(t=this.taps[this.taps.length-1],t.touchCount=this.touchCount,t.clientX=this.clientX,t.clientY=this.clientY)},t.prototype.touchMove=function(e){if(this.state!=WorldWind.POSSIBLE)return;var t=this.translationX,n=this.translationY,r=Math.sqrt(t*t+n*n);r>this.maxTouchMovement&&(this.state=WorldWind.FAILED)},t.prototype.touchEnd=function(e){if(this.state!=WorldWind.POSSIBLE)return;if(this.touchCount!=0)return;var t=this.taps.length,n=this.taps[t-1];n.touchCount!=this.numberOfTouches?this.state=WorldWind.FAILED:t==this.numberOfTaps?(this.clientX=this.taps[0].clientX,this.clientY=this.taps[0].clientY,this.state=WorldWind.RECOGNIZED):this.failAfterDelay(this.maxTapInterval)},t.prototype.touchCancel=function(e){if(this.state!=WorldWind.POSSIBLE)return;this.state=WorldWind.FAILED},t.prototype.failAfterDelay=function(e){var t=this;t.timeout&&window.clearTimeout(t.timeout),t.timeout=window.setTimeout(function(){t.timeout=null,t.state==WorldWind.POSSIBLE&&(t.state=WorldWind.FAILED)},e)},t.prototype.cancelFailAfterDelay=function(){var e=this;e.timeout&&(window.clearTimeout(e.timeout),e.timeout=null)},t}),n("util/TileFactory",["../util/Logger","../error/UnsupportedOperationError"],function(e,t){"use strict";var n=function(){};return n.prototype.createTile=function(n,r,i,s){throw new t(e.logMessage(e.LEVEL_SEVERE,"TileFactory","createTile","abstractInvocation"))},n}),n("layer/ViewControlsLayer",["../geom/Angle","../error/ArgumentError","../layer/Layer","../geom/Location","../util/Logger","../util/Offset","../shapes/ScreenImage","../geom/Vec2","../util/WWUtil"],function(e,t,n,r,i,s,o,u,a){"use strict";var f=function(e){if(!e)throw new t(i.logMessage(i.LEVEL_SEVERE,"ViewControlsLayer","constructor","missingWorldWindow"));n.call(this,"View Controls"),this.wwd=e,this.placement=new s(WorldWind.OFFSET_FRACTION,0,WorldWind.OFFSET_FRACTION,0),this.alignment=new s(WorldWind.OFFSET_FRACTION,0,WorldWind.OFFSET_FRACTION,0),this.exaggerationIncrement=.01,this.zoomIncrement=.04,this.headingIncrement=1,this.tiltIncrement=1,this.fieldOfViewIncrement=.1,this.panIncrement=.001,this._inactiveOpacity=.5,this._activeOpacity=1;var r=new s(WorldWind.OFFSET_PIXELS,0,WorldWind.OFFSET_PIXELS,0),a=WorldWind.configuration.baseUrl+"images/view/";this.panControl=new o(r.clone(),a+"view-pan-64x64.png"),this.zoomInControl=new o(r.clone(),a+"view-zoom-in-32x32.png"),this.zoomOutControl=new o(r.clone(),a+"view-zoom-out-32x32.png"),this.headingLeftControl=new o(r.clone(),a+"view-heading-left-32x32.png"),this.headingRightControl=new o(r.clone(),a+"view-heading-right-32x32.png"),this.tiltUpControl=new o(r.clone(),a+"view-pitch-up-32x32.png"),this.tiltDownControl=new o(r.clone(),a+"view-pitch-down-32x32.png"),this.exaggerationUpControl=new o(r.clone(),a+"view-elevation-up-32x32.png"),this.exaggerationDownControl=new o(r.clone(),a+"view-elevation-down-32x32.png"),this.fovNarrowControl=new o(r.clone(),a+"view-fov-narrow-32x32.png"),this.fovWideControl=new o(r.clone(),a+"view-fov-wide-32x32.png"),this.fovNarrowControl.enabled=!1,this.fovWideControl.enabled=!1,this.controls=[this.panControl,this.zoomInControl,this.zoomOutControl,this.headingLeftControl,this.headingRightControl,this.tiltUpControl,this.tiltDownControl,this.exaggerationUpControl,this.exaggerationDownControl,this.fovNarrowControl,this.fovWideControl];for(var f=0;f<this.controls.length;f++)this.controls[f].imageOffset=r.clone(),this.controls[f].opacity=this._inactiveOpacity,this.controls[f]===this.panControl?this.controls[f].size=64:this.controls[f].size=32;this.panControlCenter=new u(0,0),this.isTouchDevice=!1,this.pickEnabled=!1,this.setupInteraction()};return f.prototype=Object.create(n.prototype),Object.defineProperties(f.prototype,{showPanControl:{get:function(){return this.panControl.enabled},set:function(e){this.panControl.enabled=e}},showZoomControl:{get:function(){return this.zoomInControl.enabled},set:function(e){this.zoomInControl.enabled=e,this.zoomOutControl.enabled=e}},showHeadingControl:{get:function(){return this.headingLeftControl.enabled},set:function(e){this.headingLeftControl.enabled=e,this.headingRightControl.enabled=e}},showTiltControl:{get:function(){return this.tiltUpControl.enabled},set:function(e){this.tiltUpControl.enabled=e,this.tiltDownControl.enabled=e}},showExaggerationControl:{get:function(){return this.exaggerationUpControl.enabled},set:function(e){this.exaggerationUpControl.enabled=e,this.exaggerationDownControl.enabled=e}},showFieldOfViewControl:{get:function(){return this.fovNarrowControl.enabled},set:function(e){this.fovNarrowControl.enabled=e,this.fovWideControl.enabled=e}},inactiveOpacity:{get:function(){return this._inactiveOpacity},set:function(e){this._inactiveOpacity=e;for(var t=0;t<this.controls.length;t++)this.controls[t].opacity=e}},activeOpacity:{get:function(){return this._activeOpacity},set:function(e){this._activeOpacity=e;for(var t=0;t<this.controls.length;t++)this.controls[t].opacity=e}}}),f.prototype.doRender=function(e){var t=0,n=64,r,i,s,o;this.inCurrentFrame=!1,this.showPanControl&&(t+=this.panControl.size,this.inCurrentFrame=!0),this.showZoomControl&&(t+=this.zoomInControl.size,this.inCurrentFrame=!0),this.showHeadingControl&&(t+=this.headingLeftControl.size,this.inCurrentFrame=!0),this.showTiltControl&&(t+=this.tiltDownControl.size,this.inCurrentFrame=!0),this.showExaggerationControl&&(t+=this.exaggerationDownControl.size,this.inCurrentFrame=!0),this.showFieldOfViewControl&&(t+=this.fovNarrowControl.size,this.inCurrentFrame=!0),i=this.placement.offsetForSize(e.navigatorState.viewport.width,e.navigatorState.viewport.height),r=this.alignment.offsetForSize(t,n),s=i[0]-r[0],o=i[1]-r[1],this.showPanControl&&(this.panControl.screenOffset.x=s,this.panControl.screenOffset.y=o,this.panControl.render(e),this.panControlCenter[0]=s+this.panControl.size/2,this.panControlCenter[1]=o+this.panControl.size/2,s+=this.panControl.size),this.showZoomControl&&(this.zoomOutControl.screenOffset.x=s,this.zoomOutControl.screenOffset.y=o,this.zoomInControl.screenOffset.x=s,this.zoomInControl.screenOffset.y=o+this.zoomOutControl.size,this.zoomOutControl.render(e),this.zoomInControl.render(e),s+=this.zoomOutControl.size),this.showHeadingControl&&(this.headingRightControl.screenOffset.x=s,this.headingRightControl.screenOffset.y=o,this.headingLeftControl.screenOffset.x=s,this.headingLeftControl.screenOffset.y=o+this.headingLeftControl.size,this.headingRightControl.render(e),this.headingLeftControl.render(e),s+=this.headingLeftControl.size),this.showTiltControl&&(this.tiltDownControl.screenOffset.x=s,this.tiltDownControl.screenOffset.y=o,this.tiltUpControl.screenOffset.x=s,this.tiltUpControl.screenOffset.y=o+this.tiltDownControl.size,this.tiltDownControl.render(e),this.tiltUpControl.render(e),s+=this.tiltDownControl.size),this.showExaggerationControl&&(this.exaggerationDownControl.screenOffset.x=s,this.exaggerationDownControl.screenOffset.y=o,this.exaggerationUpControl.screenOffset.x=s,this.exaggerationUpControl.screenOffset.y=o+this.exaggerationDownControl.size,this.exaggerationUpControl.render(e),this.exaggerationDownControl.render(e),s+=this.exaggerationDownControl.size),this.showFieldOfViewControl&&(this.fovNarrowControl.screenOffset.x=s,this.fovNarrowControl.screenOffset.y=o,this.fovWideControl.screenOffset.x=s,this.fovWideControl.screenOffset.y=o+this.fovNarrowControl.size,this.fovNarrowControl.render(e),this.fovWideControl.render(e))},f.prototype.setupInteraction=function(){var e=this.wwd,t=this,n=function(n){if(!t.enabled)return;if(t.isTouchDevice)return;var r,i;t.highlightedControl&&(t.highlight(t.highlightedControl,!1),t.wwd.redraw()),n.type&&n.type==="mouseup"&&n.which===1&&t.activeControl?(t.activeControl=null,t.activeOperation=null,n.preventDefault()):(t.activeOperation?(t.activeOperation.call(t,n,null),n.preventDefault()):(r=t.pickControl(e.canvasCoordinates(n.clientX,n.clientY)),i=t.determineOperation(n,r),i&&i.call(t,n,r)),t.handleHighlight(n,r),t.wwd.redraw())};e.addEventListener("mousedown",n),e.addEventListener("mouseup",n),e.addEventListener("mousemove",n),window.addEventListener("mouseup",n),window.addEventListener("mousemove",n);var r=function(n){this.isTouchDevice=!0;if(!t.enabled)return;t.highlightedControl&&(t.highlight(t.highlightedControl,!1),t.wwd.redraw());if(!n.type||n.type!=="touchend"&&n.type!=="touchcancel")if(t.activeOperation)t.activeOperation.call(t,n,null),n.preventDefault();else{var r,i=n.changedTouches.item(0),s;r=t.pickControl(e.canvasCoordinates(i.clientX,i.clientY)),s=t.determineOperation(n,r),s&&s.call(t,n,r)}else t.activeControl&&t.isCurrentTouch(n)&&(t.activeControl=null,t.activeOperation=null,n.preventDefault());t.handleHighlight(n,r),t.wwd.redraw()};e.addEventListener("touchstart",r),e.addEventListener("touchend",r),e.addEventListener("touchcancel",r),e.addEventListener("touchmove",r)},f.prototype.isControl=function(e){for(var t=0;t<this.controls.length;t++)if(this.controls[t]==e)return!0;return!1},f.prototype.pickControl=function(e){var t=e[0],n=this.wwd.canvas.height-e[1],r;for(var i=0;i<this.controls.length;i++){r=this.controls[i];if(r.enabled&&t>=r.screenOffset.x&&t<=r.screenOffset.x+r.size&&n>=r.screenOffset.y&&n<=r.screenOffset.y+r.size)return r}return null},f.prototype.determineOperation=function(e,t){var n=null;if(t&&t instanceof o)if(t===this.panControl)n=this.handlePan;else if(t===this.zoomInControl||t===this.zoomOutControl)n=this.handleZoom;else if(t===this.headingLeftControl||t===this.headingRightControl)n=this.handleHeading;else if(t===this.tiltUpControl||t===this.tiltDownControl)n=this.handleTilt;else if(t===this.exaggerationUpControl||t===this.exaggerationDownControl)n=this.handleExaggeration;else if(t===this.fovNarrowControl||t===this.fovWideControl)n=this.handleFov;return n},f.prototype.isCurrentTouch=function(e){for(var t=0;t<e.changedTouches.length;t++)if(e.changedTouches.item(t).identifier===this.currentTouchId)return!0;return!1},f.prototype.handlePan=function(t,n){if(t.type==="mousedown"||t.type==="mousemove")this.currentEventPoint=this.wwd.canvasCoordinates(t.clientX,t.clientY);else if(t.type==="touchstart"||t.type==="touchmove"){var i=t.changedTouches.item(0);this.currentEventPoint=this.wwd.canvasCoordinates(i.clientX,i.clientY)}if(t.type==="mousedown"&&t.which===1||t.type==="touchstart"){this.activeControl=n,this.activeOperation=this.handlePan,t.preventDefault(),t.type==="touchstart"&&(this.currentTouchId=t.changedTouches.item(0).identifier);var s=this,o=function(){if(s.activeControl){var t=s.panControlCenter[0]-s.currentEventPoint[0],n=s.panControlCenter[1]-(s.wwd.viewport.height-s.currentEventPoint[1]),i=s.wwd.navigator.lookAtLocation.latitude,u=s.wwd.navigator.lookAtLocation.longitude,a=s.panIncrement*(s.wwd.navigator.range/s.wwd.globe.radiusAt(i,u)),f=s.wwd.navigator.heading+Math.atan2(t,n)*e.RADIANS_TO_DEGREES,l=a*Math.sqrt(t*t+n*n);r.greatCircleLocation(s.wwd.navigator.lookAtLocation,f,-l,s.wwd.navigator.lookAtLocation),s.wwd.redraw(),setTimeout(o,50)}};setTimeout(o,50)}},f.prototype.handleZoom=function(e,t){if(e.type==="mousedown"&&e.which===1||e.type==="touchstart"){this.activeControl=t,this.activeOperation=this.handleZoom,e.preventDefault(),e.type==="touchstart"&&(this.currentTouchId=e.changedTouches.item(0).identifier);var n=this,r=function(){n.activeControl&&(n.activeControl===n.zoomInControl?n.wwd.navigator.range*=1-n.zoomIncrement:n.activeControl===n.zoomOutControl&&(n.wwd.navigator.range*=1+n.zoomIncrement),n.wwd.redraw(),setTimeout(r,50))};setTimeout(r,50)}},f.prototype.handleHeading=function(e,t){if(e.type==="mousedown"&&e.which===1||e.type==="touchstart"){this.activeControl=t,this.activeOperation=this.handleHeading,e.preventDefault(),e.type==="touchstart"&&(this.currentTouchId=e.changedTouches.item(0).identifier);var n=this,r=function(){n.activeControl&&(n.activeControl===n.headingLeftControl?n.wwd.navigator.heading+=n.headingIncrement:n.activeControl===n.headingRightControl&&(n.wwd.navigator.heading-=n.headingIncrement),n.wwd.redraw(),setTimeout(r,50))};setTimeout(r,50)}},f.prototype.handleTilt=function(e,t){if(e.type==="mousedown"&&e.which===1||e.type==="touchstart"){this.activeControl=t,this.activeOperation=this.handleTilt,e.preventDefault(),e.type==="touchstart"&&(this.currentTouchId=e.changedTouches.item(0).identifier);var n=this,r=function(){n.activeControl&&(n.activeControl===n.tiltUpControl?n.wwd.navigator.tilt=Math.max(0,n.wwd.navigator.tilt-n.tiltIncrement):n.activeControl===n.tiltDownControl&&(n.wwd.navigator.tilt=Math.min(90,n.wwd.navigator.tilt+n.tiltIncrement)),n.wwd.redraw(),setTimeout(r,50))};setTimeout(r,50)}},f.prototype.handleExaggeration=function(e,t){if(e.type==="mousedown"&&e.which===1||e.type==="touchstart"){this.activeControl=t,this.activeOperation=this.handleExaggeration,e.preventDefault(),e.type==="touchstart"&&(this.currentTouchId=e.changedTouches.item(0).identifier);var n=this,r=function(){n.activeControl&&(n.activeControl===n.exaggerationUpControl?n.wwd.verticalExaggeration+=n.exaggerationIncrement:n.activeControl===n.exaggerationDownControl&&(n.wwd.verticalExaggeration=Math.max(1,n.wwd.verticalExaggeration-n.exaggerationIncrement)),n.wwd.redraw(),setTimeout(r,50))};setTimeout(r,50)}},f.prototype.handleFov=function(e,t){if(e.type==="mousedown"&&e.which===1||e.type==="touchstart"){this.activeControl=t,this.activeOperation=this.handleFov,e.preventDefault(),e.type==="touchstart"&&(this.currentTouchId=e.changedTouches.item(0).identifier);var n=this,r=function(){n.activeControl&&(n.activeControl===n.fovWideControl?n.wwd.navigator.fieldOfView=Math.max(90,n.wwd.navigator.fieldOfView+n.fieldOfViewIncrement):n.activeControl===n.fovNarrowControl&&(n.wwd.navigator.fieldOfView=Math.min(0,n.wwd.navigator.fieldOfView-n.fieldOfViewIncrement)),n.wwd.redraw(),setTimeout(r,50))};setTimeout(r,50)}},f.prototype.handleHighlight=function(e,t){this.activeControl?this.highlight(this.activeControl,!0):t&&this.isControl(t)&&this.highlight(t,!0)},f.prototype.highlight=function(e,t){e.opacity=t?this._activeOpacity:this._inactiveOpacity,t?this.highlightedControl=e:this.highlightedControl=null},f}),n("ogc/WmsLayerCapabilities",["../error/ArgumentError","../util/Logger"],function(e,t){"use strict";var n=function(n,r){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsLayerCapabilities","constructor","Layer element is null or undefined."));this.parent=r,this.layers,this.name,this.title,this.abstract,this.keywordList,this.identifiers,this.metadataUrls,this.dataUrls,this.featureListUrls,this.assembleLayer(n)};return Object.defineProperties(n.prototype,{capability:{get:function(){var e=this;while(e&&e instanceof n)e=e.parent;return e}},queryable:{get:function(){return n.replace(this,"_queryable")}},cascaded:{get:function(){return n.replace(this,"_cascaded")}},opaque:{get:function(){return n.replace(this,"_opaque")}},noSubsets:{get:function(){return n.replace(this,"_noSubsets")}},fixedWidth:{get:function(){return n.replace(this,"_fixedWidth")}},fixedHeight:{get:function(){return n.replace(this,"_fixedHeight")}},styles:{get:function(){return n.accumulate(this,"_styles",[])}},crses:{get:function(){return n.accumulate(this,"_crses",[])}},srses:{get:function(){return n.accumulate(this,"_srses",[])}},geographicBoundingBox:{get:function(){return n.replace(this,"_geographicBoundingBox")}},latLonBoundingBox:{get:function(){return n.replace(this,"_latLonBoundingBox")}},boundingBoxes:{get:function(){return n.replace(this,"_boundingBoxes")}},dimensions:{get:function(){var e=[],t=this;while(t&&t instanceof n)t._dimensions&&t._dimensions.length>0&&t._dimensions.forEach(function(t){var n=t.name,r=!0;e.forEach(function(e){e.name===n&&(r=!1)}),r&&e.push(t)}),t=t.parent;return e.length>0?e:undefined}},extents:{get:function(){var e=[],t=this;while(t&&t instanceof n)t._extents&&t._extents.length>0&&t._extents.forEach(function(t){var n=t.name,r=!0;e.forEach(function(e){e.name===n&&(r=!1)}),r&&e.push(t)}),t=t.parent;return e.length>0?e:undefined}},attribution:{get:function(){return n.replace(this,"_attribution")}},authorityUrls:{get:function(){return n.accumulate(this,"_authorityUrls",[])}},minScaleDenominator:{get:function(){return n.replace(this,"_minScaleDenominator")}},maxScaleDenominator:{get:function(){return n.replace(this,"_maxScaleDenominator")}},scaleHint:{get:function(){return n.replace(this,"_scaleHint")}}}),n.accumulate=function(e,t,r){while(e&&e instanceof n){var i=e[t];if(i)for(var s=0;s<i.length;s++)r.push(i[s]);e=e.parent}return r.length>0?r:null},n.replace=function(e,t){while(e&&e instanceof n){var r=e[t];if(r)return r;e=e.parent}},n.prototype.assembleLayer=function(e){var t,r,i,s;r=e.getAttribute("queryable"),r&&(this._queryable=r==="1"||r==="true"),r=e.getAttribute("opaque"),r&&(this._opaque=r==="1"||r==="true"),r=e.getAttribute("noSubsets"),r&&(this._noSubsets=r==="1"||r==="true"),r=e.getAttribute("cascaded"),r&&(this._cascaded=parseInt("10")),r=e.getAttribute("fixedWidth"),r&&(this._fixedWidth=parseInt("10")),r=e.getAttribute("fixedHeight"),r&&(this._fixedHeight=parseInt("10"));var o=e.children||e.childNodes;for(i=0;i<o.length;i++){var u=o[i];if(u.localName==="Layer")this.layers||(this.layers=[]),this.layers.push(new n(u,this));else if(u.localName==="Name")this.name=u.textContent;else if(u.localName==="Title")this.title=u.textContent;else if(u.localName==="Abstract")this.abstract=u.textContent;else if(u.localName==="KeywordList"){this.keywordList=[],t=u.getElementsByTagName("Keyword");for(s=0;s<t.length;s++)this.keywordList.push(t[s].textContent)}else u.localName==="Style"?(this._styles||(this._styles=[]),this._styles.push(n.assembleStyle(u))):u.localName==="CRS"?(this._crses||(this._crses=[]),this._crses.push(u.textContent)):u.localName==="SRS"?(this._srses||(this._srses=[]),this._srses.push(u.textContent)):u.localName==="EX_GeographicBoundingBox"?this._geographicBoundingBox=n.assembleGeographicBoundingBox(u):u.localName==="LatLonBoundingBox"?this._geographicBoundingBox=n.assembleLatLonBoundingBox(u):u.localName==="BoundingBox"?(this._boundingBoxes||(this._boundingBoxes=[]),this._boundingBoxes.push(n.assembleBoundingBox(u))):u.localName==="Dimension"?(this._dimensions||(this._dimensions=[]),this._dimensions.push(n.assembleDimension(u))):u.localName==="Extent"?(this._extents||(this._extents=[]),this._extents.push(n.assembleDimension(u))):u.localName==="Attribution"?this._attribution=n.assembleAttribution(u):u.localName==="AuthorityURL"?(this._authorityUrls||(this._authorityUrls=[]),this._authorityUrls.push(n.assembleAuthorityUrl(u))):u.localName==="Identifier"?(this.identifiers||(this.identifiers=[]),this.identifiers.push(n.assembleIdentifier(u))):u.localName==="MetadataURL"?(this.metadataUrls||(this.metadataUrls=[]),this.metadataUrls.push(n.assembleMetadataUrl(u))):u.localName==="DataURL"?(this.dataUrls||(this.dataUrls=[]),this.dataUrls.push(n.assembleUrl(u))):u.localName==="FeatureListURL"?(this.featureListUrls||(this.featureListUrls=[]),this.featureListUrls.push(n.assembleUrl(u))):u.localName==="MinScaleDenominator"?this._minScaleDenominator=parseFloat(u.textContent):u.localName==="MaxScaleDenominator"?this._maxScaleDenominator=parseFloat(u.textContent):u.localName==="ScaleHint"&&(this._scaleHint={},this._scaleHint.min=n.getFloatAttribute(u,"min"),this._scaleHint.max=n.getFloatAttribute(u,"max"))}},n.assembleStyle=function(e){var t={},r=e.children||e.childNodes;for(var i=0;i<r.length;i++){var s=r[i];s.localName==="Name"?t.name=s.textContent:s.localName==="Title"?t.title=s.textContent:s.localName==="Abstract"?t.abstract=s.textContent:s.localName==="LegendURL"?(t.legendUrls||(t.legendUrls=[]),t.legendUrls.push(n.assembleLegendUrl(s))):s.localName==="StyleSheetURL"?t.styleSheetUrl=n.assembleUrl(s):s.localName==="StyleURL"&&(t.styleUrl=n.assembleUrl(s))}return t},n.assembleGeographicBoundingBox=function(e){var t={},n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var i=n[r];i.localName==="westBoundLongitude"?t.westBoundLongitude=parseFloat(i.textContent):i.localName==="eastBoundLongitude"?t.eastBoundLongitude=parseFloat(i.textContent):i.localName==="southBoundLatitude"?t.southBoundLatitude=parseFloat(i.textContent):i.localName==="northBoundLatitude"&&(t.northBoundLatitude=parseFloat(i.textContent))}return t},n.assembleLatLonBoundingBox=function(e){var t={};return t.minx=n.getFloatAttribute(e,"minx"),t.miny=n.getFloatAttribute(e,"miny"),t.maxx=n.getFloatAttribute(e,"maxx"),t.maxy=n.getFloatAttribute(e,"maxy"),t},n.assembleBoundingBox=function(e){var t={};return t.crs=e.getAttribute("CRS"),t.minx=n.getFloatAttribute(e,"minx"),t.miny=n.getFloatAttribute(e,"miny"),t.maxx=n.getFloatAttribute(e,"maxx"),t.maxy=n.getFloatAttribute(e,"maxy"),t.resx=n.getFloatAttribute(e,"resx"),t.resy=n.getFloatAttribute(e,"resy"),t},n.assembleDimension=function(e){var t={};return t.name=e.getAttribute("name"),t.units=e.getAttribute("units"),t.unitSymbol=e.getAttribute("unitSymbol"),t.default=e.getAttribute("default"),t.multipleValues=e.getAttribute("multipleValues"),t.multipleValues&&(t.multipleValues=t.multipleValues==="true"||t.multipleValues==="1"),t.nearestValue=e.getAttribute("nearestValue"),t.nearestValue&&(t.nearestValue=t.nearestValue==="true"||t.nearestValue==="1"),t.current=e.getAttribute("current"),t.current&&(t.current=t.current==="true"||t.current==="1"),t.content=e.textContent,t},n.assembleAttribution=function(e){var t={},r=e.children||e.childNodes;for(var i=0;i<r.length;i++){var s=r[i];s.localName==="Title"?t.title=s.textContent:s.localName==="OnlineResource"?t.url=s.getAttribute("xlink:href"):s.localName==="LogoUrul"&&(t.logoUrl=n.assembleLogoUrl(s))}return t},n.assembleAuthorityUrl=function(e){var t={};t.name=e.getAttribute("name");var n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var i=n[r];i.localName==="OnlineResource"&&(t.url=i.getAttribute("xlink:href"))}return t},n.assembleIdentifier=function(e){var t={};return t.authority=e.getAttribute("authority"),t.content=e.textContent,t},n.assembleMetadataUrl=function(e){var t={};t.type=e.getAttribute("type");var n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var i=n[r];i.localName==="Format"?t.format=i.textContent:i.localName==="OnlineResource"&&(t.url=i.getAttribute("xlink:href"))}return t},n.assembleLegendUrl=function(e){var t={};t.width=n.getIntegerAttribute(e,"width"),t.height=n.getIntegerAttribute(e,"height");var r=e.children||e.childNodes;for(var i=0;i<r.length;i++){var s=r[i];s.localName==="Format"?t.format=s.textContent:s.localName==="OnlineResource"&&(t.url=s.getAttribute("xlink:href"))}return t},n.assembleLogoUrl=function(e){var t={};t.width=n.getIntegerAttribute(e,"width"),t.height=n.getIntegerAttribute(e,"height");var r=e.children||e.childNodes;for(var i=0;i<r.length;i++){var s=r[i];s.localName==="Format"?t.format=s.textContent:s.localName==="OnlineResource"&&(t.url=s.getAttribute("xlink:href"))}return t},n.assembleUrl=function(e){var t={},n=e.children||e.childNodes;for(var r=0;r<n.length;r++){var i=n[r];i.localName==="Format"?t.format=i.textContent:i.localName==="OnlineResource"&&(t.url=i.getAttribute("xlink:href"))}return t},n.getIntegerAttribute=function(e,t){var n=e.getAttribute(t);return n?n=parseInt(n):n=undefined,n},n.getFloatAttribute=function(e,t){var n=e.getAttribute(t);return n?n=parseFloat(n):n=undefined,n},n}),n("ogc/WmsCapabilities",["../error/ArgumentError","../util/Logger","../ogc/WmsLayerCapabilities"],function(e,t,n){"use strict";var r=function(n){if(!n)throw new e(t.logMessage(t.LEVEL_SEVERE,"WmsCapabilities","constructor","No XML DOM specified."));this.assembleDocument(n)};return r.prototype.assembleDocument=function(e){var t,i=e.getElementsByTagName("WMS_Capabilities");if(i.length==0){i=e.getElementsByTagName("WMT_MS_Capabilities");if(i.length==0)return}var s=i[0];this.version=s.getAttribute("version"),this.updateSequence=s.getAttribute("updateSequence"),i=s.getElementsByTagName("Service");if(i.length>0){var o=i[0];this.service={capsDoc:this},this.service.title=r.getTag(o,"Title"),this.service.abstract=r.getTag(o,"Abstract"),i=o.getElementsByTagName("KeywordList");if(i.length>0){this.service.keywordList=[],i=i[0].getElementsByTagName("Keyword");for(t=0;t<i.length;t++)this.service.keywordList.push(i[t].textContent)}i=o.getElementsByTagName("OnlineResource"),i.length>0&&(this.service.onlineResource=i[0].getAttribute("xlink:href")),this.service.fees=r.getTag(o,"Fees"),this.service.accessConstraints=r.getTag(o,"AccessConstraints"),this.service.layerLimit=r.getTag(o,"LayerLimit"),i=o.getElementsByTagName("ContactInformation");if(i.length>0){var u=i[0];this.service.contactInformation={},i=u.getElementsByTagName("ContactPersonPrimary");if(i.length>0){var a=i[0];this.service.contactInformation.contactPersonPrimary={},this.service.contactInformation.contactPersonPrimary.contactPerson=r.getTag(a,"ContactPerson"),this.service.contactInformation.contactPersonPrimary.contactOrganization=r.getTag(a,"ContactOrganization")}this.service.contactInformation.contactPosition=r.getTag(u,"ContactPosition"),this.service.contactInformation.contactVoiceTelephone=r.getTag(u,"ContactVoiceTelephone"),this.service.contactInformation.contactFaxsimileTelephone=r.getTag(u,"ContactFacsimileTelephone"),this.service.contactInformation.contactEmailAddress=r.getTag(u,"ContactEmailAddress"),i=u.getElementsByTagName("ContactAddress");if(i.length>0){var f=i[0];this.service.contactInformation.contactAddress={},this.service.contactInformation.contactAddress.addressType=r.getTag(f,"AddressType"),this.service.contactInformation.contactAddress.address=r.getTag(f,"Address"),this.service.contactInformation.contactAddress.city=r.getTag(f,"City"),this.service.contactInformation.contactAddress.stateOrProvince=r.getTag(f,"StateOrProvince"),this.service.contactInformation.contactAddress.postCode=r.getTag(f,"PostCode"),this.service.contactInformation.contactAddress.country=r.getTag(f,"Country")}}}i=s.getElementsByTagName("Capability");if(i.length>0){this.capability={capsDoc:this};var l=i[0];i=l.getElementsByTagName("Request");if(i.length>0){var c=i[0];this.capability.request={},this.capability.request.getCapabilities=r.getRequestInfo(c,"GetCapabilities"),this.capability.request.getMap=r.getRequestInfo(c,"GetMap"),this.capability.request.getFeatureInfo=r.getRequestInfo(c,"GetFeatureInfo")}i=l.getElementsByTagName("Exception");if(i.length>0){this.capability.exception={},i=i[0].getElementsByTagName("Format");if(i.length>0){this.capability.exception.formats=[];for(t=0;t<i.length;t++)this.capability.exception.formats.push(i[t].textContent)}}this.capability.layers=[];var h=l.children||l.childNodes;for(var p=0;p<h.length;p++)h[p].localName==="Layer"&&this.capability.layers.push(new n(h[p],this.capability))}},r.assembleLayers=function(e,t){var r=[],i=e.children||e.childNodes;for(var s=0;s<i.length;s++)i[s].localName==="Layer"&&r.push(new n(i[s],t));return r},r.getTag=function(e,t){var n=e.children||e.childNodes;for(var r=0;r<n.length;r++)if(n[r].localName===t)return n[r].textContent},r.getRequestInfo=function(e,t){var n=e.getElementsByTagName(t);if(n.length>0){var r=n[0],i={};n=r.getElementsByTagName("Format");if(n.length>0){i.formats=[];for(var s=0;s<n.length;s++)i.formats.push(n[s].textContent)}return n=r.getElementsByTagName("DCPType"),n.length>0&&(n=n[0].getElementsByTagName("HTTP"),n.length>0&&(n=n[0].getElementsByTagName("Get"),n.length>0&&(n=n[0].getElementsByTagName("OnlineResource"),n.length>0&&(i.url=n[0].getAttribute("xlink:href"))))),i}return undefined},r}),n("layer/WmsLayer",["../error/ArgumentError","../geom/Location","../util/Logger","../geom/Sector","../layer/TiledImageLayer","../util/WmsUrlBuilder"],function(e,t,n,r,i,s){"use strict";var o=function(t){if(!t)throw new e(n.logMessage(n.LEVEL_SEVERE,"WmsLayer","constructor","No configuration specified."));var r=t.service+t.layerNames+t.styleNames;i.call(this,t.sector,t.levelZeroDelta,t.numLevels,t.format,r,t.size,t.size),this.displayName=t.title,this.pickEnabled=!1,this.urlBuilder=new s(t.service,t.layerNames,t.styleNames,t.version),t.coordinateSystem&&(this.urlBuilder.crs=t.coordinateSystem)};return o.prototype=Object.create(i.prototype),o.formLayerConfiguration=function(e){var n={title:e.title,version:e.capability.capsDoc.version},i=e.geographicBoundingBox||e.latLonBoundingBox;i&&i.westBoundLongitude?n.sector=new r(i.southBoundLatitude,i.northBoundLatitude,i.westBoundLongitude,i.eastBoundLongitude):i&&i.minx?n.sector=new r(i.miny,i.maxy,i.minx,i.maxx):n.sector=r.FULL_SPHERE,n.levelZeroDelta=new t(36,36),n.numLevels=19,n.size=256,n.layerNames=e.name;var s=e.capability.request.getMap,o=s.formats;o.indexOf("image/png")>=0?n.format="image/png":o.indexOf("image/jpeg")>=0?n.format="image/jpeg":o.indexOf("image/tiff")>=0?n.format="image/tiff":o.indexOf("image/gif")>=0&&(n.format="image/gif"),n.service=s.url;var u=e.crses;u||(u=e.srses);if(u)if(u.indexOf("EPSG:4326")>=0||u.indexOf("epsg:4326")>=0)n.coordinateSystem="EPSG:4326";else if(u.indexOf("CRS84")>=0||u.indexOf("CRS:84")>=0)n.coordinateSystem="CRS:84";return n},o}),n("WorldWindow",["./error/ArgumentError","./render/DrawContext","./globe/EarthElevationModel","./util/FrameStatistics","./globe/Globe","./globe/Globe2D","./util/GoToAnimator","./cache/GpuResourceCache","./util/Logger","./navigate/LookAtNavigator","./navigate/NavigatorState","./pick/PickedObjectList","./geom/Rectangle","./geom/Sector","./shapes/SurfaceShape","./shapes/SurfaceShapeTileBuilder","./globe/Terrain","./geom/Vec2"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g){"use strict";var y=function(s){function p(e){c.handleContextLost(e)}function d(e){c.handleContextRestored(e)}function v(e){c.handleRedrawEvent(e)}if(!window.WebGLRenderingContext)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","constructor","The specified canvas does not support WebGL."));var u=document.getElementById(s);if(!u)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","constructor","The specified canvas name is not in the document."));var l=this.createContext(u);this.drawContext=new t(l),this.eventListeners={},this.redrawRequested=!0,this.redrawRequestId=null,this.canvas=u,this.depthBits=l.getParameter(WebGLRenderingContext.DEPTH_BITS),this.viewport=new h(0,0,l.drawingBufferWidth,l.drawingBufferHeight),this.globe=new i(new n),this.layers=[],this.navigator=new f(this),this.verticalExaggeration=1,this.deepPicking=!1,this.subsurfaceMode=!1,this.surfaceOpacity=1,this.frameStatistics=new r,this.goToAnimator=new o(this),this._redrawCallbacks=[],this._orderedRenderingFilters=[function(e){c.declutter(e,1)},function(e){c.declutter(e,2)}],this.pixelScale=1;var c=this;this.canvas.addEventListener("webglcontextlost",p,!1),this.canvas.addEventListener("webglcontextrestored",d,!1),this.canvas.addEventListener(WorldWind.REDRAW_EVENT_TYPE,v,!1),window.addEventListener(WorldWind.REDRAW_EVENT_TYPE,v,!1),this.animationFrameLoop()};return Object.defineProperties(y.prototype,{orderedRenderingFilters:{get:function(){return this._orderedRenderingFilters}},redrawCallbacks:{get:function(){return this._redrawCallbacks}}}),y.prototype.canvasCoordinates=function(e,t){var n=this.canvas.getBoundingClientRect(),r=e-(n.left+this.canvas.clientLeft),i=t-(n.top+this.canvas.clientTop);return new g(r,i)},y.prototype.addEventListener=function(t,n){if(!t)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","addEventListener","missingType"));if(!n)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","addEventListener","missingListener"));var r=this,i=this.eventListeners[t];i||(i={listeners:[],callback:function(e){e.worldWindow=r;for(var t=0,n=i.listeners.length;t<n;t++)i.listeners[t](e)}},this.eventListeners[t]=i);var s=i.listeners.indexOf(n);s==-1&&(i.listeners.splice(0,0,n),i.listeners.length==1&&this.canvas.addEventListener(t,i.callback,!1))},y.prototype.removeEventListener=function(t,n){if(!t)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","removeEventListener","missingType"));if(!n)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","removeEventListener","missingListener"));var r=this.eventListeners[t];if(!r)return;var i=r.listeners.indexOf(n);i!=-1&&(r.listeners.splice(i,1),r.listeners.length==0&&this.canvas.removeEventListener(t,r.callback,!1))},y.prototype.redraw=function(){this.redrawRequested=!0},y.prototype.pick=function(t){if(!t)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","pick","missingPoint"));return this.drawContext.currentGlContext.isContextLost()?new c:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.pickPoint=t,this.drawFrame(),this.drawContext.objectsAtPickPoint)},y.prototype.pickTerrain=function(t){if(!t)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","pickTerrain","missingPoint"));return this.drawContext.currentGlContext.isContextLost()?new c:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.pickTerrainOnly=!0,this.drawContext.pickPoint=t,this.drawFrame(),this.drawContext.objectsAtPickPoint)},y.prototype.pickShapesInRegion=function(t){if(!t)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","pickShapesInRegion","missingRectangle"));return this.drawContext.currentGlContext.isContextLost()?new c:(this.resize(),this.resetDrawContext(),this.drawContext.pickingMode=!0,this.drawContext.regionPicking=!0,this.drawContext.pickRectangle=new h(t.x,this.canvas.height-t.y,t.width,t.height),this.drawFrame(),this.drawContext.objectsAtPickPoint)},y.prototype.createContext=function(e){var t={antialias:!1,stencil:!0},n=e.getContext("webgl",t);n||(n=e.getContext("experimental-webgl",t));var r=n.getContextAttributes();return this.hasStencilBuffer=r.stencil,n},y.prototype.handleContextLost=function(e){a.log(a.LEVEL_INFO,"WebGL context event: "+e.statusMessage),e.preventDefault(),this.drawContext.contextLost(),window.cancelAnimationFrame(this.redrawRequestId)},y.prototype.handleContextRestored=function(e){a.log(a.LEVEL_INFO,"WebGL context event: "+e.statusMessage),this.drawContext.contextRestored(),this.redraw(),this.animationFrameLoop()},y.prototype.handleRedrawEvent=function(e){this.redraw()},y.prototype.animationFrameLoop=function(){function t(){e.animationFrameLoop()}this.redrawIfNeeded();var e=this;this.redrawRequestId=window.requestAnimationFrame(t)},y.prototype.redrawIfNeeded=function(){this.resize();if(!this.redrawRequested)return;try{this.redrawRequested=!1,this.drawContext.previousRedrawTimestamp=this.drawContext.timestamp,this.callRedrawCallbacks(WorldWind.BEFORE_REDRAW),this.resetDrawContext(),this.drawFrame()}catch(e){a.logMessage(a.LEVEL_SEVERE,"WorldWindow","redrawIfNeeded","Exception occurred during redrawing.\n"+e.toString())}finally{this.callRedrawCallbacks(WorldWind.AFTER_REDRAW),this.drawContext.redrawRequested&&(this.redrawRequested=!0)}},y.prototype.resize=function(){var e=this.drawContext.currentGlContext,t=e.canvas.clientWidth*this.pixelScale,n=e.canvas.clientHeight*this.pixelScale;if(e.canvas.width!=t||e.canvas.height!=n)e.canvas.width=t,e.canvas.height=n,e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),this.viewport=new h(0,0,e.drawingBufferWidth,e.drawingBufferHeight),this.redrawRequested=!0},y.prototype.resetDrawContext=function(){this.globe.offset=0;var e=this.drawContext;e.reset(),e.globe=this.globe,e.layers=this.layers,e.navigatorState=this.navigator.currentState(),e.verticalExaggeration=this.verticalExaggeration,e.surfaceOpacity=this.surfaceOpacity,e.deepPicking=this.deepPicking,e.frameStatistics=this.frameStatistics,e.pixelScale=this.pixelScale,e.update()},y.prototype.drawFrame=function(){try{this.drawContext.frameStatistics.beginFrame(),this.beginFrame(),this.drawContext.globe.is2D()&&this.drawContext.globe.continuous?this.do2DContiguousRepaint():this.doNormalRepaint()}finally{this.endFrame(),this.drawContext.frameStatistics.endFrame()}},y.prototype.doNormalRepaint=function(){this.createTerrain(),this.clearFrame(),this.drawContext.pickingMode?this.drawContext.makePickFrustum()&&this.doPick():(this.doDraw(),this.subsurfaceMode&&this.hasStencilBuffer&&this.redrawSurface())},y.prototype.do2DContiguousRepaint=function(){this.createTerrain2DContiguous(),this.clearFrame(),this.drawContext.pickingMode?this.drawContext.makePickFrustum()&&this.pick2DContiguous():this.draw2DContiguous()},y.prototype.beginFrame=function(){var e=this.drawContext.currentGlContext;e.enable(WebGLRenderingContext.BLEND),e.enable(WebGLRenderingContext.CULL_FACE),e.enable(WebGLRenderingContext.DEPTH_TEST),e.blendFunc(WebGLRenderingContext.ONE,WebGLRenderingContext.ONE_MINUS_SRC_ALPHA),e.depthFunc(WebGLRenderingContext.LEQUAL),this.drawContext.pickingMode&&(this.drawContext.makePickFramebuffer(),this.drawContext.bindFramebuffer(this.drawContext.pickFramebuffer))},y.prototype.endFrame=function(){var e=this.drawContext.currentGlContext;e.disable(WebGLRenderingContext.BLEND),e.disable(WebGLRenderingContext.CULL_FACE),e.disable(WebGLRenderingContext.DEPTH_TEST),e.blendFunc(WebGLRenderingContext.ONE,WebGLRenderingContext.ZERO),e.depthFunc(WebGLRenderingContext.LESS),e.clearColor(0,0,0,1),this.drawContext.pickingMode&&this.drawContext.bindFramebuffer(null)},y.prototype.clearFrame=function(){var e=this.drawContext,t=e.currentGlContext;t.clearColor(e.clearColor.red,e.clearColor.green,e.clearColor.blue,e.clearColor.alpha),t.clear(WebGLRenderingContext.COLOR_BUFFER_BIT|WebGLRenderingContext.DEPTH_BUFFER_BIT)},y.prototype.doDraw=function(){this.drawContext.renderShapes=!0,this.subsurfaceMode&&this.hasStencilBuffer?(this.drawContext.currentGlContext.disable(WebGLRenderingContext.STENCIL_TEST),this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||(this.drawContext.currentGlContext.clear(WebGLRenderingContext.DEPTH_BUFFER_BIT|WebGLRenderingContext.STENCIL_BUFFER_BIT),this.drawContext.currentGlContext.enable(WebGLRenderingContext.STENCIL_TEST),this.drawContext.currentGlContext.stencilFunc(WebGLRenderingContext.ALWAYS,1,1),this.drawContext.currentGlContext.stencilOp(WebGLRenderingContext.REPLACE,WebGLRenderingContext.REPLACE,WebGLRenderingContext.REPLACE),this.drawOrderedRenderables(),this.drawContext.screenCreditController.drawCredits(this.drawContext))):(this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||this.drawOrderedRenderables(),this.drawContext.screenCreditController.drawCredits(this.drawContext))},y.prototype.redrawSurface=function(){this.drawContext.currentGlContext.stencilFunc(WebGLRenderingContext.EQUAL,1,1),this.drawContext.currentGlContext.stencilOp(WebGLRenderingContext.KEEP,WebGLRenderingContext.KEEP,WebGLRenderingContext.KEEP),this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!1),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext)},y.prototype.doPick=function(){this.drawContext.terrain&&this.drawContext.terrain.pick(this.drawContext),this.drawContext.pickTerrainOnly||(this.drawContext.surfaceShapeTileBuilder.clear(),this.drawLayers(!0),this.drawContext.surfaceShapeTileBuilder.doRender(this.drawContext),this.deferOrderedRendering||this.drawOrderedRenderables()),this.drawContext.pickTerrainOnly?this.resolveTerrainPick():this.drawContext.regionPicking?this.resolveRegionPick():this.resolveTopPick()},y.prototype.createTerrain=function(){var e=this.drawContext;e.terrain=this.globe.tessellator.tessellate(e),e.frameStatistics.setTerrainTileCount(e.terrain?e.terrain.surfaceGeometry.length:0)},y.prototype.makeCurrent=function(e){var t=this.drawContext;t.globe.offset=e,t.globeStateKey=t.globe.stateKey;switch(e){case-1:t.terrain=this.terrainLeft;break;case 0:t.terrain=this.terrainCenter;break;case 1:t.terrain=this.terrainRight}},y.prototype.createTerrain2DContiguous=function(){var e=this.drawContext;this.terrainCenter=null,e.globe.offset=0,e.globeStateKey=e.globe.stateKey,e.globe.intersectsFrustum(e.navigatorState.frustumInModelCoordinates)&&(this.terrainCenter=e.globe.tessellator.tessellate(e)),this.terrainRight=null,e.globe.offset=1,e.globeStateKey=e.globe.stateKey,e.globe.intersectsFrustum(e.navigatorState.frustumInModelCoordinates)&&(this.terrainRight=e.globe.tessellator.tessellate(e)),this.terrainLeft=null,e.globe.offset=-1,e.globeStateKey=e.globe.stateKey,e.globe.intersectsFrustum(e.navigatorState.frustumInModelCoordinates)&&(this.terrainLeft=e.globe.tessellator.tessellate(e))},y.prototype.draw2DContiguous=function(){var e="";this.terrainCenter&&(e+=" 0 ",this.makeCurrent(0),this.deferOrderedRendering=this.terrainLeft||this.terrainRight,this.doDraw()),this.terrainRight&&(e+=" 1 ",this.makeCurrent(1),this.deferOrderedRendering=this.terrainLeft||this.terrainLeft,this.doDraw()),this.deferOrderedRendering=!1,this.terrainLeft&&(e+=" -1 ",this.makeCurrent(-1),this.doDraw()),this.subsurfaceMode&&this.hasStencilBuffer&&(this.deferOrderedRendering=!0,this.terrainCenter&&(e+=" 0 ",this.makeCurrent(0),this.redrawSurface()),this.terrainRight&&(e+=" 1 ",this.makeCurrent(1),this.redrawSurface()),this.terrainLeft&&(e+=" -1 ",this.makeCurrent(-1),this.redrawSurface()))},y.prototype.pick2DContiguous=function(){this.terrainCenter&&(this.makeCurrent(0),this.deferOrderedRendering=this.terrainLeft||this.terrainRight,this.doPick()),this.terrainRight&&(this.makeCurrent(1),this.deferOrderedRendering=this.terrainLeft||this.terrainLeft,this.doPick()),this.deferOrderedRendering=!1,this.terrainLeft&&(this.makeCurrent(-1),this.doPick())},y.prototype.drawLayers=function(e){var t=Date.now(),n=this.drawContext,r=n.layers,i;n.accumulateOrderedRenderables=e;for(var s=0,o=r.length;s<o;s++){i=r[s];if(i){n.currentLayer=i;try{i.render(n)}catch(u){a.log(a.LEVEL_SEVERE,"Error while rendering layer "+i.displayName+".\n"+u.toString())}}}var f=Date.now();n.frameStatistics.layerRenderingTime=f-t},y.prototype.addLayer=function(e){this.layers.push(e)},y.prototype.removeLayer=function(e){if(!e)return;var t=-1;for(var n=0,r=this.layers.length;n<r;n++)if(this.layers[n]==e){t=n;break}t>=0&&this.layers.splice(t,1)},y.prototype.insertLayer=function(e,t){t&&this.layers.splice(e,0,t)},y.prototype.drawOrderedRenderables=function(){var e=Date.now(),t=this.drawContext,n;t.sortOrderedRenderables();if(this._orderedRenderingFilters)for(var r=0;r<this._orderedRenderingFilters.length;r++)this._orderedRenderingFilters[r](this.drawContext);t.orderedRenderingMode=!0;while(n=t.popOrderedRenderable())try{n.renderOrdered(t)}catch(i){a.logMessage(a.LEVEL_WARNING,"WorldWindow","drawOrderedRenderables","Error while rendering a shape:"+i.message)}t.orderedRenderingMode=!1,t.frameStatistics.orderedRenderingTime=Date.now()-e},y.prototype.resolveTopPick=function(){if(this.drawContext.objectsAtPickPoint.objects.length==0)return;var e=this.drawContext.objectsAtPickPoint,t=this.drawContext.readPickColor(this.drawContext.pickPoint),n=null,r=null;if(t){for(var i=0,s=e.objects.length;i<s;i++){var o=e.objects[i];o.isTerrain&&(r=o);if(o.color.equals(t)){o.isOnTop=!0,n=o;if(r)break}}this.drawContext.deepPicking||(e.clear(),n&&e.add(n),r&&r!=n&&e.add(r))}else e.clear()},y.prototype.resolveTerrainPick=function(){var e=this.drawContext.objectsAtPickPoint,t;for(var n=0,r=e.objects.length;n<r;n++){t=e.objects[n];if(t.isTerrain){t.isOnTop=!0;break}}},y.prototype.resolveRegionPick=function(){if(this.drawContext.objectsAtPickPoint.objects.length==0)return;var e=this.drawContext.objectsAtPickPoint,t=this.drawContext.readPickColors(this.drawContext.pickRectangle),n,r;for(var i=0,s=e.objects.length;i<s;i++){n=e.objects[i];if(!n)continue;var o=n.color.toByteString();r=t[o],r?n.isOnTop=!0:n.userObject instanceof d&&(e.objects.splice(i,1),i-=1)}},y.prototype.callRedrawCallbacks=function(e){for(var t=0,n=this._redrawCallbacks.length;t<n;t++)try{this._redrawCallbacks[t](this,e)}catch(r){a.log(a.LEVEL_SEVERE,"Exception calling redraw callback.\n"+r.toString())}},y.prototype.goTo=function(e,t){this.goToAnimator.goTo(e,t)},y.prototype.declutter=function(t,n){if(!n)throw new e(a.logMessage(a.LEVEL_SEVERE,"WorldWindow","declutter","Group ID is null, undefined or 0."));var r=[];for(var i=0;i<t.orderedRenderables.length;i++){var s=t.orderedRenderables[i].orderedRenderable;s.declutterGroup===n&&r.push(s)}var o=[];for(var u=0;u<r.length;u++){var f=r[u],l=f.screenBounds;l&&l.intersectsRectangles(o)?f.targetVisibility=0:(f.targetVisibility=1,l&&o.push(l))}},y}),n("WorldWind",["./error/AbstractError","./geom/Angle","./error/ArgumentError","./shaders/BasicProgram","./shaders/BasicTextureProgram","./layer/BingAerialLayer","./layer/BingAerialWithLabelsLayer","./layer/BingRoadsLayer","./layer/BingWMSLayer","./layer/BlueMarbleLayer","./layer/BMNGLandsatLayer","./layer/BMNGLayer","./layer/BMNGOneImageLayer","./layer/BMNGRestLayer","./geom/BoundingBox","./gesture/ClickRecognizer","./util/Color","./shapes/Compass","./layer/CompassLayer","./layer/CoordinatesDisplayLayer","./gesture/DragRecognizer","./render/DrawContext","./globe/EarthElevationModel","./globe/EarthRestElevationModel","./globe/ElevationModel","./util/Font","./util/FrameStatistics","./render/FramebufferTexture","./render/FramebufferTile","./render/FramebufferTileController","./geom/Frustum","./shapes/GeographicMesh","./projections/GeographicProjection","./shapes/GeographicText","./gesture/GestureRecognizer","./globe/Globe","./globe/Globe2D","./util/GoToAnimator","./shaders/GpuProgram","./cache/GpuResourceCache","./shaders/GpuShader","./util/HighlightController","./util/ImageSource","./render/ImageTile","./layer/LandsatRestLayer","./layer/Layer","./util/Level","./util/LevelRowColumnUrlBuilder","./util/LevelSet","./geom/Line","./geom/Location","./util/Logger","./navigate/LookAtNavigator","./geom/Matrix","./cache/MemoryCache","./cache/MemoryCacheListener","./layer/MercatorTiledImageLayer","./navigate/Navigator","./navigate/NavigatorState","./util/NominatimGeocoder","./error/NotYetImplementedError","./util/Offset","./layer/OpenStreetMapImageLayer","./gesture/PanRecognizer","./shapes/Path","./pick/PickedObject","./pick/PickedObjectList","./gesture/PinchRecognizer","./shapes/Placemark","./shapes/PlacemarkAttributes","./geom/Plane","./shapes/Polygon","./geom/Position","./projections/ProjectionEquirectangular","./projections/ProjectionMercator","./projections/ProjectionPolarEquidistant","./projections/ProjectionUPS","./geom/Rectangle","./render/Renderable","./layer/RenderableLayer","./gesture/RotationRecognizer","./shapes/ScreenImage","./shapes/ScreenText","./geom/Sector","./shapes/ShapeAttributes","./formats/shapefile/Shapefile","./layer/ShowTessellationLayer","./shapes/SurfaceImage","./shapes/SurfaceCircle","./shapes/SurfaceEllipse","./shapes/SurfacePolygon","./shapes/SurfacePolyline","./shapes/SurfaceRectangle","./shapes/SurfaceSector","./shapes/SurfaceShape","./shapes/SurfaceShapeTile","./shapes/SurfaceShapeTileBuilder","./render/SurfaceTile","./render/SurfaceTileRenderer","./shaders/SurfaceTileRendererProgram","./gesture/TapRecognizer","./globe/Terrain","./globe/TerrainTile","./globe/TerrainTileList","./globe/Tessellator","./shapes/Text","./shapes/TextAttributes","./render/TextSupport","./render/Texture","./render/TextureTile","./util/Tile","./layer/TiledImageLayer","./util/TileFactory","./gesture/TiltRecognizer","./gesture/Touch","./error/UnsupportedOperationError","./geom/Vec2","./geom/Vec3","./layer/ViewControlsLayer","./ogc/WmsCapabilities","./layer/WmsLayer","./ogc/WmsLayerCapabilities","./util/WmsUrlBuilder","./WorldWindow","./util/WWMath","./util/WWUtil","./globe/ZeroElevationModel"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt,yt,bt,wt,Et,St,xt,Tt,Nt,Ct,kt,Lt,At,Ot,Mt,_t,Dt,Pt,Ht,Bt,jt,Ft,It,qt,Rt,Ut,zt,Wt,Xt,Vt,$t,Jt,Kt,Qt,Gt,Yt,Zt,en,tn,nn,rn,sn,on,un,an,fn,ln,cn,hn,pn,dn,vn,mn,gn,yn,bn){"use strict";var wn={VERSION:"0.0.0",ABSOLUTE:"absolute",AFTER_REDRAW:"afterRedraw",BEFORE_REDRAW:"beforeRedraw",BEGAN:"began",CANCELLED:"cancelled",CHANGED:"changed",CLAMP_TO_GROUND:"clampToGround",EARTH_RADIUS:6371e3,EAST:"east",ENDED:"ended",FAILED:"failed",GREAT_CIRCLE:"greatCircle",LINEAR:"linear",MULTI_POINT:"multiPoint",NORTH:"north",NULL:"null",OFFSET_FRACTION:"fraction",OFFSET_INSET_PIXELS:"insetPixels",OFFSET_PIXELS:"pixels",POINT:"point",POLYLINE:"polyline",POLYGON:"polygon",POSSIBLE:"possible",RECOGNIZED:"recognized",REDRAW_EVENT_TYPE:"WorldWindRedraw",RELATIVE_TO_GLOBE:"relativeToGlobe",RELATIVE_TO_GROUND:"relativeToGround",RELATIVE_TO_SCREEN:"relativeToScreen",RHUMB_LINE:"rhumbLine",SOUTH:"south",WEST:"west"};return wn.AbstractError=e,wn.Angle=t,wn.ArgumentError=n,wn.BasicProgram=r,wn.BasicTextureProgram=i,wn.BingAerialLayer=s,wn.BingAerialWithLabelsLayer=o,wn.BingRoadsLayer=u,wn.BingWMSLayer=a,wn.BlueMarbleLayer=f,wn.BMNGLandsatLayer=l,wn.BMNGLayer=c,wn.BMNGOneImageLayer=h,wn.BMNGRestLayer=p,wn.BoundingBox=d,wn.ClickRecognizer=v,wn.Color=m,wn.Compass=g,wn.CompassLayer=y,wn.CoordinatesDisplayLayer=b,wn.DragRecognizer=w,wn.DrawContext=E,wn.EarthElevationModel=S,wn.EarthRestElevationModel=x,wn.ElevationModel=T,wn.Font=N,wn.FrameStatistics=C,wn.FramebufferTexture=k,wn.FramebufferTile=L,wn.FramebufferTileController=A,wn.Frustum=O,wn.GeographicMesh=M,wn.GeographicProjection=_,wn.GeographicText=D,wn.GestureRecognizer=P,wn.Globe=H,wn.Globe2D=B,wn.GoToAnimator=j,wn.GpuProgram=F,wn.GpuResourceCache=I,wn.GpuShader=q,wn.HighlightController=R,wn.ImageSource=U,wn.ImageTile=z,wn.LandsatRestLayer=W,wn.Layer=X,wn.Level=V,wn.LevelRowColumnUrlBuilder=$,wn.LevelSet=J,wn.Line=K,wn.Location=Q,wn.Logger=G,wn.LookAtNavigator=Y,wn.Matrix=Z,wn.MemoryCache=et,wn.MemoryCacheListener=tt,wn.MercatorTiledImageLayer=nt,wn.Navigator=rt,wn.NavigatorState=it,wn.NominatimGeocoder=st,wn.NotYetImplementedError=ot,wn.Offset=ut,wn.OpenStreetMapImageLayer=at,wn.PanRecognizer=ft,wn.Path=lt,wn.PickedObject=ct,wn.PickedObjectList=ht,wn.PinchRecognizer=pt,wn.Placemark=dt,wn.PlacemarkAttributes=vt,wn.Plane=mt,wn.Polygon=gt,wn.Position=yt,wn.ProjectionEquirectangular=bt,wn.ProjectionMercator=wt,wn.ProjectionPolarEquidistant=Et,wn.ProjectionUPS=St,wn.Rectangle=xt,wn.Renderable=Tt,wn.RenderableLayer=Nt,wn.RotationRecognizer=Ct,wn.ScreenText=Lt,wn.ScreenImage=kt,wn.Sector=At,wn.ShapeAttributes=Ot,wn.Shapefile=Mt,wn.ShowTessellationLayer=_t,wn.SurfaceImage=Dt,wn.SurfaceCircle=Pt,wn.SurfaceEllipse=Ht,wn.SurfacePolygon=Bt,wn.SurfacePolyline=jt,wn.SurfaceRectangle=Ft,wn.SurfaceSector=It,wn.SurfaceShape=qt,wn.SurfaceShapeTile=Rt,wn.SurfaceShapeTileBuilder=Ut,wn.SurfaceTile=zt,wn.SurfaceTileRenderer=Wt,wn.SurfaceTileRendererProgram=Xt,wn.TapRecognizer=Vt,wn.Terrain=$t,wn.TerrainTile=Jt,wn.TerrainTileList=Kt,wn.Tessellator=Qt,wn.Text=Gt,wn.TextAttributes=Yt,wn.TextSupport=Zt,wn.Texture=en,wn.TextureTile=tn,wn.Tile=nn,wn.TiledImageLayer=rn,wn.TileFactory=sn,wn.TiltRecognizer=on,wn.Touch=un,wn.UnsupportedOperationError=an,wn.Vec2=fn,wn.Vec3=ln,wn.ViewControlsLayer=cn,wn.WmsCapabilities=hn,wn.WmsLayer=pn,wn.WmsLayerCapabilities=dn,wn.WmsUrlBuilder=vn,wn.WWMath=gn,wn.WWUtil=yn,wn.WorldWindow=mn,wn.ZeroElevationModel=bn,wn.configuration={gpuCacheSize:25e7,baseUrl:yn.worldwindlibLocation()||yn.currentUrlSansFilePart()+"/../"},wn.BingMapsKey=null,window.WorldWind=wn,wn}),t("WorldWind")});